<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


  <meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">

<script>
    (function(){
        if(''){
            let localStoragePasswdKey = 'etcdçš„restfulæ¥å£' + '_last_passwd';
            let tryCnt = 0;
            function checkPassword(password) {
                password = password == null ? null : password.trim();
                if (password !== '') {
                    if (password != null) {
                        // å¦‚æœç”¨æˆ·ç‚¹å‡»äº†ç¡®è®¤è€Œä¸”å¯†ç é”™è¯¯çš„æ—¶å€™, å› ä¸ºå½“password == nullçš„æ—¶å€™è¯´æ˜ç”¨æˆ·ç‚¹äº†å–æ¶ˆ
                        alert('Error!');
                        if (++tryCnt < 3) {
                            password = prompt('Open Sesame');
                            checkPassword(password);
                            return;
                        }
                    }

                    // if (history.length > 1) {
                    //     alert('back!');
                    //     history.back();
                    // } else {
                        // alert('blankkkk!');
                    //     window.location.href = "about:blank";
                    // }
                    if (document.referrer) {
                        window.location.href = document.referrer;
                    } else {
                        window.location.href = "about:blank";; // fallback if no referrer
                    }

                } else {
                    localStorage.setItem(localStoragePasswdKey, password);
                }
            }

            var password_verify_on_local = false;
            const hostname = window.location.hostname;
            if (password_verify_on_local || (!(hostname === "localhost" || hostname === "127.0.0.1" || hostname === "::1" || hostname.startsWith("192")))) {
                const lspk = localStorage.getItem(localStoragePasswdKey) || "";
                if (lspk !== '') {
                    var password = prompt('Open Sesame');
                    checkPassword(password);
                }
            }
        }
    })();
</script>








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">





















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Etcd,">








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2">






<meta name="description" content=". . .">
<meta name="keywords" content="Etcd">
<meta property="og:type" content="article">
<meta property="og:title" content="etcdçš„restfulæ¥å£">
<meta property="og:url" content="https://hulinhong.com/etcd_api_note/index.html">
<meta property="og:site_name" content="ğŸš™">
<meta property="og:description" content=". . .">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2025-12-17T18:31:29.647Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="etcdçš„restfulæ¥å£">
<meta name="twitter:description" content=". . .">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":12,"scrollpercent":true,"onmobile":true,"dimmer":true,"body_content_height":0,"display_duration":150},
    local_search: {"enable":true,"trigger":"auto","top_n_per_article":1},
    fancybox: false,
    mediumzoom: true,
    darkmode_js: false,
    tabs: true,
    motion: {"enable":true,"async":false,"duration":188,"transition":{"header":"fadeIn","menu":"fadeIn","logo":"fadeIn","post_block_else":"fadeIn","post_header":"fadeIn","post_body":"fadeIn","coll_header":"fadeIn","footer":"fadeIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>








  <title>etcdçš„restfulæ¥å£ | ğŸš™</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ğŸš™</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ğŸ’¨ ğŸ’¨ ğŸ’¨</p>
      
  </div>

  <div class="menu-item sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div class="menu-item site-search">
    
  
  <div class="site-search-div">
    <button class="search-icon" id="search-button">
      <i class="fa fa-search"></i>
    </button>
    <input type="text" id="local-search-input" class="st-search-input">
    <i id="local-search-close">Ã—</i>
  </div>


<script type="text/javascript" id="local.search.active">
    {/* var inputArea       = document.querySelector("#local-search-input");
    inputArea.onclick   = function(){ getSearchFile(); this.focus(); }
    inputArea.onkeydown = function(){ if(event.keyCode == 13) return false } */}
</script>



  </div>
  <div id="local-search-result-pc" class="local-search-result-cls"></div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

       
    </ul>
  

  
    
  
</nav>



 </div>
    </header>

    <div id="local-search-result-mobile" class="local-search-result-cls"></div>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/etcd_api_note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">etcdçš„restfulæ¥å£</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-10T23:11:26+00:00">
                07-10-2019
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NP/" itemprop="url" rel="index">
                    <span itemprop="name">NP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            <div class="post-tags">
              
                <a href="/tags/Etcd/" rel="tag"><i class="fa fa-tag"></i> Etcd</a>
              
            </div>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/gevent_intro/" rel="next" title="geventæ€»ç»“">
                <i class="fa fa-chevron-left"></i> 
                <p class="post-nav-pre-next-title">
                  geventæ€»ç»“
                </p> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/http_safety_idempotence/" rel="prev" title="HTTPå®‰å…¨æ€§å’Œå¹‚ç­‰æ€§">
              <p class="post-nav-pre-next-title">
                  HTTPå®‰å…¨æ€§å’Œå¹‚ç­‰æ€§
              </p> 
              <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      

      
      

      
        <p><strong>. . .</strong><a id="more"></a></p>
<div id="cnblogs_post_body" class="blogpost-body"><h1>etcd apiæ¥å£</h1><br><p>ã€€ã€€åŸºæœ¬æ“ä½œapi: <a href="https://github.com/coreos/etcd/blob/6acb3d67fbe131b3b2d5d010e00ec80182be4628/Documentation/v2/api.md" target="_blank" rel="noopener">https://github.com/coreos/etcd/blob/6acb3d67fbe131b3b2d5d010e00ec80182be4628/Documentation/v2/api.md</a></p><br><p>ã€€ã€€é›†ç¾¤é…ç½®api:&nbsp;<a href="https://github.com/coreos/etcd/blob/6acb3d67fbe131b3b2d5d010e00ec80182be4628/Documentation/v2/members_api.md" target="_blank" rel="noopener">https://github.com/coreos/etcd/blob/6acb3d67fbe131b3b2d5d010e00ec80182be4628/Documentation/v2/members_api.md</a></p><br><p>ã€€ã€€é‰´æƒè®¤è¯api:&nbsp;<a href="https://github.com/coreos/etcd/blob/6acb3d67fbe131b3b2d5d010e00ec80182be4628/Documentation/v2/auth_api.md" target="_blank" rel="noopener">https://github.com/coreos/etcd/blob/6acb3d67fbe131b3b2d5d010e00ec80182be4628/Documentation/v2/auth_api.md</a></p><br><p>ã€€ã€€é…ç½®é¡¹ï¼š<a href="https://github.com/coreos/etcd/blob/master/Documentation/op-guide/configuration.md" target="_blank" rel="noopener">https://github.com/coreos/etcd/blob/master/Documentation/op-guide/configuration.md</a></p><br><p>ã€€ã€€</p><br><p>ã€€ã€€<a href="https://coreos.com/etcd/docs/latest/runtime-configuration.html" target="_blank" rel="noopener">https://coreos.com/etcd/docs/latest/runtime-configuration.html</a></p><br><p>ã€€ã€€<a href="https://coreos.com/etcd/docs/latest/clustering.html" target="_blank" rel="noopener">https://coreos.com/etcd/docs/latest/clustering.html</a></p><br><p>ã€€ã€€<a href="https://coreos.com/etcd/docs/latest/runtime-configuration.html" target="_blank" rel="noopener">https://coreos.com/etcd/docs/latest/runtime-configuration.html</a></p><br><p>ã€€ã€€<a href="https://coreos.com/etcd/docs/latest/" target="_blank" rel="noopener">https://coreos.com/etcd/docs/latest/</a></p><br><p>ã€€ã€€<a href="https://coreos.com/etcd/docs/latest/admin_guide.html#disaster-recovery" target="_blank" rel="noopener">https://coreos.com/etcd/docs/latest/admin_guide.html#disaster-recovery</a></p><br><p>ã€€ã€€é‡‡ç”¨æ ‡å‡†çš„restful æ¥å£ï¼Œæ”¯æŒhttp å’Œ https ä¸¤ç§åè®®ã€‚</p><br><h1>è¿è¡Œå•æœºetcdæœåŠ¡</h1><br><div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> ./bin/etcd</pre><br></div><br><p>&nbsp;</p><br><p>ã€€ç›‘å¬localhostå’Œä»IANAåˆ†é…çš„ç«¯å£ï¼Œ2379ç”¨äºåŒclienté€šè®¯ï¼Œ2389ç”¨äºserverä¸serverç›´æ¥çš„é€šè®¯ã€‚</p><br><p>&nbsp;</p><br><p><strong style="line-height: 1.5;">è·å–ç‰ˆæœ¬ &nbsp;/</strong>version</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> [root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/version | python -m json.tool</span><br><span style="color: #008080;">2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;">3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;">4</span> <span style="color: #800080;">100</span>    <span style="color: #800080;">44</span>  <span style="color: #800080;">100</span>    <span style="color: #800080;">44</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>  <span style="color: #800080;">14093</span>      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“ <span style="color: #800080;">22000</span><br><span style="color: #008080;">5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;">6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">etcdcluster</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">2.3.0</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">etcdserver</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">2.3.7</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">8</span> }</pre><br></div><br><p>&nbsp;&nbsp;</p><br><p><span style="line-height: 1.5;"><strong>etcd çš„åŸºæœ¬APIæ˜¯ä¸€ä¸ªåˆ†å±‚çš„keyç©ºé—´ã€‚keyç©ºé—´ç”±é€šå¸¸è¢«ç§°ä¸ºâ€nodesâ€ï¼ˆèŠ‚ç‚¹ï¼‰çš„keyså’Œç›®å½•ç»„æˆã€‚</strong></span></p><br><p><span style="line-height: 1.5;">å¯¹datastoreçš„è®¿é—®ï¼Œå³é€šè¿‡<strong> /version/keys</strong>&nbsp;ç«¯ç‚¹(endpoint) è®¿é—®keyç©ºé—´ã€‚</span></p><br><p><span style="line-height: 1.5;"><strong>1. PUT ä¸ºetcdå­˜å‚¨çš„é”®èµ‹å€¼ï¼Œ å³åˆ›å»º message é”®å€¼ï¼Œèµ‹å€¼ä¸ºâ€Hello worldâ€</strong></span></p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/message -X PUT -d value=â€Hello worldâ€ | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">119</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">102</span>  <span style="color: #800080;">100</span>    <span style="color: #800080;">17</span>  <span style="color: #800080;">38230</span>   <span style="color: #800080;">6371</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“ <span style="color: #800080;">51000</span><br><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">set</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">30</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/message</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">30</span><span style="color: #000000;">,<br></span><span style="color: #008080;">11</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">Hello world</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">12</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">13</span> }</pre><br></div><br><p>ã€€ã€€<strong>Response bodyè¿”å›å€¼ä¸­çš„ï¼š</strong></p><br><p>ã€€ã€€<strong>actionï¼š</strong> &nbsp; è¯·æ±‚æ¥å£è¿›è¡Œçš„åŠ¨ä½œåç§°ã€‚ é€šè¿‡ http &nbsp;PUTæ–¹æ³•ä¿®æ”¹node.keyçš„å€¼ï¼Œå¯¹åº”çš„actionå€¼ä¸ºï¼šâ€set&ldquo;ã€‚ &nbsp;PUTæ–¹æ³•ä¸­ï¼Œè¯·æ±‚bodyä¸­å­˜åœ¨ prevExist=trueæ—¶ï¼Œ actionä¸º<strong>updateï¼›</strong>&nbsp;prevExist=falseæ—¶ï¼Œactionä¸º<strong>createï¼›</strong>&nbsp;å…¶ä»–ä¸º<strong>set</strong>ã€‚</p><br><p>ã€€ã€€<strong>node.createIndex:</strong> &nbsp;etcdæ¯æ¬¡å˜åŒ–æ—¶åˆ›å»ºçš„ï¼Œå”¯ä¸€çš„ï¼Œå•è°ƒé€’å¢çš„ã€æ•´æ•°å€¼ä½œä¸ºç´¢å¼•ã€‚è¿™ä¸ªç‰¹å®šçš„ç´¢å¼•å€¼åæ˜ äº†åœ¨etcdçŠ¶æ€æˆå‘˜é‡Œåˆ›å»ºäº†ä¸€ä¸ªç»™å®škeyã€‚é™¤äº†ç”¨æˆ·è¯·æ±‚å¤–ï¼Œetcdå†…éƒ¨è¿è¡Œï¼ˆå¦‚å¯åŠ¨æœåŠ¡ï¼Œé‡å¯æœåŠ¡ã€é›†ç¾¤ä¿¡æ¯å˜åŒ–ï¼šæ·»åŠ ã€åˆ é™¤ã€åŒæ­¥æœåŠ¡ç­‰ï¼‰ä¹Ÿå¯èƒ½ä¼šå› ä¸ºå¯¹èŠ‚ç‚¹æœ‰å˜åŠ¨è€Œå¼•èµ·è¯¥å€¼çš„å˜åŒ–ã€‚æ‰€ä»¥å³ä½¿æˆ‘ä»¬é¦–æ¬¡è¯·æ±‚ï¼Œæ­¤å€¼ä¹Ÿä¸æ˜¯ä»1å¼€å§‹ã€‚<strong>updateã€get</strong>&nbsp;actionä¸å¼•èµ· node.createIndexå€¼çš„å˜åŒ–ã€‚</p><br><p>&nbsp;<span style="line-height: 1.5;">&nbsp; &nbsp; &nbsp;&nbsp;<strong>node.key:</strong> &nbsp;åœ¨</span><span style="line-height: 1.5;">è¯·æ±‚çš„HTTPè·¯å¾„ä¸­ï¼Œä½œä¸ºæ“ä½œå¯¹è±¡keyã€‚etcdä½¿ç”¨ä¸€ä¸ªç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼æ¥åæ˜ é”®å€¼å­˜å‚¨çš„å†…å®¹ï¼Œ å› æ­¤æ‰€æœ‰çš„keyéƒ½æ˜¯ä»¥&lsquo;/&rsquo;å¼€å§‹ ã€‚</span></p><br><p>&nbsp; &nbsp; &nbsp;<strong> node.modifiedIndex: &nbsp;</strong>åƒ&nbsp;<strong>node.createIndex, </strong>è¿™ä¸ªå±æ€§ä¹Ÿæ˜¯etcdçš„ç´¢å¼•ã€‚ å¼•èµ·è¿™ä¸ªå€¼å˜åŒ–çš„ActionsåŒ…æ‹¬ï¼š<strong>set</strong>ï¼Œ<strong>delete</strong>ï¼Œ<strong>update</strong>ï¼Œ<strong>create</strong>ï¼Œ<strong>compareAndSwap</strong> å’Œ <strong>compareAndDelete</strong>ã€‚å› ä¸º <strong>get </strong>å’Œ <strong>watchcommands </strong>åœ¨å­˜å‚¨ä¸­ä¸ä¿®æ”¹çŠ¶æ€ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªactionä¸ä¼šä¿®æ”¹mode.modifiedIndexå€¼ï¼Œ ä¹Ÿä¸ä¼šä¿®æ”¹ node.createIndexçš„å€¼ã€‚ é‡å¯æœåŠ¡ç­‰ä¹Ÿä¼šä¿®æ”¹æ­¤å±æ€§å€¼ã€‚</p><br><p><span style="line-height: 1.5;">&nbsp; &nbsp; &nbsp;&nbsp;</span><strong style="line-height: 1.5;">node.value: &nbsp;</strong>å¤„ç†å®Œè¯·æ±‚åçš„keyå€¼ã€‚ åœ¨ä¸Šé¢çš„å®ä¾‹ä¸­ï¼ŒæˆåŠŸè¯·æ±‚åï¼Œä¿®æ”¹èŠ‚ç‚¹çš„å€¼ä¸º Hello worldã€‚</p><br><p>&nbsp;</p><br><p>&nbsp; &nbsp; &nbsp; <strong>Response headerè¿”å›å€¼ä¸­ï¼š</strong></p><br><p>ã€€ã€€åœ¨responsesä¸­åŒ…æ‹¬ä¸€äº›çš„HTTP çš„headerséƒ¨ï¼Œåœ¨headerä¸­æä¾›äº†ä¸€äº›å…³äºetcdé›†ç¾¤çš„å…¨éƒ¨ä¿¡æ¯ï¼Œé›†ç¾¤æä¾›æœåŠ¡è¯·æ±‚ã€‚</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> X-Etcd-Cluster-<span style="color: #000000;">Id: 7e27652122e8b2ae<br></span><span style="color: #008080;">2</span> X-Etcd-Index: <span style="color: #800080;">93</span><br><span style="color: #008080;">3</span> X-Raft-Index: <span style="color: #800080;">223696</span><br><span style="color: #008080;">4</span> X-Raft-Term: <span style="color: #800080;">8</span></pre><br></div><br><p>&nbsp; &nbsp;<strong>ã€€</strong><strong>X-Etcd-Cluster-Id: &nbsp;</strong>etcd é›†ç¾¤idã€‚</p><br><p><strong>ã€€ã€€X-Etcd-Indexï¼šã€€ã€€&nbsp;</strong>å½“å‰etcdçš„ç´¢å¼•ï¼Œåƒå‰é¢çš„è§£é‡Šã€‚å½“åœ¨keyç©ºé—´è¿›è¡Œwatchæ—¶ï¼Œwatchå¼€å§‹æ—¶ï¼ŒX-Etcd-Indexæ˜¯å½“å‰etcdçš„ç´¢å¼•å€¼ï¼Œè¿™æ„å‘³ç€watchedäº‹ä»¶å¯èƒ½å‘ç”Ÿåœ¨X-Etcd-Indexä¹‹åã€‚</p><br><p><strong>ã€€ã€€X-Raft-Indexï¼šã€€ã€€ </strong>ä¸X-Etcd-Indexç´¢å¼•ç±»ä¼¼ï¼Œæ˜¯raftåè®®çš„ç´¢å¼•ã€‚</p><br><p><strong>ã€€ã€€X-Raft-Termï¼šã€€ã€€ &nbsp;</strong>æ˜¯ä¸€ä¸ªåœ¨é›†ç¾¤ä¸­å‘ç”Ÿmaster electionæ—¶ï¼Œå°†å¢é•¿çš„æ•´æ•°ã€‚å¦‚æœè¿™ä¸ªå€¼å¢é•¿çš„éå¸¸å¿«ï¼Œéœ€è¦è°ƒä¼˜è¿™ä¸ªelectionè¶…æ—¶ã€‚è¯¦è§&nbsp;<a href="https://github.com/coreos/etcd/blob/6acb3d67fbe131b3b2d5d010e00ec80182be4628/Documentation/v2/tuning.md" target="_blank" rel="noopener">tuning</a>&nbsp;éƒ¨åˆ†ã€‚</p><br><p>&nbsp;</p><br><p><strong style="line-height: 1.5;">2. GET æŸ¥è¯¢etcdæŸä¸ªé”®å­˜å‚¨çš„å€¼</strong></p><br><div class="cnblogs_code"><br><pre>[root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/message | python -m json.tool</span><br>  % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #800080;">100</span>   <span style="color: #800080;">102</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">102</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>  <span style="color: #800080;">64110</span>      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“<span style="color: #000000;">   99k<br>{<br>    </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">get</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br>    </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br>        </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">19</span><span style="color: #000000;">,<br>        </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/message</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br>        </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">19</span><span style="color: #000000;">,<br>        </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">Hello world</span><span style="color: #800000;">â€œ</span><span style="color: #000000;"><br>    }<br>}</span></pre><br></div><br><p>&nbsp;</p><br><p><strong>3. PUT ä¿®æ”¹é”®å€¼</strong>ï¼šä¸åˆ›å»ºæ–°å€¼å‡ ä¹ç›¸åŒï¼Œä½†æ˜¯åé¦ˆæ—¶ä¼šæœ‰ä¸€ä¸ª<code>prevNode</code>å€¼ååº”äº†ä¿®æ”¹å‰å­˜å‚¨çš„å†…å®¹ã€‚</p><br><p>ã€€ã€€<strong>-d value=xxxx</strong></p><br><div class="cnblogs_code"><br><pre>[root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/message -X PUT -d value=â€RECREATEâ€ | python -m json.tool</span><br>  % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #800080;">100</span>   <span style="color: #800080;">202</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">188</span>  <span style="color: #800080;">100</span>    <span style="color: #800080;">14</span>  <span style="color: #800080;">57108</span>   <span style="color: #800080;">4252</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“ <span style="color: #800080;">62666</span><span style="color: #000000;"><br>{<br>    </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">set</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br>    </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br>        </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">33</span><span style="color: #000000;">,<br>        </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/message</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br>        </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">33</span><span style="color: #000000;">,<br>        </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">RECREATE</span><span style="color: #800000;">â€œ</span><span style="color: #000000;"><br>    },<br>    </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">prevNode</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br>        </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">32</span><span style="color: #000000;">,<br>        </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/message</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br>        </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">32</span><span style="color: #000000;">,<br>        </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">Hello world</span><span style="color: #800000;">â€œ</span><span style="color: #000000;"><br>    }<br>}</span></pre><br></div><br><p>ã€€ã€€Responeä¸­æ–°çš„å­—æ®µ â€œprevNodeâ€, è¿™ä¸ªå­—æ®µè¡¨ç¤ºå½“å‰è¯·æ±‚å®Œæˆå‰çš„è¯·æ±‚èŠ‚ç‚¹çš„çŠ¶æ€ã€‚ prevNodeçš„æ ¼å¼ä¸nodeç›¸åŒï¼Œ åœ¨è®¿é—®çš„èŠ‚ç‚¹æ²¡æœ‰å‰é¢çŠ¶æ€æ—¶å°†è¢«å¿½ç•¥ã€‚</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p><strong>4. DELETE åˆ é™¤ä¸€ä¸ªå€¼&nbsp;</strong></p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/message -X DELETE | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">177</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">177</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>  <span style="color: #800080;">73261</span>      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“<span style="color: #000000;">  172k<br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">delete</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">19</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/message</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">29</span><br><span style="color: #008080;">11</span> <span style="color: #000000;">    },<br></span><span style="color: #008080;">12</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">prevNode</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;">13</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">19</span><span style="color: #000000;">,<br></span><span style="color: #008080;">14</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/message</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">15</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">28</span><span style="color: #000000;">,<br></span><span style="color: #008080;">16</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">test createIndex</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">17</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">18</span> }</pre><br></div><br><p>&nbsp;</p><br><p><strong>5. PUT å¯¹ä¸€ä¸ªé”®è¿›è¡Œå®šæ—¶åˆ é™¤</strong>ï¼šetcdä¸­å¯¹é”®è¿›è¡Œå®šæ—¶åˆ é™¤ï¼Œè®¾å®šä¸€ä¸ªttlå€¼ï¼Œå½“è¿™ä¸ªå€¼åˆ°æœŸæ—¶é”®å°±ä¼šè¢«åˆ é™¤ã€‚åé¦ˆçš„å†…å®¹ä¼šç»™å‡ºexpirationé¡¹å‘ŠçŸ¥è¶…æ—¶æ—¶é—´ï¼Œttlé¡¹å‘ŠçŸ¥è®¾å®šçš„æ—¶é•¿ã€‚</p><br><p>&nbsp; &nbsp; åœ¨è®¾å®šä¸€ä¸ªkeyæ—¶ï¼Œè®¾å®šå…¶ttlï¼ˆtime to live), ttlæ—¶é—´åï¼Œè‡ªåŠ¨åˆ é™¤ã€‚</p><br><p><strong>ã€€ã€€-d&nbsp;ttl=xxx</strong></p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/foo  -XPUT -d value=bar -d ttl=5 | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">159</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">144</span>  <span style="color: #800080;">100</span>    <span style="color: #800080;">15</span>  <span style="color: #800080;">60453</span>   <span style="color: #800080;">6297</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“ <span style="color: #800080;">72000</span><br><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">set</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">34</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">expiration</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">2016-04-23T12:01:57.992249507Z</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/foo</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">11</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">34</span><span style="color: #000000;">,<br></span><span style="color: #008080;">12</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">ttl</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">5</span><span style="color: #000000;">,<br></span><span style="color: #008080;">13</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">bar</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">14</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">15</span> }</pre><br></div><br><p>&nbsp;ã€€ã€€åœ¨repsonseä¸­æœ‰ä¸¤ä¸ªæ–°çš„å­—æ®µï¼š</p><br><p>ã€€ã€€expirationï¼škeyçš„æœ‰æ•ˆæˆªè‡³æ—¥æœŸã€‚ã€€ã€€</p><br><p>ã€€ã€€ttl:ã€€ã€€ &nbsp; &nbsp; &nbsp; keyçš„ttlå€¼ï¼Œå•ä½ç§’ã€‚</p><br><p>&nbsp; &nbsp; &nbsp;æ³¨æ„|ï¼š</p><br><p>ã€€ã€€ã€€ã€€keyåªæœ‰è¢«cluster headerè®¾å®šè¿‡æœŸï¼Œå¦‚æœä¸€ä¸ªmemeber è„±ç¦»çš„é›†ç¾¤ï¼Œå®ƒé‡Œé¢çš„keyå°†æ²¡æœ‰è¿‡æœŸï¼Œç›´åˆ°é‡æ–°åŠ å…¥åæ‰æœ‰è¿‡æœŸåŠŸèƒ½ã€‚</p><br><p>&nbsp;</p><br><p><strong>6. PUT å–æ¶ˆå®šæ—¶åˆ é™¤ä»»åŠ¡</strong></p><br><p><strong>ã€€ã€€-d ttl=</strong></p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/foo -XPUT -d value=bar -d ttl= -d prevExist=true | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">254</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">225</span>  <span style="color: #800080;">100</span>    <span style="color: #800080;">29</span>  <span style="color: #800080;">98944</span>  <span style="color: #800080;">12752</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“<span style="color: #000000;">  219k<br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">update</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">38</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/foo</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">39</span><span style="color: #000000;">,<br></span><span style="color: #008080;">11</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">bar</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">12</span> <span style="color: #000000;">    },<br></span><span style="color: #008080;">13</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">prevNode</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;">14</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">38</span><span style="color: #000000;">,<br></span><span style="color: #008080;">15</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">expiration</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">2016-04-23T12:07:05.415596297Z</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">16</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/foo</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">17</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">38</span><span style="color: #000000;">,<br></span><span style="color: #008080;">18</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">ttl</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">78</span><span style="color: #000000;">,<br></span><span style="color: #008080;">19</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">bar</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">20</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">21</span> }</pre><br></div><br><p>&nbsp;</p><br><p><strong>7. PUT åˆ·æ–°keyçš„ ttl&nbsp;</strong></p><br><p>ã€€ã€€ttl åˆ°åˆ é™¤keyå’Œé‡æ–°è®¾ç½®ttlï¼Œéƒ½ä¼šè§¦å‘watcherã€‚é€šè¿‡åœ¨è¯·æ±‚çš„bodyä¸­å¢åŠ <strong> refresh=true</strong>ï¼Œæ›´æ–°ttl(å¿…é¡»å­˜åœ¨)ï¼Œä¸å¼•èµ·è§¦å‘watcheräº‹ä»¶ã€‚</p><br><p><strong>ã€€ã€€-d refresh=true</strong></p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/message -XPUT -d ttl=100 -d refresh=true | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">304</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">284</span>  <span style="color: #800080;">100</span>    <span style="color: #800080;">20</span>  <span style="color: #800080;">46973</span>   <span style="color: #800080;">3307</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“ <span style="color: #800080;">56800</span><br><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">set</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">145</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">expiration</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">2016-12-28T06:58:20.426383304Z</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/message</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">11</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">145</span><span style="color: #000000;">,<br></span><span style="color: #008080;">12</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">ttl</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">100</span><span style="color: #000000;">,<br></span><span style="color: #008080;">13</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œâ€</span><br><span style="color: #008080;">14</span> <span style="color: #000000;">    },<br></span><span style="color: #008080;">15</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">prevNode</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;">16</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">144</span><span style="color: #000000;">,<br></span><span style="color: #008080;">17</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">expiration</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">2016-12-28T06:57:55.628682326Z</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">18</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/message</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">19</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">144</span><span style="color: #000000;">,<br></span><span style="color: #008080;">20</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">ttl</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">76</span><span style="color: #000000;">,<br></span><span style="color: #008080;">21</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œâ€</span><br><span style="color: #008080;">22</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">23</span> }</pre><br></div><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p><strong>8. GET å¯¹é”®å€¼ä¿®æ”¹è¿›è¡Œç›‘æ§</strong>ï¼šetcdæä¾›çš„è¿™ä¸ªAPIé€šè¿‡long polling(è½®è¯¢)è®©ç”¨æˆ·å¯ä»¥ç›‘æ§ä¸€ä¸ªå€¼æˆ–è€…é€’å½’å¼(<strong>recursive=true</strong> åœ¨url pathä¸­ä½œä¸ºå‚æ•°)åœ°ç›‘æ§ä¸€ä¸ªç›®å½•åŠå…¶å­ç›®å½•çš„å€¼ï¼Œå½“ç›®å½•æˆ–å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œetcdä¼šä¸»åŠ¨é€šçŸ¥ã€‚</p><br><p>ã€€ã€€<strong>ï¼Ÿwait=true &nbsp; &nbsp;ã€€ã€€ã€€ã€€</strong>ç›‘å¬å½“å‰èŠ‚ç‚¹</p><br><p><strong>&nbsp; &nbsp; &nbsp; ï¼Ÿrecursive=true</strong>&nbsp;ã€€ã€€ é€’å½’ç›‘å¬å½“å‰èŠ‚ç‚¹å’Œå­ç›®å½•</p><br><p>&nbsp; &nbsp; &nbsp; <strong>ï¼ŸwaitIndex=xxxã€€ã€€</strong> ç›‘å¬è¿‡å»å·²ç»å‘ç”Ÿçš„ã€‚è¿‡å»å€¼çš„æŸ¥è¯¢æˆ–ç›‘å¬ï¼Œ å¿…é€‰ä¸<strong>wait</strong>ä¸€èµ·ä½¿ç”¨ã€‚</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl <span style="color: #800000;">â€˜</span><span style="color: #800000;"><a href="http://127.0.0.1:2379/v2/keys/message?wait=true&amp;waitIndex=2230" target="_blank" rel="noopener">http://127.0.0.1:2379/v2/keys/message?wait=true&amp;waitIndex=2230</a></span><span style="color: #800000;">â€˜</span>  | python -<span style="color: #000000;">m json.tool<br></span><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">183</span>    <span style="color: #800080;">0</span>   <span style="color: #800080;">183</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>   131k      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“<span style="color: #000000;">  178k<br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">set</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">2230</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/message</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">2230</span><span style="color: #000000;">,<br></span><span style="color: #008080;">11</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">123</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">12</span> <span style="color: #000000;">    },<br></span><span style="color: #008080;">13</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">prevNode</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;">14</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">2229</span><span style="color: #000000;">,<br></span><span style="color: #008080;">15</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/message</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">16</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">2229</span><span style="color: #000000;">,<br></span><span style="color: #008080;">17</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">123</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">18</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">19</span> }</pre><br></div><br><p>&nbsp;</p><br><p><span style="line-height: 1.5;">ã€€ã€€watch ä¸€ä¸ªttlè‡ªåˆ é™¤çš„keyæ—¶ï¼Œæ”¶åˆ°å¦‚ä¸‹ &ldquo;expire&rdquo; actionã€‚</span></p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/message?wait=true | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">215</span>    <span style="color: #800080;">0</span>   <span style="color: #800080;">215</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>     <span style="color: #800080;">19</span>      <span style="color: #800080;">0</span> â€“:â€“:â€“  <span style="color: #800080;">0</span>:<span style="color: #800080;">00</span>:<span style="color: #800080;">10</span> â€“:â€“:â€“    <span style="color: #800080;">45</span><br><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">expire</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">2223</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/message</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">2224</span><br><span style="color: #008080;">11</span> <span style="color: #000000;">    },<br></span><span style="color: #008080;">12</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">prevNode</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;">13</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">2223</span><span style="color: #000000;">,<br></span><span style="color: #008080;">14</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">expiration</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">2016-12-28T09:25:00.028597482Z</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">15</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/message</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">16</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">2223</span><span style="color: #000000;">,<br></span><span style="color: #008080;">17</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œâ€</span><br><span style="color: #008080;">18</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">19</span> }</pre><br></div><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p><strong>9. GET å¯¹è¿‡å»çš„é”®å€¼æ“ä½œè¿›è¡ŒæŸ¥è¯¢</strong>ï¼šç±»ä¼¼ä¸Šé¢æåˆ°çš„ç›‘æ§ï¼Œåœ¨å…¶åŸºç¡€ä¸ŠæŒ‡å®šè¿‡å»æŸæ¬¡ä¿®æ”¹çš„ç´¢å¼•ç¼–å·ï¼Œå°±å¯ä»¥æŸ¥è¯¢å†å²æ“ä½œã€‚é»˜è®¤å¯æŸ¥è¯¢çš„å†å²è®°å½•ä¸º1000æ¡ã€‚</p><br><p><strong>ã€€ã€€ï¼Ÿ waitIndex=xxx &nbsp;&nbsp;</strong>ç›‘å¬è¿‡å»å·²ç»å‘ç”Ÿçš„ã€‚ è¿™ä¸ªåœ¨ç¡®ä¿åœ¨watchå‘½ä»¤ä¸­ï¼Œæ²¡æœ‰ä¸¢å¤±äº‹ä»¶éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼šæˆ‘ä»¬åå¤watch æˆ‘ä»¬å¾—åˆ°èŠ‚ç‚¹çš„ modifiedIndex+1ã€‚</p><br><p>ã€€ã€€å› ä¸º node çš„<strong>modifiedIndex</strong>çš„å€¼æ˜¯ä¸è¿ç»­ï¼Œå¦‚æœ<strong>waitIndex</strong>çš„å€¼æ²¡æœ‰ç›¸åº”<strong>modifiedIndexï¼Œè¿”å›æœ€å¤§çš„modifedIndex</strong>çš„èŠ‚ç‚¹ä¿¡æ¯<strong>ã€‚</strong>&nbsp;å¦‚æœå¤§äºèŠ‚ç‚¹ä¸­æ‰€æœ‰çš„<strong>modifiedIndex</strong>ï¼Œç­‰å¾…ï¼Œç›´åˆ°èŠ‚ç‚¹çš„modifiedIndexå€¼å¤§äºç­‰äºwaitIndexçš„å€¼ã€‚</p><br><p>ã€€ã€€å³ä½¿åˆ é™¤keyåï¼Œä¹Ÿå¯ä»¥æŸ¥è¯¢å†å²æ•°æ®ã€‚</p><br><p>ã€€ã€€storeä¸­æœ‰ä¸€ä¸ªå…¨å±€çš„currentIndexï¼Œæ¯æ¬¡å˜æ›´ï¼Œindexä¼šåŠ 1.ç„¶åæ¯ä¸ªeventéƒ½ä¼šå…³è”åˆ°currentIndex.</p><br><p>ã€€ã€€å½“å®¢æˆ·ç«¯è°ƒç”¨watchæ¥å£ï¼ˆå‚æ•°ä¸­å¢åŠ  waitå‚æ•°ï¼‰æ—¶ï¼Œå¦‚æœè¯·æ±‚å‚æ•°ä¸­æœ‰waitIndexï¼Œå¹¶ä¸”waitIndex å°äº currentIndexï¼Œåˆ™ä» EventHistroy è¡¨ä¸­æŸ¥è¯¢indexå°äºç­‰äºwaitIndexï¼Œå¹¶ä¸”å’Œwatch key åŒ¹é…çš„ eventï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›ã€‚å¦‚æœå†å²è¡¨ä¸­æ²¡æœ‰æˆ–è€…è¯·æ±‚æ²¡æœ‰å¸¦ ã€€ã€€waitIndexï¼Œåˆ™æ”¾å…¥WatchHubä¸­ï¼Œæ¯ä¸ªkeyä¼šå…³è”ä¸€ä¸ªwatcheråˆ—è¡¨ã€‚ å½“æœ‰å˜æ›´æ“ä½œæ—¶ï¼Œå˜æ›´ç”Ÿæˆçš„eventä¼šæ”¾å…¥EventHistroyè¡¨ä¸­ï¼ŒåŒæ—¶é€šçŸ¥å’Œè¯¥keyç›¸å…³çš„watcherã€‚</p><br><p><strong style="line-height: 1.5;">ã€€ã€€</strong><span style="line-height: 1.5;">æ³¨æ„ï¼š</span></p><br><p>ã€€ã€€ã€€ã€€1. å¿…é¡»ä¸ wait ä¸€èµ·ä½¿ç”¨ï¼›</p><br><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2. curl ä¸­urléœ€è¦ä½¿ç”¨å¼•å·ã€‚</p><br><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3. etcd ä»…ä»…ä¿ç•™ç³»ç»Ÿä¸­æ‰€æœ‰keyæœ€è¿‘çš„1000æ¡eventï¼Œå»ºè®®å°†è·å–åˆ°çš„responseå‘é€åˆ°å¦ä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼Œè€Œä¸æ˜¯å¤„ç†responseè€Œé˜»å¡watchã€‚</p><br><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4. å¦‚æœwatchè¶…å‡ºäº†etcdä¿å­˜çš„æœ€è¿‘1000æ¡ï¼Œå»ºè®®getåä½¿ç”¨response headerä¸­çš„&nbsp;<code>X-Etcd-Index</code>&nbsp;+ 1è¿›è¡Œé‡æ–°watchï¼Œè€Œä¸æ˜¯ä½¿ç”¨nodeä¸­çš„modifiedIndex+1. å› ä¸º &nbsp;<code>X-Etcd-Index</code>&nbsp; æ°¸è¿œå¤§äºç­‰äºmodifiedIndexï¼Œ ä½¿ç”¨modifiedIndexå¯èƒ½ä¼šè¿”å›401é”™è¯¯ç ï¼ŒåŒæ ·è¶…å‡ºã€‚</p><br><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5. long pollingå¯èƒ½ä¼šè¢«æœåŠ¡å™¨å…³é—­ï¼Œå¦‚è¶…æ—¶æˆ–æœåŠ¡å™¨å…³é—­ã€‚å¯¼è‡´ä»…ä»…æ”¶åˆ°header 200OKï¼Œbodyä¸ºç©ºï¼Œæ­¤æ—¶åº”é‡æ–°watchã€‚</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl <span style="color: #800000;">â€˜</span><span style="color: #800000;"><a href="http://127.0.0.1:2379/v2/keys/foo?wait=true&amp;waitIndex=2" target="_blank" rel="noopener">http://127.0.0.1:2379/v2/keys/foo?wait=true&amp;waitIndex=2</a></span><span style="color: #800000;">â€˜</span> | python -<span style="color: #000000;">m json.tool<br></span><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">144</span>    <span style="color: #800080;">0</span>   <span style="color: #800080;">144</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>   102k      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“<span style="color: #000000;">  140k<br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">set</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">34</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">expiration</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">2016-04-23T12:01:57.992249507Z</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/foo</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">11</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">34</span><span style="color: #000000;">,<br></span><span style="color: #008080;">12</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">ttl</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">5</span><span style="color: #000000;">,<br></span><span style="color: #008080;">13</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">bar</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">14</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">15</span> }</pre><br></div><br><p>&nbsp;å¦‚æœè¶…å‡ºäº†etcdä¿ç•™çš„æœ€è¿‘1000æ¡ï¼Œè¿”å› 401é”™è¯¯ç </p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl <span style="color: #800000;">â€˜</span><span style="color: #800000;"><a href="http://127.0.0.1:2379/v2/keys/message?wait=true&amp;waitIndex=8" target="_blank" rel="noopener">http://127.0.0.1:2379/v2/keys/message?wait=true&amp;waitIndex=8</a></span><span style="color: #800000;">â€˜</span> | python -<span style="color: #000000;">m json.tool<br></span><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">154</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">154</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>  <span style="color: #800080;">56163</span>      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“<span style="color: #000000;">  150k<br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">cause</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">the requested history has been cleared [1186/8]</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">errorCode</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">401</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 8</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">index</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">2185</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">message</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">The event in requested index is outdated and cleared</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">10</span> }</pre><br></div><br><p>&nbsp;</p><br><p><strong style="line-height: 1.5;">ã€€ã€€</strong></p><br><p><strong>10. PUT&nbsp;<strong>åˆ›å»ºç›®å½•</strong></strong></p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/dir -XPUT -d dir=true | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>    <span style="color: #800080;">95</span>  <span style="color: #800080;">100</span>    <span style="color: #800080;">87</span>  <span style="color: #800080;">100</span>     <span style="color: #800080;">8</span>  <span style="color: #800080;">21260</span>   <span style="color: #800080;">1955</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“ <span style="color: #800080;">29000</span><br><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">set</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">63</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">dir</span><span style="color: #800000;">â€œ</span>: <span style="color: #0000ff;">true</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/dir</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">11</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">63</span><br><span style="color: #008080;">12</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">13</span> }</pre><br></div><br><p>&nbsp;</p><br><p><strong>11. GET åˆ—å‡ºç›®å½•ä¸‹æ‰€æœ‰çš„èŠ‚ç‚¹ä¿¡æ¯</strong>ï¼Œæœ€åä»¥<code>/</code>ç»“å°¾(ä¸æ˜¯å¿…é¡»çš„)ã€‚è¿˜å¯ä»¥é€šè¿‡recursiveå‚æ•°é€’å½’åˆ—å‡ºæ‰€æœ‰å­ç›®å½•ä¿¡æ¯ã€‚ æ²¡æœ‰recursiveï¼Œè¿”å›ç¬¬äºŒçº§ã€‚åé¢ä¸åœ¨è¿”å›ã€‚</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/dir1/ | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">167</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">167</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>  <span style="color: #800080;">65234</span>      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“ <span style="color: #800080;">83500</span><br><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">get</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">67</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">dir</span><span style="color: #800000;">â€œ</span>: <span style="color: #0000ff;">true</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/dir1</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">11</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">67</span><span style="color: #000000;">,<br></span><span style="color: #008080;">12</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">nodes</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: [<br></span><span style="color: #008080;">13</span> <span style="color: #000000;">            {<br></span><span style="color: #008080;">14</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">67</span><span style="color: #000000;">,<br></span><span style="color: #008080;">15</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">dir</span><span style="color: #800000;">â€œ</span>: <span style="color: #0000ff;">true</span><span style="color: #000000;">,<br></span><span style="color: #008080;">16</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/dir1/dir2</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">17</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">67</span><br><span style="color: #008080;">18</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">        ]<br></span><span style="color: #008080;">20</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">21</span> }</pre><br></div><br><p>&nbsp;</p><br><p><strong>12. POST è‡ªåŠ¨åœ¨ç›®å½•ä¸‹åˆ›å»ºæœ‰åºé”®</strong>ã€‚åœ¨å¯¹åˆ›å»ºçš„ç›®å½•ä½¿ç”¨<code>POST</code>å‚æ•°ï¼Œä¼šè‡ªåŠ¨åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä»¥global etcd indexå€¼ä¸ºé”®çš„å€¼ï¼Œè¿™æ ·å°±ç›¸å½“äºæ ¹æ®åˆ›å»ºæ—¶é—´çš„å…ˆåè¿›è¡Œäº†ä¸¥æ ¼æ’åºã€‚<span style="background-color: #ffff00;"><strong>è¯¥APIå¯¹åˆ†å¸ƒå¼é˜Ÿåˆ—è¿™ç±»åœºæ™¯éå¸¸æœ‰ç”¨</strong></span>ã€‚</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/queue  -XPOST -d value=Job1 | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">127</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">117</span>  <span style="color: #800080;">100</span>    <span style="color: #800080;">10</span>  <span style="color: #800080;">31655</span>   <span style="color: #800080;">2705</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“ <span style="color: #800080;">39000</span><br><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">create</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">47</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/queue/00000000000000000047</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">47</span><span style="color: #000000;">,<br></span><span style="color: #008080;">11</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">Job1</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">12</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">13</span> }</pre><br></div><br><p>&nbsp;</p><br><p><strong>13. GET&nbsp;æŒ‰é¡ºåºåˆ—å‡ºæ‰€æœ‰åˆ›å»ºçš„æœ‰åºé”®</strong></p><br><p><strong>ã€€ã€€ï¼Ÿ sorted=true</strong></p><br><p><strong>ã€€ã€€<span class="pl-s">? recursive=true</span></strong></p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl -s <span style="color: #800000;">â€˜</span><span style="color: #800000;"><a href="http://127.0.0.1:2379/v2/keys/queue?sorted=true" target="_blank" rel="noopener">http://127.0.0.1:2379/v2/keys/queue?sorted=true</a></span><span style="color: #800000;">â€˜</span> | python -<span style="color: #000000;">m json.tool<br></span><span style="color: #008080;"> 2</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 3</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">get</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 4</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 5</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">46</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 6</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">dir</span><span style="color: #800000;">â€œ</span>: <span style="color: #0000ff;">true</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/queue</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">46</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">nodes</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: [<br></span><span style="color: #008080;">10</span> <span style="color: #000000;">            {<br></span><span style="color: #008080;">11</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">46</span><span style="color: #000000;">,<br></span><span style="color: #008080;">12</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/queue/00000000000000000046</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">13</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">46</span><span style="color: #000000;">,<br></span><span style="color: #008080;">14</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œâ€</span><br><span style="color: #008080;">15</span> <span style="color: #000000;">            },<br></span><span style="color: #008080;">16</span> <span style="color: #000000;">            {<br></span><span style="color: #008080;">17</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">47</span><span style="color: #000000;">,<br></span><span style="color: #008080;">18</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/queue/00000000000000000047</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">19</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">47</span><span style="color: #000000;">,<br></span><span style="color: #008080;">20</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">Job1</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">21</span> <span style="color: #000000;">            },<br></span><span style="color: #008080;">22</span> <span style="color: #000000;">            {<br></span><span style="color: #008080;">23</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">48</span><span style="color: #000000;">,<br></span><span style="color: #008080;">24</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/queue/00000000000000000048</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">25</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">48</span><span style="color: #000000;">,<br></span><span style="color: #008080;">26</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">aaaa</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">27</span> <span style="color: #000000;">            },<br></span><span style="color: #008080;">28</span> <span style="color: #000000;">            {<br></span><span style="color: #008080;">29</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">49</span><span style="color: #000000;">,<br></span><span style="color: #008080;">30</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/queue/00000000000000000049</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">31</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">49</span><span style="color: #000000;">,<br></span><span style="color: #008080;">32</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">aaaa</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">33</span> <span style="color: #000000;">            },<br></span><span style="color: #008080;">34</span> <span style="color: #000000;">            {<br></span><span style="color: #008080;">35</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">50</span><span style="color: #000000;">,<br></span><span style="color: #008080;">36</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/queue/00000000000000000050</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">37</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">50</span><span style="color: #000000;">,<br></span><span style="color: #008080;">38</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">aaaa</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">39</span> <span style="color: #000000;">            },<br></span><span style="color: #008080;">40</span> <span style="color: #000000;">            {<br></span><span style="color: #008080;">41</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">51</span><span style="color: #000000;">,<br></span><span style="color: #008080;">42</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/queue/00000000000000000051</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">43</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">51</span><span style="color: #000000;">,<br></span><span style="color: #008080;">44</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">aaaa</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">45</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">46</span> <span style="color: #000000;">        ]<br></span><span style="color: #008080;">47</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">48</span> }</pre><br></div><br><p>&nbsp;</p><br><p><strong>14. DELETE&nbsp;</strong><strong>åˆ é™¤ç›®å½•ï¼š</strong>é»˜è®¤æƒ…å†µä¸‹åªå…è®¸åˆ é™¤ç©ºç›®å½•ï¼Œå¦‚æœè¦åˆ é™¤æœ‰å†…å®¹çš„ç›®å½•éœ€è¦åŠ ä¸Š<code>recursive=true</code>å‚æ•°ã€‚</p><br><p><strong>ã€€ã€€ï¼Ÿdir=trueã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€åˆ é™¤ç›®å½•&nbsp;</strong></p><br><p><strong>ã€€ã€€ï¼Ÿrecursive=trueã€€ã€€ã€€ã€€ &nbsp;åˆ é™¤éç©ºç›®å½•</strong></p><br><p>&nbsp; &nbsp; &nbsp; åˆ é™¤éç©ºç›®å½•å¿…é¡»ä½¿ç”¨<strong> recursive=true</strong> å‚æ•°ï¼Œåˆ é™¤ç©ºç›®å½•ï¼Œ<strong>dir=true</strong>æˆ–<strong>recursive=trueè‡³å°‘æœ‰ä¸€ä¸ªã€‚</strong></p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl <span style="color: #800000;">â€˜</span><span style="color: #800000;"><a href="http://127.0.0.1:2379/v2/keys/dir1?dir=true" target="_blank" rel="noopener">http://127.0.0.1:2379/v2/keys/dir1?dir=true</a></span><span style="color: #800000;">â€˜</span> -XDELETE | python -<span style="color: #000000;">m json.tool<br></span><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>    <span style="color: #800080;">77</span>  <span style="color: #800080;">100</span>    <span style="color: #800080;">77</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>  <span style="color: #800080;">38557</span>      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“ <span style="color: #800080;">77000</span><br><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">cause</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/dir1</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">errorCode</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">108</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 8</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">index</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">67</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">message</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">Directory not empty</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">10</span> <span style="color: #000000;">}<br></span><span style="color: #008080;">11</span> [root@vStack ~]# curl <span style="color: #800000;">â€˜</span><span style="color: #800000;"><a href="http://127.0.0.1:2379/v2/keys/dir1?dir=true&amp;recursive=true" target="_blank" rel="noopener">http://127.0.0.1:2379/v2/keys/dir1?dir=true&amp;recursive=true</a></span><span style="color: #800000;">â€˜</span> -XDELETE | python -<span style="color: #000000;">m json.tool<br></span><span style="color: #008080;">12</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;">13</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;">14</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">166</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">166</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>  <span style="color: #800080;">62032</span>      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“ <span style="color: #800080;">83000</span><br><span style="color: #008080;">15</span> <span style="color: #000000;">{<br></span><span style="color: #008080;">16</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">delete</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">17</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;">18</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">67</span><span style="color: #000000;">,<br></span><span style="color: #008080;">19</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">dir</span><span style="color: #800000;">â€œ</span>: <span style="color: #0000ff;">true</span><span style="color: #000000;">,<br></span><span style="color: #008080;">20</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/dir1</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">21</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">68</span><br><span style="color: #008080;">22</span> <span style="color: #000000;">    },<br></span><span style="color: #008080;">23</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">prevNode</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;">24</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">67</span><span style="color: #000000;">,<br></span><span style="color: #008080;">25</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">dir</span><span style="color: #800000;">â€œ</span>: <span style="color: #0000ff;">true</span><span style="color: #000000;">,<br></span><span style="color: #008080;">26</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/dir1</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">27</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">67</span><br><span style="color: #008080;">28</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">29</span> }</pre><br></div><br><p>&nbsp;</p><br><p><strong>15. PUT åˆ›å»ºå®šæ—¶åˆ é™¤çš„ç›®å½•</strong>ï¼šå°±è·Ÿå®šæ—¶åˆ é™¤æŸä¸ªé”®ç±»ä¼¼ã€‚å¦‚æœç›®å½•å› ä¸ºè¶…æ—¶è¢«åˆ é™¤äº†ï¼Œå…¶ä¸‹çš„æ‰€æœ‰å†…å®¹ä¹Ÿè‡ªåŠ¨è¶…æ—¶åˆ é™¤ã€‚</p><br><p>&nbsp; &nbsp; &nbsp; å¦‚æœç›®å½•å­˜åœ¨ï¼Œåˆ›å»ºæ—¶ï¼Œè¿”å› 102 é”™è¯¯ç </p><br><p><strong>&nbsp; &nbsp; &nbsp; -d ttl=xx</strong></p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/dir  -XPUT -d ttl=30 -d dir=true | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">157</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">142</span>  <span style="color: #800080;">100</span>    <span style="color: #800080;">15</span>  <span style="color: #800080;">22873</span>   <span style="color: #800080;">2416</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“ <span style="color: #800080;">28400</span><br><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">set</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">52</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">dir</span><span style="color: #800000;">â€œ</span>: <span style="color: #0000ff;">true</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">expiration</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">2016-04-23T13:37:51.502289114Z</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">11</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/dir</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">12</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">52</span><span style="color: #000000;">,<br></span><span style="color: #008080;">13</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">ttl</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">30</span><br><span style="color: #008080;">14</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">15</span> }</pre><br></div><br><p>&nbsp;</p><br><p><strong>16. PUT è®¾ç½®åˆ·æ–°ç›®å½•è¶…æ—¶æ—¶é—´ &nbsp;&nbsp;</strong>å¼€å§‹åˆ›å»ºæ—¶ï¼Œæ²¡æœ‰è®¾ç½®ttlï¼Œ æˆ–åˆ·æ–°å·²è®¾ç½®ttlçš„ç›®å½•çš„ttlçš„å€¼ã€‚</p><br><p><strong>ã€€ã€€-d ttl=xxxã€€ã€€ã€€ã€€ã€€ è®¾ç½®æˆ–åˆ·æ–°çš„ttlå€¼ã€‚ ttlä¸ºç©ºæ˜¯ï¼Œå–æ¶ˆttlã€‚<br></strong></p><br><p><strong>ã€€ã€€-d prevExist=true &nbsp; &nbsp;å¿…é€‰å‚æ•°ï¼Œå¦è€…æŠ¥é”™102é”™è¯¯ç </strong></p><br><p>ã€€ã€€ä¼šè§¦å‘watcheräº‹ä»¶ã€‚</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/dir -XPUT -d ttl=30 -d dir=true -d prevExist=true | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">304</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">274</span>  <span style="color: #800080;">100</span>    <span style="color: #800080;">30</span>  <span style="color: #800080;">60392</span>   <span style="color: #800080;">6612</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“ <span style="color: #800080;">91333</span><br><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">update</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">56</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">dir</span><span style="color: #800000;">â€œ</span>: <span style="color: #0000ff;">true</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">expiration</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">2016-04-23T13:42:56.395923381Z</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">11</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/dir</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">12</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">61</span><span style="color: #000000;">,<br></span><span style="color: #008080;">13</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">ttl</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">30</span><br><span style="color: #008080;">14</span> <span style="color: #000000;">    },<br></span><span style="color: #008080;">15</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">prevNode</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;">16</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">56</span><span style="color: #000000;">,<br></span><span style="color: #008080;">17</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">dir</span><span style="color: #800000;">â€œ</span>: <span style="color: #0000ff;">true</span><span style="color: #000000;">,<br></span><span style="color: #008080;">18</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">expiration</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">2016-04-23T13:42:46.225222674Z</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">19</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/dir</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">20</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">56</span><span style="color: #000000;">,<br></span><span style="color: #008080;">21</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">ttl</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">20</span><br><span style="color: #008080;">22</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">23</span> }</pre><br></div><br><p>ã€€ã€€å½“ttlæ—¶é—´åˆ°åï¼Œwatcherå°†æ”¶åˆ°ä¸€ä¸ªâ€expireâ€ action.ã€€ã€€&nbsp;</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl  http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/dir?wait=true | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">207</span>    <span style="color: #800080;">0</span>   <span style="color: #800080;">207</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>     <span style="color: #800080;">16</span>      <span style="color: #800080;">0</span> â€“:â€“:â€“  <span style="color: #800080;">0</span>:<span style="color: #800080;">00</span>:<span style="color: #800080;">12</span> â€“:â€“:â€“    <span style="color: #800080;">43</span><br><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">expire</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">2219</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/dir</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">2220</span><br><span style="color: #008080;">11</span> <span style="color: #000000;">    },<br></span><span style="color: #008080;">12</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">prevNode</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;">13</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">2219</span><span style="color: #000000;">,<br></span><span style="color: #008080;">14</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">dir</span><span style="color: #800000;">â€œ</span>: <span style="color: #0000ff;">true</span><span style="color: #000000;">,<br></span><span style="color: #008080;">15</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">expiration</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">2016-12-28T09:22:35.853484071Z</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">16</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/dir</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">17</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">2219</span><br><span style="color: #008080;">18</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">19</span> }</pre><br></div><br><p>&nbsp;&nbsp;</p><br><p><strong>17. åˆ›å»ºä¸€ä¸ªéšè—èŠ‚ç‚¹</strong>ï¼šå‘½åæ—¶åå­—ä»¥ä¸‹åˆ’çº¿<code>_</code>å¼€å¤´çš„keyæˆ–ç›®å½•ï¼Œé»˜è®¤å°±æ˜¯éšè—é”®ã€‚</p><br><p><span style="line-height: 1.5;">&nbsp; &nbsp; &nbsp; listç›®å½•ä¸‹æ—¶ï¼Œå°†ä¸æ˜¾ç¤ºã€‚å¯ä»¥æ˜¾ç¤ºä½¿ç”¨ã€‚</span></p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]#  curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/keys/_message  -XPUT -d value=â€Hello hidden worldâ€ | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">134</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">110</span>  <span style="color: #800080;">100</span>    <span style="color: #800080;">24</span>  <span style="color: #800080;">46948</span>  <span style="color: #800080;">10243</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“<span style="color: #000000;">  107k<br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">action</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">set</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">node</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">createdIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">69</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">key</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">/_message</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">modifiedIndex</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">69</span><span style="color: #000000;">,<br></span><span style="color: #008080;">11</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">value</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">Hello hidden world</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">12</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">13</span> }</pre><br></div><br><p>&nbsp;&nbsp;</p><br><p>æ³¨æ„ï¼š</p><br><p>&nbsp; &nbsp; &nbsp; 1. api url åŒºåˆ†å¤§å°å†™ï¼ŒåŒ…æ‹¬å…¶ä¸­çš„å‚æ•°ã€‚&nbsp;</p><br><p>ã€€ã€€2. å¦‚æœkeyå­˜åœ¨ï¼Œé€šè¿‡ curl <a href="http://IP:PORT/v2/keys/message001&nbsp;-XPUT" target="_blank" rel="noopener">http://IP:PORT/v2/keys/message001&nbsp;-XPUT</a> -d dir=true , å°†ä¼šæŠŠkeyè°ƒæ•´ä¸ºdirå±æ€§ï¼Œvalueå€¼ä¸ºNoneï¼› å¢åŠ  -d prevExist=falseï¼Œå°†æŠ¥105é”™è¯¯ç ã€‚ ä¿®æ”¹ä¸ºdiråï¼Œæ— æ³•åœ¨æ¢å¤ä¸ºkeyã€‚</p><br><p>&nbsp; &nbsp; &nbsp;3. ä¸èƒ½å¯¹ä¸€ä¸ªdirè¿›è¡Œèµ‹å€¼ï¼Œå³&nbsp;curl <a href="http://127.0.0.1:2379/v2/keys/message001" target="_blank" rel="noopener">http://127.0.0.1:2379/v2/keys/message001</a> -XPUT -d value=123 &nbsp; &nbsp;ï¼Œ è¿”å›é”™è¯¯ç  102ï¼Œ &ldquo;Not a file&rdquo;</p><br><p>&nbsp; &nbsp; &nbsp;4. keyç›¸å½“äºæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶ï¼Œå¯ä»¥èµ‹å€¼å³å‘æ–‡ä»¶å†™å†…å®¹ã€‚dirç›¸å½“äºæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•æˆ–è·¯å¾„ï¼Œå†…å®¹åŒ…æ‹¬dirå’Œkeyï¼Œ å³æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•å’Œæ–‡ä»¶ã€‚</p><br><p>&nbsp; &nbsp; &nbsp;5. åœ¨api urlä¸­çš„pathï¼Œä½“ç°äº†å­˜å‚¨ç»“æ„ã€‚å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œç›´æ¥åˆ›å»ºã€‚å¦‚ï¼šcurl <a href="http://127.0.0.1:2379/v2/keys/fst/sec/thr" target="_blank" rel="noopener">http://127.0.0.1:2379/v2/keys/fst/sec/thr</a> -XPUT -d value=123 &nbsp;ä¸­çš„fstã€secä¼šè‡ªåŠ¨åˆ›å»ºä¸ºdirã€‚&nbsp;</p><br><p>&nbsp; &nbsp; &nbsp;6. åˆ›å»ºdirä¸keyçš„åŒºåˆ«ï¼Œå³åœ¨ curlçš„bodyä¸­æ˜¯å¦æœ‰ dir=trueï¼Œæœ‰å³ä¸ºdir,ã€€å¦è®¤åˆ™keyï¼› dirå­˜åœ¨æ—¶ï¼Œvalueæ— æ•ˆã€‚ åˆ›å»ºkeyæ—¶ï¼Œvalueå¯ä»¥ä¸å­˜åœ¨ã€‚</p><br><p>&nbsp; &nbsp; &nbsp;7. ä¸èƒ½åœ¨keyä¸‹åˆ›å»ºdiræˆ–å¯ä»¥ï¼Œå¦è€…æŠ¥é”™è¯¯ç ï¼š104ï¼Œ&ldquo;Not a directory&rdquo;</p><br><p>&nbsp; &nbsp; &nbsp;8. ç›®å½•ä¸èƒ½é‡å¤åˆ›å»ºï¼Œå³&nbsp;curl -v <a href="http://127.0.0.1:2379/v2/keys/message" target="_blank" rel="noopener">http://127.0.0.1:2379/v2/keys/message</a> -XPUT -d dir=true &nbsp;å¦‚æœ message ç›®å½•å·²ç»å·²ç»å­˜åœ¨ï¼Œè¿”å›é”™è¯¯ç ï¼š102ï¼Œ&nbsp;&ldquo;Not a file&rdquo;</p><br><p>&nbsp; &nbsp; &nbsp;9. åˆ é™¤ä¸€ä¸ªéç©ºç›®å½•ï¼Œè¿”å›é”™è¯¯ç ï¼š102. é€šè¿‡åœ¨urlä¸­å¢åŠ  recursive=true å‚æ•°ï¼Œå¯ä»¥å‚æ•°éç©ºç›®å½•ã€‚</p><br><h2>&nbsp;</h2><br><h2>Statistics &nbsp;ç»Ÿè®¡æ¥å£</h2><br><p>ã€€ã€€etcd é›†ç¾¤è®°å½•å¤§é‡çš„ç»Ÿè®¡æ•°æ®ï¼ŒåŒ…æ‹¬ï¼šå»¶æ—¶(latency)ï¼Œå¸¦å®½å’Œæ­£å¸¸è¿è¡Œæ—¶é—´ã€‚ç»Ÿè®¡åŠŸèƒ½é€šè¿‡ç»Ÿè®¡ç«¯ç‚¹(/stats)å»ç†è§£ä¸€ä¸ªé›†ç¾¤çš„å†…éƒ¨å¥åº·çŠ¶æ€ã€‚</p><br><p>ã€€ã€€An etcd cluster keeps track of a number of statistics including latency, bandwidth and uptime. These are exposed via the statistics endpoint to understand the internal health of a cluster.</p><br><h3>Leader Statistics é¢†å¯¼ç‚¹ç»Ÿè®¡</h3><br><p>&nbsp;</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@localhost testectd]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/stats/self | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">119</span>   <span style="color: #800080;">357</span>  <span style="color: #800080;">119</span>   <span style="color: #800080;">357</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>   274k      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“<span style="color: #000000;">  348k<br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">id</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">45b967575ff25cb2</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 7</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">leaderInfo</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">leader</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">45b967575ff25cb2</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;"> 9</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">startTime</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">2016-12-29T20:15:13.811259537+08:00</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">uptime</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">8m19.603722077s</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">11</span> <span style="color: #000000;">    },<br></span><span style="color: #008080;">12</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">name</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">infra0</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">13</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">recvAppendRequestCnt</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">18</span><span style="color: #000000;">,<br></span><span style="color: #008080;">14</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">sendAppendRequestCnt</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">3670</span><span style="color: #000000;">,<br></span><span style="color: #008080;">15</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">sendBandwidthRate</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">123950.52498801574</span><span style="color: #000000;">,<br></span><span style="color: #008080;">16</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">sendPkgRate</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">7.5456304767920797</span><span style="color: #000000;">,<br></span><span style="color: #008080;">17</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">startTime</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">2016-12-29T20:14:29.300999352+08:00</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">18</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">state</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">StateLeader</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">19</span> }</pre><br></div><br><p>&nbsp;</p><br><p>&nbsp;</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@localhost testectd]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/stats/leader | python -m json.tool </span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">132</span>   <span style="color: #800080;">398</span>  <span style="color: #800080;">132</span>   <span style="color: #800080;">398</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>   133k      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“<span style="color: #000000;">  388k<br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">followers</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 7</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">3c828782a67e0043</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 8</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">counts</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;"> 9</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">fail</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">1211</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">success</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">0</span><br><span style="color: #008080;">11</span> <span style="color: #000000;">            },<br></span><span style="color: #008080;">12</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">latency</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;">13</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">average</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">0</span><span style="color: #000000;">,<br></span><span style="color: #008080;">14</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">current</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">0</span><span style="color: #000000;">,<br></span><span style="color: #008080;">15</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">maximum</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">0</span><span style="color: #000000;">,<br></span><span style="color: #008080;">16</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">minimum</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">9.2233720368547758e+18</span><span style="color: #000000;">,<br></span><span style="color: #008080;">17</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">standardDeviation</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">0</span><br><span style="color: #008080;">18</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">        },<br></span><span style="color: #008080;">20</span>         <span style="color: #800000;">â€œ</span><span style="color: #800000;">b26f1b9a6c735437</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;">21</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">counts</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;">22</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">fail</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">0</span><span style="color: #000000;">,<br></span><span style="color: #008080;">23</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">success</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">3231</span><br><span style="color: #008080;">24</span> <span style="color: #000000;">            },<br></span><span style="color: #008080;">25</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">latency</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: {<br></span><span style="color: #008080;">26</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">average</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">0.0073246419065304607</span><span style="color: #000000;">,<br></span><span style="color: #008080;">27</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">current</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">0.0032520000000000001</span><span style="color: #000000;">,<br></span><span style="color: #008080;">28</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">maximum</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">1.713633</span><span style="color: #000000;">,<br></span><span style="color: #008080;">29</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">minimum</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">0.0012520000000000001</span><span style="color: #000000;">,<br></span><span style="color: #008080;">30</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;">standardDeviation</span><span style="color: #800000;">â€œ</span>: <span style="color: #800080;">0.035654606550540036</span><br><span style="color: #008080;">31</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">32</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">33</span> <span style="color: #000000;">    },<br></span><span style="color: #008080;">34</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">leader</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">45b967575ff25cb2</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">35</span> }</pre><br></div><br><p>&nbsp;</p><br><h2>Memeber API</h2><br><p><strong>1.&nbsp;List members</strong></p><br><p>ã€€ã€€è¿”å›http 200 OK responseï¼Œæ˜¾ç¤ºåœ¨ etcd é›†ç¾¤ä¸­çš„æ‰€æœ‰æˆå‘˜ã€‚</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.150:2379/v2/members | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">138</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">138</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>  <span style="color: #800080;">73287</span>      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“<span style="color: #000000;">  134k<br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">members</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: [<br></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">        {<br></span><span style="color: #008080;"> 8</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">clientURLs</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: [<br></span><span style="color: #008080;"> 9</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;"><a href="http://192.168.10.150:2379" target="_blank" rel="noopener">http://192.168.10.150:2379</a></span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">10</span> <span style="color: #000000;">            ],<br></span><span style="color: #008080;">11</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">id</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">8e9e05c52164694d</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">12</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">name</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">default</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">13</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">peerURLs</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: [<br></span><span style="color: #008080;">14</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;"><a href="http://localhost:2380" target="_blank" rel="noopener">http://localhost:2380</a></span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">15</span> <span style="color: #000000;">            ]<br></span><span style="color: #008080;">16</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">17</span> <span style="color: #000000;">    ]<br></span><span style="color: #008080;">18</span> }</pre><br></div><br><p>&nbsp;</p><br><div class="cnblogs_code"><br><pre>[root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2379/v2/members | python -m json.tool</span><br>  % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #800080;">100</span>   <span style="color: #800080;">181</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">181</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>   138k      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“<span style="color: #000000;">  176k<br>{<br>    </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">members</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: [<br>        {<br>            </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">clientURLs</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: [<br>                </span><span style="color: #800000;">â€œ</span><span style="color: #800000;"><a href="http://localhost:2379" target="_blank" rel="noopener">http://localhost:2379</a></span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br>                </span><span style="color: #800000;">â€œ</span><span style="color: #800000;"><a href="http://localhost:4001" target="_blank" rel="noopener">http://localhost:4001</a></span><span style="color: #800000;">â€œ</span><span style="color: #000000;"><br>            ],<br>            </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">id</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">ce2a822cea30bfca</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br>            </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">name</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">default</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br>            </span><span style="color: #800000;">â€œ</span><span style="color: #800000;">peerURLs</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: [<br>                </span><span style="color: #800000;">â€œ</span><span style="color: #800000;"><a href="http://localhost:2380" target="_blank" rel="noopener">http://localhost:2380</a></span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br>                </span><span style="color: #800000;">â€œ</span><span style="color: #800000;"><a href="http://localhost:7001" target="_blank" rel="noopener">http://localhost:7001</a></span><span style="color: #800000;">â€œ</span><span style="color: #000000;"><br>            ]<br>        }<br>    ]<br>}</span></pre><br></div><br><p>&nbsp;</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@vStack ~]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.150:2379/v2/members | python -m json.tool</span><br><span style="color: #008080;"> 2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;"> 4</span> <span style="color: #800080;">100</span>   <span style="color: #800080;">227</span>  <span style="color: #800080;">100</span>   <span style="color: #800080;">227</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>   116k      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“<span style="color: #000000;">  221k<br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #800000;">â€œ</span><span style="color: #800000;">members</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: [<br></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">        {<br></span><span style="color: #008080;"> 8</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">clientURLs</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: [],<br></span><span style="color: #008080;"> 9</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">id</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">755ef544f1926e2e</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">10</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">name</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œâ€</span><span style="color: #000000;">,<br></span><span style="color: #008080;">11</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">peerURLs</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: [<br></span><span style="color: #008080;">12</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;"><a href="http://127.0.0.1:2380" target="_blank" rel="noopener">http://127.0.0.1:2380</a></span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">13</span> <span style="color: #000000;">            ]<br></span><span style="color: #008080;">14</span> <span style="color: #000000;">        },<br></span><span style="color: #008080;">15</span> <span style="color: #000000;">        {<br></span><span style="color: #008080;">16</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">clientURLs</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: [<br></span><span style="color: #008080;">17</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;"><a href="http://192.168.10.150:2379" target="_blank" rel="noopener">http://192.168.10.150:2379</a></span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">18</span> <span style="color: #000000;">            ],<br></span><span style="color: #008080;">19</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">id</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">8e9e05c52164694d</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">20</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">name</span><span style="color: #800000;">â€œ</span>: <span style="color: #800000;">â€œ</span><span style="color: #800000;">default</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">,<br></span><span style="color: #008080;">21</span>             <span style="color: #800000;">â€œ</span><span style="color: #800000;">peerURLs</span><span style="color: #800000;">â€œ</span><span style="color: #000000;">: [<br></span><span style="color: #008080;">22</span>                 <span style="color: #800000;">â€œ</span><span style="color: #800000;"><a href="http://localhost:2380" target="_blank" rel="noopener">http://localhost:2380</a></span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">23</span> <span style="color: #000000;">            ]<br></span><span style="color: #008080;">24</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">25</span> <span style="color: #000000;">    ]<br></span><span style="color: #008080;">26</span> }</pre><br></div><br><p>&nbsp;</p><br><p><strong>2. Add a member</strong></p><br><p>ã€€ã€€æˆåŠŸæ—¶è¿”å› HTTP 201 response çŠ¶æ€ç ï¼ŒåŠæ–°å»ºå…¥æˆå‘˜çš„ä¿¡æ¯ï¼Œå¯¹æ–°åŠ å…¥çš„æˆå‘˜ç”Ÿæˆä¸€ä¸ªæˆå‘˜idã€‚ å¤±è´¥æ—¶ï¼Œè¿”å›å¤±è´¥çŠ¶æ€çš„å­—ç¬¦æè¿°ã€‚</p><br><p>ã€€ã€€</p><br><p>&nbsp;Returns an HTTP 201 response code and the representation of added member with a newly generated a memberID when successful. Returns a string describing the failure condition when unsuccessful.</p><br><p>If the POST body is malformed an HTTP 400 will be returned. If the member exists in the cluster or existed in the cluster at some point in the past an HTTP 409 will be returned. If any of the given peerURLs exists in the cluster an HTTP 409 will be returned. If the cluster fails to process the request within timeout an HTTP 500 will be returned, though the request may be processed later.</p><br><p>&nbsp;</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> curl http:<span style="color: #008000;">//</span><span style="color: #008000;">10.0.0.10:2379/v2/members -XPOST \</span><br><span style="color: #008080;">2</span> -H <span style="color: #800000;">â€œ</span><span style="color: #800000;">Content-Type: application/json</span><span style="color: #800000;">â€œ</span> -d <span style="color: #800000;">â€˜</span><span style="color: #800000;">{â€œpeerURLsâ€:[â€œ<a href="http://10.0.0.10:2380&quot;]}" target="_blank" rel="noopener">http://10.0.0.10:2380&quot;]}</a></span><span style="color: #800000;">â€˜</span></pre><br></div><br><p>&nbsp;</p><br><p>ã€€ã€€1.&nbsp;&nbsp;éœ€è¦åœ¨headerä¸­è®¾ç½®&nbsp;Content-Type: application/jsonï¼Œ å¦åˆ™ä¼šæŠ¥ 405 é”™è¯¯&nbsp;Unsupported Media Type</p><br><p>ã€€ã€€2. &nbsp;å¦‚æœå·²ç»å­˜åœ¨ç›¸åŒçš„peerURLsï¼Œç›´æ¥è¿”å›å½“å‰å­˜åœ¨ç›¸åŒpeerURLsçš„memberã€‚</p><br><p>&nbsp; &nbsp; &nbsp; 3.<span style="background-color: #ffff00;"> å¦‚æœæ·»åŠ ä¸€ä¸ªæ— æ³•ä½¿ç”¨çš„peerURLsï¼Œå¯¼è‡´æœåŠ¡æŒ‚æ‰ï¼Œæ— æ³•æ“ä½œã€‚é‡å¯ä¹Ÿæ— æ³•ä½¿ç”¨ã€‚è§£å†³æ–¹æ³•åˆ é™¤ç‰©ç†æ–‡ä»¶ï¼Œä½†è¿™ä¸ªä¼šåˆ é™¤è®°å½•çš„æ•°æ®ï¼Œå¯¼è‡´æŒä¹…æ•°æ®çš„å°±ä¸¢å¤±ã€‚éœ€è¦è¿›ä¸€æ­¥å¯»æ±‚è§£å†³æ–¹æ³•ã€‚</span></p><br><p><span style="background-color: #ffff00;">ã€€ã€€ã€€ é›†ç¾¤ä¿¡æ¯ä¼šè®°å½•åˆ°æŒä¹…åŒ–ä¿¡æ¯æ–‡ä»¶ä¸­ï¼Œé‡å¯é—®é¢˜ä¾æ—§ã€‚é™¤éä½¿ç”¨ä¸åŒçš„nameæˆ–æ”¹å˜æ•°æ®ç›®å½•ã€‚</span></p><br><p><span style="background-color: #ffff00;">ã€€ã€€</span></p><br><p>&nbsp;</p><br><p><strong>3. Delete a member</strong></p><br><p>ã€€ã€€ä»é›†ç¾¤ä¸­åˆ é™¤ä¸€ä¸ªmemeberã€‚ member ID å¿…é¡»æ˜¯ä¸€ä¸ª64ä½æ•´æ•°çš„16ä½ç¼–ç çš„å­—ç¬¦ä¸²ã€‚æˆåŠŸæ—¶ï¼Œè¿”å› 204 çŠ¶æ€ç å’Œæ²¡æœ‰å†…å®¹ã€‚å¤±è´¥æ—¶ï¼Œè¿”å›404çŠ¶æ€ç å’Œå­—ç¬¦æè¿°çš„å¤±è´¥æƒ…å†µã€‚<strong><br></strong></p><br><p>ã€€ã€€ä»é›†ç¾¤ä¸­åˆ é™¤ä¸€ä¸ªä¸å­˜åœ¨çš„memberï¼Œè¿”å›500é”™è¯¯ã€‚é›†ç¾¤å¤„ç†å¤±è´¥è¯·æ±‚ï¼ŒåŒ…æ‹¬è¶…æ—¶ï¼Œè¿”å›ä¸€ä¸ª500é”™è¯¯ç ã€‚å³ä½¿è¯·æ±‚å¯èƒ½åé¢ä¼šå¤„ç†ã€‚</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> [root@localhost testectd]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.150:2379/v2/members/2ae1ee131894262b -XDELETE | python -m json.tool</span><br><span style="color: #008080;">2</span>   % Total    % Received %<span style="color: #000000;"> Xferd  Average Speed   Time    Time     Time  Current<br></span><span style="color: #008080;">3</span> <span style="color: #000000;">                                 Dload  Upload   Total   Spent    Left  Speed<br></span><span style="color: #008080;">4</span>   <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>    <span style="color: #800080;">0</span>     <span style="color: #800080;">0</span>      <span style="color: #800080;">0</span>      <span style="color: #800080;">0</span> â€“:â€“:â€“ â€“:â€“:â€“ â€“:â€“:â€“     <span style="color: #800080;">0</span><br><span style="color: #008080;">5</span> No JSON <span style="color: #0000ff;">object</span> could be decoded</pre><br></div><br><p>&nbsp;</p><br><p><span style="line-height: 1.5;">ã€€ã€€1. åˆ é™¤æˆå‘˜åï¼Œetcdä½¿ç”¨çš„</span><span style="line-height: 1.5;">data-dirå¿…é¡»è¢«åˆ é™¤ã€‚å¦‚ä¸‹æ˜¯åˆ é™¤æœ€åä¸€ä¸ªmemberï¼Œetcdç»™å‡ºçš„è¾“å‡ºï¼ŒæœåŠ¡é€€å‡ºã€‚</span></p><br><p>ã€€ã€€ã€€ã€€2016-12-29 16:10:59.544409 E | etcdserver: the member has been permanently removed from the cluster</p><br><p>ã€€ã€€ã€€ã€€2016-12-29 16:10:59.544480 I | etcdserver: the data-dir used by this member must be removed.</p><br><p>ã€€ã€€2. é€šè¿‡etcdctl åˆ é™¤ä¸€ä¸ªæˆå‘˜åï¼ŒæœåŠ¡ä¼šé€€å‡ºã€‚é€šè¿‡ etcdctlé‡æ–°åŠ å…¥ï¼Œæ˜¾ç¤ºä¸ºunstartã€‚ã€€</p><br><p>ã€€ã€€ã€€å¦‚æœéœ€è¦é‡æ–°åŠ å…¥é›†ç¾¤ï¼Œå…ˆç”¨å‘½ä»¤åŠ å…¥ï¼Œå†å¯åŠ¨ï¼Œå¦åˆ™å¯åŠ¨æ—¶æŠ¥&nbsp;<strong>the member has been permanently removed from the cluster</strong></p><br><p>ã€€ã€€ã€€åŠ å…¥åï¼Œå¯åŠ¨å‰ï¼Œéœ€è¦åˆ é™¤å…¶å­˜å‚¨çš„æ•°æ®(<strong><span style="background-color: #ffcc00;">member idå‘ç”Ÿäº†æ”¹å˜ï¼Œä¼šå°†ä½¿ç”¨ç£ç›˜è®°å½•çš„idï¼Œä¸æ–°åŠ å…¥çš„IDä¸ä¸€è‡´</span></strong>)ã€‚å¹¶è®¾ç½®&nbsp;â€“initial-cluster-state <strong>existing ä¸èƒ½è®¾ç½®ä¸º new</strong></p><br><p><strong style="line-height: 1.5;">ã€€ã€€ã€€</strong><span style="line-height: 1.5;">æ³¨æ„ clusterç‰ˆæœ¬è¦ä¸€è‡´ã€‚cluster</span><span style="line-height: 1.5;">{â€œetcdserverâ€:â€3.0.15â€,â€etcdclusterâ€:â€3.0.0â€} å¯ä»¥ã€‚</span></p><br><p>&nbsp;ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€{â€œetcdserverâ€:â€2.3.7â€,â€etcdclusterâ€:â€2.3.0â€}</p><br><p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€å‡ºç°ï¼š&nbsp;{â€œetcdserverâ€:â€3.0.15â€,â€etcdclusterâ€:â€2.3.0â€} &nbsp;åœ¨é›†ç¾¤ç³»ç»Ÿä¸­å‡ºç°ä¸åŒç‰ˆæœ¬çš„member</p><br><p>ã€€ã€€ã€€ä»¥ä¸Šåˆ é™¤é‡æ–°åŠ å…¥çš„æ“ä½œï¼Œé«˜ç‰ˆæœ¬çš„å¯ä»¥ï¼Œå•ä½ç‰ˆæœ¬çš„ä¸æ”¯æŒï¼ŒæŠ¥&nbsp; <span style="background-color: #ffcc00;"><strong>failed to find member 3c828782a67e0043 in cluster 34b660d543ad1445 æ— æ³•å‘ç°å…¶ä»–member</strong></span></p><br><p>&nbsp;</p><br><p><span style="background-color: #ffcc00;"><strong><span style="background-color: #ffffff;">&nbsp;ã€€ã€€</span><br></strong></span></p><br><p>ã€€ &nbsp;</p><br><p>&nbsp; &nbsp; &nbsp; &nbsp; å³ åœ¨é›†ç¾¤ä¸­ï¼Œæˆå‘˜çš„ç‰ˆæœ¬ä¸åŒã€‚<strong>ä½ç‰ˆæœ¬</strong>çš„æˆå‘˜å¤±è´¥é€€å‡ºï¼Œé‡å¯å¯åŠ¨å¯ä»¥é‡æ–°åŠ å…¥é›†ç¾¤ã€‚<span style="color: #ff0000; background-color: #ffff00;"><strong>é€šè¿‡æ¥å£ï¼Œè¢«åŠ¨ä»é›†ç¾¤ä¸­ç§»é™¤ï¼Œå†æ¬¡åŠ å…¥ï¼Œåªèƒ½åœæ­¢æ‰€æœ‰çš„æˆå‘˜ï¼Œåˆ é™¤å…¶ä¸­ç£ç›˜æ•°æ®ï¼Œé‡æ–°æ„å»ºã€‚å¯¼è‡´æ•°æ®çš„ä¸¢å¤±ï¼Œå¦‚ä½•æ¢å¤ï¼Ÿ&nbsp;</strong></span><strong>é«˜ç‰ˆæœ¬çš„æˆå‘˜æ²¡æœ‰æ­¤é—®é¢˜ã€‚</strong></p><br><p><strong>&nbsp; ã€€ã€€å³ åœ¨é›†ç¾¤ä¸­ï¼Œæˆå‘˜çš„ç‰ˆæœ¬ä¸åŒã€‚é›†ç¾¤ç‰ˆæœ¬é™ä½ä¸º ä½ç‰ˆæœ¬ å¦‚ï¼š{â€œetcdserverâ€:â€3.0.15â€,â€etcdclusterâ€:â€2.3.0â€}ï¼Œ ä½ç‰ˆæœ¬çš„æˆå‘˜é€€å‡ºåï¼Œé›†ç¾¤ç‰ˆæœ¬å‡çº§ä¸ºé«˜ç‰ˆæœ¬ï¼š{â€œetcdserverâ€:â€3.0.15â€,â€etcdclusterâ€:â€3.0.0â€}&nbsp;&nbsp;ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<br></strong></p><br><p>&nbsp;</p><br><p>&nbsp; &nbsp; &nbsp; &nbsp; å…¶ç‰ˆæœ¬çš„é¦–å…ˆå¯åŠ¨æ—¶ï¼Œä½¿ç”¨â€“initial-cluster-state newï¼› &nbsp;é«˜ç‰ˆæœ¬çš„åœ¨å¯åŠ¨æ—¶&nbsp;â€“initial-cluster-state&nbsp;<strong>existing ä¼šæŠ¥ é›†ç¾¤ç‰ˆæœ¬ä¸å…¼å®¹ã€‚éœ€è¦ä½¿ç”¨&nbsp;â€“initial-cluster-state newã€‚ å†æ¬¡å¯åŠ¨é«˜ç‰ˆæœ¬çš„å¯ä»¥ä½¿ç”¨&nbsp;<strong>existing ã€‚</strong></strong></p><br><p><strong><strong>ã€€ã€€ &nbsp;æ„å»ºé›†ç¾¤æ—¶ï¼Œé‡‡ç”¨å°±ä½ç‰ˆæœ¬ï¼Œåœ¨é«˜ç‰ˆæœ¬åŠ å…¥æ—¶ï¼Œéœ€è¦ä½¿ç”¨&nbsp;â€“initial-cluster-state new æˆ– ä¸è®¾ç½®ï¼Œ ä½¿ç”¨existing ï¼ŒæŠ¥é›†ç¾¤ä¸å…¼å®¹ã€‚<br></strong></strong></p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@centos7mini etcd]# ./<span style="color: #000000;">etcdctl member remove 45b967575ff25cb2<br></span><span style="color: #008080;"> 2</span> <span style="color: #000000;">Removed member 45b967575ff25cb2 from cluster<br></span><span style="color: #008080;"> 3</span><br><span style="color: #008080;"> 4</span> [root@centos7mini etcd]# ./etcdctl member add infra0 http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.150:2380</span><br><span style="color: #008080;"> 5</span> <span style="color: #000000;">Added member named infra0 with ID 700fb7bf97791e71 to cluster<br></span><span style="color: #008080;"> 6</span><br><span style="color: #008080;"> 7</span> ETCD_NAME=<span style="color: #800000;">â€œ</span><span style="color: #800000;">infra0</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;"> 8</span> ETCD_INITIAL_CLUSTER=<span style="color: #800000;">â€œ</span><span style="color: #800000;">infra3=<a href="http://192.168.10.184:2380,infra0=http://192.168.10.150:2380,infra1=http://192.168.10.231:2380" target="_blank" rel="noopener">http://192.168.10.184:2380,infra0=http://192.168.10.150:2380,infra1=http://192.168.10.231:2380</a></span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;"> 9</span> ETCD_INITIAL_CLUSTER_STATE=<span style="color: #800000;">â€œ</span><span style="color: #800000;">existing</span><span style="color: #800000;">â€œ</span><br><span style="color: #008080;">10</span><br><span style="color: #008080;">11</span> [root@centos7mini etcd]# ./<span style="color: #000000;">etcdctl member list<br></span><span style="color: #008080;">12</span> 3c828782a67e0043: name=infra3 peerURLs=http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.184:2380 clientURLs=</span><span style="color: #008000; text-decoration: underline;"><a href="http://192.168.10.184" target="_blank" rel="noopener">http://192.168.10.184</a></span><span style="color: #008000;">:2379 isLeader=true</span><br><span style="color: #008080;">13</span> 700fb7bf97791e71[unstarted]: peerURLs=http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.150:2380</span><br><span style="color: #008080;">14</span> b26f1b9a6c735437: name=infra1 peerURLs=http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.231:2380 clientURLs=</span><span style="color: #008000; text-decoration: underline;"><a href="http://192.168.10.231" target="_blank" rel="noopener">http://192.168.10.231</a></span><span style="color: #008000;">:2379 isLeader=false</span><br><span style="color: #008080;">15</span> [root@centos7mini etcd]# </pre><br></div><br><p>&nbsp;</p><br><p><strong>4. Change the peer urls of a member</strong></p><br><p>ã€€ã€€ä¿®æ”¹å·²å­˜åœ¨æˆå‘˜çš„peer urlsã€‚æˆå‘˜IDå¿…é¡»æ˜¯ä¸€ä¸ª64ä½æ•´æ•°çš„16è¿›åˆ¶æ˜¾ç¤ºçš„å­—ç¬¦ä¸²ã€‚æˆåŠŸæ—¶ï¼Œè¿”å›204çŠ¶æ€ç ï¼Œç©ºå†…å®¹ã€‚å¤±è´¥æ—¶ï¼Œè¿”å›å¤±è´¥çŠ¶æ€å­—ç¬¦æè¿°ã€‚</p><br><p>ã€€ã€€ä¿®æ”¹çš„æˆå‘˜ä¸å­˜åœ¨ï¼Œè¿”å›400 é”™è¯¯ç ã€‚ å¦‚æœæä¾›çš„peerlURLå­˜åœ¨ï¼Œå°†è¿”å›409é”™è¯¯ç ã€‚500é”™è¯¯ï¼š é›†ç¾¤å¤„ç†è¶…æ—¶ã€‚</p><br><p>ã€€ã€€</p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> [root@localhost etcd-v3.<span style="color: #800080;">0.15</span>-linux-amd64]# ./<span style="color: #000000;">etcdctl member list<br></span><span style="color: #008080;"> 2</span> 3c828782a67e0043: name=infra3 peerURLs=http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.184:2380 clientURLs=</span><span style="color: #008000; text-decoration: underline;"><a href="http://192.168.10.184" target="_blank" rel="noopener">http://192.168.10.184</a></span><span style="color: #008000;">:2379 isLeader=false</span><br><span style="color: #008080;"> 3</span> 45b967575ff25cb2: name=infra0 peerURLs=http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.150:2380 clientURLs=</span><span style="color: #008000; text-decoration: underline;"><a href="http://192.168.10.150" target="_blank" rel="noopener">http://192.168.10.150</a></span><span style="color: #008000;">:2379 isLeader=true</span><br><span style="color: #008080;"> 4</span> b26f1b9a6c735437: name=infra1 peerURLs=http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.231:2380 clientURLs=</span><span style="color: #008000; text-decoration: underline;"><a href="http://192.168.10.231" target="_blank" rel="noopener">http://192.168.10.231</a></span><span style="color: #008000;">:2379 isLeader=false</span><br><span style="color: #008080;"> 5</span> [root@localhost etcd-v3.<span style="color: #800080;">0.15</span>-linux-<span style="color: #000000;">amd64]#<br></span><span style="color: #008080;"> 6</span> [root@localhost etcd-v3.<span style="color: #800080;">0.15</span>-linux-amd64]# curl http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.150:2379/v2/members/b26f1b9a6c735437 -XPUT -H â€œContent-Type: application/jsonâ€ -d â€˜{â€œpeerURLsâ€:[â€œ</span><span style="color: #008000; text-decoration: underline;"><a href="http://127.0.0.1" target="_blank" rel="noopener">http://127.0.0.1</a></span><span style="color: #008000;">:2380â€]}â€™</span><br><span style="color: #008080;"> 7</span> [root@localhost etcd-v3.<span style="color: #800080;">0.15</span>-linux-<span style="color: #000000;">amd64]#<br></span><span style="color: #008080;"> 8</span> [root@localhost etcd-v3.<span style="color: #800080;">0.15</span>-linux-amd64]# ./<span style="color: #000000;">etcdctl member list<br></span><span style="color: #008080;"> 9</span> 3c828782a67e0043: name=infra3 peerURLs=http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.184:2380 clientURLs=</span><span style="color: #008000; text-decoration: underline;"><a href="http://192.168.10.184" target="_blank" rel="noopener">http://192.168.10.184</a></span><span style="color: #008000;">:2379 isLeader=false</span><br><span style="color: #008080;">10</span> 45b967575ff25cb2: name=infra0 peerURLs=http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.150:2380 clientURLs=</span><span style="color: #008000; text-decoration: underline;"><a href="http://192.168.10.150" target="_blank" rel="noopener">http://192.168.10.150</a></span><span style="color: #008000;">:2379 isLeader=true</span><br><span style="color: #008080;">11</span> b26f1b9a6c735437: name=infra1 peerURLs=http:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2380 clientURLs=</span><span style="color: #008000; text-decoration: underline;"><a href="http://192.168.10.231" target="_blank" rel="noopener">http://192.168.10.231</a></span><span style="color: #008000;">:2379 isLeader=false</span><br><span style="color: #008080;">12</span> [root@localhost etcd-v3.<span style="color: #800080;">0.15</span>-linux-amd64]# </pre><br></div><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p><span style="line-height: 1.5;">&nbsp; <strong>åœ¨å¯åŠ¨etcdè®¾ç½®&nbsp;â€“listen-client-urls å€¼æ—¶ï¼Œè¯·å°†localhost:2379æˆ–127.0.0.1:2379 è®¾ç½®ï¼Œå¦è€… æœ¬åœ°etcdctlä¼šæŠ¥é”™å¦‚ä¸‹</strong></span></p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> [root@centos7mini etcd]# ./<span style="color: #000000;">etcdctl member list<br></span><span style="color: #008080;">2</span> <span style="color: #000000;">Error: client: etcd cluster is unavailable or misconfigured<br></span><span style="color: #008080;">3</span> error #<span style="color: #800080;">0</span>: dial tcp <span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">4001</span><span style="color: #000000;">: getsockopt: connection refused<br></span><span style="color: #008080;">4</span> error #<span style="color: #800080;">1</span>: dial tcp <span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">2379</span>: getsockopt: connection refused</pre><br></div><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p><strong><em>ä¸€ä¸ªèŠ‚ç‚¹æ–­å¼€åï¼Œæˆä¸ºcandicateï¼Œå‘å…¶ä»–memberå‘èµ·voteï¼Œé‡æ–°é€‰å‡† master/leaderã€‚</em></strong></p><br><p>2016-12-29 19:43:15.767905 I | raft: b26f1b9a6c735437 became candidate at term 146<br>2016-12-29 19:43:15.767932 I | raft: b26f1b9a6c735437 received vote from b26f1b9a6c735437 at term 146<br>2016-12-29 19:43:15.767961 I | raft: b26f1b9a6c735437 [logterm: 101, index: 688] sent vote request to 45b967575ff25cb2 at term 146<br>2016-12-29 19:43:17.266905 I | raft: b26f1b9a6c735437 is starting a new election at term 146</p><br><p>&nbsp;</p><br><p><strong>å°†ä¸€ä¸ªmemeberåŠ å…¥ä¸¤ä¸ªé›†ç¾¤æ—¶ï¼Œå‡ºç° cluster id åŒ¹é…é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯é™æ€åˆ›å»ºclusterã€‚</strong></p><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> # etcd â€“name infra1 â€“initial-advertise-peer-urls http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.231:2380 \</span><br><span style="color: #008080;"> 2</span>   â€“listen-peer-urls http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.231:2380 \</span><br><span style="color: #008080;"> 3</span>   â€“listen-client-urls http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.231:2379,</span><span style="color: #008000; text-decoration: underline;"><a href="http://127.0.0.1" target="_blank" rel="noopener">http://127.0.0.1</a></span><span style="color: #008000;">:2379 \</span><br><span style="color: #008080;"> 4</span>   â€“advertise-client-urls http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.231:2379 \</span><br><span style="color: #008080;"> 5</span>   â€“initial-cluster-token etcd-cluster-<span style="color: #800080;">1</span><span style="color: #000000;"> \<br></span><span style="color: #008080;"> 6</span>   â€“initial-cluster infra0=http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.150:2380,infra1=</span><span style="color: #008000; text-decoration: underline;"><a href="http://192.168.10.231" target="_blank" rel="noopener">http://192.168.10.231</a></span><span style="color: #008000;">:2380,infra3=</span><span style="color: #008000; text-decoration: underline;"><a href="http://192.168.10.184" target="_blank" rel="noopener">http://192.168.10.184</a></span><span style="color: #008000;">:2380 \</span><br><span style="color: #008080;"> 7</span>   â€“initial-cluster-<span style="color: #000000;">state new<br></span><span style="color: #008080;"> 8</span><br><span style="color: #008080;"> 9</span> # ./etcd â€“debug â€“name infra3 â€“initial-advertise-peer-urls http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.184:2380  \</span><br><span style="color: #008080;">10</span>   â€“listen-peer-urls http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.184:2380 â€“initial-cluster infra3=</span><span style="color: #008000; text-decoration: underline;"><a href="http://192.168.10.184" target="_blank" rel="noopener">http://192.168.10.184</a></span><span style="color: #008000;">:2380 \</span><br><span style="color: #008080;">11</span>   â€“listen-client-urls http:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.10.184:2379 â€“advertise-client-urls </span><span style="color: #008000; text-decoration: underline;"><a href="http://192.168.10.184" target="_blank" rel="noopener">http://192.168.10.184</a></span><span style="color: #008000;">:2379 \</span><br><span style="color: #008080;">12</span>   â€“initial-cluster-state new â€“initial-cluster-token etcd-cluster-<span style="color: #800080;">1</span></pre><br></div><br><p>&nbsp;</p><br><p>&nbsp;<em id="__mceDel" style="line-height: 1.5;">2016-12-30 11:47:30.939730 E | rafthttp: request sent was ignored (cluster ID mismatch: remote[3c828782a67e0043]=625ac7f9082c643, local=34b660d543ad1445)</em></p><br><p><em id="__mceDel">2016-12-30 11:47:30.977766 E | rafthttp: request sent was ignored (cluster ID mismatch: remote[3c828782a67e0043]=625ac7f9082c643, local=34b660d543ad1445)</em></p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p><strong>å¦‚ä¸‹å»ºç«‹é›†ç¾¤åï¼Œâ€“debug æç¤ºï¼š150ä¸Šçš„iptablesé˜²ç«å¢™å¯¼è‡´ã€‚</strong></p><br><p>2016-12-30 12:07:19.479241 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: getsockopt: no route to host)<br>2016-12-30 12:07:19.914614 D | rafthttp: failed to dial 45b967575ff25cb2 on stream MsgApp v2 (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 12:07:20.781345 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 12:07:21.216792 D | rafthttp: failed to dial 45b967575ff25cb2 on stream MsgApp v2 (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 12:07:21.885187 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: getsockopt: no route to host)<br>2016-12-30 12:07:22.518689 D | rafthttp: failed to dial 45b967575ff25cb2 on stream MsgApp v2 (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 12:07:22.620358 D | rafthttp: failed to dial 45b967575ff25cb2 on stream MsgApp v2 (dial tcp 192.168.10.150:2380: getsockopt: no route to host)<br>2016-12-30 12:07:23.187832 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 12:07:23.925031 D | rafthttp: failed to dial 45b967575ff25cb2 on stream MsgApp v2 (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 12:07:24.490547 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 12:07:24.592188 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: getsockopt: no route to host)<br>2016-12-30 12:07:25.226673 D | rafthttp: failed to dial 45b967575ff25cb2 on stream MsgApp v2 (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 12:07:25.696521 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: getsockopt: no route to host)<br>2016-12-30 12:07:26.528616 D | rafthttp: failed to dial 45b967575ff25cb2 on stream MsgApp v2 (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 12:07:26.630548 D | rafthttp: failed to dial 45b967575ff25cb2 on stream MsgApp v2 (dial tcp 192.168.10.150:2380: getsockopt: no route to host)<br>2016-12-30 12:07:27.000087 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 12:07:27.932728 D | rafthttp: failed to dial 45b967575ff25cb2 on stream MsgApp v2 (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 12:07:28.302774 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 12:07:28.404591 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: getsockopt: no r</p><br><p><strong>å¦‚ä¸‹è°ƒè¯•ä¿¡æ¯æ˜¯åœ¨leader ä¸Šçš„ã€‚ ç”±äºiptablesé˜²ç«å¢™çš„åŸå› å¯¼è‡´ã€‚</strong></p><br><p>2016-12-30 14:03:10.838829 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 14:03:11.353601 W | etcdserver: failed to reach the peerURL(<a href="http://192.168.10.150:2380" target="_blank" rel="noopener">http://192.168.10.150:2380</a>) of member 45b967575ff25cb2 (Get <a href="http://192.168.10.150:2380/version" target="_blank" rel="noopener">http://192.168.10.150:2380/version</a>: dial tcp 192.168.10.150:2380: getsockopt: no route to host)<br>2016-12-30 14:03:11.353640 W | etcdserver: cannot get the version of member 45b967575ff25cb2 (Get <a href="http://192.168.10.150:2380/version" target="_blank" rel="noopener">http://192.168.10.150:2380/version</a>: dial tcp 192.168.10.150:2380: getsockopt: no route to host)<br>2016-12-30 14:03:11.672262 D | rafthttp: failed to dial 45b967575ff25cb2 on stream MsgApp v2 (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 14:03:12.140697 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 14:03:12.974912 D | rafthttp: failed to dial 45b967575ff25cb2 on stream MsgApp v2 (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 14:03:13.445167 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 14:03:13.547340 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: getsockopt: no route to host)<br>2016-12-30 14:03:14.278497 D | rafthttp: failed to dial 45b967575ff25cb2 on stream MsgApp v2 (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 14:03:14.380259 D | rafthttp: failed to dial 45b967575ff25cb2 on stream MsgApp v2 (dial tcp 192.168.10.150:2380: getsockopt: no route to host)<br>2016-12-30 14:03:14.850132 D | rafthttp: failed to dial 45b967575ff25cb2 on stream Message (dial tcp 192.168.10.150:2380: i/o timeout)<br>2016-12-30 14:03:15.358565 W | etcdserver: failed to reach the peerURL(<a href="http://192.168.10.150:2380" target="_blank" rel="noopener">http://192.168.10.150:2380</a>) of member 45b967575ff25cb2 (Get <a href="http://192.168.10.150:2380/version" target="_blank" rel="noopener">http://192.168.10.150:2380/version</a>: dial tcp 192.168.10.150:2380: getsockopt: no route to host)<br>2016-12-30 14:03:15.358613 W | etcdserver: cannot get the version of member 45b967575ff25cb2 (Get <a href="http://192.168.10.150:2380/version" target="_blank" rel="noopener">http://192.168.10.150:2380/version</a>: dial tcp 192.168.10.150:2380: getsockopt: no route to host)</p><br><p><strong style="line-height: 1.5;">å¦‚ä¸‹è°ƒè¯•ä¿¡æ¯ï¼Œæ˜¯ç”±äº 192.168.10.231:2380 æ— æ³•è®¿é—®ï¼Œ&nbsp;b26f1b9a6c735437 ä¸ºmember idã€‚</strong></p><br><p>2016-12-30 21:38:43.130791 D | rafthttp: failed to dial b26f1b9a6c735437 on stream Message (dial tcp 192.168.10.231:2380: getsockopt: connection refused)<br>2016-12-30 21:38:43.191227 D | rafthttp: failed to dial b26f1b9a6c735437 on stream MsgApp v2 (dial tcp 192.168.10.231:2380: getsockopt: connection refused)<br>2016-12-30 21:38:43.232280 D | rafthttp: failed to dial b26f1b9a6c735437 on stream Message (dial tcp 192.168.10.231:2380: getsockopt: connection refused)<br>2016-12-30 21:38:43.292289 D | rafthttp: failed to dial b26f1b9a6c735437 on stream MsgApp v2 (dial tcp 192.168.10.231:2380: getsockopt: connection refused)<br>2016-12-30 21:38:43.334129 D | rafthttp: failed to dial b26f1b9a6c735437 on stream Message (dial tcp 192.168.10.231:2380: getsockopt: connection refused)<br>2016-12-30 21:38:43.393576 D | rafthttp: failed to dial b26f1b9a6c735437 on stream MsgApp v2 (dial tcp 192.168.10.231:2380: getsockopt: connection refused)</p><br><p>&nbsp;</p><br><p>2016-12-30 14:18:36.328628 W | rafthttp: the clock difference against peer 3c828782a67e0043 is too high [2.00405135s &gt; 1s]<br>2016-12-30 14:19:06.329559 W | rafthttp: the clock difference against peer 3c828782a67e0043 is too high [2.003973758s &gt; 1s]<br>2016-12-30 14:19:36.331189 W | rafthttp: the clock difference against peer 3c828782a67e0043 is too high [2.004098356s &gt; 1s]</p><br><p>&nbsp;</p><br><p><span style="line-height: 1.5;">2016-12-30 21:38:22.857546 W | rafthttp: the clock difference against peer 3c828782a67e0043 is too high [7h59m58.924003117s &gt; 1s]</span></p><br><p>2016-12-30 21:38:22.892541 W | rafthttp: health check for peer b26f1b9a6c735437 failed<br>2016-12-30 21:38:22.892848 W | rafthttp: the clock difference against peer b26f1b9a6c735437 is too high [7h59m56.920465483s &gt; 1s]</p><br><p>&nbsp;</p></div><div id="MySignature"></div><br><div class="clear"></div><br><div id="blog_post_info_block"><br><div id="BlogPostCategory"></div><br><div id="EntryTag"></div><br><div id="blog_post_info"><br></div><br><div class="clear"></div><br><div id="post_next_prev"></div><br></div>


<p>è½¬è‡ª: <a href="https://www.cnblogs.com/doscho/p/6227351.html" target="_blank" rel="noopener">https://www.cnblogs.com/doscho/p/6227351.html</a></p>

      


      

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/Etcd/" rel="tag"><i class="fa fa-tag"></i> Etcd</a>
            
          </div>
        

        
        
        

        
          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/gevent_intro/" rel="next" title="geventæ€»ç»“">
                  <i class="fa fa-chevron-left"></i> 
                  <p class="post-nav-pre-next-title">
                    geventæ€»ç»“
                  </p> 
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/http_safety_idempotence/" rel="prev" title="HTTPå®‰å…¨æ€§å’Œå¹‚ç­‰æ€§">
                <p class="post-nav-pre-next-title">
                    HTTPå®‰å…¨æ€§å’Œå¹‚ç­‰æ€§
                </p> 
                <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        

        
        
      </footer>
      
    </div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  

  <aside id="sidebar" class="sidebar">

    
      
        <div id="sidebar-dimmer"></div>
      
    

    <div class="sidebar-inner">
    
      <div class="sidebar-toggle-inside motion-element">
        <div class="sidebar-toggle-line-wrap">
          <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
          <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
          <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
        </div>
      </div>

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a href="/" class="site-author-image" rel="start" style="border:none">
            <img class="site-author-image" itemprop="image" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/uploads/avatar.png" alt="Mike">
          </a>
          <p class="site-author-name" itemprop="name">Mike</p>
           
              <p class="site-description motion-element" itemprop="description">ğŸš™ ğŸš— ğŸ’¨ ğŸ’¨ If you want to create a blog like this, just follow my open-source project, "hexo-theme-neo", click the GitHub button below and check it out ^_^ . It is recommended to use Chrome, Safari, or Edge to read this blog since this blog was developed on Edge (Chromium kernel version) and tested on Safari.</p>
          
        </div>

        <nav class="site-state motion-element">

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">298</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">111</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

          <div class="site-state-item site-state-about">
            <a href="/about/">
              <span class="site-state-item-about fa fa-fw fa-user"></span>
              <span class="site-state-item-name">about</span>
            </a>
          </div>
          
        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/no5ix" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://open.spotify.com/user/313duq77ekebrfyak3xijqewzss4?si=e7653b829a9747bf" target="_blank" title="Spotify">
                  
                    <i class="fa fa-fw fa-spotify"></i>
                  
                    
                      Spotify
                    
                </a>
              </span>
            
          
          
          <!-- ç½‘æ˜“äº‘éŸ³ä¹ -->
            <!-- <div class="netease-cloud-music"> -->
              <!-- <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=280 height=110 src="//music.163.com/outchain/player?type=0&id=992743594&auto=0&height=90"></iframe> -->
            <!-- </div> -->
          <!-- ç½‘æ˜“äº‘éŸ³ä¹ -->

        </div>

        
        

        
        

        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#etcd%20api%E6%8E%A5%E5%8F%A3"><span class="nav-text">etcd apiæ¥å£</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E5%8D%95%E6%9C%BAetcd%E6%9C%8D%E5%8A%A1"><span class="nav-text">è¿è¡Œå•æœºetcdæœåŠ¡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%C2%A0"><span class="nav-text">Â </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Statistics%20%C2%A0%E7%BB%9F%E8%AE%A1%E6%8E%A5%E5%8F%A3"><span class="nav-text">Statistics Â ç»Ÿè®¡æ¥å£</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Leader%20Statistics%20%E9%A2%86%E5%AF%BC%E7%82%B9%E7%BB%9F%E8%AE%A1"><span class="nav-text">Leader Statistics é¢†å¯¼ç‚¹ç»Ÿè®¡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Memeber%20API"><span class="nav-text">Memeber API</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mike</span>
</div>



        

        
      </div>
    </footer>

    <!--
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      
        <span id="scrollpercent"><span>0</span>%</span>
      
    </div>
    -->

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>










  















  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/mediumzoom/medium-zoom.js?v=1.1.0"></script>





  




  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>


  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

    <script src="/js/src/local-search.js"></script>





  

  

  

  

  

  


  <script type="text/javascript" src="/lib/wobble_window/wobblewindow.js"> </script>
<script type="text/javascript" src="/js/src/custom.js"></script>
</body>
</html>






<script type="text/javascript" src="/js/src/headroom.js"></script>

<!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½ -->
<script type="text/javascript" src="/js/src/code-highlight-modification.js"></script>

<!-- Flashcards Script -->
<script type="text/javascript" src="/js/src/flashcards.js"></script>
