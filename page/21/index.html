<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


  <meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">

<script>
    (function(){
        if(''){
            let localStoragePasswdKey = '' + '_last_passwd';
            let tryCnt = 0;
            function checkPassword(password) {
                password = password == null ? null : password.trim();
                if (password !== '') {
                    if (password != null) {
                        // å¦‚æœç”¨æˆ·ç‚¹å‡»äº†ç¡®è®¤è€Œä¸”å¯†ç é”™è¯¯çš„æ—¶å€™, å› ä¸ºå½“password == nullçš„æ—¶å€™è¯´æ˜ç”¨æˆ·ç‚¹äº†å–æ¶ˆ
                        alert('Error!');
                        if (++tryCnt < 3) {
                            password = prompt('Open Sesame');
                            checkPassword(password);
                            return;
                        }
                    }

                    // if (history.length > 1) {
                    //     alert('back!');
                    //     history.back();
                    // } else {
                        // alert('blankkkk!');
                    //     window.location.href = "about:blank";
                    // }
                    if (document.referrer) {
                        window.location.href = document.referrer;
                    } else {
                        window.location.href = "about:blank";; // fallback if no referrer
                    }

                } else {
                    localStorage.setItem(localStoragePasswdKey, password);
                }
            }

            var password_verify_on_local = false;
            const hostname = window.location.hostname;
            if (password_verify_on_local || (!(hostname === "localhost" || hostname === "127.0.0.1" || hostname === "::1" || hostname.startsWith("192")))) {
                const lspk = localStorage.getItem(localStoragePasswdKey) || "";
                if (lspk !== '') {
                    var password = prompt('Open Sesame');
                    checkPassword(password);
                }
            }
        }
    })();
</script>








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">





















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2">






<meta name="description" content="ğŸš™ ğŸš— ğŸ’¨ ğŸ’¨ If you want to create a blog like this, just follow my open-source project, &quot;hexo-theme-neo&quot;, click the GitHub button below and check it out ^_^ . It is recommended to use Chrome, Safari,">
<meta property="og:type" content="website">
<meta property="og:title" content="ğŸš™">
<meta property="og:url" content="https://hulinhong.com/page/21/index.html">
<meta property="og:site_name" content="ğŸš™">
<meta property="og:description" content="ğŸš™ ğŸš— ğŸ’¨ ğŸ’¨ If you want to create a blog like this, just follow my open-source project, &quot;hexo-theme-neo&quot;, click the GitHub button below and check it out ^_^ . It is recommended to use Chrome, Safari,">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ğŸš™">
<meta name="twitter:description" content="ğŸš™ ğŸš— ğŸ’¨ ğŸ’¨ If you want to create a blog like this, just follow my open-source project, &quot;hexo-theme-neo&quot;, click the GitHub button below and check it out ^_^ . It is recommended to use Chrome, Safari,">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":12,"scrollpercent":true,"onmobile":true,"dimmer":true,"body_content_height":0,"display_duration":150},
    local_search: {"enable":true,"trigger":"auto","top_n_per_article":1},
    fancybox: false,
    mediumzoom: true,
    darkmode_js: false,
    tabs: true,
    motion: {"enable":true,"async":false,"duration":188,"transition":{"header":"fadeIn","menu":"fadeIn","logo":"fadeIn","post_block_else":"fadeIn","post_header":"fadeIn","post_body":"fadeIn","coll_header":"fadeIn","footer":"fadeIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>








  <title>ğŸš™ - ğŸ’¨ ğŸ’¨ ğŸ’¨</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ğŸš™</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ğŸ’¨ ğŸ’¨ ğŸ’¨</p>
      
  </div>

  <div class="menu-item sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div class="menu-item site-search">
    
  
  <div class="site-search-div">
    <button class="search-icon" id="search-button">
      <i class="fa fa-search"></i>
    </button>
    <input type="text" id="local-search-input" class="st-search-input">
    <i id="local-search-close">Ã—</i>
  </div>


<script type="text/javascript" id="local.search.active">
    {/* var inputArea       = document.querySelector("#local-search-input");
    inputArea.onclick   = function(){ getSearchFile(); this.focus(); }
    inputArea.onkeydown = function(){ if(event.keyCode == 13) return false } */}
</script>



  </div>
  <div id="local-search-result-pc" class="local-search-result-cls"></div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

       
    </ul>
  

  
    
  
</nav>



 </div>
    </header>

    <div id="local-search-result-mobile" class="local-search-result-cls"></div>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/client_server_connection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/client_server_connection/" itemprop="url">æ„å»ºæ¸¸æˆç½‘ç»œåè®®å…­ä¹‹å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„è¿æ¥</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-09T23:13:35+00:00">
                04-09-2017
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GS/" itemprop="url" rel="index">
                    <span itemprop="name">GS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          
            <h1 id="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"><a href="#æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“" class="headerlink" title="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"></a>æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“</h1><p>è¿™ç¯‡æ–‡ç« ç½‘ä¸Šæ‰¾ä¸åˆ°ç¿»è¯‘, æˆ‘ä¹Ÿæ²¡æ—¶é—´è¯¦ç»†ç¿»è¯‘, å¤§æ¦‚æ€»ç»“ä¸€ä¸‹å§.<br>æœ¬ç¯‡ä¸»è¦è®²äº†æŠŠæœ¬ç³»åˆ—ä¹‹å‰äº”ç¯‡æ–‡ç« çš„æŠ€æœ¯åº”ç”¨åˆ°å®æˆ˜ä¸­å¤„ç†å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„çš„è¿æ¥.<br>è¯·çœ‹æ€»ç»“, ä¸æ˜ä¹‹å¤„å†çœ‹æ–‡ä¸­å…·ä½“è®²è§£.</p>
<h2 id="ç®€å•çš„è¿æ¥åè®®"><a href="#ç®€å•çš„è¿æ¥åè®®" class="headerlink" title="ç®€å•çš„è¿æ¥åè®®"></a>ç®€å•çš„è¿æ¥åè®®</h2><p>First up we have the client state machine.<br>The client is in one of three states:</p>
<ul>
<li>Disconnected</li>
<li>Connecting</li>
<li>Connected</li>
</ul>
<p>The goal is to create an abstraction on top of a UDP socket where our server presents a number of virtual slots for clients to connect to.</p>
<p>When a client requests a connection, it gets assigned to one of these slots.</p>
<p>If a client requests connection, but no slots are available, the server is full and the connection request is denied.</p>
<p>On the server, we have the following data structure:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MaxClients = <span class="number">64</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Server</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> m_maxClients;</span><br><span class="line">    <span class="keyword">int</span> m_numConnectedClients;</span><br><span class="line">    <span class="keyword">bool</span> m_clientConnected[MaxClients];</span><br><span class="line">    Address m_clientAddress[MaxClients];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="è¿™ä¸ªç®€å•åè®®å­˜åœ¨çš„é—®é¢˜"><a href="#è¿™ä¸ªç®€å•åè®®å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="è¿™ä¸ªç®€å•åè®®å­˜åœ¨çš„é—®é¢˜"></a>è¿™ä¸ªç®€å•åè®®å­˜åœ¨çš„é—®é¢˜</h2><ul>
<li>æ˜“è¢«æ”»å‡»è€…åˆ©ç”¨æˆ‘ä»¬çš„æœåŠ¡å™¨å½“åšDDosæ”¾å¤§æ”»å‡»çš„å·¥å…·</li>
<li>æ”»å‡»è€…å¯ä»¥å¾ˆè½»æ¾çš„å æ»¡æˆ‘ä»¬çš„client slots</li>
<li>Traffic between the client and server can be read and modified in transit by a third party. </li>
<li>ä¸€æ—¦è¢«æ”»å‡»è€…çŸ¥é“äº†å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨çš„åœ°å€, ä»–å°±å¯ä»¥ä¼ªè£…æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯æ¥æ¬ºéª—å¯¹æ–¹è·å–åˆ©ç›Š</li>
<li>æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ–­å¼€è¿æ¥çš„æ–¹å¼, åªèƒ½ç­‰time out</li>
</ul>
<p>è¿™äº›é—®é¢˜éœ€è¦ç”¨æˆæƒç³»ç»Ÿå’ŒåŠ å¯†ç³»ç»Ÿæ¥è§£å†³.</p>
<h2 id="å¦‚ä½•æ”¹è¿›è¿™ä¸ªè¿æ¥åè®®"><a href="#å¦‚ä½•æ”¹è¿›è¿™ä¸ªè¿æ¥åè®®" class="headerlink" title="å¦‚ä½•æ”¹è¿›è¿™ä¸ªè¿æ¥åè®®"></a>å¦‚ä½•æ”¹è¿›è¿™ä¸ªè¿æ¥åè®®</h2><ul>
<li><p>we no longer accept client connections immediately on connection request, instead we send back a challenge packet, and only complete connection when a client replies with information that can only be obtained by receiving the challenge packet.</p>
</li>
<li><p>ä¸ºäº†é˜²æ­¢æ”»å‡»è€…åˆ©ç”¨æˆ‘ä»¬çš„æœåŠ¡å™¨å½“åšDDosæ”¾å¤§æ”»å‡»çš„å·¥å…·, æˆ‘ä»¬è®©å®¢æˆ·ç«¯å‘çš„åŒ…æ¯”æœåŠ¡å™¨å‘çš„åŒ…è¦å¤§äº›.</p>
</li>
<li><p>Weâ€™ll add some unique random identifiers, or â€˜saltsâ€™, to make each client connection unique from previous ones coming from the same IP address and port.</p>
</li>
<li><p>ä¸€æ—¦å½¼æ­¤è¿æ¥ä¸Šä¹‹å, å°±ç”¨ client salt å’Œ server salt çš„å¼‚æˆ–å€¼æ¥æ ‡è¯†å½¼æ­¤.</p>
</li>
<li><p>ä»¥ä¸Šçš„é˜²å¾¡æªæ–½è®©æˆ‘ä»¬çš„æœåŠ¡å™¨åšåˆ°äº† no longer able to be used as port of DDoS amplification attacks, and with a trivial xor based authentication, ä½†å¯¹äºä¸€ä¸ªç»éªŒä¸°å¯Œçš„ä¼šæŠ“åŒ…åˆ†æçš„æ”»å‡»è€…æ¥è¯´, è¿˜å­˜åœ¨ä»¥ä¸‹é—®é¢˜ : </p>
<ul>
<li>This attacker can read and modify packets in flight.</li>
<li>This breaks the trivial identification based around salt valuesâ€¦</li>
<li>giving an attacker the power to disconnect any client at will.</li>
</ul>
</li>
</ul>
<p>To solve this, we need to get serious with cryptography to encrypt and sign packets so they canâ€™t be read or modified by a third party.</p>
<h1 id="åŸæ–‡"><a href="#åŸæ–‡" class="headerlink" title="åŸæ–‡"></a>åŸæ–‡</h1><p><a href="https://gafferongames.com/post/client_server_connection/" target="_blank" rel="noopener">åŸæ–‡å‡ºå¤„</a></p>
<p>åŸæ–‡æ ‡é¢˜ : <strong>Client Server Connection</strong> (<em>How to create a client/server connection over UDP</em>)</p>
<hr>
<p></p><h2 id="introduction">Introduction</h2><p></p>
<p>Hi, Iâ€™m <a href="https://gafferongames.com/about" target="_blank" rel="noopener">Glenn Fiedler</a> and welcome to <strong><a href="https://gafferongames.com/categories/building-a-game-network-protocol/" target="_blank" rel="noopener">Building a Game Network Protocol</a></strong>.</p><br><p>So far in this article series we&rsquo;ve discussed how games read and write packets, how to unify packet read and write into a single function, how to fragment and re-assemble packets, and how to send large blocks of data over UDP.</p><br><p>Now in this article we&rsquo;re going to bring everything together and build a client/server connection on top of UDP.</p><br><h2 id="background">Background</h2><br><p>Developers from a web background often wonder why games go to such effort to build a client/server connection on top of UDP, when for many applications, TCP is good enough. </p>

<blockquote>
<p>These days even web servers are transitioning to UDP via <a href="https://ma.ttias.be/googles-quic-protocol-moving-web-tcp-udp/" target="_blank" rel="noopener">Google&rsquo;s QUIC</a>. If you still think TCP is good enough for time critical data in 2016, I encourage you to put that in your pipe and smoke it :)</p>
</blockquote>
<p>The reason is that games send <strong>time critical data</strong>.</p><br><p>Why don&rsquo;t games use TCP for time critical data? The answer is that TCP delivers data reliably and in-order, and to do this on top of IP (which is unreliable, unordered) it holds more recent packets hostage in a queue while older packets are resent over the network.</p><br><p>This is known as <strong>head of line blocking</strong> and it&rsquo;s a <em>huuuuuge</em> problem for games. To understand why, consider a game server broadcasting the state of the world to clients 10 times per-second. Each client advances time forward and wants to display the most recent state it receives from the server.</p><br><p><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/img/client_server_connection/client-time.png" width="100%"></p><br><p>But if the packet containing state for time t = 10.0 is lost, under TCP we must wait for it to be resent before we can access t = 10.1 and 10.2, even though those packets have already arrived and contain the state the client wants to display.</p><br><p>Worse still, by the time the resent packet arrives, it&rsquo;s far too late for the client to actually do anything useful with it. The client has already advanced past 10.0 and wants to display something around 10.3 or 10.4!</p><br><p>So why resend dropped packets at all? <strong>BINGO!</strong> What we&rsquo;d really like is an option to tell TCP: &ldquo;Hey, I don&rsquo;t care about old packets being resent, by they time they arrive I can&rsquo;t use them anyway, so just let me skip over them and access the most recent data&rdquo;.</p><br><p>Unfortunately, TCP simply does not give us this option :(</p><br><p><strong>All data must be delivered reliably and in-order</strong>.</p><br><p>This creates terrible problems for time critical data where packet loss <em>and</em> latency exist. Situations like, you know, The Internet, where people play FPS games.</p><br><p>Large hitches corresponding to multiples of round trip time are added to the stream of data as TCP waits for dropped packets to be resent, which means additional buffering to smooth out these hitches, or long pauses where the game freezes and is non-responsive.</p><br><p>Neither option is acceptable for first person shooters, which is why virtually all first person shooters are networked using UDP. UDP doesn&rsquo;t provide any reliability or ordering, so protocols built on top it can access the most recent data without waiting for lost packets to be resent, implementing whatever reliability they need in <em>radically</em> different ways to TCP.</p><br><p>But, using UDP comes at a cost:</p><br><p><strong>UDP doesn&rsquo;t provide any concept of connection.</strong></p><br><p>We have to build that ourselves. This is a lot of work! So strap in, get ready, because we&rsquo;re going to build it all up from scratch using the same basic techniques first person shooters use when creating their protocols over UDP. You can use this client/server protocol for games or non-gaming applications and, provided the data you send is time critical, I promise you, it&rsquo;s well worth the effort.</p>

<p></p><h2 id="client-server-abstraction">Client/Server Abstraction</h2><p></p>
<p>The goal is to create an abstraction on top of a UDP socket where our server presents a number of <em>virtual slots</em> for clients to connect to:</p><br><p><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/img/client_server_connection/connection-request.png" width="100%"></p><br><p>When a client requests a connection, it gets assigned to one of these slots:</p><br><p><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/img/client_server_connection/connection-accepted.png" width="100%"></p><br><p>If a client requests connection, but no slots are available, the server is full and the connection request is denied:</p><br><p><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/img/client_server_connection/server-is-full.png" width="100%"></p><br><p>Once a client is connected, packets are exchanged in both directions. These packets form the basis for the custom protocol between the client and server which is game specific.</p><br><p><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/img/client_server_connection/client-server-packets.png" width="100%"></p><br><p>In a first person shooter, packets are sent continuously in both directions. Clients send input to the server as quickly as possible, often 30 or 60 times per-second, and the server broadcasts the state of the world to clients 10, 20 or even 60 times per-second.</p><br><p>Because of this steady flow of packets in both directions there is no need for keep-alive packets. If at any point packets stop being received from the other side, the connection simply times out. No packets for 5 seconds is a good timeout value in my opinion, but you can be more aggressive if you want.</p><br><p>When a client slot times out on the server, it becomes available for other clients to connect. When the client times out, it transitions to an error state.</p><br><h2 id="simple-connection-protocol">Simple Connection Protocol</h2><br><p>Let&rsquo;s get started with the implementation of a simple protocol. It&rsquo;s a bit basic and more than a bit naive, but it&rsquo;s a good starting point and we&rsquo;ll build on it during the rest of this article, and the next few articles in this series.</p><br><p>First up we have the client state machine.</p><br><p>The client is in one of three states:</p><br><ul><br><li>Disconnected</li><br><li>Connecting</li><br><li>Connected</li><br></ul><br><p>Initially the client starts in <em>disconnected</em>.</p><br><p>When a client connects to a server, it transitions to the <em>connecting</em> state and sends <strong>connection request</strong> packets to the server:</p><br><p><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/img/client_server_connection/connection-request-packet.png" width="100%"></p><br><p>The CRC32 and implicit protocol id in the packet header allow the server to trivially reject UDP packets not belonging to this protocol or from a different version of it.</p><br><p>Since connection request packets are sent over UDP, they may be lost, received out of order or in duplicate.</p><br><p>Because of this we do two things: 1) we keep sending packets for the client state until we get a response from the server or the client times out, and 2) on both client and server we ignore any packets that don&rsquo;t correspond to what we are expecting, since a lot of redundant packets are flying over the network.</p><br><p>On the server, we have the following data structure:</p><br><pre><code>const int MaxClients = 64;<br><br>class Server<br>{<br>    int m_maxClients;<br>    int m_numConnectedClients;<br>    bool m_clientConnected[MaxClients];<br>    Address m_clientAddress[MaxClients];<br>};<br></code></pre><br><p>Which lets the server lookup a free slot for a client to join (if any are free):</p><br><pre><code>int Server::FindFreeClientIndex() const<br>{<br>    for ( int i = 0; i &lt; m_maxClients; ++i )<br>    {<br>        if ( !m_clientConnected[i] )<br>            return i;<br>    }<br>    return -1;<br>}<br></code></pre><br><p>Find the client index corresponding to an IP address and port:</p><br><pre><code>int Server::FindExistingClientIndex( const Address &amp; address ) const<br>{<br>    for ( int i = 0; i &lt; m_maxClients; ++i )<br>    {<br>        if ( m_clientConnected[i] &amp;&amp; m_clientAddress[i] == address )<br>            return i;<br>    }<br>    return -1;<br>}<br></code></pre><br><p>Check if a client is connected to a given slot:</p><br><pre><code>bool Server::IsClientConnected( int clientIndex ) const<br>{<br>    return m_clientConnected[clientIndex];<br>}<br></code></pre><br><p>&hellip; and retrieve a clientâ€™s IP address and port by client index:</p><br><pre><code>const Address &amp; Server::GetClientAddress( int clientIndex ) const<br>{<br>    return m_clientAddress[clientIndex];<br>}<br></code></pre><br><p>Using these queries we implement the following logic when the server processes a <strong>connection request</strong> packet:</p><br><ul><br><li><p>If the server is full, reply with <strong>connection denied</strong>.</p></li><br><li><p>If the connection request is from a new client and we have a slot free, assign the client to a free slot and respond with <strong>connection accepted</strong>.</p></li><br><li><p>If the sender corresponds to the address of a client that is already connected, <em>also</em> reply with <strong>connection accepted</strong>. This is necessary because the first response packet may not have gotten through due to packet loss. If we don&rsquo;t resend this response, the client gets stuck in the <em>connecting</em> state until it times out.</p></li><br></ul><br><p>The connection accepted packet tells the client which client index it was assigned, which the client needs to know which player it is in the game:</p><br><p><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/img/client_server_connection/connection-accepted-packet.png" width="100%"></p><br><p>Once the server sends a connection accepted packet, from its point of view it considers that client connected. As the server ticks forward, it watches connected client slots, and if no packets have been received from a client for 5 seconds, the slot times out and is reset, ready for another client to connect.</p><br><p>Back to the client. While the client is in the <em>connecting</em> state the client listens for <strong>connection denied</strong> and <strong>connection accepted</strong> packets from the server. Any other packets are ignored.</p><br><p>If the client receives <strong>connection accepted</strong>, it transitions to connected. If it receives <strong>connection denied</strong>, or after 5 seconds hasn&rsquo;t received any response from the server, it transitions to disconnected.</p><br><p>Once the client hits <em>connected</em> it starts sending connection payload packets to the server. If no packets are received from the server in 5 seconds, the client times out and transitions to <em>disconnected</em>.</p><br><h2 id="naive-protocol-is-naive">Naive Protocol is Naive</h2><br><p>While this protocol is easy to implement, we can&rsquo;t use a protocol like this in production. It&rsquo;s way too naive. It simply has too many weaknesses to be taken seriously:</p><br><ul><br><li><p>Spoofed packet source addresses can be used to redirect connection accepted responses to a target (victim) address. If the connection accepted packet is larger than the connection request packet, attackers can use this protocol as part of a <a href="https://www.us-cert.gov/ncas/alerts/TA14-017A" target="_blank" rel="noopener">DDoS amplification attack</a>.</p></li><br><li><p>Spoofed packet source addresses can be used to trivially fill all client slots on a server by sending connection request packets from n different IP addresses, where n is the number of clients allowed per-server. This is a real problem for dedicated servers. Obviously you want to make sure that only real clients are filling slots on servers you are paying for.</p></li><br><li><p>An attacker can trivially fill all slots on a server by varying the client UDP port number on each client connection. This is because clients are considered unique on an address + port basis. This isn&rsquo;t easy to fix because due to NAT (network address translation), different players behind the same router collapse to the same IP address with only the port being different, so we can&rsquo;t just consider clients to be unique at the IP address level sans port.</p></li><br><li><p>Traffic between the client and server can be read and modified in transit by a third party. While the CRC32 protects against packet corruption, an attacker would simply recalculate the CRC32 to match the modified packet.</p></li><br><li><p>If an attacker knows the client and server IP addresses and ports, they can impersonate the client or server. This gives an attacker the power to completely a hijack a clientâ€™s connection and perform actions on their behalf.</p></li><br><li><p>Once a client is connected to a server there is no way for them to disconnect cleanly, they can only time out. This creates a delay before the server realizes a client has disconnected, or before a client realizes the server has shut down. It would be nice if both the client and server could indicate a clean disconnect, so the other side doesnâ€™t need to wait for timeout in the common case.</p></li><br><li><p>Clean disconnection is usually implemented with a disconnect packet, however because an attacker can impersonate the client and server with spoofed packets, doing so would give the attacker the ability to disconnect a client from the server whenever they like, provided they know the client and server IP addresses and the structure of the disconnect packet.</p></li><br><li><p>If a client disconnects dirty and attempts to reconnect before their slot times out on the server, the server still thinks that client is connected and replies with <strong>connection accepted</strong> to handle packet loss. The client processes this response and thinks it&rsquo;s connected to the server, but it&rsquo;s actually in an undefined state.</p></li><br></ul><br><p>While some of these problems require authentication and encryption before they can be fully solved, we can make some small steps forward to improve the protocol before we get to that. These changes are instructive.</p><br><h2 id="improving-the-connection-protocol">Improving The Connection Protocol</h2><br><p>The first thing we want to do is only allow clients to connect if they can prove they are actually at the IP address and port they say they are.</p><br><p>To do this, we no longer accept client connections immediately on connection request, instead we send back a challenge packet, and only complete connection when a client replies with information that can only be obtained by receiving the challenge packet.</p><br><p>The sequence of operations in a typical connect now looks like this:</p><br><p><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/img/client_server_connection/challenge-response.png" width="100%"></p><br><p>To implement this we need an additional data structure on the server. Somewhere to store the challenge data for pending connections, so when a challenge response comes in from a client we can check against the corresponding entry in the data structure and make sure it&rsquo;s a valid response to the challenge sent to that address.</p><br><p>While the pending connect data structure can be made larger than the maximum number of connected clients, it&rsquo;s still ultimately finite and is therefore subject to attack. We&rsquo;ll cover some defenses against this in the next article. But for the moment, be happy at least that attackers can&rsquo;t progress to the <strong>connected</strong> state with spoofed packet source addresses.</p><br><p>Next, to guard against our protocol being used in a DDoS amplification attack, we&rsquo;ll inflate client to server packets so they&rsquo;re large relative to the response packet sent from the server. This means we add padding to both <strong>connection request</strong> and <strong>challenge response</strong> packets and enforce this padding on the server, ignoring any packets without it. Now our protocol effectively has DDoS <em>minification</em> for requests -&gt; responses, making it highly unattractive for anyone thinking of launching this kind of attack.</p><br><p>Finally, we&rsquo;ll do one last small thing to improve the robustness and security of the protocol. It&rsquo;s not perfect, we need authentication and encryption for that, but it at least it ups the ante, requiring attackers to actually sniff traffic in order to impersonate the client or server. We&rsquo;ll add some unique random identifiers, or &lsquo;salts&rsquo;, to make each client connection unique from previous ones coming from the same IP address and port.</p><br><p>The connection request packet now looks like this:</p><br><p><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/img/client_server_connection/connection-request-packet-2.0.png" width="100%"></p><br><p>The client salt in the packet is a random 64 bit integer rolled each time the client starts a new connect. Connection requests are now uniquely identified by the IP address and port combined with this client salt value. This distinguishes packets from the current connection from any packets belonging to a previous connection, which makes connection and reconnection to the server much more robust.</p><br><p>Now when a connection request arrives and a pending connection entry can&rsquo;t be found in the data structure (according to IP, port and client salt) the server rolls a server salt and stores it with the rest of the data for the pending connection before sending a challange packet back to the client. If a pending connection is found, the salt value stored in the data structure is used for the challenge. This way there is always a consistent pair of client and server salt values corresponding to each client session.</p><br><p><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/img/client_server_connection/challenge-packet.png" width="100%"></p><br><p>The client state machine has been expanded so <em>connecting</em> is replaced with two new states: <em>sending connection request</em> and <em>sending challenge response</em>, but it&rsquo;s the same idea as before. Client states repeatedly send the packet corresponding to that state to the server while listening for the response that moves it forward to the next state, or back to an error state. If no response is received, the client times out and transitions to <em>disconnected</em>.</p><br><p>The challenge response sent from the client to the server looks like this:</p><br><p><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/img/client_server_connection/challenge-response-packet.png" width="100%"></p><br><p>The utility of this being that once the client and server have established connection, we prefix all payload packets with the xor of the client and server salt values and discard any packets with the incorrect salt values. This neatly filters out packets from previous sessions and requires an attacker to sniff packets in order to impersonate a client or server.</p><br><p><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/img/client_server_connection/connection-payload-packet.png" width="100%"></p><br><p>Now that we have at least a <em>basic</em> level of security, it&rsquo;s not much, but at least it&rsquo;s <em>something</em>, we can implement a disconnect packet:</p><br><p><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/img/client_server_connection/disconnect-packet.png" width="100%"></p><br><p>And when the client or server want to disconnect clean, they simply fire 10 of these over the network to the other side, in the hope that some of them get through, and the other side disconnects cleanly instead of waiting for timeout.</p><br><h2 id="conclusion">Conclusion</h2><br><p>We now have a much more robust protocol. It&rsquo;s secure against spoofed IP packet headers. It&rsquo;s no longer able to be used as port of DDoS amplification attacks, and with a trivial xor based authentication, we are protected against <em>casual</em> attackers while client reconnects are much more robust.</p><br><p>But it&rsquo;s still vulnerable to a sophisticated actors who can sniff packets:</p><br><ul><br><li><p>This attacker can read and modify packets in flight.</p></li><br><li><p>This breaks the trivial identification based around salt values&hellip;</p></li><br><li><p>&hellip; giving an attacker the power to disconnect any client at will.</p></li><br></ul><br><p>To solve this, we need to get serious with cryptography to encrypt and sign packets so they can&rsquo;t be read or modified by a third party.</p>
          
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/kbe_note_one/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/kbe_note_one/" itemprop="url">kbeæœåŠ¡ç«¯ç¬”è®°(ä¸€)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-01T19:48:28+00:00">
                04-01-2017
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Misc/" itemprop="url" rel="index">
                    <span itemprop="name">Misc</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          <h1 id="main"><a href="#main" class="headerlink" title="main"></a><strong>main</strong></h1><p>çœ‹èµ·æ¥ä¼¼ä¹æ‰€æœ‰çš„ç»„ä»¶éƒ½æœ‰ä¸€ä¸ªè¿™æ ·çš„å®(KBENGINE_MAIN)æ¥åŒ…è£¹mainå‡½æ•°<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">intKBENGINE_MAIN(intargc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	ENGINE_COMPONENT_INFO&amp;info = g_kbeSrvConfig.getXXX();</span><br><span class="line">	returnkbeMainT&lt;XXX&gt;(argc, argv, YYY, info.externalPorts_min, </span><br><span class="line">		info.externalPorts_max, info.externalInterface, 0, info.internalInterface);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>. . .</strong>
          <!--noindex-->
          
          <!--/noindex-->
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </p></div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/reliable_ordered_messages/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/reliable_ordered_messages/" itemprop="url">æ„å»ºæ¸¸æˆç½‘ç»œåè®®äº”ä¹‹å¯é çš„æœ‰åºæ¶ˆæ¯</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-29T13:13:35+00:00">
                03-29-2017
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GS/" itemprop="url" rel="index">
                    <span itemprop="name">GS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          
            <h1 id="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"><a href="#æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“" class="headerlink" title="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"></a>æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“</h1><p>æœ¬ç¯‡ä¸»è¦è®²äº†æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„é—®é¢˜, åˆ°åº•æ•°æ®åŒ…å¤šå¤§æ‰å¥½å‘¢?æ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½å‘¢?åŒ…å¤ªå¤§äº†æ€ä¹ˆåŠå‘¢?<br>è¯·çœ‹æ€»ç»“, ä¸æ˜ä¹‹å¤„å†çœ‹æ–‡ä¸­å…·ä½“è®²è§£.</p>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå¯é UDPåè®®"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå¯é UDPåè®®" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå¯é UDPåè®®"></a>ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå¯é UDPåè®®</h2><p>ç½‘ç»œåè®®åœ¨åŠ¨ä½œæ¸¸æˆç±»å‹ï¼ˆFPSï¼‰ä¸­çš„å…¸å‹ç‰¹å¾å°±æ˜¯ä¸€ä¸ªæŒç»­å‘é€çš„æ•°æ®åŒ…ï¼Œåœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šä»¥ç¨³å®šçš„é€Ÿåº¦å¦‚20æˆ–30åŒ…æ¯ç§’å‘é€ã€‚è¿™äº›æ•°æ®åŒ…éƒ½åŒ…å«æœ‰ä¸å¯é çš„æ— åºæ•°æ®ä¾‹å¦‚tæ—¶é—´å†…çš„ä¸–ç•ŒçŠ¶æ€ï¼›æ‰€ä»¥ï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼Œé‡æ–°å‘é€å®ƒå¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚å½“é‡æ–°å‘é€çš„æ•°æ®åŒ…åˆ°è¾¾æ—¶ï¼Œæ—¶é—´tå·²ç»è¿‡å»äº†ã€‚</p>
<p>æ‰€ä»¥è¿™å°±æ˜¯æˆ‘ä»¬å°†è¦å®ç°å¯é æ€§çš„ç°çŠ¶ã€‚å¯¹äºæˆ‘ä»¬90%çš„æ•°æ®åŒ…ï¼Œä»…ä¸¢å¼ƒå¹¶ä¸å†é‡æ–°å‘é€å®ƒä¼šæ›´å¥½ã€‚å¯¹äº10%æˆ–æ›´å°‘ï¼ˆè¯¯å·®å…è®¸èŒƒå›´å†…ï¼‰çš„æƒ…å†µï¼Œæˆ‘ä»¬ç¡®å®éœ€è¦å¯é æ€§ï¼Œä½†è¿™æ ·çš„æ•°æ®æ˜¯éå¸¸ç½•è§çš„ï¼Œå¾ˆå°‘è¢«å‘é€è€Œä¸”æ¯”ä¸å¯é çš„æ•°æ®çš„å¹³å‡å¤§å°è¦å°å¾—å¤šã€‚è¿™ä¸ªä½¿ç”¨æ¡ˆä¾‹é€‚ç”¨äºæ‰€æœ‰è¿‡å»åäº”å¹´æ¥å‘å¸ƒçš„AAAçº§çš„FPSæ¸¸æˆã€‚</p>
<h2 id="åº”ç­”ç³»ç»Ÿæ˜¯å®ç°å¯é UDPçš„æœ€é‡è¦çš„éƒ¨åˆ†"><a href="#åº”ç­”ç³»ç»Ÿæ˜¯å®ç°å¯é UDPçš„æœ€é‡è¦çš„éƒ¨åˆ†" class="headerlink" title="åº”ç­”ç³»ç»Ÿæ˜¯å®ç°å¯é UDPçš„æœ€é‡è¦çš„éƒ¨åˆ†"></a>åº”ç­”ç³»ç»Ÿæ˜¯å®ç°å¯é UDPçš„æœ€é‡è¦çš„éƒ¨åˆ†</h2><p>ä¸ºå®ç°æ•°æ®åŒ…å±‚çº§çš„åº”ç­”ï¼Œåœ¨æ¯ä¸ªåŒ…çš„å‰é¢æ·»åŠ å¦‚ä¸‹çš„æŠ¥å¤´ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Header</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">uint16_t</span> sequence;</span><br><span class="line">    <span class="keyword">uint16_t</span> ack;</span><br><span class="line">    <span class="keyword">uint32_t</span> ack_bits;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¿™äº›æŠ¥å¤´å…ƒç´ ç»„åˆèµ·æ¥ä»¥åˆ›å»ºåº”ç­”ç³»ç»Ÿï¼š</p>
<ul>
<li>sequence æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œéšæ¯ä¸ªæ•°æ®åŒ…å‘é€è€Œå¢é•¿ï¼ˆå¹¶ä¸”åœ¨è¾¾åˆ°65535åå›å¾€å¤ï¼‰ã€‚</li>
<li>ack æ˜¯ä»å¦ä¸€æ–¹æ¥æ”¶åˆ°çš„æœ€æ–°çš„æ•°æ®åŒ…åºåˆ—å·ã€‚</li>
<li>ack_bits æ˜¯ä¸€ä¸ªä½å­—æ®µï¼Œå®ƒç¼–ç ä¸ackç›¸å…³çš„æ”¶åˆ°çš„æ•°æ®åŒ…ç»„åˆï¼šå¦‚æœä½nå·²ç»è®¾ç½®ï¼Œå³ ackâ€“ n æ•°æ®åŒ…è¢«æ¥æ”¶äº†ã€‚</li>
</ul>
<p>ack_bits ä¸ä»…æ˜¯ä¸€ä¸ªèŠ‚çœå¸¦å®½çš„å·§å¦™çš„ç¼–ç ï¼Œå®ƒåŒæ ·ä¹Ÿå¢åŠ äº†ä¿¡æ¯å†—ä½™æ¥æŠµå¾¡åŒ…çš„ä¸¢å¤±ã€‚æ¯ä¸ªåº”ç­”ç è¦è¢«å‘é€32æ¬¡ã€‚å¦‚æœæœ‰ä¸€ä¸ªåŒ…ä¸¢å¤±äº†ï¼Œä»ç„¶æœ‰å…¶ä»–31ä¸ªåŒ…æœ‰ç€ç›¸åŒçš„åº”ç­”ç ã€‚ä»ç»Ÿè®¡ä¸Šæ¥è¯´ï¼Œåº”ç­”ç è¿˜æ˜¯éå¸¸æœ‰å¯èƒ½é€è¾¾çš„ã€‚</p>
<p>ä½†çªå‘çš„ä¼ é€æ•°æ®åŒ…çš„ä¸¢å¤±è¿˜æ˜¯æœ‰å¯èƒ½å‘ç”Ÿçš„ï¼Œæ‰€ä»¥é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼š</p>
<ul>
<li>å¦‚æœä½ æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…nçš„åº”ç­”ç ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…è‚¯å®šå·²ç»æ”¶åˆ°äº†ã€‚</li>
<li>å¦‚æœä½ æ²¡æœ‰æ”¶åˆ°åº”ç­”ç ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…å°±å¾ˆæœ‰å¯èƒ½ æ²¡æœ‰è¢«æ”¶åˆ°ã€‚ä½†æ˜¯â€¦å®ƒä¹Ÿè®¸ä¼šæ˜¯ï¼Œä»…æ˜¯åº”ç­”ç æ²¡æœ‰é€è¾¾ã€‚è¿™ç§æƒ…å†µæ˜¯æå…¶ç½•è§çš„ã€‚</li>
</ul>
<p>ä»¥æˆ‘çš„ç»éªŒï¼Œæ²¡æœ‰å¿…è¦è®¾è®¡å®Œå–„çš„åº”ç­”æœºåˆ¶ã€‚åœ¨ä¸€ä¸ªæå°‘ä¸¢åº”ç­”ç çš„ç³»ç»Ÿä¸Šæ„å»ºä¸€ä¸ªå¯é æ€§ç³»ç»Ÿå¹¶ä¸ä¼šå¢åŠ ä»€ä¹ˆå¤§é—®é¢˜ã€‚</p>
<h2 id="å‘é€æ–¹å¦‚ä½•è¿½è¸ªæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«åº”ç­”"><a href="#å‘é€æ–¹å¦‚ä½•è¿½è¸ªæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«åº”ç­”" class="headerlink" title="å‘é€æ–¹å¦‚ä½•è¿½è¸ªæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«åº”ç­”"></a>å‘é€æ–¹å¦‚ä½•è¿½è¸ªæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«åº”ç­”</h2><p>ä¸ºå®ç°è¿™ä¸ªåº”ç­”ç³»ç»Ÿï¼Œæˆ‘ä»¬åœ¨å‘é€æ–¹è¿˜éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥è¿½è¸ªä¸€ä¸ªæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«åº”ç­”ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¿½ç•¥å†—ä½™çš„åº”ç­”ï¼ˆæ¯ä¸ªåŒ…ä¼šé€šè¿‡ <code>ack_bits</code>å¤šæ¬¡åº”ç­”)ã€‚æˆ‘ä»¬åŒæ ·åœ¨æ¥æ”¶æ–¹ä¹Ÿè¿˜éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥è¿½è¸ªé‚£äº›å·²ç»æ”¶åˆ°çš„åŒ…ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨æ•°æ®åŒ…çš„æŠ¥å¤´å¡«å†™<code>ack_bits</code>çš„å€¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> BufferSize = <span class="number">1024</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">uint32_t</span> sequence_buffer[BufferSize];</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PacketData</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">bool</span> acked;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">PacketData packet_data[BufferSize];</span><br><span class="line"> </span><br><span class="line"><span class="function">PacketData * <span class="title">GetPacketData</span><span class="params">( <span class="keyword">uint16_t</span> sequence )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> index = sequence % BufferSize;</span><br><span class="line">    <span class="keyword">if</span> ( sequence_buffer[index] == sequence )</span><br><span class="line">        <span class="keyword">return</span> &amp;packet_data[index];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ åœ¨è¿™å¯ä»¥çœ‹åˆ°çš„çªé—¨æ˜¯è¿™ä¸ªæ»šåŠ¨çš„ç¼“å†²åŒºæ˜¯ä»¥åºåˆ—å·æ¥ä½œä¸ºç´¢å¼•çš„ï¼š</p>
<p><code>const int index =sequence % BufferSize;</code></p>
<p>å½“æ¡ç›®è¢«é¡ºåºæ·»åŠ ï¼Œå°±åƒä¸€ä¸ªè¢«å‘é€çš„é˜Ÿåˆ—ï¼Œå¯¹æ’å…¥æ‰€éœ€è¦åšçš„å°±æ˜¯æŠŠè¿™ä¸ªåºåˆ—ç¼“å†²åŒºçš„å€¼æ›´æ–°ä¸ºæ–°çš„åºåˆ—å·å¹¶ä¸”åœ¨è¯¥ç´¢å¼•å¤„é‡å†™è¿™ä¸ªæ•°æ®ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">PacketData &amp; <span class="title">InsertPacketData</span><span class="params">( <span class="keyword">uint16_t</span> sequence )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> index = sequence % BufferSize;</span><br><span class="line">    sequence_buffer[index] = sequence;</span><br><span class="line">    <span class="keyword">return</span> packet_data[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="åŸæ–‡"><a href="#åŸæ–‡" class="headerlink" title="åŸæ–‡"></a>åŸæ–‡</h1><p><a href="https://gafferongames.com/post/reliable_ordered_messages/" target="_blank" rel="noopener">åŸæ–‡å‡ºå¤„</a></p>
<p>åŸæ–‡æ ‡é¢˜ : <strong>Reliable Ordered Messages</strong> (<em>How to implement reliable-ordered messages on top of UDP</em>)</p>
<hr>
<p></p><h2 id="introduction">Introduction</h2><p></p>
<p>Hi, Iâ€™m <a href="https://gafferongames.com/about" target="_blank" rel="noopener">Glenn Fiedler</a> and welcome to <strong><a href="https://gafferongames.com/categories/building-a-game-network-protocol/" target="_blank" rel="noopener">Building a Game Network Protocol</a></strong>.</p><br><p>Many people will tell you that implementing your own reliable message system on top of UDP is foolish. After all, why reimplement TCP?</p><br><p>But why limit ourselves to how TCP works? But there are so many different ways to implement reliable-messages and most of them work <em>nothing</em> like TCP!</p><br><p>So let&rsquo;s get creative and work out how we can implement a reliable message system that&rsquo;s <em>better</em> and <em>more flexible</em> than TCP for real-time games.</p><br><h2 id="different-approaches">Different Approaches</h2><br><p>A common approach to reliability in games is to have two packet types: reliable-ordered and unreliable. You&rsquo;ll see this approach in many network libraries.</p><br><p>The basic idea is that the library resends reliable packets until they are received by the other side. This is the option that usually ends up looking a bit like TCP-lite for the reliable-packets. It&rsquo;s not that bad, but you can do much better.</p><br><p>The way I prefer to think of it is that messages are smaller bitpacked elements that know how to serialize themselves. This makes the most sense when the overhead of length prefixing and padding bitpacked messages up to the next byte is undesirable (eg. lots of small messages included in each packet). Sent messages are placed in a queue and each time a packet is sent some of the messages in the send queue are included in the outgoing packet. This way there are no reliable packets that need to be resent. Reliable messages are simply included in outgoing packets until they are received.</p><br><p>The easiest way to do this is to include all unacked messages in each packet sent. It goes something like this: each message sent has an id that increments each time a message is sent. Each outgoing packet includes the start <em>message id</em> followed by the data for <em>n</em> messages. The receiver continually sends back the most recent received message id to the sender as an ack and only messages newer than the most recent acked message id are included in packets.</p><br><p>This is simple and easy to implement but if a large burst of packet loss occurs while you are sending messages you get a spike in packet size due to unacked messages.</p><br><p>You can avoid this by extending the system to have an upper bound on the number of messages included per-packet <em>n</em>. But now if you have a high packet send rate (like 60 packets per-second) you are sending the same message multiple times until you get an ack for that message.</p><br><p>If your round trip time is 100ms each message will be sent 6 times redundantly before being acked on average. Maybe you really need this amount of redundancy because your messages are extremely time critical, but in most cases, your bandwidth would be better spent on other things.</p><br><p>The approach I prefer combines packet level acks with a prioritization system that picks the n most important messages to include in each packet. This combines time critical delivery and the ability to send only n messages per-packet, while distributing sends across all messages in the send queue.</p><br><h2 id="packet-level-acks">Packet Level Acks</h2><br><p>To implement packet level acks, we add the following packet header:</p><br><pre>struct Header<br>{<br>    uint16_t sequence;<br>    uint16_t ack;<br>    uint32_t ack_bits;<br>};<br></pre><br><p>These header elements combine to create the ack system: <strong>sequence</strong> is a number that increases with each packet sent, <strong>ack</strong> is the most recent packet sequence number received, and <strong>ack_bits</strong> is a bitfield encoding the set of acked packets.</p><br><p>If bit <strong>n</strong> is set in <strong>ack_bits</strong>, then <strong>ack - n</strong> is acked. Not only is <strong>ack_bits</strong> a smart encoding that saves bandwidth, it also adds <em>redundancy</em> to combat packet loss. Each ack is sent 32 times. If one packet is lost, there&rsquo;s 31 other packets with the same ack. Statistically speaking, acks are very likely to get through.</p><br><p>But bursts of packet loss do happen, so it&rsquo;s important to note that:</p><br><ol><br><li><p>If you receive an ack for packet n then that packet was <strong>definitely received</strong>.</p></li><br><li><p>If you don&rsquo;t receive an ack, the packet was <em>most likely</em> not received. But, it might have been, and the ack just didn&rsquo;t get through. <strong>This is extremely rare</strong>.</p></li><br></ol><br><p>In my experience it&rsquo;s not necessary to send perfect acks. Building a reliability system on top of a system that very rarely drops acks adds no significant problems. But it does create a challenge for testing this system works under all situations because of the edge cases when acks are dropped.</p><br><p>So please if you do implement this system yourself, setup a soak test with terrible network conditions to make sure your ack system is working correctly. You&rsquo;ll find such a soak test in the <a href="http://www.patreon.com/gafferongames" target="_blank" rel="noopener">example source code</a> for this article, and the open source network libraries <a href="https://github.com/networkprotocol/reliable.io" target="_blank" rel="noopener">reliable.io</a> and <a href="http://www.libyojimbo.com" target="_blank" rel="noopener">yojimbo</a> which also implement this technique.</p><br><h2 id="sequence-buffers">Sequence Buffers</h2><br><p>To implement this ack system we need a data structure on the sender side to track whether a packet has been acked so we can ignore redundant acks (each packet is acked multiple times via <strong>ack_bits</strong>. We also need a data structure on the receiver side to keep track of which packets have been received so we can fill in the <strong>ack_bits</strong> value in the packet header.</p><br><p>The data structure should have the following properties:</p><br><ul><br><li>Constant time insertion (inserts may be <em>random</em>, for example out of order packets&hellip;)</li><br><li>Constant time query if an entry exists given a packet sequence number</li><br><li>Constant time access for the data stored for a given packet sequence number</li><br><li>Constant time removal of entries</li><br></ul><br><p>You might be thinking. Oh of course, <em>hash table</em>. But there&rsquo;s a much simpler way:</p><br><pre>const int BufferSize = 1024;<br><br>uint32_t sequence_buffer[BufferSize];<br><br>struct PacketData<br>{<br>    bool acked;<br>};<br><br>PacketData packet_data[BufferSize];<br><br>PacketData <em> GetPacketData( uint16_t sequence )<br>{<br>    const int index = sequence % BufferSize;<br>    if ( sequence_buffer[index] == sequence )<br>        return &amp;packet_data[index];<br>    else<br>        return NULL;<br>}<br></em></pre><br><p>As you can see the trick here is a rolling buffer indexed by sequence number:</p><br><pre>const int index = sequence % BufferSize;<br></pre><br><p>This works because we don&rsquo;t care about being destructive to old entries. As the sequence number increases older entries are naturally overwritten as we insert new ones. The sequence_buffer[index] value is used to test if the entry at that index actually corresponds to the sequence number you&rsquo;re looking for. A sequence buffer value of 0xFFFFFFFF indicates an empty entry and naturally returns NULL for any sequence number query without an extra branch.</p><br><p>When entries are added in order like a send queue, all that needs to be done on insert is to update the sequence buffer value to the new sequence number and overwrite the data at that index:</p><br><pre>PacketData &amp; InsertPacketData( uint16_t sequence )<br>{<br>    const int index = sequence % BufferSize;<br>    sequence_buffer[index] = sequence;<br>    return packet_data[index];<br>}<br></pre><br><p>Unfortunately, on the receive side packets arrive out of order and some are lost. Under ridiculously high packet loss (99%) I&rsquo;ve seen old sequence buffer entries stick around from before the previous sequence number wrap at 65535 and break my ack logic (leading to false acks and broken reliability where the sender thinks the other side has received something they haven&rsquo;t&hellip;).</p><br><p>The solution to this problem is to walk between the previous highest insert sequence and the new insert sequence (if it is more recent) and clear those entries in the sequence buffer to 0xFFFFFFFF. Now in the common case, insert is <em>very close</em> to constant time, but worst case is linear where n is the number of sequence entries between the previous highest insert sequence and the current insert sequence.</p><br><p>Before we move on I would like to note that you can do much more with this data structure than just acks. For example, you could extend the per-packet data to include time sent:</p><br><pre>struct PacketData<br>{<br>    bool acked;<br>    double send_time;<br>};<br></pre><br><p>With this information you can create your own estimate of round trip time by comparing send time to current time when packets are acked and taking an <a href="https://en.wikipedia.org/wiki/Exponential_smoothing" target="_blank" rel="noopener">exponentially smoothed moving average</a>. You can even look at packets in the sent packet sequence buffer older than your RTT estimate (you should have received an ack for them by now&hellip;) to create your own packet loss estimate.</p><br><h2 id="ack-algorithm">Ack Algorithm</h2><br><p>Now that we have the data structures and packet header, here is the algorithm for implementing packet level acks:</p><br><p><strong>On packet send:</strong></p><br><ol><br><li><p>Insert an entry for for the current send packet sequence number in the sent packet sequence buffer with data indicating that it hasn&rsquo;t been acked yet</p></li><br><li><p>Generate <strong>ack</strong> and <strong>ack_bits</strong> from the contents of the local received packet sequence buffer and the most recent received packet sequence number</p></li><br><li><p>Fill the packet header with <strong>sequence</strong>, <strong>ack</strong> and <strong>ack_bits</strong></p></li><br><li><p>Send the packet and increment the send packet sequence number</p></li><br></ol><br><p><strong>On packet receive:</strong></p><br><ol><br><li><p>Read in <strong>sequence</strong> from the packet header</p></li><br><li><p>If <strong>sequence</strong> is more recent than the previous most recent received packet sequence number, update the most recent received packet sequence number</p></li><br><li><p>Insert an entry for this packet in the received packet sequence buffer</p></li><br><li><p>Decode the set of acked packet sequence numbers from <strong>ack</strong> and <strong>ack_bits</strong> in the packet header.</p></li><br><li><p>Iterate across all acked packet sequence numbers and for any packet that is not already acked call <strong>OnPacketAcked</strong>( uint16_t sequence ) and mark that packet as <em>acked</em> in the sent packet sequence buffer.</p></li><br></ol><br><p>Importantly this algorithm is done on both sides so if you have a client and a server then each side of the connection runs the same logic, maintaining its own sequence number for sent packets, tracking most recent received packet sequence # from the other side and a sequence buffer of received packets from which it generates <strong>sequence</strong>, <strong>ack</strong> and <strong>ack_bits</strong> to send to the other side.</p><br><p>And that&rsquo;s really all there is to it. Now you have a callback when a packet is received by the other side: <strong>OnPacketAcked</strong>. The main benefit of this ack system is now that you know which packets were received, you can build <em>any</em> reliability system you want on top. It&rsquo;s not limited to just reliable-ordered messages. For example, you could use it to implement delta encoding on a per-object basis.</p><br><h2 id="message-objects">Message Objects</h2><br><p>Messages are small objects (smaller than packet size, so that many will fit in a typical packet) that know how to serialize themselves. In my system they perform serialization using a <a href="https://gafferongames.com/building-a-game-network-protocol/serialization-strategies" target="_blank" rel="noopener">unified serialize function</a>unified serialize function.</p><br><p>The serialize function is templated so you write it once and it handles read, write and <em>measure</em>.</p><br><p>Yes. Measure. One of my favorite tricks is to have a dummy stream class called <strong>MeasureStream</strong> that doesn&rsquo;t do any actual serialization but just measures the number of bits that <em>would</em> be written if you called the serialize function. This is particularly useful for working out which messages are going to fit into your packet, especially when messages themselves can have arbitrarily complex serialize functions.</p><br><pre>struct TestMessage : public Message<br>{<br>    uint32_t a,b,c;<br><br>    TestMessage()<br>    {<br>        a = 0;<br>        b = 0;<br>        c = 0;<br>    }<br><br>    template &lt;typename Stream&gt; bool Serialize( Stream &amp; stream )<br>    {<br>        serialize_bits( stream, a, 32 );<br>        serialize_bits( stream, b, 32 );<br>        serialize_bits( stream, c, 32 );<br>        return true;<br>    }<br><br>    virtual SerializeInternal( WriteStream &amp; stream )<br>    {<br>        return Serialize( stream );<br>    }<br><br>    virtual SerializeInternal( ReadStream &amp; stream )<br>    {<br>        return Serialize( stream );<br>    }<br><br>    virtual SerializeInternal( MeasureStream &amp; stream )<br>    {<br>        return Serialize( stream );<br>    }<br>};<br></pre><br><p>The trick here is to bridge the unified templated serialize function (so you only have to write it once) to virtual serialize methods by calling into it from virtual functions per-stream type. I usually wrap this boilerplate with a macro, but it&rsquo;s expanded in the code above so you can see what&rsquo;s going on.</p><br><p>Now when you have a base message pointer you can do this and it <em>just works</em>:</p><br><pre>Message  message = CreateSomeMessage();<br>message-&gt;SerializeInternal( stream );<br></pre><br><p>An alternative if you know the full set of messages at compile time is to implement a big switch statement on message type casting to the correct message type before calling into the serialize function for each type. I&rsquo;ve done this in the past on console platform implementations of this message system (eg. PS3 SPUs) but for applications today (2016) the overhead of virtual functions is neglible.</p><br><p>Messages derive from a base class that provides a common interface such as serialization, querying the type of a message and reference counting. Reference counting is necessary because messages are passed around by pointer and stored not only in the message send queue until acked, but also in outgoing packets which are themselves C++ structs.</p><br><p>This is a strategy to avoid copying data by passing both messages and packets around by pointer. Somewhere else (ideally on a separate thread) packets and the messages inside them are serialized to a buffer. Eventually, when no references to a message exist in the message send queue (the message is acked) and no packets including that message remain in the packet send queue, the message is destroyed.</p><br><p>We also need a way to create messages. I do this with a message factory class with a virtual function overriden to create a message by type. It&rsquo;s good if the packet factory also knows the total number of message types, so we can serialize a message type over the network with tight bounds and discard malicious packets with message type values outside of the valid range:</p><br><pre>enum TestMessageTypes<br>{<br>    TEST_MESSAGE_A,<br>    TEST_MESSAGE_B,<br>    TEST_MESSAGE_C,<br>    TEST_MESSAGE_NUM_TYPES<br>};<br><br>// message definitions omitted<br><br>class TestMessageFactory : public MessageFactory<br>{<br>public:<br><br>    Message <em> Create( int type )<br>    {<br>        switch ( type )<br>        {<br>            case TEST_MESSAGE_A: return new TestMessageA();<br>            case TEST_MESSAGE_B: return new TestMessageB();<br>            case TEST_MESSAGE_C: return new TestMessageC();<br>        }<br>    }<br><br>    virtual int GetNumTypes() const<br>    {<br>        return TEST_MESSAGE_NUM_TYPES;<br>    }<br>};<br></em></pre><br><p>Again, this is boilerplate and is usually wrapped by macros, but underneath this is what&rsquo;s going on.</p><br><h2 id="reliable-ordered-message-algorithm">Reliable Ordered Message Algorithm</h2><br><p>The algorithm for sending reliable-ordered messages is as follows:</p><br><p><strong>On message send:</strong></p><br><ol><br><li><p>Measure how many bits the message serializes to using the measure stream</p></li><br><li><p>Insert the message pointer and the # of bits it serializes to into a sequence buffer indexed by message id. Set the time that message has last been sent to -1</p></li><br><li><p>Increment the send message id</p></li><br></ol><br><p><strong>On packet send:</strong></p><br><ol><br><li><p>Walk across the set of messages in the send message sequence buffer between the oldest unacked message id and the most recent inserted message id from left -&gt; right (increasing message id order).</p></li><br><li><p>Never send a message id that the receiver can&rsquo;t buffer or you&rsquo;ll break message acks (since that message won&rsquo;t be buffered, but the packet containing it will be acked, the sender thinks the message has been received, and will not resend it). This means you must <em>never</em> send a message id equal to or more recent than the oldest unacked message id plus the size of the message receive buffer.</p></li><br><li><p>For any message that hasn&rsquo;t been sent in the last 0.1 seconds <em>and</em> fits in the available space we have left in the packet, add it to the list of messages to send. Messages on the left (older messages) naturally have priority due to the iteration order.</p></li><br><li><p>Include the messages in the outgoing packet and add a reference to each message. Make sure the packet destructor decrements the ref count for each message.</p></li><br><li><p>Store the number of messages in the packet <strong>n</strong> and the array of message ids included in the packet in a sequence buffer indexed by the outgoing packet sequence number so they can be used to map packet level acks to the set of messages included in that packet.</p></li><br><li><p>Add the packet to the packet send queue.</p></li><br></ol><br><p><strong>On packet receive:</strong></p><br><ol><br><li><p>Walk across the set of messages included in the packet and insert them in the receive message sequence buffer indexed by their message id.</p></li><br><li><p>The ack system automatically acks the packet sequence number we just received.</p></li><br></ol><br><p><strong>On packet ack:</strong></p><br><ol><br><li><p>Look up the set of messages ids included in the packet by sequence number.</p></li><br><li><p>Remove those messages from the message send queue if they exist and decrease their ref count.</p></li><br><li><p>Update the last unacked message id by walking forward from the previous unacked message id in the send message sequence buffer until a valid message entry is found, or you reach the current send message id. Whichever comes first.</p></li><br></ol><br><p><strong>On message receive:</strong></p><br><ol><br><li><p>Check the receive message sequence buffer to see if a message exists for the current receive message id.</p></li><br><li><p>If the message exists, remove it from the receive message sequence buffer, increment the receive message id and return a pointer to the message.</p></li><br><li><p>Otherwise, no message is available to receive. Return <strong>NULL</strong>.</p></li><br></ol><br><p>In short, messages keep getting included in packets until a packet containing that message is acked. We use a data structure on the sender side to map packet sequence numbers to the set of message ids to ack. Messages are removed from the send queue when they are acked. On the receive side, messages arriving out of order are stored in a sequence buffer indexed by message id, which lets us receive them in the order they were sent.</p><br><h2 id="the-end-result">The End Result</h2><br><p>This provides the user with an interface that looks something like this on send:</p><br><pre>TestMessage  message = (TestMessage<em>) factory.Create( TEST_MESSAGE );<br>if ( message )<br>{<br>    message-&gt;a = 1;<br>    message-&gt;b = 2;<br>    message-&gt;c = 3;<br>    connection.SendMessage( message );<br>}</em></pre><br><p>And on the receive side:</p><br><pre>while ( true )<br>{<br>    Message  message = connection.ReceiveMessage();<br>    if ( !message )<br>        break;<br><br>    if ( message-&gt;GetType() == TEST_MESSAGE )<br>    {<br>        TestMessage <em> testMessage = (TestMessage</em>) message;<br>        // process test message<br>    }<br><br>    factory.Release( message );<br>}<br></pre><br><p>Which is flexible enough to implement whatever you like on top of it.</p>


<h1 id="è¯‘æ–‡">è¯‘æ–‡</h1>


<p><a href="http://gad.qq.com/program/translateview/7168700" target="_blank" rel="noopener">è¯‘æ–‡å‡ºå¤„</a></p>
<div class="WordSection1"><div><p class="MsoNormal" align="left" style="vertical-align: baseline; border: none; padding: 0cm;"><span style="font-family:å¾®è½¯é›…é»‘;font-size:medium;"><span style="color: rgb(34, 34, 34);">è¯‘è€…ï¼šç¿åƒ–éªï¼ˆ</span><span style="color: rgb(34, 34, 34);"><a href="http://gad.qq.com/user/index?id=304098" target="_blank" rel="noopener"><span><span>âˆˆæ˜Ÿé™…é•¿é€”â†</span></span></a></span><span style="color: rgb(34, 34, 34);">ï¼‰</span><span style="color: rgb(34, 34, 34);">  </span><span style="color: rgb(34, 34, 34);">å®¡æ ¡ï¼šä¾¯é¹ï¼ˆ</span><span style="color: rgb(34, 34, 34);"><a href="http://gad.qq.com/user/index?id=391222" target="_blank" rel="noopener"><span><span>å¶è½&amp;</span></span><span><span>æ— ç—•</span></span></a></span><span style="color: rgb(34, 34, 34);">ï¼‰</span><span style="color: rgb(34, 34, 34);"> </span></span> </p></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å—¨ï¼Œæˆ‘æ˜¯æ ¼ä¼¦è´¹å¾·å‹’ï¼Œæ¬¢è¿æ¥åˆ°</span><u><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#DD3333">åˆ›å»ºä¸€ä¸ªæ¸¸æˆç½‘ç»œåè®®</span></u><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ç¬¬äº”ç¯‡æ–‡ç« ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä»<span><a rel="noopener" href="http://gafferongames.com/building-a-game-network-protocol/sending-large-blocks-of-data/" target="_blank"><span style="color:#DD3333"><span>ä¸Šä¸€ç¯‡æ–‡ç« </span></span></a></span>åˆ°ç°åœ¨å·²ç»æœ‰å¾ˆé•¿ä¸€æ®µæ—¶é—´äº†ï¼Œä¸Šæ¬¡æˆ‘å·²ç»ç‡å…ˆè€Œä¸”å®ç°äº†ä½™ä¸‹çš„è¿™ä¸€ç³»åˆ—æ–‡ç« æ‰€éœ€çš„æºç å¹¶åˆ›å»ºäº†å¼€æºåº“<span><a rel="noopener" href="https://github.com/networkprotocol/libyojimbo" target="_blank"><span style="color:#DD3333">libyojimbo</span></a></span>ï¼Œæ˜¯æœ¬ç³»åˆ—æ–‡ç« æ‰€è¦æè¿°çš„ç½‘ç»œåè®®çš„ä¸€ä¸ªè´¨é‡æœ‰ä¿è¯çš„çš„å’Œç»è¿‡å•å…ƒæµ‹è¯•çš„ç‰ˆæœ¬ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å¦‚æœä½ æƒ³è¦æœ‰ä¸€ä¸ªå¼€æºåº“æ¥ä¸ºè‡ªå·±åœ¨<span>UDP</span>ä¹‹ä¸Šå®ç°å¯é æ¶ˆæ¯æˆ–æ˜¯ä¸ºäº†å…¶ä»–æ›´å¤šï¼Œçœ‹çœ‹<span><a rel="noopener" href="https://github.com/networkprotocol/libyojimbo" target="_blank"><span style="color:#DD3333">libyojimbo</span></a></span>ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åƒæˆ‘è¿™æ ·æ˜¯æƒ³ç†è§£å®ƒå…·ä½“æ˜¯æ€ä¹ˆå·¥ä½œçš„å¹¶ä¸”å¯èƒ½è‡ªå·±å»å®ç°å®ƒï¼Œé˜…è¯»ä¸‹å»ï¼Œå› ä¸ºæˆ‘ä»¬å°†è¦ä»å¤´åˆ°è„šåœ°å»å»ºç«‹ä¸€ä¸ªåœ¨<span>UDP</span>ä¹‹ä¸Šç”¨æ¥å‘é€å¯é æœ‰åºæ¶ˆæ¯çš„å®Œæ•´çš„ç³»ç»Ÿï¼</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="è¯´æ˜"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¯´æ˜</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å¾ˆå¤šäººä¹Ÿè®¸ä¼šè·Ÿä½ è¯´ï¼Œè¦åœ¨<span>UDP</span>ä¹‹ä¸Šå®ç°ä½ è‡ªå·±çš„å¯é æ¶ˆæ¯ç³»ç»Ÿæ˜¯æ„šè ¢çš„ã€‚ä¸ºä»€ä¹ˆè¦æ’°å†™ä½ ç‰¹æœ‰çš„ç®€åŒ–ç‰ˆæœ¬çš„<span>TCP</span>ï¼Ÿè¿™äº›äººæ·±ä¿¡ï¼Œä»»ä½•å¯é æ€§çš„å®ç°<i><u><span style="border:none windowtext 1.0pt;padding:0cm">ä¸å¯é¿å…åœ°</span></u></i><span> </span>æœ€ç»ˆä¼šæˆä¸ºä¸€ä¸ªï¼ˆç®€åŒ–çš„ï¼‰<span>TCP</span>çš„é‡å®ç°ã€‚ </span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½†ä¹Ÿæœ‰å¾ˆå¤šä¸åŒçš„æ–¹æ³•æ¥åœ¨<span>UDP</span>ä¹‹ä¸Šå®ç°å¯é æ¶ˆæ¯ï¼Œå„æœ‰ä¸åŒçš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚<span>TCP</span>çš„æ–¹æ³•å¹¶ä¸æ˜¯å”¯ä¸€çš„é€‰æ‹©ã€‚äº‹å®ä¸Šï¼Œæˆ‘æ‰€äº†è§£åˆ°çš„å¤§å¤šæ•°å¯é æœ‰åºä¿¡æ¯çš„é€‰æ‹©çš„åŸç†å’Œ<span>TCP</span>å¹¶ä¸ç›¸åŒã€‚æ‰€ä»¥è®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„ç›®æ ‡å‘æŒ¥åˆ›é€ åŠ›å¹¶å¼„æ‡‚æˆ‘ä»¬è¯¥å¦‚ä½•å……åˆ†åˆ©ç”¨æˆ‘ä»¬çš„ç°çŠ¶æ¥å®ç°ä¸€ä¸ªæ¯”<span>TCP</span><i><u><span style="border:none windowtext 1.0pt;padding:0cm">æ›´å¥½</span></u></i><span> </span>çš„å¯é æ€§ç³»ç»Ÿã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ç½‘ç»œåè®®åœ¨åŠ¨ä½œæ¸¸æˆç±»å‹ï¼ˆ<span>FPS</span>ï¼‰ä¸­çš„å…¸å‹ç‰¹å¾å°±æ˜¯ä¸€ä¸ª<u><span style="border:none windowtext 1.0pt;padding:0cm">æŒç»­å‘é€çš„æ•°æ®åŒ…ï¼Œ</span></u>åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šä»¥ç¨³å®šçš„é€Ÿåº¦å¦‚<span>20</span>æˆ–<span>30</span>åŒ…æ¯ç§’å‘é€ã€‚è¿™äº›æ•°æ®åŒ…éƒ½åŒ…å«æœ‰ä¸å¯é çš„æ— åºæ•°æ®ä¾‹å¦‚<span>t</span>æ—¶é—´å†…çš„ä¸–ç•ŒçŠ¶æ€ï¼›æ‰€ä»¥ï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼Œé‡æ–°å‘é€å®ƒå¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚å½“é‡æ–°å‘é€çš„æ•°æ®åŒ…åˆ°è¾¾æ—¶ï¼Œæ—¶é—´<span>t</span>å·²ç»è¿‡å»äº†ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ‰€ä»¥è¿™å°±æ˜¯æˆ‘ä»¬å°†è¦å®ç°å¯é æ€§çš„ç°çŠ¶ã€‚å¯¹äºæˆ‘ä»¬<span>90%</span>çš„æ•°æ®åŒ…ï¼Œä»…ä¸¢å¼ƒå¹¶ä¸å†é‡æ–°å‘é€å®ƒä¼šæ›´å¥½ã€‚å¯¹äº<span>10%</span>æˆ–æ›´å°‘ï¼ˆè¯¯å·®å…è®¸èŒƒå›´å†…ï¼‰çš„æƒ…å†µï¼Œæˆ‘ä»¬ç¡®å®éœ€è¦å¯é æ€§ï¼Œä½†è¿™æ ·çš„æ•°æ®æ˜¯éå¸¸ç½•è§çš„ï¼Œå¾ˆå°‘è¢«å‘é€è€Œä¸”æ¯”ä¸å¯é çš„æ•°æ®çš„å¹³å‡å¤§å°è¦å°å¾—å¤šã€‚è¿™ä¸ªä½¿ç”¨æ¡ˆä¾‹é€‚ç”¨äºæ‰€æœ‰è¿‡å»åäº”å¹´æ¥å‘å¸ƒçš„<span>AAA</span>çº§çš„<span>FPS</span>æ¸¸æˆã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="ä¸åŒçš„æ–¹æ³•"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä¸åŒçš„æ–¹æ³•</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å¯é æ€§çš„ä¸€ä¸ªå¸¸ç”¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸¤ç§åŒ…ç±»å‹ï¼šå¯é æœ‰åºçš„å’Œä¸å¯é çš„ã€‚ä½ åœ¨ä¼—å¤šç½‘ç»œåº“ä¸­éƒ½ä¼šçœ‹åˆ°è¿™ä¸ªæ–¹æ³•ã€‚å®ƒåŸºæœ¬çš„æƒ³æ³•æ˜¯ï¼Œè¿™ä¸ªåº“ä¸æ–­é‡æ–°å‘é€å¯é çš„æ•°æ®åŒ…ç›´åˆ°å®ƒçš„å¦ä¸€æ–¹æ¥æ”¶åˆ°ä¸ºæ­¢ã€‚è¿™æ˜¯ä¸€ä¸ªæœ€ç»ˆçœ‹èµ·æ¥ä¼šæœ‰ä¸€ç‚¹åƒ<span>TCP</span>æ–¹å¼ä¼ è¾“çš„å¯é åŒ…çš„é€‰æ‹©ã€‚è¿™å¹¶æ²¡æœ‰å¾ˆç³Ÿç³•ï¼Œä½†ä½ ä¹Ÿå¯ä»¥åšå¾—æ›´å¥½ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æˆ‘æ›´æ„¿æ„å»è€ƒè™‘çš„æ–¹æ³•å°±æ˜¯æ¶ˆæ¯å…¶å®æ˜¯æ›´å°çš„ä½åŒ…è£…å…ƒç´ ï¼Œå®ƒçŸ¥é“å¦‚ä½•ä½¿å®ƒä»¬è‡ªå·±åºåˆ—åŒ–ã€‚è¿™å°±æ˜¾å¾—éå¸¸æœ‰æ„ä¹‰äº†ï¼Œå› ä¸ºæŒ‰ä½æ‰“åŒ…çš„æ¶ˆæ¯ä¸­ï¼Œç”¨äºæè¿°ä¸‹ä¸ªå­—èŠ‚çš„å‰ç¼€æˆ–è€…åç¼€çš„å­—èŠ‚å¼€é”€åœ¨å¤§éƒ¨åˆ†çš„æƒ…å†µä¸‹æ˜¯ä¸å¿…éœ€çš„ï¼ˆä¾‹å¦‚æ¯ä¸ªåŒ…ä¸­åŒ…å«çš„è®¸å¤šå°çš„æ¶ˆæ¯ï¼‰ã€‚è¢«å‘é€çš„æ¶ˆæ¯ä¼šè¢«æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—å¹¶ä¸”æ¯æ¬¡ä¸€ä¸ªåŒ…è¢«å‘é€æ—¶ï¼Œå‘é€é˜Ÿåˆ—ä¸­çš„ä¸€äº›æ¶ˆæ¯å°±ä¼šè¢«åŒ…å«åœ¨å¤–å‘çš„åŒ…ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±æ²¡æœ‰å¯é çš„æ•°æ®åŒ…éœ€è¦è¢«é‡æ–°å‘é€äº†ã€‚å¯é æ¶ˆæ¯ä¹Ÿåªä¼šåŒ…å«åœ¨æ•°æ®åŒ…é‡Œç›´åˆ°å®ƒä»¬è¢«æ¥æ”¶ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¦åšåˆ°è¿™æ ·æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ï¼ŒæŠŠæ‰€æœ‰æœªåº”ç­”çš„æ¶ˆæ¯åŒ…å«åˆ°æ¯ä¸ªè¢«å‘é€çš„åŒ…ä¸­ã€‚å®ƒæ˜¯è¿™æ ·çš„ï¼šæ¯ä¸ªè¢«å‘é€çš„æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªéšæ¯å½“ä¸€ä¸ªæ¶ˆæ¯è¢«å‘é€æ—¶é€’å¢çš„<span>id</span>ã€‚æ¯ä¸ªè¾“å‡ºæ•°æ®åŒ…åŒ…å«èµ·å§‹<b><span style="border:none windowtext 1.0pt;padding:0cm">æ¶ˆæ¯<span>id</span></span></b><span> </span>ï¼Œç´§è·Ÿç€çš„æ˜¯<b><span style="border:none windowtext 1.0pt;padding:0cm">n</span></b><span> </span>ä¸ªæ¶ˆæ¯çš„æ•°æ®ã€‚æ¥æ”¶æ–¹ä¸æ–­å‘å›æœ€æ–°æ”¶åˆ°æ¶ˆæ¯çš„<span>id</span>ç»™å‘é€æ–¹ä½œä¸ºä¸€ä¸ªåº”ç­”ä¿¡å·ï¼Œå¹¶ä¸”æ¶ˆæ¯è¦å½“ä¸”ä»…å½“æ¯”æœ€æ–°çš„åº”ç­”æ¶ˆæ¯<span>id</span>è¦æ›´æ–°ï¼Œæ‰ä¼šè¢«åŒ…å«åœ¨æ•°æ®åŒ…ä¸­ã€‚ </span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™å¾ˆç®€å•ä¹Ÿæ˜“äºå®ç°ï¼Œä½†å½“ä½ æ­£åœ¨å‘é€æ¶ˆæ¯æ—¶å¦‚æœçªå‘ä¸€ä¸ªå¾ˆå¤§çš„åŒ…ä¸¢å¤±æƒ…å†µï¼Œä½ ä¼šé‡åˆ°ä¸€ä¸ªæ•°æ®åŒ…å¤§å°çš„å³°å€¼ï¼Œå› ä¸ºæœ‰å¾ˆå¤šæœªåº”ç­”çš„æ¶ˆæ¯ã€‚ã€‚æ­£å¦‚åœ¨<span><a rel="noopener" href="http://gafferongames.com/building-a-game-network-protocol/packet-fragmentation-and-reassembly/" target="_blank"><span style="color:#DD3333"><span>æ•°æ®åŒ…åˆ†å‰²</span></span><span style="color:#DD3333"><span>å’Œé‡ç»„</span></span></a></span>ä¸­è®¨è®ºçš„éœ€è¦æŒ‰ç…§<span>MTU</span>åˆ†å‰²åŒ…çš„æ–¹å¼æ¥å‘é€å¤§çš„æ•°æ®åŒ…ä¼šå¢åŠ ä¸¢åŒ…çš„æƒ…å†µã€‚åœ¨é«˜ä¸¢åŒ…ç‡ä¸‹ä½ æœ€ä¸æƒ³åšçš„å°±æ˜¯å¢å¤§åŒ…çš„è§„æ ¼å¹¶å¼•èµ·æ›´å¤šçš„åŒ…çš„ä¸¢å¤±ã€‚è¿™æ˜¯ä¸€ä¸ªæ½œåœ¨çš„æ— åº•æ´ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½ å¯ä»¥é€šè¿‡æ‰©å±•ç³»ç»Ÿæ¥ç»™æ¯ä¸ªåŒ…çš„æ¶ˆæ¯æ•°é‡<span>n</span>è®¾ç½®ä¸€ä¸ªä¸Šé™ï¼Œæ¥é¿å…è¿™ç§æƒ…å†µã€‚ä½†ç°åœ¨å¦‚æœä½ æœ‰ä¸€ä¸ªé«˜æ•°æ®åŒ…å‘é€ç‡ï¼ˆå¦‚æ¯ç§’<span>60</span>åŒ…ï¼‰ä½ å°±è¦å¤šæ¬¡å‘é€åŒæ ·çš„æ¶ˆæ¯ç›´åˆ°ä½ å¾—åˆ°è¯¥æ¶ˆæ¯çš„åº”ç­”ä¿¡å·ã€‚å¦‚æœçš„å¾€è¿”æ—¶é—´æ˜¯<span>100ms</span>ï¼Œæ¯æ¡æ¶ˆæ¯åœ¨è¢«åº”ç­”ä¹‹å‰å°†è¦å¹³å‡è¢«å¤šä½™å‘é€å…­æ¬¡ã€‚ä¹Ÿè®¸ä½ çœŸçš„éœ€è¦è¿™äº›å¤šä½™çš„å‘é€æ•°é‡å› ä¸ºä½ çš„æ¶ˆæ¯æ˜¯å¯¹æ—¶é—´æå…¶æ•æ„Ÿçš„ï¼Œä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥ç»™é˜Ÿåˆ—é‡Œçš„å…¶ä»–æ¶ˆæ¯åˆ†é…åˆç†çš„å¸¦å®½ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æˆ‘æ¯”è¾ƒå–œæ¬¢çš„æ–¹æ³•æ˜¯ç”¨ä¸€ä¸ªä¼˜å…ˆæ¬¡åºç³»ç»Ÿæ•´åˆæ¯åŒ…çš„åº”ç­”ä¿¡å·ï¼Œè¿™ä¸ªç³»ç»Ÿæ£€å‡º<span>n</span>æ¡æœ€é‡è¦çš„æ¶ˆæ¯å¹¶åŒ…å«åœ¨æ¯ä¸ªåŒ…ä¸­ã€‚åœ¨æ•£å¸ƒçš„æ¶ˆæ¯ç©¿è¿‡æ‰€æœ‰åœ¨å‘é€é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å‘é€æ—¶ï¼Œè¿™æ ·å°±æŠŠå¯¹æ—¶é—´æ•æ„Ÿçš„é€’é€ä¸æ¯åŒ…ä»…å‘é€<span>n</span>æ¡æ¶ˆæ¯çš„èƒ½åŠ›è”åˆèµ·æ¥äº†ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="æ•°æ®åŒ…å±‚çº§åº”ç­”"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ•°æ®åŒ…å±‚çº§åº”ç­”</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="line-height: 150%; font-size: 12pt; font-family: å¾®è½¯é›…é»‘, sans-serif; color: rgb(34, 34, 34);">è®©æˆ‘ä»¬è¡ŒåŠ¨èµ·æ¥å®ç°å®ƒã€‚</span> <span style="line-height: 150%; color: rgb(34, 34, 34); font-family: å¾®è½¯é›…é»‘, sans-serif; font-size: 12pt;">è¿™ç§å¯é æ€§ç³»ç»Ÿçš„åŸºç¡€æ˜¯æ¯ä¸ªåŒ…çš„åº”ç­”ã€‚</span></p><p class="MsoNormal" align="left" style="line-height: 150%; vertical-align: baseline;"><span style="font-size:12.0pt;line-height:150%;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½†ä¸ºä»€ä¹ˆåº”ç­”æ˜¯åœ¨æ•°æ®åŒ…å±‚çº§è€Œä¸æ˜¯åœ¨æ¶ˆæ¯å±‚çº§å‘¢ï¼Ÿç®€è¦æˆªè¯´åŸå› å°±æ˜¯åŒ…çš„æ•°é‡ä¼šè¿œè¿œå°‘äºæ¶ˆæ¯çš„æ•°é‡ã€‚å‡è®¾æ¯ä¸ªåŒ…ä¸­æœ‰<span>32</span>æˆ–<span>64</span>æ¡æ¶ˆæ¯ï¼Œæ˜¾ç„¶è®©ä¸€ä¸ªåŒ…å«<span>32</span>æˆ–<span>64</span>æ¡æ¶ˆæ¯çš„åŒ…æ¥åº”ç­”ä¼šæ¯”è®©æ¯ä¸ªæ¶ˆæ¯éƒ½åˆ†åˆ«åº”ç­”è¦é«˜æ•ˆå¾—å¤šã€‚</span> </p><p class="MsoNormal" align="left" style="line-height: 150%; vertical-align: baseline;"><span style="font-size:12.0pt;line-height:150%;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™æ ·åŒæ ·ä¹Ÿå¢åŠ äº†çµæ´»æ€§ï¼Œå› ä¸ºä½ å¯ä»¥åœ¨æ•°æ®åŒ…å±‚çº§åº”ç­”ä¸Šæ„å»ºå…¶ä»–å¯é æ€§ç³»ç»Ÿï¼Œä¸ä»…ä»…æ˜¯ä¸ºäº†å¯é æœ‰åºçš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨äº†æ•°æ®åŒ…å±‚çº§åº”ç­”ï¼Œä½ å°±çŸ¥é“å“ªä¸€ä¸ªæ—¶é—´å…ˆå†³çš„ä¸å¯é çŠ¶æ€æ›´æ–°å·²ç»“æŸï¼Œæ‰€ä»¥ä½ å¯ä»¥è½»æ˜“åœ°æ„å»ºä¸€ä¸ªç³»ç»Ÿï¼Œåœ¨ä¸€æ—¦ä¸€ä¸ªæ•°æ®åŒ…æ‰€åŒ…å«çš„æœ€åä¸€ä¸ªçŠ¶æ€æ›´æ–°å·²ç»åº”ç­”æ—¶ï¼Œåœæ­¢å‘é€ä¸å†æ”¹å˜çš„å¯¹è±¡çŠ¶æ€ã€‚</span> </p><p class="MsoNormal" align="left" style="line-height: 150%; vertical-align: baseline;"><span style="font-size:12.0pt;line-height:150%;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä¸ºå®ç°æ•°æ®åŒ…å±‚çº§çš„åº”ç­”ï¼Œåœ¨æ¯ä¸ªåŒ…çš„å‰é¢æ·»åŠ å¦‚ä¸‹çš„æŠ¥å¤´ï¼š</span></p><div><div id="highlighter_102525" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">struct</code> <code class="cpp plain">Header</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp plain">uint16_t sequence;</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp plain">uint16_t ack;</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp plain">uint32_t ack_bits;</code></div><div class="line number6 index5 alt1"><code class="cpp plain">};</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="line-height: 150%; vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™äº›æŠ¥å¤´å…ƒç´ ç»„åˆèµ·æ¥ä»¥åˆ›å»ºåº”ç­”ç³»ç»Ÿï¼š</span> </p><ul type="disc"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;     border:none windowtext 1.0pt;padding:0cm">sequence</span></b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;"> </span><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œéšæ¯ä¸ªæ•°æ®åŒ…å‘é€è€Œå¢é•¿ï¼ˆå¹¶ä¸”åœ¨è¾¾åˆ°<span>65535</span>åå›å¾€å¤ï¼‰ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;     border:none windowtext 1.0pt;padding:0cm">ack</span></b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;"> </span><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">æ˜¯ä»å¦ä¸€æ–¹æ¥æ”¶åˆ°çš„æœ€æ–°çš„æ•°æ®åŒ…åºåˆ—å·ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;     border:none windowtext 1.0pt;padding:0cm">ack_bits</span></b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;"> </span><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">æ˜¯ä¸€ä¸ªä½å­—æ®µï¼Œå®ƒç¼–ç ä¸<b><span style="border:none windowtext 1.0pt;padding:0cm">ack</span></b>ç›¸å…³çš„æ”¶åˆ°çš„æ•°æ®åŒ…ç»„åˆï¼šå¦‚æœä½<b><span style="border:none windowtext 1.0pt;padding:0cm">n</span></b>å·²ç»è®¾ç½®ï¼Œå³<span> <b><span style="border:none windowtext 1.0pt;padding:     0cm">ackâ€“</span></b> <b><span style="border:none windowtext 1.0pt;     padding:0cm">n</span></b> </span>æ•°æ®åŒ…è¢«æ¥æ”¶äº†ã€‚</span> </li></ul><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">ack_bits</span></b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"> </span><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä¸ä»…æ˜¯ä¸€ä¸ªèŠ‚çœå¸¦å®½çš„å·§å¦™çš„ç¼–ç ï¼Œå®ƒåŒæ ·ä¹Ÿå¢åŠ äº†<u><span style="border:none windowtext 1.0pt;padding:0cm">ä¿¡æ¯å†—ä½™</span></u>æ¥æŠµå¾¡åŒ…çš„ä¸¢å¤±ã€‚æ¯ä¸ªåº”ç­”ç è¦è¢«å‘é€<span>32</span>æ¬¡ã€‚å¦‚æœæœ‰ä¸€ä¸ªåŒ…ä¸¢å¤±äº†ï¼Œä»ç„¶æœ‰å…¶ä»–<span>31</span>ä¸ªåŒ…æœ‰ç€ç›¸åŒçš„åº”ç­”ç ã€‚ä»ç»Ÿè®¡ä¸Šæ¥è¯´ï¼Œåº”ç­”ç è¿˜æ˜¯éå¸¸æœ‰å¯èƒ½é€è¾¾çš„ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½†çªå‘çš„ä¼ é€æ•°æ®åŒ…çš„ä¸¢å¤±è¿˜æ˜¯æœ‰å¯èƒ½å‘ç”Ÿçš„ï¼Œæ‰€ä»¥é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼š</span> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¦‚æœä½ æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…<span>n</span>çš„åº”ç­”ç ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…<u><span style="border:none windowtext 1.0pt;     padding:0cm">è‚¯å®šå·²ç»æ”¶åˆ°</span></u>äº†ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¦‚æœä½ æ²¡æœ‰æ”¶åˆ°åº”ç­”ç ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…å°±<i><span style="border:none windowtext 1.0pt;padding:0cm">å¾ˆæœ‰å¯èƒ½</span></i><span> </span>æ²¡æœ‰è¢«æ”¶åˆ°ã€‚ä½†æ˜¯<span>â€¦</span>å®ƒä¹Ÿè®¸ä¼šæ˜¯ï¼Œä»…æ˜¯åº”ç­”ç æ²¡æœ‰é€è¾¾ã€‚<u><span style="border:none windowtext 1.0pt;padding:0cm">è¿™ç§æƒ…å†µæ˜¯æå…¶ç½•è§çš„ã€‚</span></u> </span> </li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä»¥æˆ‘çš„ç»éªŒï¼Œæ²¡æœ‰å¿…è¦è®¾è®¡å®Œå–„çš„åº”ç­”æœºåˆ¶ã€‚åœ¨ä¸€ä¸ªæå°‘ä¸¢åº”ç­”ç çš„ç³»ç»Ÿä¸Šæ„å»ºä¸€ä¸ªå¯é æ€§ç³»ç»Ÿå¹¶ä¸ä¼šå¢åŠ ä»€ä¹ˆå¤§é—®é¢˜ã€‚ä½†å¯¹äºåœ¨æ‰€æœ‰æƒ…å†µä¸‹æ¥æµ‹è¯•è¿™ä¸ªç³»ç»Ÿçš„å·¥ä½œå°†ä¼šæˆä¸ºå¾ˆå¤§çš„æŒ‘æˆ˜ï¼Œå› ä¸ºè¿˜è¦è€ƒè™‘åº”ç­”ç ä¸¢å¤±çš„è¾¹ç•Œæƒ…å†µã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ‰€ä»¥å¦‚æœä½ è‡ªå·±å®ç°è¿™ä¸ªç³»ç»Ÿçš„è¯ï¼Œè¯·è®¾ç½®ä¸€ä¸ªæµ¸æ³¡æµ‹è¯•æ¥è¦†ç›–ç³Ÿç³•çš„ç½‘ç»œæƒ…å†µï¼Œç”¨æ¥ç¡®ä¿ä½ çš„åº”ç­”ç³»ç»Ÿæ˜¯åœ¨æ­£ç¡®çš„å·¥ä½œï¼Œç›¸å…³åœ°ï¼Œä½ çš„æ¶ˆæ¯ç³»ç»Ÿçš„æ‰§è¡Œå®é™…ä¸Šæ˜¯åœ¨è¿™äº›ç½‘ç»œæƒ…å†µä¸‹<i><u>å¯é åœ°è€Œä¸”æœ‰åºçš„</u></i>äº¤ä»˜å¯é æœ‰åºæ¶ˆæ¯ã€‚ä»¥æˆ‘ä¹‹è§ï¼ˆå¹¶ä¸”æˆ‘å·²ç»å†™äº†è®¸å¤šè¿™æ ·çš„ç³»ç»Ÿçš„å˜å¼è‡³å°‘æœ‰åæ¬¡äº†ï¼‰ï¼Œè¿™æ˜¯ç¡®ä¿æ­£ç¡®è¡Œä¸ºçš„ä¸€ä¸ªå¿…è¦æ­¥éª¤ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½ åœ¨è¿™ç¯‡æ–‡ç« çš„ç¤ºä¾‹æºä»£ç ä¸­ä¼šæ‰¾åˆ°è¿™æ ·ä¸€ä¸ªæµ¸æ³¡æµ‹è¯•ï¼Œå®ƒå¯¹<span><a rel="noopener" href="https://www.patreon.com/gafferongames" target="_blank"><span style="color:#DD3333">patreon</span><span style="color:#DD3333"><span>æ”¯æŒ</span></span></a></span>æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”ä¹Ÿåœ¨å¼€æºç½‘ç»œåº“<span><a rel="noopener" href="http://www.libyojimbo.com/" target="_blank"><span style="color:#DD3333">libyojimbo</span></a></span>ä¸­ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="åºåˆ—ç¼“å†²åŒº"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">åºåˆ—ç¼“å†²åŒº</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä¸ºå®ç°è¿™ä¸ªåº”ç­”ç³»ç»Ÿï¼Œæˆ‘ä»¬åœ¨å‘é€æ–¹è¿˜éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥è¿½è¸ªä¸€ä¸ªæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«åº”ç­”ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¿½ç•¥å†—ä½™çš„åº”ç­”ï¼ˆæ¯ä¸ªåŒ…ä¼šé€šè¿‡<span> <b><span style="border:none windowtext 1.0pt;padding:0cm">ack_bits</span></b></span>å¤šæ¬¡åº”ç­”ï¼‰ã€‚æˆ‘ä»¬åŒæ ·åœ¨æ¥æ”¶æ–¹ä¹Ÿè¿˜éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥è¿½è¸ªé‚£äº›å·²ç»æ”¶åˆ°çš„åŒ…ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨æ•°æ®åŒ…çš„æŠ¥å¤´å¡«å†™<b><span style="border:none windowtext 1.0pt;padding:0cm">ack_bits</span></b>çš„å€¼ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™ä¸ªæ•°æ®ç»“æ„åº”è¯¥å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š</span> </p><ul type="disc"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¸¸é‡æ—¶é—´å†…æ’å…¥ï¼ˆæ’å…¥å¯èƒ½ä¼šæ˜¯<i><u><span style="border:none windowtext 1.0pt;padding:0cm">éšæœº</span></u></i>çš„ï¼Œä¾‹å¦‚ä¹±åºæ•°æ®åŒ…<span>â€¦</span>ï¼‰</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ç»™å®šçš„æ•°æ®åŒ…çš„åºåˆ—å·åœ¨å¸¸é‡æ—¶é—´å†…æŸ¥è¯¢ä¸€ä¸ªæ¡ç›®æ˜¯å¦å­˜åœ¨</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¯¹ç»™å®šçš„æ•°æ®åŒ…åºåˆ—å·ï¼Œåœ¨å¸¸é‡æ—¶é—´å†…è®¿é—®æ•°æ®å­˜å‚¨</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¸¸é‡æ—¶é—´å†…åˆ é™¤æ¡ç›®</span> </li></ul><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½ å¯èƒ½ä¼šæƒ³ã€‚å“¦ï¼Œå½“ç„¶ï¼Œ<i><u><span style="border:none windowtext 1.0pt;padding:0cm">å“ˆå¸Œè¡¨</span></u></i>ã€‚ä½†è¿˜æœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•ï¼š</span></p><div><div id="highlighter_389542" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">BufferSize = 1024;</code></div><div class="line number2 index1 alt1"> </div><div class="line number3 index2 alt2"><code class="cpp plain">uint32_t sequence_buffer[BufferSize];</code></div><div class="line number4 index3 alt1"> </div><div class="line number5 index4 alt2"><code class="cpp keyword bold">struct</code> <code class="cpp plain">PacketData</code></div><div class="line number6 index5 alt1"><code class="cpp plain">{</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">acked;</code></div><div class="line number8 index7 alt1"><code class="cpp plain">};</code></div><div class="line number9 index8 alt2"> </div><div class="line number10 index9 alt1"><code class="cpp plain">PacketData packet_data[BufferSize];</code></div><div class="line number11 index10 alt2"> </div><div class="line number12 index11 alt1"><code class="cpp plain"><code>PacketData * GetPacketData( uint16_t sequence )</code></code></div><div class="line number13 index12 alt2"><code class="cpp plain">{</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">    </code><code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">index = sequence % BufferSize;</code></div><div class="line number15 index14 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">if</code> <code class="cpp plain">( sequence_buffer[index] == sequence )</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp plain">&amp;packet_data[index];</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">else</code></div><div class="line number18 index17 alt1"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp plain">NULL;</code></div><div class="line number19 index18 alt2"><code class="cpp plain">}</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½ åœ¨è¿™å¯ä»¥çœ‹åˆ°çš„çªé—¨æ˜¯è¿™ä¸ªæ»šåŠ¨çš„ç¼“å†²åŒºæ˜¯ä»¥åºåˆ—å·æ¥ä½œä¸ºç´¢å¼•çš„ï¼š</span> </p><div style="border:solid #F0F0F0 1.0pt;border-left:solid #E0E0E0 2.25pt;padding:0cm 0cm 0cm 0cm;background:whitesmoke"><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline; border: none; padding: 0cm; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"><span style="font-family:&quot;Courier New&quot;;color:#222222">const int index =sequence % BufferSize;</span> </p></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™æ˜¯å¯è¡Œçš„ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸åœ¨æ„æ—§æ¡ç›®ç ´åã€‚éšç€åºåˆ—å·çš„é€’å¢ï¼Œæ—§çš„æ¡ç›®ä¹Ÿè‡ªç„¶è€Œç„¶åœ°éšç€æˆ‘ä»¬æ’å…¥äº†æ–°æ¡ç›®è€Œè¢«é‡å†™ã€‚<span>sequence_buffer[index]</span>çš„å€¼æ˜¯ç”¨æ¥æµ‹è¯•è¯¥ç´¢å¼•çš„æ¡ç›®æ˜¯å¦å®é™…ä¸Šä¸ä½ æ‰€æœå¯»çš„åºåˆ—å·ç›¸ç¬¦ã€‚ä¸€ä¸ªç¼“å†²åºåˆ—çš„å€¼æ˜¯<span>0xFFFFFFFF </span>å°±è¡¨ç¤ºä¸€ä¸ªç©ºçš„æ¡ç›®å¹¶è‡ªç„¶åœ°å¯¹ä»»ä½•åºåˆ—å·æŸ¥è¯¢è¿”å›<span>NULL</span>ï¼Œæ²¡æœ‰ä»»ä½•å…¶ä»–ï¼ˆä»£ç ï¼‰åˆ†æ”¯ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å½“æ¡ç›®è¢«é¡ºåºæ·»åŠ ï¼Œå°±åƒä¸€ä¸ªè¢«å‘é€çš„é˜Ÿåˆ—ï¼Œå¯¹æ’å…¥æ‰€éœ€è¦åšçš„å°±æ˜¯æŠŠè¿™ä¸ªåºåˆ—ç¼“å†²åŒºçš„å€¼æ›´æ–°ä¸ºæ–°çš„åºåˆ—å·å¹¶ä¸”åœ¨è¯¥ç´¢å¼•å¤„é‡å†™è¿™ä¸ªæ•°æ®ï¼š</span></p><div><div id="highlighter_839387" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">PacketData &amp; InsertPacketData( uint16_t sequence )</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">index = sequence % BufferSize;</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp plain">sequence_buffer[index] = sequence;</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">return</code> <code class="cpp plain">packet_data[index];</code></div><div class="line number6 index5 alt1"><code class="cpp plain">}</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½†åœ¨æ¥æ”¶ç«¯æ•°æ®åŒ…ä»¥ä¹±åºåˆ°è¾¾å¹¶ä¸”æœ‰ä¸€éƒ¨åˆ†ä¸¢å¤±ã€‚åœ¨é«˜å¾—ç¦»è°±çš„ä¸¢åŒ…ç‡ä¸‹ï¼ˆ<span>99%</span>ï¼‰ï¼Œæˆ‘å°±ä¼šçœ‹åˆ°æ—§çš„åºåˆ—ç¼“å†²åŒºæ¡ç›®è¿˜å­˜åœ¨ï¼Œä½†æ˜¯æ–°æ¡ç›®çš„åºåˆ—å·å·²ç»è¶…è¿‡äº†<span>65535</span>å¹¶ä¸”å¾ªç¯åˆ°è¾¾äº†æ—§æ¡ç›®ä¹‹å‰ï¼Œå¹¶ä¸”æ‰“ç ´äº†æˆ‘çš„åº”ç­”é€»è¾‘ï¼ˆå¯¼è‡´é”™è¯¯åº”ç­”å¹¶æ‰“ç ´äº†å¯é æ€§ï¼Œè¿™æ—¶å‘é€æ–¹ä¼šçœŸçš„è®¤ä¸ºå¯¹æ–¹å·²ç»æ¥æ”¶åˆ°äº†ä¸€äº›ä¸œè¥¿ä½†å…¶å®å¹¶ä¸æ˜¯<span>â€¦</span>ï¼‰</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•æ˜¯éå†ä¸Šä¸€ä¸ªæœ€é«˜çš„æ’å…¥åºåˆ—ä¸æœ€æ–°æ”¶åˆ°çš„æ’å…¥åºåˆ—ä¹‹é—´çš„æ¡ç›®ï¼ˆå¦‚æœå®ƒæ˜¯æ›´åŠ æ–°çš„è¯ï¼‰å¹¶åœ¨ç¼“å†²åŒºæ¸…é™¤è¿™äº›æ¡ç›®å³éƒ½ç½®ä¸º<span>0xFFFFFFFF</span>ã€‚ç°åœ¨ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ’å…¥æ“ä½œæ˜¯<i><u><span style="border:none windowtext 1.0pt;padding:0cm">éå¸¸æ¥è¿‘</span></u></i><span> </span>æ—¶é—´å¸¸é‡çš„ï¼Œä½†æœ€ç³Ÿçš„æƒ…å†µæ˜¯ï¼Œåœ¨å…ˆå‰æœ€é«˜çš„åºåˆ—å·å’Œå½“å‰æ’å…¥çš„åºåˆ—å·ä¹‹é—´çº¿æ€§éå†çš„æ¬¡æ•°<span>n</span>ç­‰äºç¼“å†²åŒºçš„é•¿åº¦ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰ï¼Œæˆ‘æƒ³æŒ‡å‡ºï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ªæ•°æ®ç»“æ„åšæ›´å¤šäº‹æƒ…è€Œä¸ä»…æ˜¯å¯¹äºåº”ç­”ç ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åŠ å…¥å‘é€æ—¶é—´ï¼Œæ¥æ‰©å±•æ¯ä¸ªåŒ…çš„æ•°æ®ï¼š</span></p><div><div id="highlighter_615471" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">struct</code> <code class="cpp plain">PacketData</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">acked;</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">double</code> <code class="cpp plain">send_time;</code></div><div class="line number5 index4 alt2"><code class="cpp plain">};</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æœ‰äº†è¿™äº›ä¿¡æ¯ä½ å¯ä»¥å¯¹å¾€è¿”æ—¶é—´é€šè¿‡åšæŒ‡æ•°çº§çš„å¹³æ»‘å–å¹³å‡æ•°åšä¿®æ­£ï¼Œæœ€ç»ˆå¾—åˆ°åˆç†çš„é¢„æœŸå¾€è¿”æ—¶é—´ã€‚ä½ ç”šè‡³å¯ä»¥çœ‹åˆ°åœ¨å‘é€æ•°æ®åŒ…çš„åºåˆ—ç¼“å­˜åŒºçš„æ•°æ®åŒ…ä¼šæ¯”ä½ <span>RTT</span>é¢„è®¡çš„ï¼ˆä½ ç°åœ¨åº”è¯¥å·²ç»æ”¶åˆ°äº†å®ƒä»¬çš„åº”ç­”ç <span>â€¦</span>ï¼‰è¦æ—§ï¼Œé€šè¿‡è¿™ä¸ªå¾€è¿”æ—¶é—´å¯¹è¿˜æ²¡æœ‰åº”ç­”çš„åŒ…åšåˆ¤æ–­ï¼Œæ¥å†³å®šåˆ›å»ºä½ çš„æ•°æ®åŒ…ä¸¢å¤±é¢„è®¡ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="åº”ç­”ç®—æ³•"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">åº”ç­”ç®—æ³•</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ç°åœ¨æˆ‘ä»¬æ¥æŠŠæ³¨æ„åŠ›é›†ä¸­åœ¨æ•°æ®åŒ…å±‚çº§åº”ç­”çš„å®é™…ç®—æ³•ä¸Šã€‚</span><span style="color: rgb(34, 34, 34); font-family: å¾®è½¯é›…é»‘, sans-serif; font-size: 12pt;">è¯¥ç®—æ³•å¦‚ä¸‹ï¼š</span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">åœ¨æ•°æ®åŒ…å‘é€ç«¯ï¼š</span></b> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">åœ¨æ•°æ®åŒ…å‘é€ç¼“å†²åŒºæ’å…¥ä¸€ä¸ªä¸ºå½“å‰å‘é€çš„æ•°æ®åŒ…åºåˆ—å·çš„æ¡ç›®ï¼Œå¹¶ä¸”å¸¦ç€è¡¨ç¤ºå®ƒè¿˜æ²¡æœ‰è¢«åº”ç­”çš„å­—æ®µ</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ä»æœ¬åœ°æ¥æ”¶åˆ°çš„æ•°æ®åŒ…åºåˆ—ç¼“å­˜å’Œæœ€æ–°æ¥æ”¶åˆ°çš„æ•°æ®åŒ…åºåˆ—å·ä¸­ç”Ÿæˆ<span> <b><span style="border:none windowtext 1.0pt;padding:     0cm">ack</span></b> </span>å’Œ<b><span style="border:none windowtext 1.0pt;     padding:0cm">ack_bits</span></b><span> </span></span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¡«å†™æ•°æ®åŒ…æŠ¥å¤´çš„<b><span style="border:none windowtext 1.0pt;padding:0cm">sequence, ack</span></b><span> </span>å’Œ<span> <b><span style="border:     none windowtext 1.0pt;padding:0cm">ack_bits</span></b> </span>å€¼</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å‘é€æ•°æ®åŒ…å¹¶é€’å¢å‘é€æ•°æ®åŒ…çš„åºåˆ—å·</span> </li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">åœ¨æ•°æ®åŒ…æ¥æ”¶ç«¯ï¼š</span></b> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ä»æ•°æ®åŒ…æŠ¥å¤´è¯»å–<span> <b><span style="border:none windowtext 1.0pt;padding:     0cm">sequence</span></b> </span></span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¦‚æœ<span> <b><span style="border:none windowtext 1.0pt;padding:     0cm">sequence</span></b> </span>æ¯”ä¹‹å‰çš„æœ€æ–°æ”¶åˆ°çš„æ•°æ®åŒ…åºåˆ—å·è¦æ–°ï¼Œå°±æ›´æ–°æœ€æ–°çš„æ¥æ”¶åˆ°çš„æ•°æ®åŒ…åºåˆ—å·</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">åœ¨æ¥æ”¶æ•°æ®åŒ…åºåˆ—ç¼“å†²åŒºä¸­ä¸ºè¿™ä¸ªæ•°æ®åŒ…æ’å…¥ä¸€ä¸ªæ¡ç›®</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ä»æ•°æ®åŒ…æŠ¥å¤´ä¸­çš„<b><span style="border:none windowtext 1.0pt;padding:0cm">ack</span></b>å’Œ<b><span style="border:none windowtext 1.0pt;padding:0cm">ack_bits</span></b>è§£ç åº”ç­”çš„æ•°æ®åŒ…åºåˆ—å·ç»„åˆ</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">è¿­ä»£åº”ç­”çš„æ•°æ®åŒ…åºåˆ—å·ä»¥åŠä»»ä½•è¿˜æ²¡æœ‰è¢«åº”ç­”çš„æ•°æ®åŒ…è°ƒç”¨<span> <b><span style="border:none windowtext 1.0pt;padding:     0cm">OnPacketAcked</span></b>( uint16_t sequence ) </span>åœ¨æ•°æ®åŒ…å‘é€ç¼“å†²åŒºæŠŠè¿™ä¸ªæ•°æ®åŒ…è®¾ç½®ä¸º<span>â€˜</span>å·²åº”ç­”çš„<span>â€™</span>ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;"><br></span></li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">é‡è¦çš„ä¸€ç‚¹æ˜¯è¿™ä¸ªç®—æ³•æ˜¯åœ¨ä¸¤ç«¯éƒ½å¯ä»¥æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å¦‚æœä½ æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å’Œä¸€ä¸ªæœåŠ¡ç«¯ï¼Œç„¶åæ¯ä¸€æ–¹çš„è¿æ¥è¿è¡Œç€åŒæ ·çš„é€»è¾‘ï¼Œç»´æŠ¤è‡ªå·±çš„åºåˆ—å·å‘é€çš„æ•°æ®åŒ…ï¼Œè·Ÿè¸ªæœ€æ–°ä»å¦ä¸€æ–¹æ”¶åˆ°çš„æ•°æ®åŒ…åºåˆ—<span>#</span>è¿˜æœ‰ä»ä¸€ä¸ªåºåˆ—ç¼“å†²åŒºé‡Œæ¥æ”¶åˆ°çš„æ•°æ®åŒ…ä¸­ç”Ÿæˆ<b><span style="border:none windowtext 1.0pt;padding:0cm">sequence, ack</span></b><span> </span>å’Œ<b><span style="border:none windowtext 1.0pt;padding:0cm">ack_bits</span></b><span> </span>æ¥å‘é€åˆ°å¦ä¸€æ–¹ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å¹¶ä¸”è¿™çœŸçš„å°±æ˜¯å’Œå®ƒæœ‰å…³çš„å…¨éƒ¨äº†ã€‚ç°åœ¨å½“ä¸€ä¸ªæ•°æ®åŒ…è¢«å¦ä¸€æ–¹æ¥æ”¶åˆ°æ—¶ï¼Œä½ æœ‰ä¸€ä¸ªå›è°ƒï¼š<b><span style="border:none windowtext 1.0pt;padding:0cm">OnPacketAcked</span></b><span> </span>ã€‚è¿™ä¸ªå¯é æ€§ç³»ç»Ÿçš„å…³é”®å°±åœ¨äºä½ å¾—çŸ¥é“å“ªä¸ªæ•°æ®åŒ…è¢«æ¥æ”¶ï¼Œä½ å¯ä»¥åœ¨ä½ æƒ³çš„åª’ä»‹ä¹‹ä¸Šåˆ›å»º<i><u><span style="border:none windowtext 1.0pt;padding:0cm">ä»»ä½•</span></u></i><span> </span>å¯é æ€§ç³»ç»Ÿã€‚å®ƒä¸ä»…é™äºå¯é æœ‰åºçš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ç”¨å®ƒç¡®è®¤å“ªä¸ªä¸å¯é çš„çŠ¶æ€æ›´æ–°å·²ç»å®Œæˆäº†ï¼Œç”¨ä»¥å®ç°åŸºäºæ¯ä¸ªç‰©ä½“çš„å¢é‡ç¼–ç ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="æ¶ˆæ¯å¯¹è±¡"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ¶ˆæ¯å¯¹è±¡</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ¶ˆæ¯æ˜¯å°å‹çš„å¯¹è±¡ï¼ˆæ¯”æ•°æ®åŒ…å¤§å°è¦å°ï¼Œæ‰€ä»¥å¾ˆå¤šæ¶ˆæ¯è£…é…åœ¨ä¸€ä¸ªå…¸å‹çš„æ•°æ®åŒ…ä¸­ï¼‰å¹¶ä¸”çŸ¥é“å¦‚ä½•å°†å®ƒä»¬è‡ªå·±åºåˆ—åŒ–ã€‚åœ¨æˆ‘çš„ç³»ç»Ÿé‡Œï¼Œå®ƒä»¬ä½¿ç”¨ä¸€ä¸ª</span><u><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#DD3333">ç»Ÿä¸€çš„åºåˆ—åŒ–å‡½æ•°</span></u><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ¥æ‰§è¡Œåºåˆ—åŒ–ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™ä¸ªåºåˆ—åŒ–çš„å‡½æ•°æ˜¯æ¨¡æ¿åŒ–çš„ï¼Œæ‰€ä»¥ä½ åªè¦å†™å®ƒä¸€æ¬¡å®ƒå°±ä¼šå¤„ç†è¯»ã€å†™ä»¥åŠ<i><u><span style="border:none windowtext 1.0pt;padding:0cm">æµ‹é‡</span></u></i> ã€‚<i><span style="border:none windowtext 1.0pt;padding:0cm"> </span></i></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ˜¯çš„ã€‚æµ‹é‡ã€‚æˆ‘å–œæ¬¢çš„ä¸€ä¸ªæŠ€å·§å°±æ˜¯æœ‰ä¸€ä¸ªè™šæ‹Ÿæµç±»å«åš<b><span style="border:none windowtext 1.0pt;padding:0cm">MeasureStream</span></b>ï¼Œå¦‚æœä½ è°ƒç”¨äº†åºåˆ—åŒ–å‡½æ•°ï¼Œå®ƒä¸å‚ä¸ä»»ä½•çš„åºåˆ—åŒ–ï¼Œè€Œåªæ˜¯æµ‹é‡<i><u><span style="border:none windowtext 1.0pt;padding:0cm">å¯èƒ½</span></u></i>è¢«å†™å…¥çš„æ¯”ç‰¹æ•°ã€‚è¿™å¯¹äºè§£å†³å“ªä¸ªæ¶ˆæ¯è¦è£…è½½åˆ°ä½ çš„æ•°æ®åŒ…é‡Œï¼Œç‰¹åˆ«æ˜¯å½“æ¶ˆæ¯å¯ä»¥æœ‰ä»»æ„å¤æ‚çš„åºåˆ—åŒ–å‡½æ•°çš„æƒ…å†µæ—¶æ˜¯ç‰¹åˆ«æœ‰ç”¨çš„ã€‚</span></p><div><div id="highlighter_699334" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">struct</code> <code class="cpp plain">TestMessage : </code><code class="cpp keyword bold">public</code> <code class="cpp plain">Message</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp plain">uint32_t a,b,c;</code></div><div class="line number4 index3 alt1"> </div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp plain">TestMessage()</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">        </code><code class="cpp plain">a = 0;</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">        </code><code class="cpp plain">b = 0;</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">        </code><code class="cpp plain">c = 0;</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number11 index10 alt2"> </div><div class="line number12 index11 alt1"><code class="cpp spaces">    </code><code class="cpp keyword bold">template</code> <code class="cpp plain">&lt;</code><code class="cpp keyword bold">typename</code> <code class="cpp plain">stream</code><code class="cpp string"></code><code class="cpp plain">&gt; </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">Serialize( Stream &amp; stream )</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">    </code><code class="cpp plain">{ </code></div><div class="line number14 index13 alt1"><code class="cpp spaces">        </code><code class="cpp plain">serialize_bits( stream, a, 32 );</code></div><div class="line number15 index14 alt2"><code class="cpp spaces">        </code><code class="cpp plain">serialize_bits( stream, b, 32 );</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">        </code><code class="cpp plain">serialize_bits( stream, c, 32 );</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp keyword bold">true</code><code class="cpp plain">;</code></div><div class="line number18 index17 alt1"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number19 index18 alt2"> </div><div class="line number20 index19 alt1"><code class="cpp spaces">    </code><code class="cpp keyword bold">virtual</code> <code class="cpp plain">SerializeInternal( WriteStream &amp; stream )</code></div><div class="line number21 index20 alt2"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number22 index21 alt1"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp plain">Serialize( stream );</code></div><div class="line number23 index22 alt2"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number24 index23 alt1"> </div><div class="line number25 index24 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">virtual</code> <code class="cpp plain">SerializeInternal( ReadStream &amp; stream )</code></div><div class="line number26 index25 alt1"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number27 index26 alt2"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp plain">Serialize( stream );</code></div><div class="line number28 index27 alt1"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number29 index28 alt2"> </div><div class="line number30 index29 alt1"><code class="cpp spaces">    </code><code class="cpp keyword bold">virtual</code> <code class="cpp plain">SerializeInternal( MeasureStream &amp; stream )</code></div><div class="line number31 index30 alt2"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number32 index31 alt1"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp plain">Serialize( stream );        </code></div><div class="line number33 index32 alt2"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number34 index33 alt1"><code class="cpp plain">};</code><code class="cpp keyword bold"></code><code class="cpp plain"></code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™é‡Œçš„æŠ€å·§æ˜¯æ¡¥æ¥ç»Ÿä¸€æ¨¡æ¿çš„åºåˆ—åŒ–å‡½æ•°ï¼ˆæ‰€ä»¥ä½ åªéœ€è¦å†™ä¸€æ¬¡ï¼‰ä¸è™šæ‹Ÿåºåˆ—åŒ–æ–¹æ³•ï¼Œè¿™é€šè¿‡ä»è™šå‡½æ•°æ¯ä¸ªæµç±»å‹ä¸­è°ƒå…¥å®ƒã€‚æˆ‘é€šå¸¸ç”¨ä¸€ä¸ªå®æ¥æ‰“åŒ…è¿™ä¸ªå¼•ç”¨ï¼Œä½†å®ƒåœ¨ä¸Šæ–‡çš„ä»£ç ä¸­è¿™ä¸ªå®å·²ç»è¢«å±•å¼€ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°å‘ç”Ÿäº†ä»€ä¹ˆã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ç°åœ¨ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªåŸºäºæ¶ˆæ¯çš„æŒ‡é’ˆå¯ä»¥è®©ä½ åšåˆ°è¿™æ ·å¹¶ä¸”å®ƒåªæ˜¯é€šè¿‡é‡è½½æ¥å·¥ä½œï¼š</span></p><div><div id="highlighter_300994" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">Message <em> message = CreateSomeMessage();</em></code></div><div class="line number2 index1 alt1"><code class="cpp plain">message-&gt;SerializeInternal( stream );</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å¦å¤–ä¸€ä¸ªå°±æ˜¯å¦‚æœä½ åœ¨ç¼–è¯‘æ—¶é—´çŸ¥é“äº†æ¶ˆæ¯çš„å®Œæ•´ç»„åˆï¼Œå°±å¯ä»¥ä¸ºæ¯ä¸ªç±»å‹åœ¨è¢«è°ƒå…¥åºåˆ—åŒ–å‡½æ•°ä¹‹å‰å®ç°ä¸€ä¸ªå…³äºæ¶ˆæ¯ç±»å‹è½¬æ¢ä¸ºç¡®åˆ‡æ¶ˆæ¯ç±»å‹çš„å¤§çš„<span>switch</span>è¯­å¥ã€‚æˆ‘åœ¨è¿‡å»å·²ç»åœ¨æ§åˆ¶å°å¹³å°å®ç°çš„è¿™ä¸ªæ¶ˆæ¯ç³»ç»Ÿè¿™ä¹ˆåšäº†ï¼ˆå¦‚<span>PS3 SPUs</span>ï¼‰ï¼Œä½†å¯¹äºç°åœ¨ï¼ˆ<span>2016</span>ï¼‰çš„åº”ç”¨ç¨‹åºï¼Œè™šå‡½æ•°çš„æ€»å¼€é”€æ˜¯å¿½ç•¥ä¸è®¡çš„ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ¶ˆæ¯ä»ä¸€ä¸ªåŸºç±»æ´¾ç”Ÿï¼Œè¿™ä¸ªåŸºç±»æä¾›ä¸€ä¸ªé€šç”¨çš„æ¥å£ä¾‹å¦‚åºåˆ—åŒ–ã€æ¶ˆæ¯çš„æŸ¥è¯¢ç±»å‹è¿˜æœ‰å¼•ç”¨è®¡æ•°ã€‚å¼•ç”¨è®¡æ•°æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºæ¶ˆæ¯æ˜¯é€šè¿‡æŒ‡é’ˆä¼ é€’çš„å¹¶ä¸”åœ¨åº”ç­”ä¹‹å‰ä¸åªæ˜¯å­˜å‚¨åœ¨æ¶ˆæ¯å‘é€é˜Ÿåˆ—ï¼Œè€Œä¸”ä¹Ÿå­˜å‚¨åœ¨å¤–å‘çš„æ•°æ®åŒ…ä¸­ï¼ŒåŒ…æœ¬èº«æ˜¯<span>C++</span>ç»“æ„ä½“ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™æ˜¯ä¸€ä¸ªç­–ç•¥ï¼Œå°±æ˜¯é¿å…é€šè¿‡æŒ‡é’ˆä¼ é€’æ¶ˆæ¯å’Œæ•°æ®åŒ…æ¥å¤åˆ¶æ•°æ®ã€‚åˆ«çš„ä¸€äº›åœºæ™¯ï¼ˆç†æƒ³çš„æƒ…å†µæ˜¯åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼‰å®ƒä»¬é‡Œé¢çš„æ•°æ®åŒ…å’Œæ¶ˆæ¯ä¼šåºåˆ—åŒ–åˆ°ä¸€ä¸ªç¼“å†²åŒºã€‚æœ€ç»ˆï¼Œå½“ä¸å†æœ‰å¯¹å­˜åœ¨æ¶ˆæ¯å‘é€é˜Ÿåˆ—çš„æ¶ˆæ¯çš„å¼•ç”¨æ—¶ï¼ˆæ¶ˆæ¯å·²ç»è¢«åº”ç­”ï¼‰å¹¶ä¸”æ²¡æœ‰æ•°æ®åŒ…åŒ…å«ä¿ç•™åœ¨æ•°æ®åŒ…å‘é€é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯å³æ˜¯è¢«é”€æ¯çš„ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ç§æ–¹å¼æ¥åˆ›å»ºæ¶ˆæ¯ã€‚æˆ‘ç”¨ä¸€ä¸ªæ¶ˆæ¯çš„å·¥å‚ç±»æ¥åšè¿™ä»¶äº‹æƒ…ï¼Œå®ƒæœ‰ä¸€ä¸ªè¢«å¤å†™çš„è™šå‡½æ•°æ¥æ ¹æ®ç±»å‹åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯ã€‚å¦‚æœè¿™ä¸ªæ•°æ®åŒ…å·¥å‚è¿˜çŸ¥é“æ¶ˆæ¯ç±»å‹çš„æ€»æ•°é‡å°±å¥½äº†ï¼Œé‚£æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ç½‘ç»œä¸Šåºåˆ—åŒ–ä¸€ä¸ªæ¶ˆæ¯ç±»å‹ï¼Œå› ä¸ºæœ‰ä¸¥æ ¼çš„ç•Œé™å’Œåœ¨æœ‰æ•ˆèŒƒå›´ä¹‹å¤–çš„æ¶ˆæ¯ç±»å‹å€¼çš„åŒ…çš„æ¶æ„ä¸¢å¼ƒï¼š</span></p><div><div id="highlighter_935705" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">enum</code> <code class="cpp plain">TestMessageTypes</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp plain">TEST_MESSAGE_A,</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp plain">TEST_MESSAGE_B,</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp plain">TEST_MESSAGE_C,</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">    </code><code class="cpp plain">TEST_MESSAGE_NUM_TYPES</code></div><div class="line number7 index6 alt2"><code class="cpp plain">};</code></div><div class="line number8 index7 alt1"> </div><div class="line number9 index8 alt2"><code class="cpp comments">// message definitions omitted</code></div><div class="line number10 index9 alt1"> </div><div class="line number11 index10 alt2"><code class="cpp keyword bold">class</code> <code class="cpp plain">TestMessageFactory : </code><code class="cpp keyword bold">public</code> <code class="cpp plain">MessageFactory</code></div><div class="line number12 index11 alt1"><code class="cpp plain">{ </code></div><div class="line number13 index12 alt2"><code class="cpp keyword bold">public</code><code class="cpp plain">:</code></div><div class="line number14 index13 alt1"> </div><div class="line number15 index14 alt2"><code class="cpp spaces">    </code><code class="cpp plain">Message  Create( </code><code class="cpp color1 bold">int</code> <code class="cpp plain">type )</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">        </code><code class="cpp keyword bold">switch</code> <code class="cpp plain">( type )</code></div><div class="line number18 index17 alt1"><code class="cpp spaces">        </code><code class="cpp plain">{</code></div><div class="line number19 index18 alt2"><code class="cpp spaces">            </code><code class="cpp keyword bold">case</code> <code class="cpp plain">TEST_MESSAGE_A: </code><code class="cpp keyword bold">return</code> <code class="cpp keyword bold">new</code> <code class="cpp plain">TestMessageA();</code></div><div class="line number20 index19 alt1"><code class="cpp spaces">            </code><code class="cpp keyword bold">case</code> <code class="cpp plain">TEST_MESSAGE_B: </code><code class="cpp keyword bold">return</code> <code class="cpp keyword bold">new</code> <code class="cpp plain">TestMessageB();</code></div><div class="line number21 index20 alt2"><code class="cpp spaces">            </code><code class="cpp keyword bold">case</code> <code class="cpp plain">TEST_MESSAGE_C: </code><code class="cpp keyword bold">return</code> <code class="cpp keyword bold">new</code> <code class="cpp plain">TestMessageC();</code></div><div class="line number22 index21 alt1"><code class="cpp spaces">        </code><code class="cpp plain">}</code></div><div class="line number23 index22 alt2"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number24 index23 alt1"> </div><div class="line number25 index24 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">virtual</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">GetNumTypes() </code><code class="cpp keyword bold">const</code></div><div class="line number26 index25 alt1"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number27 index26 alt2"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp plain">TEST_MESSAGE_NUM_TYPES;</code></div><div class="line number28 index27 alt1"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number29 index28 alt2"><code class="cpp plain">};</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å†æ¬¡é‡ç”³ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å¹¶ä¸”é€šå¸¸æ˜¯è¢«åŒ…è£¹åœ¨å®é‡Œé¢çš„ï¼Œä½†ä¸‹é¢è¦è¯´æ˜çš„å°±æ˜¯å®ƒå…·ä½“æ˜¯æ€ä¹ˆå›äº‹äº†ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="å¯é çš„æœ‰åºæ¶ˆæ¯ç®—æ³•"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å¯é çš„æœ‰åºæ¶ˆæ¯ç®—æ³•</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ç°åœ¨è®©æˆ‘ä»¬æ¥ç€æ‰‹äºå¦‚ä½•åœ¨åº”ç­”ç³»ç»Ÿä¸­å®ç°å¯é æœ‰åºæ¶ˆæ¯çš„ç»†èŠ‚ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å‘é€å¯é æœ‰åºæ¶ˆæ¯çš„ç®—æ³•å¦‚ä¸‹ï¼š</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">å¯¹äºæ¶ˆæ¯å‘é€ï¼š</span></b> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ä½¿ç”¨æµ‹é‡æµæµ‹é‡æ¶ˆæ¯åºåˆ—åŒ–åçš„å¤§å°</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">æ’å…¥æ¶ˆæ¯æŒ‡é’ˆå’Œå®ƒåºåˆ—åŒ–çš„ä½æ•°åˆ°ä¸€ä¸ªåºåˆ—ç¼“å†²åŒºï¼Œå®ƒä»¥æ¶ˆæ¯<span>id</span>ä¸ºç´¢å¼•ã€‚è®¾ç½®æ¶ˆæ¯æœ€åè¢«å‘é€çš„æ—¶é—´ä¸º<span>-1</span></span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">é€’å¢å‘é€çš„æ¶ˆæ¯çš„<span>id</span></span> </li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">å¯¹äºæ•°æ®åŒ…å‘é€ï¼š</span></b> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ä»å·¦<span>-&gt;</span>å³ï¼ˆé€’å¢çš„æ¶ˆæ¯<span>id</span>é¡ºåºï¼‰éå†åœ¨æœ€æ—©çš„æœªåº”ç­”æ¶ˆæ¯<span>id</span>å’Œæœ€æ–°æ’å…¥çš„æ¶ˆæ¯<span>id</span>ä¹‹é—´çš„å‘é€æ¶ˆæ¯åºåˆ—ç¼“å†²åŒºçš„è¿™ç»„æ¶ˆæ¯ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;border:none windowtext 1.0pt;     padding:0cm">è¶…çº§é‡è¦çš„ï¼š</span></b><span style="font-size:12.0pt;     font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;"> </span><span style="font-size:12.0pt;     font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ä¸è¦å‘é€ä¸€ä¸ªæ¥æ”¶æ–¹ä¸èƒ½ç¼“å†²çš„æ¶ˆæ¯<span>id</span>ï¼Œä¸ç„¶ä½ ä¼šç ´åæ¶ˆæ¯çš„åº”ç­”ï¼ˆç”±äºè¿™ä¸ªæ¶ˆæ¯ä¸èƒ½è¢«ç¼“å†²ï¼Œä½†åŒ…å«å®ƒçš„æ•°æ®åŒ…ä¼šè¢«åº”ç­”ï¼Œå‘é€æ–¹å°±ä¼šè®¤ä¸ºè¿™ä¸ªæ¶ˆæ¯å·²ç»è¢«æ¥æ”¶äº†ï¼Œå°±ä¸å†é‡æ–°å‘é€å®ƒäº†ï¼‰ã€‚è¿™æ„å‘³ç€ä½ å¿…é¡»ä¸èƒ½å‘é€ä¸€ä¸ªæ¶ˆæ¯<span>id</span>ç­‰äºæˆ–æ¯”æœ€æ—©çš„æœªåº”ç­”æ¶ˆæ¯çš„<span>id</span>åŠ ä¸Šæ¶ˆæ¯æ¥æ”¶ç¼“å†²åŒºå¤§å°è¦æ–°ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¯¹äºé‚£äº›åœ¨æœ€å<span>0.1</span>ç§’æ²¡æœ‰è¢«å‘é€çš„æ¶ˆæ¯<u><span style="border:none windowtext 1.0pt;     padding:0cm">å¹¶ä¸”</span></u>é€‚åˆæˆ‘ä»¬ç•™åœ¨æ•°æ®åŒ…çš„æœ‰æ•ˆç©ºé—´ï¼Œå°±æŠŠå®ƒè¿½åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨å»å‘é€ã€‚æ ¹æ®è¿­ä»£é¡ºåºå¾—åˆ°ä¼˜å…ˆçº§ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">åŒ…æ‹¬åœ¨å¤–å‘æ•°æ®åŒ…ä¸­çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”è¦ä¸ºæ¯ä¸ªæ¶ˆæ¯æ·»åŠ ä¸€ä¸ªå¼•ç”¨ã€‚ç¡®ä¿æ¯ä¸ªæ•°æ®åŒ…çš„ææ„å‡½æ•°ä¸­å‡äº†å¼•ç”¨è®¡æ•°ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">åœ¨æ•°æ®åŒ…<b><span style="border:none windowtext 1.0pt;padding:0cm">n</span></b>å­˜å‚¨æ¶ˆæ¯çš„æ•°é‡å¹¶ä¸”æ¶ˆæ¯çš„æ ‡è¯†æ•°ç»„åŒ…å«åœ¨ä¸€ä¸ªåºåˆ—ç¼“å†²åŒºçš„æ•°æ®åŒ…ä¸­ï¼Œä»¥å¤–å‘æ•°æ®åŒ…çš„åºåˆ—å·ä¸ºç´¢å¼•ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">æŠŠæ•°æ®åŒ…æ·»åŠ åˆ°æ•°æ®åŒ…å‘é€é˜Ÿåˆ—ã€‚</span> </li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">å¯¹äºæ•°æ®åŒ…æ¥æ”¶ï¼š</span></b> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">éå†åŒ…å«åœ¨æ•°æ®åŒ…ä¸­çš„æ¶ˆæ¯ç»„åˆå¹¶ä¸”æŠŠå®ƒä»¬æ’å…¥åˆ°æ¶ˆæ¯æ¥æ”¶é˜Ÿåˆ—ç¼“å†²åŒºï¼Œä»¥å®ƒä»¬çš„æ¶ˆæ¯<span>id</span>ä¸ºç´¢å¼•ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å‰é¢çš„åº”ç­”ç³»ç»Ÿè‡ªåŠ¨åœ°åº”ç­”æˆ‘ä»¬åˆšåˆšæ”¶åˆ°çš„æ•°æ®åŒ…åºåˆ—å·ã€‚</span> </li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">å¯¹äºæ•°æ®åŒ…åº”ç­”ï¼š</span></b> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ç”¨åºåˆ—å·æŸ¥æ‰¾åŒ…å«åœ¨æ•°æ®åŒ…ä¸­æ¶ˆæ¯ç»„åˆçš„æ ‡è¯†éƒ¨åˆ†ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ä»æ¶ˆæ¯å‘é€é˜Ÿåˆ—ä¸­ç§»é™¤é‚£äº›å·²ç»å­˜åœ¨çš„æ¶ˆæ¯ï¼Œå¹¶å‡å°‘å®ƒä»¬çš„å¼•ç”¨è®¡æ•°ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">é€šè¿‡ä»å‘é€æ¶ˆæ¯é˜Ÿåˆ—ç¼“å†²åŒºä¸­ä¹‹å‰æœªåº”ç­”æ¶ˆæ¯çš„<span>id</span>çš„è½¬å¯„æ¥æ›´æ–°æœ€åä¸€ä¸ªæœªåº”ç­”çš„æ¶ˆæ¯çš„<span>id</span>ï¼Œç›´åˆ°å‘ç°ä¸€ä¸ªæœ‰æ•ˆçš„æ¶ˆæ¯æ¡ç›®ï¼Œæˆ–è€…ä½ ä¼šåˆ°è¾¾å½“å‰å‘é€æ¶ˆæ¯çš„<span>id</span>ã€‚ä»¥å…ˆåˆ°è€…ä¸ºå‡†ã€‚ </span> </li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">å¯¹äºæ¶ˆæ¯æ¥æ”¶ï¼š</span></b> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">æ£€æŸ¥æ¥å—æ¶ˆæ¯ç¼“å†²åŒºç¡®ä¿å½“å‰æ”¶åˆ°æ¶ˆæ¯çš„<span>id</span>å¯¹åº”çš„æ¶ˆæ¯æ˜¯å¦å­˜åœ¨ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¦‚æœæ¶ˆæ¯å­˜åœ¨ï¼Œå°†å®ƒä»æ¶ˆæ¯é˜Ÿåˆ—ç¼“å†²åŒºä¸­ç§»é™¤ï¼Œé€’å¢æ¥æ”¶æ¶ˆæ¯çš„<span>id</span>å¹¶ç»™è¿™ä¸ªæ¶ˆæ¯è¿”å›ä¸€ä¸ªæŒ‡é’ˆã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¦‚æœå¦ï¼Œå°±æ˜¯æ²¡æœ‰æœ‰æ•ˆçš„æ¶ˆæ¯å¯æ¥æ”¶ã€‚è¿”å›<b><span style="border:none windowtext 1.0pt;padding:0cm">NULL</span></b>ã€‚</span> </li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ€»ä¹‹ï¼Œæ¶ˆæ¯è¦ä¿æŒè¢«åŒ…å«åœ¨æ•°æ®åŒ…ä¸­ç›´åˆ°è¿™ä¸ªæ•°æ®åŒ…åŒ…å«çš„æ¶ˆæ¯å¾—åˆ°åº”ç­”ã€‚æˆ‘ä»¬åœ¨å‘é€è€…æ–¹ä½¿ç”¨ä¸€ä¸ªæ•°æ®ç»“æ„æ¥ç»™æ¶ˆæ¯æ ‡è¯†çš„ç»„åˆæ˜ å°„æ•°æ®åŒ…åºåˆ—å·ä»¥ä¾¿åº”ç­”ã€‚å½“æ¶ˆæ¯è¢«åº”ç­”æ—¶ï¼Œè¦ä»å‘é€é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚å¯¹äºæ¥æ”¶æ–¹ï¼Œä»¥ä¹±åºåˆ°è¾¾çš„æ¶ˆæ¯ä¼šè¢«å­˜å‚¨åœ¨ä¸€ä¸ªåºåˆ—ç¼“å†²åŒºï¼Œå¹¶ä»¥æ¶ˆæ¯<span>id</span>ä¸ºç´¢å¼•ï¼Œè¿™ä¸ª<span>id</span>ä¼šè®©æˆ‘ä»¬ä»¥å®ƒä»¬è¢«å‘é€çš„é¡ºåºæ¥æ”¶å®ƒä»¬ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="æœ€ç»ˆçš„ç»“æœ"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æœ€ç»ˆçš„ç»“æœ</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">åœ¨å‘é€æ–¹ï¼Œè¿™ä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªåƒè¿™æ ·çš„æ¥å£ï¼š</span></p><div><div id="highlighter_731637" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">TestMessage <em> message = (TestMessage</em>) factory.Create( TEST_MESSAGE );</code></div><div class="line number2 index1 alt1"><code class="cpp keyword bold">if</code> <code class="cpp plain">( message )</code></div><div class="line number3 index2 alt2"><code class="cpp plain">{</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp plain">message-&gt;a = 1;</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp plain">message-&gt;b = 2;</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">    </code><code class="cpp plain">message-&gt;c = 3;</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">    </code><code class="cpp plain">connection.SendMessage( message );</code></div><div class="line number8 index7 alt1"><code class="cpp plain">}</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿˜æœ‰åœ¨æ¥æ”¶æ–¹ï¼š</span></p><div><div id="highlighter_315020" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">while</code> <code class="cpp plain">( </code><code class="cpp keyword bold">true</code> <code class="cpp plain">)</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp plain">Message <em> message = connection.ReceiveMessage();</em></code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp keyword bold">if</code> <code class="cpp plain">( !message )</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">        </code><code class="cpp keyword bold">break</code><code class="cpp plain">;</code></div><div class="line number6 index5 alt1"> </div><div class="line number7 index6 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">if</code> <code class="cpp plain">( message-&gt;GetType() == TEST_MESSAGE )</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">        </code><code class="cpp plain">TestMessage  testMessage = (TestMessage*) message;</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">        </code><code class="cpp comments">// process test message</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number12 index11 alt1"> </div><div class="line number13 index12 alt2"><code class="cpp spaces">    </code><code class="cpp plain">factory.Release( message );</code></div><div class="line number14 index13 alt1"><code class="cpp plain">}</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå®ƒå·²ç»æ˜¯ç®€å•å¾—ä¸èƒ½å†ç®€å•äº†ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å¦‚æœè¿™å‡ ä¸ªæ¥å£æœ‰å¼•èµ·ä½ çš„å…´è¶£ï¼Œè¯·çœ‹çœ‹æˆ‘çš„æ–°å¼€æºåº“<span> <a rel="noopener" href="https://github.com/networkprotocol/libyojimbo" target="_blank"><span style="color:#DD3333">libyojimbo</span></a></span>ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æˆ‘å¸Œæœ›ä½ åˆ°ç°åœ¨ä¸ºæ­¢å¯¹è¿™ä¸ªç³»åˆ—çš„æ–‡ç« æ˜¯äº«å—çš„<span><a rel="noopener" href="http://www.patreon.com/gafferongames" target="_blank"><span style="color:#DD3333"><span>è¯·åœ¨ patreon</span></span><span style="color:#DD3333"><span>ä¸Šæ”¯æŒæˆ‘çš„å†™ä½œ</span></span></a></span>ï¼Œå¹¶ä¸”æˆ‘å°†æ›´å¿«å†™æ–°çš„æ–‡ç« ï¼Œå†è€…ä½ ä¼šåœ¨åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡è½¯ä»¶çš„å¼€æºè®¸å¯è¯ä¸‹è·å¾—è¿™ç¯‡æ–‡ç« çš„ç¤ºä¾‹æºä»£ç ã€‚<b><u><span style="border:none windowtext 1.0pt;padding:0cm">è°¢è°¢ä½ çš„æ”¯æŒï¼</span></u></b></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;Lucida Sans Unicode&quot;,&quot;sans-serif&quot;;color:#222222"> </span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">å³å°†åˆ°æ¥ï¼š</span></b><b><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><a rel="noopener" href="http://gafferongames.com/building-a-game-network-protocol/client-server-connection/" target="_blank"><span style="color:#DD3333"><span>å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„è¿æ¥</span></span></a></span></b> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">åœ¨<span>â€œ</span>åˆ›å»ºä¸€ä¸ªæ¸¸æˆç½‘ç»œåè®®<span>â€</span>çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¼šå±•ç¤ºä½ å¦‚ä½•åœ¨<span>UDP</span>ä¹‹ä¸Šåˆ›å»ºä½ è‡ªå·±çš„å®¢æˆ·ç«¯<span>/</span>æœåŠ¡å™¨è¿æ¥å±‚ï¼Œå®ƒä¼šå®ç°æŒ‘æˆ˜<span>/</span>å“åº”ï¼Œä¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ†é…å®¢æˆ·ç«¯æ’æ§½ï¼Œå½“æœåŠ¡å™¨çˆ†æ»¡æˆ–æ£€æµ‹è¶…æ—¶å°±æ‹’ç»å®¢æˆ·ç«¯çš„è¿æ¥ã€‚</span> </p><p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;"> </span> </p><p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;"> </span> </p><p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ã€ç‰ˆæƒå£°æ˜ã€‘</span> </p><p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">åŸæ–‡ä½œè€…æœªåšæƒåˆ©å£°æ˜ï¼Œè§†ä¸ºå…±äº«çŸ¥è¯†äº§æƒè¿›å…¥å…¬å…±é¢†åŸŸï¼Œè‡ªåŠ¨è·å¾—æˆæƒï¼›</span> </p><p class="MsoNormal"><span> </span> </p></div>                    <br>                

          
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/ssl_tls_illustrated/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/ssl_tls_illustrated/" itemprop="url">SSL/TLSè¯¦è§£</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-12T06:00:54+00:00">
                03-12-2017
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NP/" itemprop="url" rel="index">
                    <span itemprop="name">NP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          <p>äº’è”ç½‘çš„é€šä¿¡å®‰å…¨ï¼Œå»ºç«‹åœ¨ SSL/TLS åè®®ä¹‹ä¸Šã€‚</p>
<p>æœ¬æ–‡ç®€è¦ä»‹ç» SSL/TLS åè®®çš„è¿è¡Œæœºåˆ¶ã€‚æ–‡ç« çš„é‡ç‚¹æ˜¯è®¾è®¡æ€æƒ³å’Œè¿è¡Œè¿‡ç¨‹ï¼Œä¸æ¶‰åŠå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚å¦‚æœæƒ³äº†è§£è¿™æ–¹é¢çš„å†…å®¹ï¼Œè¯·å‚é˜… <a href="http://tools.ietf.org/html/rfc5246" target="_blank" rel="noopener">RFC æ–‡æ¡£</a>ã€‚</p>
<p><strong>. . .</strong>
          <!--noindex-->
          
          <!--/noindex-->
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </p></div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/kbe_ue4_demo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/kbe_ue4_demo/" itemprop="url">KBEçš„UE4çš„demoå¤§ä½“è§£è¯»</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-11T11:41:58+00:00">
                03-11-2017
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UE4/" itemprop="url" rel="index">
                    <span itemprop="name">UE4</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          
            <p>å†™åˆ°ä¸€åŠå‘ç°è®ºå›çš„çƒ­é—¨å¸–å­é‡Œå®˜æ–¹å†™äº†ä¸ªu3dçš„demoæºç è§£æ,  å†…å®¹å‡ ä¹é‡å¤, u3dè·Ÿue4çš„demoæ¡†æ¶æµç¨‹å‡ ä¹éƒ½æ˜¯å·®ä¸å¤šçš„, ç›´æ¥ç»™å‡ºå®˜æ–¹å¸–å­çš„é“¾æ¥å¥½äº†, å°´å°¬:<br><a href="http://bbs.kbengine.org/forum.php?mod=viewthread&amp;tid=166" target="_blank" rel="noopener">http://bbs.kbengine.org/forum.php?mod=viewthread&amp;tid=166</a></p>

          
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/sending_large_blocks_of_data/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/sending_large_blocks_of_data/" itemprop="url">æ„å»ºæ¸¸æˆç½‘ç»œåè®®å››ä¹‹å‘é€å¤§å—æ•°æ®</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-28T15:13:35+00:00">
                02-28-2017
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GS/" itemprop="url" rel="index">
                    <span itemprop="name">GS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          
            <h1 id="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"><a href="#æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“" class="headerlink" title="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"></a>æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“</h1><p>æœ‰äº†æœ¬ç³»åˆ—ä¸Šç¯‡æ–‡ç« ä¸­çš„åˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿä¸ºä½•è¿˜è¦è¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ?æ˜¯å¦æ˜¯å¤šä½™çš„?æ˜¯é›·åŒçš„å—?<br>è¯·çœ‹æ€»ç»“æ¦‚è¦ç†æ¸…æ€è·¯, å†ç»†çœ‹æ–‡ç« .</p>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ</h2><p>ç¬¬ä¸€çœ¼çœ‹ä¸Šå»ï¼Œè¿™ç§æ›¿ä»£æ€§çš„æŠ€æœ¯ä¼¼ä¹éå¸¸ç±»ä¼¼äºæ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ï¼Œä½†æ˜¯å®ƒçš„å®ç°æ˜¯å®Œå…¨ä¸åŒçš„ã€‚è¿™ç§å®ç°ä¸Šçš„å·®å¼‚çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³æ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„çš„ä¸€ä¸ªå…³é”®å¼±ç‚¹ : ä¸€ä¸ªç‰‡æ®µçš„ä¸¢å¤±å°±ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®åŒ…éƒ½è¦è¢«ä¸¢å¼ƒæ‰ç„¶åé‡æ–°åˆ†åŒ…é‡å‘ã€‚</p>
<p>ä½ å¯èƒ½éœ€è¦è¿™æ ·åšçš„ä¸€äº›å¸¸è§çš„ä¾‹å­åŒ…æ‹¬ï¼šå®¢æˆ·ç«¯åœ¨é¦–æ¬¡åŠ å…¥çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éœ€è¦ä¸‹å‘ä¸€ä¸ªå¤§çš„æ•°æ®å—ç»™å®¢æˆ·ç«¯(å¯èƒ½æ˜¯ä¸–ç•Œçš„åˆå§‹çŠ¶æ€)ã€ä¸€å¼€å§‹ç”¨æ¥åšå¢é‡ç¼–ç çš„åŸºçº¿æˆ–è€…æ˜¯åœ¨ä¸€ä¸ªå¤šäººåœ¨çº¿ç½‘ç»œæ¸¸æˆé‡Œé¢å®¢æˆ·ç«¯åœ¨åŠ è½½ç•Œé¢æ‰€ç­‰å¾…çš„å¤§å—æ•°æ®ã€‚</p>
<p>åœ¨è¿™äº›æƒ…å†µä¸‹éå¸¸é‡è¦çš„æ˜¯ä¸ä»…è¦ä¼˜é›…åœ°å¤„ç†æ•°æ®åŒ…çš„ä¸¢å¤±ï¼Œè¿˜è¦å°½å¯èƒ½çš„åˆ©ç”¨å¯ç”¨çš„å¸¦å®½å¹¶å°½å¯èƒ½å¿«çš„å‘é€å¤§å—æ•°æ®ã€‚</p>
<p>è¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿå¤§è‡´å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªåœ¨åŸæ¥åˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿçš„åŸºç¡€ä¸Šå¢åŠ äº†åˆ†åŒ…ç¡®è®¤åŠŸèƒ½, ä¹Ÿå°±æ˜¯è¯´å¢åŠ äº†å¯é æ€§çš„éƒ¨åˆ†.</p>
<h2 id="æœ¬ç¯‡åŸºæœ¬æœ¯è¯­"><a href="#æœ¬ç¯‡åŸºæœ¬æœ¯è¯­" class="headerlink" title="æœ¬ç¯‡åŸºæœ¬æœ¯è¯­"></a>æœ¬ç¯‡åŸºæœ¬æœ¯è¯­</h2><p>In this new system blocks of data are called chunks. Chunks are split up into slices. This name change keeps the chunk system terminology (chunks/slices) distinct from packet fragmentation and reassembly (packets/fragments).</p>
<ul>
<li>å— : åœ¨è¿™ä¸ªæ–°ç³»ç»Ÿä¸­ï¼Œå¤§å—çš„æ•°æ®è¢«ç§°ä¸ºâ€å—â€(chunks)</li>
<li>ç‰‡æ®µ : è€Œå—è¢«åˆ†æˆçš„åˆ†åŒ…è¢«ç§°ä¸ºâ€ç‰‡æ®µâ€(slices)</li>
</ul>
<h2 id="æ•°æ®åŒ…çš„ç»“æ„è®¾è®¡"><a href="#æ•°æ®åŒ…çš„ç»“æ„è®¾è®¡" class="headerlink" title="æ•°æ®åŒ…çš„ç»“æ„è®¾è®¡"></a>æ•°æ®åŒ…çš„ç»“æ„è®¾è®¡</h2><p>è¿™ä¸ªç³»ç»Ÿåœ¨ç½‘ç»œä¸Šå‘é€çš„æ•°æ®åŒ…ç±»å‹ä¸€å…±æœ‰ä¸¤ç§ç±»å‹ï¼š</p>
<ul>
<li><p>Slice packetç‰‡æ®µæ•°æ®åŒ… : è¿™åŒ…æ‹¬äº†ä¸€ä¸ªå—çš„ç‰‡æ®µï¼Œæœ€å¤šå¤§å°ä¸º1kã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SliceSize = <span class="number">1024</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MaxSlicesPerChunk = <span class="number">256</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MaxChunkSize = SliceSize  MaxSlicesPerChunk;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SlicePacket</span> :</span> <span class="keyword">public</span> protocol2::Packet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">uint16_t</span> chunkId;</span><br><span class="line">    <span class="keyword">int</span> sliceId;</span><br><span class="line">    <span class="keyword">int</span> numSlices;</span><br><span class="line">    <span class="keyword">int</span> sliceBytes;</span><br><span class="line">    <span class="keyword">uint8_t</span> data[SliceSize];</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> stream&gt; <span class="function"><span class="keyword">bool</span> <span class="title">Serialize</span><span class="params">( Stream &amp; stream )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        serialize_bits( stream, chunkId, <span class="number">16</span> );</span><br><span class="line">        serialize_int( stream, sliceId, <span class="number">0</span>, MaxSlicesPerChunk - <span class="number">1</span> );</span><br><span class="line">        serialize_int( stream, numSlices, <span class="number">1</span>, MaxSlicesPerChunk );</span><br><span class="line">        <span class="keyword">if</span> ( sliceId == numSlices - <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            serialize_int( stream, sliceBytes, <span class="number">1</span>, SliceSize );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( Stream::IsReading )</span><br><span class="line">        &#123;</span><br><span class="line">            sliceBytes = SliceSize;</span><br><span class="line">        &#125;</span><br><span class="line">        serialize_bytes( stream, data, sliceBytes );</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Ack packetç¡®è®¤æ•°æ®åŒ… : ä¸€ä¸ªä½åŸŸbitfieldæŒ‡ç¤ºå“ªäº›ç‰‡æ®µå·²ç»æ”¶åˆ°, we just send the entire state of all acked slices in each ack packet. When the ack packet is received (including the slice that was just received).</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AckPacket</span> :</span> <span class="keyword">public</span> protocol2::Packet </span><br><span class="line">&#123; </span><br><span class="line">    <span class="keyword">uint16_t</span> chunkId; </span><br><span class="line">    <span class="keyword">int</span> numSlices; </span><br><span class="line">    <span class="keyword">bool</span> acked[MaxSlicesPerChunk]; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Serialize</span><span class="params">( Stream &amp; stream )</span></span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        serialize_bits( stream, chunkId, <span class="number">16</span> ); </span><br><span class="line">        serialize_int( stream, numSlices, <span class="number">1</span>, MaxSlicesPerChunk ); </span><br><span class="line">        <span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numSlices; ++i ) </span><br><span class="line">            serialize_bool( stream, acked[i] ); <span class="keyword">return</span> <span class="literal">true</span>; &#125; &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="å‘é€æ–¹çš„å®ç°"><a href="#å‘é€æ–¹çš„å®ç°" class="headerlink" title="å‘é€æ–¹çš„å®ç°"></a>å‘é€æ–¹çš„å®ç°</h2><p>ä¸ä¹‹å‰æ–‡ç« ä»‹ç»çš„æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿä¸åŒï¼Œå—ç³»ç»Ÿåœ¨åŒä¸€æ—¶é—´åªèƒ½ç”±ä¸€ä¸ªå—æ­£åœ¨ä¼ è¾“ã€‚<br>å‘é€æ–¹çš„ç­–ç•¥æ˜¯ï¼š</p>
<ul>
<li>æŒç»­çš„å‘é€ç‰‡æ®µæ•°æ®åŒ…ï¼Œç›´åˆ°æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…éƒ½è¢«ç¡®è®¤ã€‚</li>
<li>ä¸å†å¯¹å·²ç»ç¡®è®¤è¿‡çš„ç‰‡æ®µæ•°æ®åŒ…è¿›è¡Œå‘é€ã€‚</li>
</ul>
<p>å¯¹äºå‘é€æ–¹è€Œè¨€æœ‰ä¸€ç‚¹æ¯”è¾ƒå¾®å¦™ï¼Œå®ç°ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…é‡æ–°å‘é€çš„æœ€å°å»¶è¿Ÿæ˜¯ä¸€ä¸ªå¾ˆæ£’çš„ä¸»æ„ï¼Œå¦‚æœä¸è¿™ä¹ˆåšçš„è¯ï¼Œå°±å¯èƒ½ä¼šå‡ºç°è¿™ç§ä¸€æ ·æƒ…å†µï¼Œå¯¹äºå¾ˆå°çš„å—æ•°æ®æˆ–è€…ä¸€ä¸ªå—çš„æœ€åå‡ ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œå¾ˆå®¹æ˜“ä¸åœçš„å‘é€å®ƒä»¬æŠŠæ•´ä¸ªç½‘ç»œéƒ½å¡æ»¡ã€‚æ­£æ˜¯å› ä¸ºè¿™ä¸€åŸå› ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªæ•°ç»„æ¥è®°å½•æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„ä¸Šä¸€æ¬¡å‘é€æ—¶é—´ã€‚é‡æ–°å‘é€å»¶è¿Ÿçš„ä¸€ä¸ªé€‰æ‹©æ˜¯ä½¿ç”¨ä¸€ä¸ªä¼°è®¡çš„ç½‘ç»œå¾€è¿”æ—¶å»¶ï¼Œæˆ–è€…åªæœ‰åœ¨è¶…è¿‡ä¸Šä¸€æ¬¡å‘é€æ—¶é—´ç½‘ç»œå¾€è¿”æ—¶å»¶*1.25è¿˜æ²¡æœ‰æ”¶åˆ°ç¡®è®¤æ•°æ®åŒ…çš„æƒ…å†µæ‰ä¼šé‡æ–°å‘é€ã€‚æˆ–è€…ï¼Œä½ å¯ä»¥è¯´â€œè¿™æ ¹æœ¬å°±æ— æ‰€è°“â€ï¼Œåªè¦è¶…è¿‡ä¸Šä¸€æ¬¡å‘é€æ—¶é—´100æ¯«ç§’äº†å°±é‡æ–°å‘é€ã€‚æˆ‘åªæ˜¯åˆ—ä¸¾é€‚åˆæˆ‘è‡ªå·±çš„æ–¹æ¡ˆï¼</p>
<p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹çš„æ•°æ®ç»“æ„æ¥æè¿°å‘é€æ–¹ï¼š<br><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChunkSender</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">bool</span> sending;</span><br><span class="line">    <span class="keyword">uint16_t</span> chunkId;</span><br><span class="line">    <span class="keyword">int</span> chunkSize;</span><br><span class="line">    <span class="keyword">int</span> numSlices;</span><br><span class="line">    <span class="keyword">int</span> numAckedSlices;</span><br><span class="line">    <span class="keyword">int</span> currentSliceId;</span><br><span class="line">    <span class="keyword">bool</span> acked[MaxSlicesPerChunk];</span><br><span class="line">    <span class="keyword">uint8_t</span> chunkData[MaxChunkSize];</span><br><span class="line">    <span class="keyword">double</span> timeLastSent[MaxSlicesPerChunk];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="æ¥æ”¶æ–¹çš„å®ç°æ€è·¯"><a href="#æ¥æ”¶æ–¹çš„å®ç°æ€è·¯" class="headerlink" title="æ¥æ”¶æ–¹çš„å®ç°æ€è·¯"></a>æ¥æ”¶æ–¹çš„å®ç°æ€è·¯</h2><p>é¦–å…ˆï¼Œæ¥æ”¶æ–¹çš„è®¾ç½®ä¼šä»å—0å¼€å§‹ã€‚å½“ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…ä»ç½‘ç»œä¸Šä¼ é€’è¿‡æ¥ï¼Œå¹¶ä¸”èƒ½å¤ŸåŒ¹é…è¿™ä¸ªå—idçš„è¯ï¼Œâ€œreceivingâ€çŠ¶æ€ä¼šä»falseç¿»è½¬ä¸ºtrueï¼Œç¬¬ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ•°æ®ä¼šæ’å…¥â€ chunkDataâ€œå˜é‡çš„åˆé€‚ä½ç½®ï¼Œç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ä¼šæ ¹æ®ç¬¬ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…é‡Œé¢çš„æ•°æ®è¿›è¡Œæ­£ç¡®çš„è®¾ç½®ï¼Œå·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ä¼šåŠ ä¸€ï¼Œä¹Ÿå°±æ˜¯ä»0åˆ°1ï¼Œé’ˆå¯¹æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ¥æ”¶æ ‡è®°é‡Œé¢å¯¹åº”è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„é¡¹ä¼šå˜ä¸ºtrueã€‚</p>
<p>éšç€è¿™ä¸ªå—æ•°æ®çš„å…¶ä»–ç‰‡æ®µæ•°æ®åŒ…çš„åˆ°æ¥ï¼Œä¼šå¯¹æ¯ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…è¿›è¡Œæ£€æµ‹ï¼Œåˆ¤æ–­å®ƒä»¬çš„idæ˜¯å¦ä¸å½“å‰å—çš„idç›¸åŒï¼Œå¦‚æœä¸ç›¸åŒçš„è¯å°±ä¼šè¢«ä¸¢å¼ƒã€‚å¦‚æœè¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…å·²ç»æ”¶åˆ°è¿‡çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…ä¹Ÿä¼šè¢«ä¸¢å¼ƒã€‚å¦åˆ™ï¼Œè¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ•°æ®ä¼šæ’å…¥â€ chunkDataâ€œå˜é‡çš„åˆé€‚ä½ç½®ã€å·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ä¼šåŠ ä¸€ã€é’ˆå¯¹æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ¥æ”¶æ ‡è®°é‡Œé¢å¯¹åº”è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„é¡¹ä¼šå˜ä¸ºtrueã€‚</p>
<p>è¿™ä¸€è¿‡ç¨‹ä¼šæŒç»­è¿›è¡Œï¼Œç›´åˆ°æ¥æ”¶åˆ°æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…ã€‚ä¸€æ—¦æ¥æ”¶åˆ°æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…ï¼ˆä¹Ÿå°±æ˜¯å·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ç­‰äºç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡çš„æ—¶å€™ï¼‰ï¼Œæ¥æ”¶æ–¹ä¼šæŠŠâ€œreceiving â€œçŠ¶æ€æ”¹ä¸ºfalseï¼Œè€ŒæŠŠâ€readyToReadâ€œçŠ¶æ€æ”¹ä¸ºtrueã€‚å½“â€readyToReadâ€çŠ¶æ€ä¸ºtrueçš„æ—¶å€™ï¼Œæ‰€æœ‰æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œè¿™ä¸ªå¤„ç†è¿‡ç¨‹é€šå¸¸éå¸¸çš„çŸ­ï¼Œä¼šåœ¨æ”¶åˆ°ç‰‡æ®µæ•°æ®åŒ…çš„åŒä¸€å¸§è¿›è¡Œå¤„ç†ï¼Œè°ƒç”¨è€…ä¼šæ£€æŸ¥â€æˆ‘æœ‰ä¸€å—æ•°æ®è¦è¯»å–ä¹ˆï¼Ÿâ€œå¹¶å¤„ç†å—æ•°æ®ã€‚ç„¶åä¼šé‡ç½®æ•°æ®å—æ¥æ”¶å™¨çš„æ‰€æœ‰æ•°æ®ä¸ºé»˜è®¤å€¼ï¼Œé™¤äº†å—æ•°æ®çš„idä»0å¢åŠ åˆ°1ï¼Œè¿™æ ·æˆ‘ä»¬å°±å‡†å¤‡å¥½æ¥æ”¶ä¸‹ä¸€ä¸ªå—äº†ã€‚<br><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChunkReceiver</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">bool</span> receiving;</span><br><span class="line">    <span class="keyword">bool</span> readyToRead;</span><br><span class="line">    <span class="keyword">uint16_t</span> chunkId;</span><br><span class="line">    <span class="keyword">int</span> chunkSize;</span><br><span class="line">    <span class="keyword">int</span> numSlices;</span><br><span class="line">    <span class="keyword">int</span> numReceivedSlices;</span><br><span class="line">    <span class="keyword">bool</span> received[MaxSlicesPerChunk];</span><br><span class="line">    <span class="keyword">uint8_t</span> chunkData[MaxChunkSize];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="é˜²DDos"><a href="#é˜²DDos" class="headerlink" title="é˜²DDos"></a>é˜²DDos</h2><p>å¦‚æœä½ å¯¹æ¯ä¸ªæ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…éƒ½ä¼šå›å¤ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…çš„è¯ï¼Œé‚£ä¹ˆå‘é€æ–¹èƒ½å¤Ÿæ„é€ ä¸€ä¸ªå¾ˆå°çš„ç‰‡æ®µæ•°æ®åŒ…å‘é€ç»™ä½ ï¼Œè€Œä½ ä¼šå›å¤ä¸€ä¸ªæ¯”å‘é€ç»™ä½ çš„ç‰‡æ®µæ•°æ®åŒ…è¿˜å¤§çš„ç¡®è®¤æ•°æ®åŒ…ï¼Œè¿™æ ·ä½ çš„æœåŠ¡å™¨å°±å˜æˆäº†ä¸€ä¸ªå¯ä»¥è¢«äººåˆ©ç”¨æ¥è¿›è¡ŒDDosæ”¾å¤§æ”»å‡»çš„å·¥å…·ã€‚</p>
<p>æ°¸è¿œä¸è¦è®¾è®¡ä¸€ä¸ªåŒ…å«å¯¹æ¥æ”¶åˆ°çš„æ•°æ®åŒ…è¿›è¡Œä¸€å¯¹ä¸€çš„æ˜ å°„å“åº”çš„åè®®ã€‚è®©æˆ‘ä»¬ä¸¾ä¸ªç®€å•ä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœæœ‰äººç»™ä½ å‘é€1000ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œæ°¸è¿œä¸è¦ç»™ä»–å›å¤1000ä¸ªç¡®è®¤æ•°æ®åŒ…ã€‚ç›¸ååªå‘ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…ï¼Œè€Œä¸”æœ€å¤šæ¯50æ¯«ç§’æˆ–è€…100æ¯«ç§’æ‰å‘é€ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…ã€‚å¦‚æœä½ æ˜¯è¿™æ ·è®¾è®¡çš„è¯ï¼Œé‚£ä¹ˆDDosæ”»å‡»å®Œå…¨ä¸å¯èƒ½çš„ã€‚</p>
<h1 id="åŸæ–‡"><a href="#åŸæ–‡" class="headerlink" title="åŸæ–‡"></a>åŸæ–‡</h1><p><a href="https://gafferongames.com/post/sending_large_blocks_of_data/" target="_blank" rel="noopener">åŸæ–‡å‡ºå¤„</a></p>
<p>åŸæ–‡æ ‡é¢˜ : <strong>Sending Large Blocks of Data</strong> (<em>How to send blocks quickly and reliably over UDP</em>)</p>
<hr>
<p></p><h2 id="introduction">Introduction</h2><p></p>
<p>Hi, Iâ€™m <a href="https://gafferongames.com/about" target="_blank" rel="noopener">Glenn Fiedler</a> and welcome to <strong><a href="https://gafferongames.com/categories/building-a-game-network-protocol/" target="_blank" rel="noopener">Building a Game Network Protocol</a></strong>.</p><br><p>In the <a href="https://gafferongames.com/post/packet_fragmentation_and_reassembly/" target="_blank" rel="noopener">previous article</a> we implemented packet fragmentation and reassembly so we can send packets larger than MTU.</p><br><p>This approach works great when the data block you&rsquo;re sending is time critical and can be dropped, but in other cases you need to send large blocks of quickly and reliably over packet loss, and you need the data to get through.</p><br><p>In this situation, a different technique gives much better results.</p><br><h2 id="background">Background</h2><br><p>It&rsquo;s common for servers to send large block of data to the client on connect, for example, the initial state of the game world for late join.</p><br><p>Let&rsquo;s assume this data is 256k in size and the client needs to receive it before they can join the game. The client is stuck behind a load screen waiting for the data, so obviously we want it to be transmitted as quickly as possible.</p><br><p>If we send the data with the technique from the previous article, we get <em>packet loss amplification</em> because a single dropped fragment results in the whole packet being lost. The effect of this is actually quite severe. Our example block split into 256 fragments and sent over 1% packet loss now has a whopping 92.4% chance of being dropped!</p><br><p>Since we just need the data to get across, we have no choice but to keep sending it until it gets through. On average, we have to send the block 10 times before it&rsquo;s received. You may laugh but this actually happened on a AAA game I worked on!</p><br><p>To fix this, I implemented a new system for sending large blocks, one that handles packet loss by resends fragments until they are acked. Then I took the problematic large blocks and piped them through this system, fixing a bunch of players stalling out on connect, while continuing to send time critical data (snapshots) via packet fragmentation and reassembly.</p><br><h2 id="chunks-and-slices">Chunks and Slices</h2><br><p>In this new system blocks of data are called <em>chunks</em>. Chunks are split up into <em>slices</em>. This name change keeps the chunk system terminology (chunks/slices) distinct from packet fragmentation and reassembly (packets/fragments).</p><br><p>The basic idea is that slices are sent over the network repeatedly until they all get through. Since we are implementing this over UDP, simple in concept becomes a little more complicated in implementation because have to build in our own basic reliability system so the sender knows which slices have been received.</p><br><p>This reliability gets quite tricky if we have a bunch of different chunks in flight, so we&rsquo;re going to make a simplifying assumption up front: we&rsquo;re only going to send one chunk over the network at a time. This doesn&rsquo;t mean the sender can&rsquo;t have a local send queue for chunks, just that in terms of network traffic there&rsquo;s only ever one chunk <em>in flight</em> at any time.</p><br><p>This makes intuitive sense because the whole point of the chunk system is to send chunks reliably and in-order. If you are for some reason sending chunk 0 and chunk 1 at the same time, what&rsquo;s the point? You can&rsquo;t process chunk 1 until chunk 0 comes through, because otherwise it wouldn&rsquo;t be reliable-ordered.</p><br><p>That said, if you dig a bit deeper you&rsquo;ll see that sending one chunk at a time does introduce a small trade-off, and that is that it adds a delay of RTT between chunk n being received and the send starting for chunk n+1 from the receiver&rsquo;s point of view.</p><br><p>This trade-off is totally acceptable for the occasional sending of large chunks like data sent once on client connect, but it&rsquo;s definitely <em>not</em> acceptable for data sent 10 or 20 times per-second like snapshots. So remember, this system is useful for large, infrequently sent blocks of data, not for time critical data.</p><br><h2 id="packet-structure">Packet Structure</h2><br><p>There are two sides to the chunk system, the <strong>sender</strong> and the <strong>receiver</strong>.</p><br><p>The sender is the side that queues up the chunk and sends slices over the network. The receiver is what reads those slice packets and reassembles the chunk on the other side. The receiver is also responsible for communicating back to the sender which slices have been received via acks.</p><br><p>The netcode I work on is usually client/server, and in this case I usually want to be able to send blocks of data from the server to the client <em>and</em> from the client to the server. In that case, there are two senders and two receivers, a sender on the client corresponding to a receiver on the server and vice-versa.</p><br><p>Think of the sender and receiver as end points for this chunk transmission protocol that define the direction of flow. If you want to send chunks in a different direction, or even extend the chunk sender to support peer-to-peer, just add sender and receiver end points for each direction you need to send chunks.</p><br><p>Traffic over the network for this system is sent via two packet types:</p><br><ul><br><li><strong>Slice packet</strong> - contains a slice of a chunk up to 1k in size.</li><br><li><strong>Ack packet</strong> - a bitfield indicating which slices have been received so far.</li><br></ul><br><p>The slice packet is sent from the sender to the receiver. It is the payload packet that gets the chunk data across the network and is designed so each packet fits neatly under a conservative MTU of 1200 bytes. Each slice is a maximum of 1k and there is a maximum of 256 slices per-chunk, therefore the largest data you can send over the network with this system is 256k.</p><br><pre><code>const int SliceSize = 1024;<br>const int MaxSlicesPerChunk = 256;<br>const int MaxChunkSize = SliceSize <em> MaxSlicesPerChunk;<br><br>struct SlicePacket : public protocol2::Packet<br>{<br>    uint16_t chunkId;<br>    int sliceId;<br>    int numSlices;<br>    int sliceBytes;<br>    uint8_t data[SliceSize];<br><br>    template &amp;lt;typename Stream&amp;gt; bool Serialize( Stream &amp;amp; stream )<br>    {<br>        serialize_bits( stream, chunkId, 16 );<br>        serialize_int( stream, sliceId, 0, MaxSlicesPerChunk - 1 );<br>        serialize_int( stream, numSlices, 1, MaxSlicesPerChunk );<br>        if ( sliceId == numSlices - 1 )<br>        {<br>            serialize_int( stream, sliceBytes, 1, SliceSize );<br>        }<br>        else if ( Stream::IsReading )<br>        {<br>            sliceBytes = SliceSize;<br>        }<br>        serialize_bytes( stream, data, sliceBytes );<br>        return true;<br>    }<br>};<br></em></code></pre><br><p>There are two points I&rsquo;d like to make about the slice packet. The first is that even though there is only ever one chunk in flight over the network, it&rsquo;s still necessary to include the chunk id (0,1,2,3, etc&hellip;) because packets sent over UDP can be received out of order.</p><br><p>Second point. Due to the way chunks are sliced up we know that all slices except the last one must be SliceSize (1024 bytes). We take advantage of this to save a small bit of bandwidth sending the slice size only in the last slice, but there is a trade-off: the receiver doesn&rsquo;t know the exact size of a chunk until it receives the last slice.</p><br><p>The other packet sent by this system is the ack packet. This packet is sent in the opposite direction, from the receiver back to the sender. This is the reliability part of the chunk network protocol. Its purpose is to lets the sender know which slices have been received.</p><br><pre><code>struct AckPacket : public protocol2::Packet<br>{<br>    uint16_t chunkId;<br>    int numSlices;<br>    bool acked[MaxSlicesPerChunk];<br><br>    bool Serialize( Stream &amp;amp; stream )<br>    {<br>        serialize_bits( stream, chunkId, 16 );<br>        serialize_int( stream, numSlices, 1, MaxSlicesPerChunk );<br>        for ( int i = 0; i &amp;lt; numSlices; ++i )<br>        {<br>            serialize_bool( stream, acked[i] ); return true; } };<br>        }<br>    }<br>};<br></code></pre><br><p>Acks are short for &lsquo;acknowledgments&rsquo;. So an ack for slice 100 means the receiver is <em>acknowledging</em> that it has received slice 100. This is critical information for the sender because not only does it let the sender determine when all slices have been received so it knows when to stop, it also allows the sender to use bandwidth more efficiently by only sending slices that haven&rsquo;t been acked.</p><br><p>Looking a bit deeper into the ack packet, at first glance it seems a bit <em>redundant</em>. Why are we sending acks for all slices in every packet? Well, ack packets are sent over UDP so there is no guarantee that all ack packets are going to get through. You certainly don&rsquo;t want a desync between the sender and the receiver regarding which slices are acked.</p><br><p>So we need some reliability for acks, but we don&rsquo;t want to implement an <em>ack system for acks</em> because that would be a huge pain in the ass. Since the worst case ack bitfield is just 256 bits or 32 bytes, we just send the entire state of all acked slices in each ack packet. When the ack packet is received, we consider a slice to be acked the instant an ack packet comes in with that slice marked as acked and locally that slice is not seen as acked yet.</p><br><p>This last step, biasing in the direction of non-acked to ack, like a fuse getting blown, means we can handle out of order delivery of ack packets.</p><br><h2 id="sender-implementation">Sender Implementation</h2><br><p>Let&rsquo;s get started with the implementation of the sender.</p><br><p>The strategy for the sender is:</p><br><ul><br><li>Keep sending slices until all slices are acked</li><br><li>Don&rsquo;t resend slices that have already been acked</li><br></ul><br><p>We use the following data structure for the sender:</p><br><pre><code>class ChunkSender<br>{<br>    bool sending;<br>    uint16_t chunkId;<br>    int chunkSize;<br>    int numSlices;<br>    int numAckedSlices;<br>    int currentSliceId;<br>    bool acked[MaxSlicesPerChunk];<br>    uint8_t chunkData[MaxChunkSize];<br>    double timeLastSent[MaxSlicesPerChunk];<br>};<br></code></pre><br><p>As mentioned before, only one chunk is sent at a time, so there is a &lsquo;sending&rsquo; state which is true if we are currently sending a chunk, false if we are in an idle state ready for the user to send a chunk. In this implementation, you can&rsquo;t send another chunk while the current chunk is still being sent over the network. If you don&rsquo;t like this, stick a queue in front of the sender.</p><br><p>Next, we have the id of the chunk we are currently sending, or, if we are not sending a chunk, the id of the next chunk to be sent, followed by the size of the chunk and the number of slices it has been split into. We also track, per-slice, whether that slice has been acked, which lets us count the number of slices that have been acked so far while ignoring redundant acks. A chunk is considered fully received from the sender&rsquo;s point of view when numAckedSlices == numSlices.</p><br><p>We also keep track of the current slice id for the algorithm that determines which slices to send, which works like this. At the start of a chunk send, start at slice id 0 and work from left to right and wrap back around to 0 again when you go past the last slice. Eventually, you stop iterating across because you&rsquo;ve run out of bandwidth to send slices. At this point, remember our current slice index via current slice id so you can pick up from where you left off next time. This last part is important because it distributes sends across all slices, not just the first few.</p><br><p>Now let&rsquo;s discuss bandwidth limiting. Obviously you don&rsquo;t just blast slices out continuously as you&rsquo;d flood the connection in no time, so how do we limit the sender bandwidth? My implementation works something like this: as you walk across slices and consider each slice you want to send, estimate roughly how many bytes the slice packet will take eg: roughly slice bytes + some overhead for your protocol and UDP/IP header. Then compare the amount of bytes required vs. the available bytes you have to send in your bandwidth budget. If you don&rsquo;t have enough bytes accumulated, stop. Otherwise, subtract the bytes required to send the slice and repeat the process for the next slice.</p><br><p>Where does the available bytes in the send budget come from? Each frame before you update the chunk sender, take your target bandwidth (eg. 256kbps), convert it to bytes per-second, and add it multiplied by delta time (dt) to an accumulator.</p><br><p>A conservative send rate of 256kbps means you can send 32000 bytes per-second, so add 32000  dt to the accumulator. A middle ground of 512kbit/sec is 64000 bytes per-second. A more aggressive 1mbit is 125000 bytes per-second. This way each update you <em>accumulate</em> a number of bytes you are allowed to send, and when you&rsquo;ve sent all the slices you can given that budget, any bytes left over stick around for the next time you try to send a slice.</p><br><p>One subtle point with the chunk sender and is that it&rsquo;s a good idea to implement some minimum resend delay per-slice, otherwise you get situations where for small chunks, or the last few slices of a chunk that the same few slices get spammed over the network.</p><br><p>For this reason we maintain an array of last send time per-slice. One option for this resend delay is to maintain an estimate of RTT and to only resend a slice if it hasn&rsquo;t been acked within RTT * 1.25 of its last send time. Or, you could just resend the slice it if it hasn&rsquo;t been sent in the last 100ms. Works for me!</p><br><h2 id="kicking-it-up-a-notch">Kicking it up a notch</h2><br><p>Do the math you&rsquo;ll notice it still takes a long time for a 256k chunk to get across:</p><br><ul><br><li>1mbps = 2 seconds</li><br><li>512kbps = 4 seconds</li><br><li>256kbps = <strong>8 seconds :(</strong></li><br></ul><br><p>Which kinda sucks. The whole point here is quickly and reliably. Emphasis on <em>quickly</em>. Wouldn&rsquo;t it be nice to be able to get the chunk across faster? The typical use case of the chunk system supports this. For example, a large block of data sent down to the client immediately on connect or a block of data that has to get through before the client exits a load screen and starts to play. You want this to be over as quickly as possible and in both cases the user really doesn&rsquo;t have anything better to do with their bandwidth, so why not use as much of it as possible?</p><br><p>One thing I&rsquo;ve tried in the past with excellent results is an initial burst. Assuming your chunk size isn&rsquo;t so large, and your chunk sends are infrequent, I can see no reason why you can&rsquo;t just fire across the entire chunk, all slices of it, in separate packets in one glorious burst of bandwidth, wait 100ms, and then resume the regular bandwidth limited slice sending strategy.</p><br><p>Why does this work? In the case where the user has a good internet connection (some multiple of 10mbps or greater&hellip;), the slices get through very quickly indeed. In the situation where the connection is not so great, the burst gets buffered up and <em>most</em> slices will be delivered as quickly as possible limited only by the amount bandwidth available. After this point switching to the regular strategy at a lower rate picks up any slices that didn&rsquo;t get through the first time.</p><br><p>This seems a bit risky so let me explain. In the case where the user can&rsquo;t quite support this bandwidth what you&rsquo;re relying on here is that routers on the Internet <em>strongly prefer</em> to buffer packets rather than discard them at almost any cost. It&rsquo;s a TCP thing. Normally, I hate this because it induces latency in packet delivery and messes up your game packets which you want delivered as quickly as possible, but in this case it&rsquo;s good behavior because the player really has nothing else to do but wait for your chunk to get through.</p><br><p>Just don&rsquo;t go too overboard with the spam or the congestion will persist after your chunk send completes and it will affect your game for the first few seconds. Also, make sure you increase the size of your OS socket buffers on both ends so they are larger than your maximum chunk size (I recommend at least double), otherwise you&rsquo;ll be dropping slices packets before they even hit the wire.</p><br><p>Finally, I want to be a responsible network citizen here so although I recommend sending all slices once in an initial burst, it&rsquo;s important for me to mention that I think this really is only appropriate, and only really <em>borderline appropriate</em> behavior for small chunks in the few 100s of k range in 2016, and only when your game isn&rsquo;t sending anything else that is time-critical.</p><br><p>Please don&rsquo;t use this burst strategy if your chunk is really large, eg: megabytes of data, because that&rsquo;s way too big to be relying on the kindness of strangers, AKA. the buffers in the routers between you and your packet&rsquo;s destination. For this it&rsquo;s necessary to implement something much smarter. Something adaptive that tries to send data as quickly as it can, but backs off when it detects too much latency and/or packet loss as a result of flooding the connection. Such a system is outside of the scope of this article.</p><br><h2 id="receiver-implementation">Receiver Implementation</h2><br><p>Now that we have the sender all sorted out let&rsquo;s move on to the reciever. </p><br><p>As mentioned previously, unlike the packet fragmentation and reassembly system from the previous article, the chunk system only ever has one chunk in flight.</p><br><p>This makes the reciever side of the chunk system much simpler:</p><br><pre><code>class ChunkReceiver<br>{<br>    bool receiving;<br>    bool readyToRead;<br>    uint16_t chunkId;<br>    int chunkSize;<br>    int numSlices;<br>    int numReceivedSlices;<br>    bool received[MaxSlicesPerChunk];<br>    uint8_t chunkData[MaxChunkSize];<br>};<br></code></pre><br><p>We have a state whether we are currently &lsquo;receiving&rsquo; a chunk over the network, plus a &rsquo;readyToRead&rsquo; state which indicates that a chunk has received all slices and is ready to be popped off by the user. This is effectively a minimal receive queue of length 1. If you don&rsquo;t like this, of course you are free to add a queue.</p><br><p>In this data structure we also keep track of chunk size (although it is not known with complete accuracy until the last slice arrives), num slices and num received slices, as well as a received flag per-slice. This per-slice received flag lets us discard packets containing slices we have already received, and count the number of slices received so far (since we may receive the slice multiple times, we only increase this count the first time we receive a particular slice). It&rsquo;s also used when generating ack packets. The chunk receive is completed from the receiver&rsquo;s point of view when numReceivedSlices == numSlices.</p><br><p>So what does it look like end-to-end receiving a chunk?</p><br><p>First, the receiver sets up set to start at chunk 0. When the a slice packet comes in over the network matching the chunk id 0, &lsquo;receiving&rsquo; flips from false to true, data for that first slice is inserted into &lsquo;chunkData&rsquo; at the correct position, numSlices is set to the value in that packet, numReceivedSlices is incremented from 0 -&gt; 1, and the received flag in the array entry corresponding to that slice is set to true.</p><br><p>As the remaining slice packets for the chunk come in, each of them are checked that they match the current chunk id and numSlices that are being received and are ignored if they don&rsquo;t match. Packets are also ignored if they contain a slice that has already been received. Otherwise, the slice data is copied into the correct place in the chunkData array, numReceivedSlices is incremented and received flag for that slice is set to true.</p><br><p>This process continues until all slices of the chunk are received, at which point the receiver sets receiving to &lsquo;false&rsquo; and &lsquo;readyToRead&rsquo; to true. While &lsquo;readyToRead&rsquo; is true, incoming slice packets are discarded. At this point, the chunk receive packet processing is performed, typically on the same frame. The caller checks &lsquo;do I have a chunk to read?&rsquo; and processes the chunk data. All chunk receive data is cleared back to defaults, except chunk id which is incremented from 0 -&gt; 1, and we are ready to receive the next chunk.</p><br><h2 id="conclusion">Conclusion</h2><br><p>The chunk system is simple in concept, but the implementation is certainly not. I encourage you to take a close look at the <a href="http://www.patreon.com/gafferongames" target="_blank" rel="noopener">source code</a> for this article for further details.</p>


<h1 id="è¯‘æ–‡">è¯‘æ–‡</h1>


<p><a href="http://gad.qq.com/program/translateview/7165598" target="_blank" rel="noopener">è¯‘æ–‡å‡ºå¤„</a></p>
<div class="WordSection1"><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç¿»è¯‘ï¼šå¼ åæ ‹<span> (wcby)     </span>å®¡æ ¡ï¼šç‹ç£Š<span>(</span>æœªæ¥çš„æœªæ¥<span>)</span></span> </span></p><p class="MsoNormal" align="left"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ ¼ä¼¦Â·è²å¾·å‹’ã€‚æ¬¢è¿å¤§å®¶é˜…è¯»ç³»åˆ—æ•™ç¨‹ã€Šæ„å»ºæ¸¸æˆç½‘ç»œåè®®ã€‹çš„ç¬¬å››ç¯‡æ–‡ç« ã€‚</span></span><span style="color: rgb(34, 34, 34); font-size: 12pt; font-family: å¾®è½¯é›…é»‘;">åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•åœ¨æ¸¸æˆåè®®è¿™ä¸€å±‚å®ç°å¯¹æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ã€‚</span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç°åœ¨åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢ï¼Œæˆ‘ä»¬å°†ç»§ç»­é€šè¿‡æ¢ç´¢åœ¨<span>UDP</span>åè®®ä¸Šå‘é€å¤§å—æ•°æ®çš„æ›¿ä»£æ–¹æ¡ˆæ¥ç»§ç»­æˆ‘ä»¬æ„å»ºä¸€ä¸ªä¸“ä¸šçº§åˆ«çš„æ¸¸æˆç½‘ç»œåè®®çš„å¾ç¨‹ã€‚</span> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç¬¬ä¸€çœ¼çœ‹ä¸Šå»ï¼Œè¿™ç§æ›¿ä»£æ€§çš„æŠ€æœ¯ä¼¼ä¹éå¸¸ç±»ä¼¼äºæ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ï¼Œä½†æ˜¯å®ƒçš„å®ç°æ˜¯å®Œå…¨ä¸åŒçš„ã€‚è¿™ç§å®ç°ä¸Šçš„å·®å¼‚çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³æ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„çš„ä¸€ä¸ªå…³é”®å¼±ç‚¹<span>-</span>ä¸€ä¸ªç‰‡æ®µçš„ä¸¢å¤±å°±ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®åŒ…éƒ½è¦è¢«ä¸¢å¼ƒæ‰ã€‚è¿™ç§è¡Œä¸ºæ˜¯éå¸¸ä¸å¥½çš„ï¼Œå› ä¸ºå®ƒä¼šéšç€åˆ†åŒ…æ•°é‡çš„å¢åŠ è€Œæ”¾å¤§æ•°æ®åŒ…ä¸¢å¤±çš„æ¦‚ç‡ã€‚å½“ä½ é‡åˆ°å¤§å—æ•°æ®åŒ…çš„æ—¶å€™ï¼Œè¿™ç§æ”¾å¤§æ˜¯å¦‚æ­¤çš„æ˜æ˜¾ï¼ŒåŠ å…¥<span>256 k</span>å¤§å°çš„åˆ†åŒ…ä¸¢å¤±ç‡æ˜¯<span>1%</span>çš„è¯ï¼Œé‚£ä¹ˆåŸå§‹æ•°æ®åŒ…å°±æœ‰<span>92.4%</span>çš„æ¦‚ç‡è¢«ä¸¢å¼ƒã€‚å¹³å‡æ¥è¯´ï¼Œä½ éœ€è¦å‘é€åŸå§‹æ•°æ®åŒ…<span>10</span>æ¬¡ï¼Œå®ƒæ‰èƒ½é¡ºåˆ©çš„åˆ°è¾¾ç½‘ç»œçš„å¦å¤–ä¸€ç«¯ï¼</span> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¦‚æœä½ éœ€è¦åœ¨ä¸€ä¸ªå¯èƒ½ä¼šæœ‰æ•°æ®åŒ…ä¸¢å¤±çš„ç½‘ç»œä¸Šæ¯”å¦‚è¯´äº’è”ç½‘ï¼Œå¿«é€Ÿå’Œå¯é åœ°å‘é€å¤§é‡çš„æ•°æ®ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™æ ·çš„æ–¹æ³•æ˜¯å®Œå…¨ä¸å¯æ¥å—çš„ã€‚ä½ å¯èƒ½éœ€è¦è¿™æ ·åšçš„ä¸€äº›å¸¸è§çš„ä¾‹å­åŒ…æ‹¬ï¼šå®¢æˆ·ç«¯åœ¨é¦–æ¬¡åŠ å…¥çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éœ€è¦ä¸‹å‘ä¸€ä¸ªå¤§çš„æ•°æ®å—ç»™å®¢æˆ·ç«¯<span>(</span>å¯èƒ½æ˜¯ä¸–ç•Œçš„åˆå§‹çŠ¶æ€<span>)</span>ã€ä¸€å¼€å§‹ç”¨æ¥åšå¢é‡ç¼–ç çš„åŸºçº¿æˆ–è€…æ˜¯åœ¨ä¸€ä¸ªå¤šäººåœ¨çº¿ç½‘ç»œæ¸¸æˆé‡Œé¢å®¢æˆ·ç«¯åœ¨åŠ è½½ç•Œé¢æ‰€ç­‰å¾…çš„å¤§å—æ•°æ®ã€‚</span> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åœ¨è¿™äº›æƒ…å†µä¸‹éå¸¸é‡è¦çš„æ˜¯ä¸ä»…è¦ä¼˜é›…åœ°å¤„ç†æ•°æ®åŒ…çš„ä¸¢å¤±ï¼Œè¿˜è¦å°½å¯èƒ½çš„åˆ©ç”¨å¯ç”¨çš„å¸¦å®½å¹¶å°½å¯èƒ½å¿«çš„å‘é€å¤§å—æ•°æ®ã€‚</span></span><span style="color: rgb(34, 34, 34); font-size: 12pt; font-family: å¾®è½¯é›…é»‘;">è¿™æ­£æ˜¯æˆ‘è¦åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢å‘Šè¯‰ä½ è¯¥å¦‚ä½•åšçš„å†…å®¹ã€‚</span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><h2 id="å—å’Œç‰‡æ®µ"><span style="color: rgb(34, 34, 34);"><span style="font-size:x-large;">å—å’Œç‰‡æ®µ</span></span></h2> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è®©æˆ‘ä»¬å¼€å§‹ä½¿ç”¨åŸºæœ¬æœ¯è¯­ã€‚åœ¨è¿™ä¸ªæ–°ç³»ç»Ÿä¸­ï¼Œå¤§å—çš„æ•°æ®è¢«ç§°ä¸º<span>â€</span>å—<span>â€œ</span>ï¼Œè€Œå®ƒä»¬è¢«åˆ†æˆçš„åˆ†åŒ…è¢«ç§°ä¸º<span>â€</span>ç‰‡æ®µ<span>â€</span>ã€‚ è¿™ä¸ªåå­—ä¸Šçš„æ”¹å˜ä½¿çš„å—ç³»ç»Ÿçš„æœ¯è¯­<span>(</span>å—å’Œç‰‡æ®µ<span>)</span>ä¸åŒäºæ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„çš„æœ¯è¯­<span>(</span>æ•°æ®åŒ…å’Œåˆ†åŒ…<span>)</span>ã€‚è¿™æ˜¯æˆ‘è®¤ä¸ºå¾ˆé‡è¦çš„ä¸€ä¸ªäº‹æƒ…ï¼Œå› ä¸ºè¿™äº›ç³»ç»Ÿæ˜¯åœ¨è§£å†³ä¸åŒçš„é—®é¢˜ï¼Œæ²¡æœ‰ç†ç”±ä½ ä¸èƒ½åœ¨ç›¸åŒçš„ç½‘ç»œåè®®ä¸­åŒæ—¶è¿™ä¸¤ä¸ªç³»ç»Ÿã€‚äº‹å®ä¸Šï¼Œæˆ‘ç»å¸¸æŠŠè¿™ä¸¤ä¸ªç»“åˆèµ·æ¥ï¼Œåœ¨æ—¶é—´æ¯”è¾ƒå…³é”®çš„å¢é‡æ•°æ®åŒ…é‡Œé¢ä½¿ç”¨æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ï¼Œå½“å®¢æˆ·ç«¯åŠ å…¥æ¸¸æˆçš„æ—¶å€™ï¼Œä½¿ç”¨å—ç³»ç»Ÿæ¥ä¸‹å‘æ•´ä¸ªæ¸¸æˆä¸–ç•Œçš„åˆå§‹çŠ¶æ€ä¸‹<span>(</span>éå¸¸å¤§çš„æ•°æ®åŒ…<span>)</span>ã€‚</span> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å—ç³»ç»Ÿçš„åŸºæœ¬æ€æƒ³ï¼ŒçœŸæ˜¯ä¸€ç‚¹éƒ½ä¸å¤æ‚ï¼Œæ˜¯æŠŠå—åˆ†æˆå¾ˆå¤šç‰‡æ®µï¼Œç„¶åé€šè¿‡ç½‘ç»œå¤šæ¬¡å‘é€ç‰‡æ®µï¼Œç›´åˆ°ä»–ä»¬éƒ½é¡ºåˆ©çš„åˆ°è¾¾ç½‘ç»œçš„å¦å¤–ä¸€ç«¯ã€‚å½“ç„¶ï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨<span>UDP</span>åè®®ä¸Šå®ç°è¿™ä¸ªåŠŸèƒ½ï¼ŒåŒæ—¶è¿˜æœ‰å¯èƒ½æ•°æ®åŒ…ä¼šä¸¢å¤±ã€æ•°æ®åŒ…ä¹±åºåˆ°è¾¾ä»¥åŠæ•°æ®åŒ…é‡å¤åˆ°è¾¾çš„æƒ…å†µï¼Œç®€å•çš„æ¦‚å¿µåœ¨å®ç°ä¸­ä¹Ÿä¼šå˜å¾—éå¸¸å¤æ‚ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»åœ¨<span>UDP</span>åè®®ä¸Šå»ºç«‹æˆ‘ä»¬è‡ªå·±çš„å…·æœ‰åŸºæœ¬å¯é æ€§çš„ç³»ç»Ÿï¼Œè¿™æ ·å‘é€æ–¹æ‰èƒ½çŸ¥é“è¿™ä¸ªç‰‡æ®µå·²ç»è¢«ç½‘ç»œçš„å¦å¤–ä¸€ç«¯æˆåŠŸæ”¶åˆ°ã€‚</span> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¦‚æœæˆ‘ä»¬æœ‰ä¸€ç»„ä¸åŒçš„å—æ­£åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­<span>(</span>å°±åƒæˆ‘ä»¬åœ¨æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ä¸­æ‰€åšçš„é‚£æ ·<span>)</span>ï¼Œé‚£ä¹ˆå¯é æ€§çš„é—®é¢˜å°±ä¼šå˜å¾—éå¸¸æ£˜æ‰‹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åšä¸€ä¸ªç®€åŒ–çš„å‡è®¾ã€‚æˆ‘ä»¬ä¸€æ¬¡åªä¼šé€šè¿‡ç½‘ç»œå‘é€ä¸€ä¸ªå—çš„æ•°æ®ã€‚è¿™å¹¶ä¸æ„å‘³ç€å‘é€è€…ä¸èƒ½åœ¨æœ¬åœ°æœ‰ä¸€ä¸ªå—çš„å‘é€é˜Ÿåˆ—ï¼Œè¿™åªæ˜¯æ„å‘³ç€åœ¨å®é™…çš„ç½‘ç»œä¼ è¾“ä¸­åªæœ‰ä¸€ä¸ªå—çš„æ•°æ®ä¼šæ­£åœ¨ä¼ é€’ã€‚</span> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™ä¹ˆåšä¹‹æ‰€ä»¥æœ‰æ„ä¹‰ï¼Œæ˜¯å› ä¸ºæœ‰äº†è¿™ä¸€ç‚¹å‡è®¾ä»¥åå°±èƒ½ä¿è¯å—ç³»ç»Ÿèƒ½å¤Ÿå¯é æœ‰åºçš„å‘é€å—ã€‚å¦‚æœä½ å› ä¸ºæŸäº›åŸå› åœ¨åŒä¸€æ—¶é—´å‘é€å—<span>0</span>å’Œå—<span>1</span>ï¼Œè¿™ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿä½ ä¸èƒ½åœ¨å—<span>0</span>åˆ°æ¥ä¹‹å‰å¤„ç†å—<span>1</span>ï¼Œå¦åˆ™è¿™ä¸ªä¼ è¾“è¿‡ç¨‹å°±ä¸æ˜¯æœ‰åºå¯é äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æŒ–å¾—æ·±ä¸€äº›çš„è¯ï¼Œä½ ä¼šå‘ç°ä¸€æ¬¡åªèƒ½å‘é€ä¸€ä¸ªå—ç¡®å®å¼•å…¥äº†ä¸€ä¸ªå°çš„æƒè¡¡ï¼Œå®ƒç»™æ­£åœ¨æ¥æ”¶çš„å—ï¼®å¢åŠ äº†ä¸€ä¸ªç½‘ç»œå¾€è¿”å»¶è¿Ÿï¼Œä»¥åŠä»æ¥æ”¶æ–¹çš„è§’åº¦çœ‹å—ï¼®ï¼‹ï¼‘çš„å‘é€å¼€å§‹æ—¶é—´ä¹Ÿè¢«å»¶è¿Ÿäº†ä¸€ä¸ªç½‘ç»œå¾€è¿”å»¶è¿Ÿã€‚</span> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™ä¸ªä»£ä»·æ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºå‘é€å¤§å—æ•°æ®æ˜¯ä¸€ä¸ªéå¸¸å¶ç„¶çš„äº‹æƒ…ï¼ˆä¸¾äº›ç®€å•çš„ä¾‹å­æ¥è¯´ï¼Œå½“å®¢æˆ·ç«¯è¿æ¥ä¸Šæ¥çš„æ—¶å€™ä¼šå‘é€å¤§å—æ•°æ®ï¼Œå½“æ–°çš„å…³å¡éœ€è¦è¿›è¡ŒåŠ è½½çš„æ—¶å€™æ‰ä¼šå‘é€å¤§å—æ•°æ®ã€‚ã€‚ã€‚ï¼‰ï¼Œä½†æ˜¯å¦‚æœ<span>1</span>ç§’é’Ÿå†…<span>10</span>æ¬¡æˆ–è€…<span>20</span>æ¬¡å‘é€å—æ•°æ®çš„è¯è¿™å°±æ˜¯ç»å¯¹ä¸èƒ½è¢«æ¥å—çš„äº†ã€‚æ‰€ä»¥æˆ‘å¸Œæœ›ä½ èƒ½çœ‹åˆ°è¿™ä¸ªç³»ç»Ÿæ˜¯ä¸“ä¸ºä»€ä¹ˆç›®çš„è®¾è®¡çš„ä»¥åŠä¸æ˜¯ä¸ºä»€ä¹ˆç›®çš„è®¾è®¡çš„ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><h2 id="æ•°æ®åŒ…çš„ç»“æ„"><span style="font-size: 18pt; color: rgb(34, 34, 34);">æ•°æ®åŒ…çš„ç»“æ„</span></h2> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åœ¨å—ç³»ç»Ÿä¸­æœ‰ä¸¤æ–¹ä¼šå‚ä¸ï¼Œåˆ†åˆ«æ˜¯å‘é€æ–¹å’Œæ¥æ”¶æ–¹ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å‘é€æ–¹æ˜¯è´Ÿè´£å°†å—å‹å…¥é˜Ÿåˆ—å¹¶é€šè¿‡ç½‘ç»œå‘é€ç‰‡æ®µã€‚æ¥æ”¶æ–¹æ˜¯è´Ÿè´£åœ¨ç½‘ç»œçš„å¦å¤–ä¸€ç«¯è¯»å–è¿™äº›ç‰‡æ®µå¹¶è¿›è¡Œé‡ç»„ã€‚æ¥æ”¶æ–¹è¿˜è´Ÿè´£é€šè¿‡å‘é€<span>â€œ</span>ç¡®è®¤<span>â€</span>æ•°æ®åŒ…ç»™å‘é€æ–¹æ¥ä¸å‘é€æ–¹äº¤æµè¡¨æ˜è¿™ä¸ªç‰‡æ®µå·²ç»æ”¶åˆ°ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æˆ‘å·¥ä½œè¿‡çš„ç½‘ç»œæ¨¡å¼é€šå¸¸æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„é€šä¿¡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘é€šå¸¸å¸Œæœ›èƒ½å¤Ÿä»æœåŠ¡å™¨å¾€å®¢æˆ·ç«¯å‘é€å¤§å—æ•°æ®ï¼Œä»¥åŠä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨å‘é€å¤§å—æ•°æ®ã€‚æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰ä¸¤ä¸ªå‘é€æ–¹å’Œä¸¤ä¸ªæ¥æ”¶æ–¹ï¼Œä¸€ä¸ªå‘é€æ–¹åœ¨å®¢æˆ·ç«¯å¯¹åº”ç€åœ¨æœåŠ¡å™¨é‚£è¾¹æœ‰ä¸€ä¸ªæ¥æ”¶æ–¹ï¼Œåè¿‡æ¥ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¯ä»¥æŠŠå‘é€æ–¹å’Œæ¥æ”¶æ–¹è®¤ä¸ºæ˜¯å—ä¼ è¾“åè®®çš„ç»ˆç‚¹ï¼Œè¿™æ ·ä¹Ÿå°±å®šä¹‰äº†ç½‘ç»œæµçš„æ–¹å‘ã€‚å¦‚æœä½ æƒ³åœ¨ä¸åŒçš„æ–¹å‘å‘é€å—ï¼Œç”šè‡³æ˜¯æ‰©å±•å—çš„å‘é€æ–¹æ¥æ”¯æŒç‚¹å¯¹ç‚¹çš„å‘é€ï¼Œåªéœ€è¦åœ¨ä½ éœ€è¦å‘é€å—çš„æ¯ä¸ªæ–¹å‘æ·»åŠ ä¸€ä¸ªå‘é€æ–¹å’Œä¸€ä¸ªæ¥æ”¶æ–¹ä½œä¸ºç»ˆç‚¹ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™ä¸ªç³»ç»Ÿåœ¨ç½‘ç»œä¸Šå‘é€çš„æ•°æ®åŒ…ç±»å‹ä¸€å…±æœ‰ä¸¤ç§ç±»å‹ï¼š</span> </span></p><p class="MsoListParagraph" align="left" style="margin-left: 21pt; text-indent: -21pt; line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">1ï¼‰ç‰‡æ®µæ•°æ®åŒ…<span>-</span>è¿™åŒ…æ‹¬äº†ä¸€ä¸ªå—çš„ç‰‡æ®µï¼Œæœ€å¤šå¤§å°ä¸º<span>1k</span>ã€‚</span> </span></p><p class="MsoListParagraph" align="left" style="margin-left: 21pt; text-indent: -21pt; line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">2ï¼‰ç¡®è®¤æ•°æ®åŒ…<span>-</span>ä¸€ä¸ªä½åŸŸæŒ‡ç¤ºå“ªäº›ç‰‡æ®µå·²ç»æ”¶åˆ°ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç‰‡æ®µæ•°æ®åŒ…æ˜¯ä»å‘é€æ–¹å‘é€åˆ°æ¥æ”¶å™¨çš„ã€‚è¿™æ˜¯é€šè¿‡ç½‘ç»œå¯¹å—æ•°æ®è¿›è¡Œä¼ é€’çš„æœ‰æ•ˆè½½è·æ•°æ®åŒ…ï¼Œåœ¨è®¾è®¡çš„æ—¶å€™æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„å¤§å°éƒ½è´´è¿‘ä¸€ä¸ªä¿å®ˆçš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯<span> 1200</span>å­—èŠ‚ã€‚æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…æœ€å¤§æ˜¯<span>1 k</span>ï¼Œæ¯ä¸ªå—æœ€å¤šæœ‰<span>256</span>ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œæ‰€ä»¥é€šè¿‡è¿™ä¸ªç³»ç»Ÿå¯ä»¥é€šè¿‡ç½‘ç»œå‘é€çš„æœ€å¤§çš„æ•°æ®æ˜¯<span>256k</span>ï¼ˆå¦‚æœä½ æ„¿æ„çš„è¯ï¼Œä½ å¯ä»¥å¢åŠ è¿™ä¸ªç‰‡æ®µçš„æœ€å¤§æ•°ç›®ï¼‰ã€‚æˆ‘å»ºè®®ä¿æŒç‰‡æ®µçš„å¤§å°ä¸º<span>1k</span>ï¼Œè¿™ä¸»è¦æ˜¯åŸºäºæœ€å¤§ä¼ è¾“å•å…ƒæ–¹é¢çš„è€ƒè™‘ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="color: rgb(43, 43, 43); background: rgb(248, 248, 248);"> </span></span></p><div><div id="highlighter_653417" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">SliceSize = 1024;</code></div><div class="line number2 index1 alt1"><code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">MaxSlicesPerChunk = 256;</code></div><div class="line number3 index2 alt2"><code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">MaxChunkSize = SliceSize <em> MaxSlicesPerChunk;</em></code></div><div class="line number4 index3 alt1"> </div><div class="line number5 index4 alt2"><code class="cpp keyword bold">struct</code> <code class="cpp plain">SlicePacket : </code><code class="cpp keyword bold">public</code> <code class="cpp plain">protocol2::Packet</code></div><div class="line number6 index5 alt1"><code class="cpp plain">{</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">    </code><code class="cpp plain">uint16_t chunkId;</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">sliceId;</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">numSlices;</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">sliceBytes;</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">    </code><code class="cpp plain">uint8_t data[SliceSize];</code></div><div class="line number12 index11 alt1"><code class="cpp spaces"> </code> </div><div class="line number13 index12 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">template</code> <code class="cpp plain">&lt;</code><code class="cpp keyword bold">typename</code> <code class="cpp plain">stream</code><code class="cpp string"></code><code class="cpp plain">&gt; </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">Serialize( Stream &amp; stream )</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number15 index14 alt2"><code class="cpp spaces">        </code><code class="cpp plain">serialize_bits( stream, chunkId, 16 );</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">        </code><code class="cpp plain">serialize_int( stream, sliceId, 0, MaxSlicesPerChunk - 1 );</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">        </code><code class="cpp plain">serialize_int( stream, numSlices, 1, MaxSlicesPerChunk );</code></div><div class="line number18 index17 alt1"><code class="cpp spaces">        </code><code class="cpp keyword bold">if</code> <code class="cpp plain">( sliceId == numSlices - 1 )</code></div><div class="line number19 index18 alt2"><code class="cpp spaces">        </code><code class="cpp plain">{</code></div><div class="line number20 index19 alt1"><code class="cpp spaces">            </code><code class="cpp plain">serialize_int( stream, sliceBytes, 1, SliceSize );</code></div><div class="line number21 index20 alt2"><code class="cpp spaces">        </code><code class="cpp plain">}</code></div><div class="line number22 index21 alt1"><code class="cpp spaces">        </code><code class="cpp keyword bold">else</code> <code class="cpp keyword bold">if</code> <code class="cpp plain">( Stream::IsReading )</code></div><div class="line number23 index22 alt2"><code class="cpp spaces">        </code><code class="cpp plain">{</code></div><div class="line number24 index23 alt1"><code class="cpp spaces">            </code><code class="cpp plain">sliceBytes = SliceSize;</code></div><div class="line number25 index24 alt2"><code class="cpp spaces">        </code><code class="cpp plain">}</code></div><div class="line number26 index25 alt1"><code class="cpp spaces">        </code><code class="cpp plain">serialize_bytes( stream, data, sliceBytes );</code></div><div class="line number27 index26 alt2"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp keyword bold">true</code><code class="cpp plain">;</code></div><div class="line number28 index27 alt1"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number29 index28 alt2"><code class="cpp plain">};</code><code class="cpp keyword bold"></code><code class="cpp plain"></code></div></div></td></tr></table></div></div><br><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åœ¨è¿™é‡Œæˆ‘æƒ³å¯¹ç‰‡æ®µæ•°æ®åŒ…è¿›è¡Œä¸¤ç‚¹è¯´æ˜ã€‚ç¬¬ä¸€ç‚¹æ˜¯å³ä½¿åªæœ‰ä¸€ä¸ªå—åœ¨ç½‘ç»œä¸Šè¿›è¡Œä¼ è¾“ï¼Œä»ç„¶æ˜¯æœ‰å¿…è¦åœ¨æ•°æ®åŒ…é‡Œé¢åŒ…å«ä¸€ä¸ªå—çš„<span>id(</span>æ¯”å¦‚è¯´ï¼Œ<span>0</span>ã€<span>1</span>ã€<span>2</span>ã€<span>3</span>ã€ç­‰ç­‰ç­‰<span>)</span>ï¼Œè¿™æ˜¯<span>,</span>å› ä¸ºé€šè¿‡<span>UDP</span>åè®®å‘é€çš„æ•°æ®åŒ…å¯ä»¥æ˜¯ä¹±åºåˆ°è¾¾çš„ã€‚é€šè¿‡è¿™ç§æ–¹å¼çš„è¯ï¼Œå¦‚æœä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…åˆ°è¾¾çš„æ—¶å€™å¯¹åº”ç€ä¸€ä¸ªå·²ç»æ¥å—è¿‡çš„å—ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼Œä½ æ­£åœ¨æ¥å—å—<span>2</span>çš„æ•°æ®ï¼Œä½†æ˜¯å—<span>1</span>çš„ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…ç°åœ¨åˆ°è¾¾äº†ï¼Œä½ å¯ä»¥ç›´æ¥æ‹’ç»è¿™ä¸ªæ•°æ®åŒ…ï¼Œè€Œä¸æ˜¯æ¥å—å®ƒçš„æ•°æ®åŒ…å¹¶æŠŠå®ƒçš„æ•°æ®æ’å…¥åˆ°å—<span>2</span>ä»è€ŒæŠŠå—<span>2</span>çš„æ•°æ®ç»™å¼„æ··äº†ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç¬¬äºŒç‚¹ã€‚ç”±äºæˆ‘ä»¬çŸ¥é“å—åˆ†æˆç‰‡æ®µçš„æ–¹æ³•ä¼šæŠŠæ‰€æœ‰çš„ç‰‡æ®µé™¤äº†æœ€åä¸€ä¸ªä»¥å¤–éƒ½å¼„æˆå¿…é¡»<span>SliceSize</span>çš„å¤§å°<span>(</span>ä¹Ÿå°±æ˜¯<span>1024</span>å­—èŠ‚<span>)</span>ã€‚æˆ‘ä»¬åˆ©ç”¨è¿™ä¸€ç‚¹æ¥èŠ‚çœä¸€ç‚¹å¸¦å®½ï¼Œæˆ‘ä»¬åªåœ¨æœ€åä¸€ä¸ªç‰‡æ®µé‡Œé¢å‘é€ç‰‡æ®µçš„å¤§å°ï¼Œä½†è¿™æ˜¯ä¸€ç§æƒè¡¡<span>:</span>æ¥æ”¶æ–¹ä¸çŸ¥é“å—çš„ç¡®åˆ‡å¤§å°åˆ°åº•æ˜¯å¤šå°‘å­—èŠ‚ï¼Œç›´åˆ°å®ƒæ¥æ”¶åˆ°æœ€åä¸€ä¸ªç‰‡æ®µæ‰èƒ½çŸ¥é“ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¯ä»¥è®©è¿™ä¸ªç³»ç»Ÿç»§ç»­å¾€åå‘é€æ–°çš„æ•°æ®åŒ…çš„æœºåˆ¶æ˜¯ç¡®è®¤æ•°æ®åŒ…ã€‚è¿™ä¸ªæ•°æ®åŒ…æ˜¯æ²¿ç€å¦å¤–ä¸€ä¸ªæ–¹å‘è¿›è¡Œå‘é€çš„ï¼Œä¹Ÿå°±æ˜¯ä»æ¥æ”¶æ–¹å‘å›ç»™å‘é€æ–¹ï¼Œè¿™ä¹Ÿæ˜¯å—ç½‘ç»œåè®®ä¸­è´Ÿè´£å¯é æ€§çš„éƒ¨åˆ†ã€‚å®ƒå­˜åœ¨çš„ç›®çš„æ˜¯è®©å‘é€æ–¹çŸ¥é“è¿™ä¸ªç‰‡æ®µå·²ç»è¢«å‘é€æ–¹æ”¶åˆ°ã€‚</span></span></p><div><div id="highlighter_476828" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">struct</code> <code class="cpp plain">AckPacket : </code><code class="cpp keyword bold">public</code> <code class="cpp plain">protocol2::Packet </code></div><div class="line number2 index1 alt1"><code class="cpp plain">{ </code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp plain">uint16_t chunkId; </code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">numSlices; </code></div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">acked[MaxSlicesPerChunk]; </code></div><div class="line number6 index5 alt1"> </div><div class="line number7 index6 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">Serialize( Stream &amp; stream )</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">    </code><code class="cpp plain">{ </code></div><div class="line number9 index8 alt2"><code class="cpp spaces">        </code><code class="cpp plain">serialize_bits( stream, chunkId, 16 ); </code></div><div class="line number10 index9 alt1"><code class="cpp spaces">        </code><code class="cpp plain">serialize_int( stream, numSlices, 1, MaxSlicesPerChunk ); </code></div><div class="line number11 index10 alt2"><code class="cpp spaces">        </code><code class="cpp keyword bold">for</code> <code class="cpp plain">( </code><code class="cpp color1 bold">int</code> <code class="cpp plain">i = 0; i &lt; numSlices; ++i ) </code></div><div class="line number12 index11 alt1"><code class="cpp spaces">            </code><code class="cpp plain">serialize_bool( stream, acked[i] ); </code><code class="cpp keyword bold">return</code> <code class="cpp keyword bold">true</code><code class="cpp plain">; } };</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number14 index13 alt1"><code class="cpp plain">};</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ack</span><span style="font-size: 12pt; color: rgb(34, 34, 34);">æ˜¯<span>â€œ</span>ç¡®è®¤<span>â€</span>çš„ç¼©å†™ã€‚æ‰€ä»¥ä¸€ä¸ªå¯¹ç‰‡æ®µ<span>100</span>çš„ç¡®è®¤æ•°æ®åŒ…æ„å‘³ç€æ¥æ”¶æ–¹ç¡®è®¤å®ƒå·²ç»æ¥æ”¶åˆ°äº†ç‰‡æ®µ<span>100</span>ã€‚è¿™å¯¹äºå‘é€æ–¹æ¥è¯´æ˜¯ä¸€æ¡å…³é”®ä¿¡æ¯ï¼Œå› ä¸ºå®ƒä¸ä»…è®©å‘é€æ–¹çŸ¥é“ä»€ä¹ˆæ—¶å€™æ‰€æœ‰çš„ç‰‡æ®µéƒ½å·²ç»è¢«æˆåŠŸæ¥æ”¶ï¼Œè¿™æ ·å‘é€æ–¹å°±å¯ä»¥åœæ­¢å‘é€äº†ï¼Œå®ƒè¿˜å…è®¸å‘é€æ–¹åªé‡å‘é‚£äº›è¿˜æ²¡æœ‰è¢«ç¡®è®¤çš„ç‰‡æ®µï¼Œè¿™æ ·å°±èƒ½è®©å‘é€æ–¹æ›´æœ‰æ•ˆç‡çš„åˆ©ç”¨å¸¦å®½ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è®©æˆ‘ä»¬å¯¹ç¡®è®¤æ•°æ®åŒ…å†æ·±å…¥ä¸€ç‚¹æ€è€ƒï¼Œä¼¼ä¹åœ¨ä¸€å¼€å§‹çœ‹ä¸Šå»å¯¹äºæ¯ä¸ªæ•°æ®åŒ…çš„æ‰€æœ‰åˆ†ç‰‡éƒ½å‘é€ç¡®è®¤åŒ…ä¼¼ä¹æœ‰ç‚¹å¤šä½™ã€‚æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåš<span>?</span>æ˜¯çš„ï¼Œè¿™æ˜¯å› ä¸ºç¡®è®¤æ•°æ®åŒ…æ˜¯é€šè¿‡<span>UDP</span>åè®®å‘é€çš„ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•ä¿è¯æ‰€æœ‰çš„ç¡®è®¤æ•°æ®åŒ…éƒ½ä¼šæˆåŠŸçš„åˆ°è¾¾ç½‘ç»œçš„å¦å¤–ä¸€ç«¯ï¼Œä½ å½“ç„¶ä¸ä¼šå¸Œæœ›å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¹‹é—´å¯¹äºç›®å‰ç¡®è®¤åˆ°é‚£ä¸ªç‰‡æ®µçš„ä¿¡æ¯éƒ½æ˜¯ä¸åŒæ­¥çš„ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€äº›ç¡®è®¤æ•°æ®åŒ…ä¼ è¾“çš„å¯é æ€§ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›å®ç°ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…çš„ç¡®è®¤ç³»ç»Ÿï¼Œå› ä¸ºè¿™å°†ä¼šæ˜¯ä¸€ä¸ªéå¸¸ç—›è‹¦å’Œéº»çƒ¦çš„è¿‡ç¨‹ã€‚å› ä¸ºåœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œç¡®è®¤æ•°æ®åŒ…çš„å¤§å°æ˜¯<span>256</span>ä½æˆ–<span>32</span>å­—èŠ‚ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä¹Ÿæ˜¯æœ€å¥½çš„ã€‚we just send the entire state of all acked slices in each ack packet. When the ack packet is received, we consider a slice to be acked the instant an ack packet comes in with that slice marked as acked and locally that slice is not seen as acked yet.</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"></span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><h2 id="åŸºæœ¬çš„å‘é€æ–¹å®ç°"><span style="font-size: 18pt; color: rgb(34, 34, 34);">åŸºæœ¬çš„å‘é€æ–¹å®ç°</span></h2> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†è¿™ä¸ªç³»ç»ŸèƒŒåçš„åŸºæœ¬æ¦‚å¿µï¼Œè®©æˆ‘ä»¬ä»å‘é€æ–¹çš„å®ç°å¼€å§‹å®ç°æ•´ä¸ªç³»ç»Ÿã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å‘é€æ–¹çš„ç­–ç•¥æ˜¯ï¼š</span> </span></p><p class="MsoListParagraph" align="left" style="margin-left: 21pt; text-indent: -21pt; line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">1ï¼‰æŒç»­çš„å‘é€ç‰‡æ®µæ•°æ®åŒ…ï¼Œç›´åˆ°æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…éƒ½è¢«ç¡®è®¤ã€‚</span> </span></p><p class="MsoListParagraph" align="left" style="margin-left: 21pt; text-indent: -21pt; line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="color: rgb(34, 34, 34);">2ï¼‰</span><span style="font-size: 12pt; color: rgb(34, 34, 34);">ä¸å†å¯¹å·²ç»ç¡®è®¤è¿‡çš„ç‰‡æ®µæ•°æ®åŒ…è¿›è¡Œå‘é€ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹çš„æ•°æ®ç»“æ„æ¥æè¿°å‘é€æ–¹ï¼š</span></span></p><div><div id="highlighter_252465" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">class</code> <code class="cpp plain">ChunkSender</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">sending;</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp plain">uint16_t chunkId;</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">chunkSize;</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">numSlices;</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">numAckedSlices;</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">currentSliceId;</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">acked[MaxSlicesPerChunk];</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">    </code><code class="cpp plain">uint8_t chunkData[MaxChunkSize];</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">double</code> <code class="cpp plain">timeLastSent[MaxSlicesPerChunk];</code></div><div class="line number12 index11 alt1"><code class="cpp plain">};</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æ­£å¦‚ä¹‹å‰æåˆ°çš„é‚£æ ·ï¼Œä¸€æ¬¡åªä¼šå‘é€ä¸€ä¸ªå—çš„æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬æ­£åœ¨å‘é€ä¸€ä¸ªå—çš„æ•°æ®çš„æ—¶å€™ï¼Œé‚£ä¹ˆå…³äº<span>â€œ</span>å‘é€<span>â€</span>çš„çŠ¶æ€æ˜¯<span>true</span>ï¼Œå‡å¦‚æˆ‘ä»¬å¤„äºé—²ç½®çŠ¶æ€ã€æ­£åœ¨å‡†å¤‡å‘é€ä¸€ä¸ªå—çš„æ•°æ®çš„æ—¶å€™ï¼Œé‚£ä¹ˆå…³äº<span>â€œ</span>å‘é€<span>â€</span>çš„çŠ¶æ€æ˜¯<span>false</span>ã€‚åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œå¦‚æœå½“å‰æœ‰ä¸€ä¸ªå—çš„æ•°æ®ä»åœ¨é€šè¿‡ç½‘ç»œè¿›è¡Œå‘é€çš„è¯ï¼Œä½ ä¸èƒ½å‘é€å¦å¤–ä¸€ä¸ªå—çš„æ•°æ®ã€‚ä½ å¿…é¡»ç­‰å¾…å½“å‰å—çš„æ•°æ®å‘é€å®Œæ¯•ä¹‹åæ‰å¯ä»¥å‘é€å¦å¤–ä¸€ä¸ªå—çš„æ•°æ®ã€‚å¦‚æœä½ ä¸å–œæ¬¢çš„è¯ï¼Œåœ¨å—çš„å‘é€å™¨çš„å‰ç«¯æŒ‰ç…§ä½ çš„æ„æ„¿å¯ä»¥æ”¾ç½®ä¸€ä¸ªå‘é€é˜Ÿåˆ—ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æœ‰æˆ‘ä»¬æ­£åœ¨å‘é€çš„å—æ•°æ®çš„<span>id</span>ï¼Œæˆ–è€…å¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨å‘é€å—æ•°æ®çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰è¦å‘é€çš„ä¸‹ä¸€ä¸ªå—æ•°æ®çš„<span>id</span>ã€ä»¥åŠè¿™ä¸ªå—æ‰€åˆ†æˆçš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ã€‚æˆ‘ä»¬ä¹Ÿä¼šè·Ÿè¸ªæ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œæ¥è®°å½•è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«ç¡®è®¤ï¼Œè¿™å¯ä»¥è®©æˆ‘ä»¬é¿å…é‡å‘é‚£äº›å·²ç»æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜ä¼šè®°å½•è¿„ä»Šä¸ºæ­¢å·²ç»ç¡®è®¤æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ï¼Œè¿™ä¸ªæ•°é‡ä¼šå»æ‰å†—ä½™çš„ç¡®è®¤ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„ç¡®è®¤åªç®—ä¸€æ¬¡ã€‚ä»å‘é€æ–¹çš„è§‚ç‚¹æ¥çœ‹ï¼Œåªæœ‰å½“ç¡®è®¤çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ç­‰äºè¿™ä¸ªå—æ‰€åˆ†æˆçš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡çš„æ—¶å€™æ‰ä¼šè¿™ä¸ªå—æ•°æ®å·²ç»è¢«å®Œå…¨æ”¶åˆ°äº†ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æˆ‘ä»¬è¿˜éœ€è¦ä¸ºè¿™ä¸ªç®—æ³•è®°å½•å½“å‰å‘é€çš„ç‰‡æ®µæ•°æ®åŒ…çš„<span>id</span>ï¼Œå› ä¸ºè¿™å°†å†³å®šäº†å“ªäº›ç‰‡æ®µæ•°æ®åŒ…å°†è¢«å‘é€ã€‚å®ƒçš„å·¥ä½œæœºåˆ¶å¤§è‡´æ˜¯è¿™æ ·ï¼šä¸€ä¸ªå—æ•°æ®å¼€å§‹å‘é€çš„æ—¶å€™ï¼Œæ˜¯ä»<span>id</span>ä¸º<span>0</span>çš„ç‰‡æ®µæ•°æ®åŒ…å¼€å§‹å‘é€çš„ï¼Œç„¶åä¾æ¬¡ä»å·¦åˆ°å³å¼€å§‹å‘é€ç›´åˆ°ç»è¿‡æœ€åä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…<span>(</span>ä¹Ÿå°±æ˜¯<span>id</span>ä¸ºåˆ†åŒ…æ•°é‡çš„å¤§å°<span>-1)</span>çš„æ—¶å€™ä¼šå›å¤´ä»<span>id</span>ä¸º<span>0</span>çš„ç‰‡æ®µæ•°æ®åŒ…ç»§ç»­å‘é€ã€‚æœ€ç»ˆï¼Œä½ ä¼šåœæ­¢è¿™ä¸ªè¿­ä»£å› ä¸ºå‘é€çš„ç‰‡æ®µæ•°æ®åŒ…å·²ç»è€—å°½äº†å¸¦å®½ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡è®°å½•å½“å‰å‘é€çš„ç‰‡æ®µæ•°æ®åŒ…çš„<span>id</span>å°±èƒ½è®°ä½æˆ‘ä»¬å½“å‰éå†çš„ç‰‡æ®µæ•°æ®åŒ…çš„ç´¢å¼•ï¼Œè¿™æ ·åœ¨ä¸‹ä¸€æ¬¡å¼€å§‹éå†çš„æ—¶å€™ä½ å°±å¯ä»¥ç»§ç»­ä»è¿™ä¸ªä½ç½®å¼€å§‹å‘é€ç‰‡æ®µæ•°æ®åŒ…ã€‚æœ€åä¸€éƒ¨åˆ†æ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™æ˜¯å› ä¸ºå®ƒå¯ä»¥æŠŠå‘é€ä¸€ä¸ªå—æ•°æ®æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…è¿™ä¸ªäº‹æƒ…æ˜¯åˆ†æ•£å¼€ï¼Œè€Œä¸æ˜¯åœ¨ä¸€èµ·å°±å…¨éƒ¨å‘å‡ºå»ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç°åœ¨è®©æˆ‘ä»¬è®¨è®ºä¸‹å¸¦å®½é™åˆ¶ã€‚æ˜¾ç„¶ä½ ä¸èƒ½æŠŠæ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…ä¸€æ¬¡å…¨éƒ¨å‘å®Œï¼Œå› ä¸ºå¦‚æœè¿™ä¹ˆåšçš„è¯ï¼Œä¼šæŠŠæ•´ä¸ªé“¾æ¥å µä½ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•é™åˆ¶å‘é€æ–¹æ‰€ä½¿ç”¨çš„å¸¦å®½<span>?</span>æˆ‘çš„å®ç°æœºåˆ¶å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼šå½“ä½ å¯¹å…¨éƒ¨çš„ç‰‡æ®µæ•°æ®åŒ…è¿›è¡Œéå†å¹¶ä¸”è€ƒè™‘ä½ æƒ³è¦å‘é€çš„æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ—¶å€™ï¼Œå¤§æ¦‚ä¼°è®¡ä¸‹è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…ä¼šéœ€è¦å æ®å¤šå°‘å­—èŠ‚ï¼Œæ¯”å¦‚å¯ä»¥ç”¨è¿™ç§ä¼°è®¡ç®—æ³•ï¼šå¤§æ¦‚è¿™ä¸ªç‰‡æ®µçš„å­—èŠ‚æ•°<span>+</span>ä¸€äº›åè®®çš„å¼€é”€å’Œ<span>UDP / IP</span>çš„æŠ¥å¤´ã€‚ç„¶åç”¨æ‰€éœ€çš„å­—èŠ‚æ•°å’Œä½ å¸¦å®½é¢„ç®—é‡Œé¢å¯ç”¨æ¥è¿›è¡Œå‘é€çš„å­—èŠ‚æ•°è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå¸¦å®½é¢„ç®—é‡Œé¢æ²¡æœ‰è¶³å¤Ÿå¯ç”¨çš„å­—èŠ‚æ•°ï¼Œé‚£ä¹ˆå°±åœæ­¢å‘é€ã€‚å¦åˆ™çš„è¯ï¼Œä»å¸¦å®½é¢„ç®—é‡Œé¢å‡å»å‘é€è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…æ‰€éœ€çš„å­—èŠ‚æ•°ï¼Œç„¶åå¯¹äºä¸‹ä¸ªç‰‡æ®µæ•°æ®åŒ…é‡å¤æ•´ä¸ªè¿‡ç¨‹ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¸¦å®½é¢„ç®—é‡Œé¢å¯ç”¨çš„å­—èŠ‚å‘é€é¢„ç®—æ˜¯ä»å“ªé‡Œè®¡ç®—å¾—æ¥çš„ï¼Ÿåœ¨æ¯ä¸€å¸§æ›´æ–°å—çš„å‘é€æ–¹ä¹‹å‰ï¼ŒæŠŠä½ çš„ç›®æ ‡å¸¦å®½ï¼ˆæ¯”å¦‚è¯´æ¯ç§’<span>256KB</span>ï¼‰è½¬æ¢æˆæ¯ç§’å¯ä»¥å‘é€çš„å­—èŠ‚æ•°ï¼Œç„¶åç”¨å®ƒä¹˜ä»¥æ›´æ–°æ—¶é—´æ¥æŠŠè®°è¿‡æ”¾åˆ°ä¸€ä¸ªç´¯åŠ å™¨é‡Œé¢ã€‚æ¯ç§’<span>256KB</span>æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¿å®ˆçš„å‘é€é€Ÿç‡ï¼Œè¿™æ„å‘³ä½ å¯ä»¥æ¯ç§’å‘é€<span>32000</span>ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æŠŠ<span>32000  dt</span>è¿™ä¸ªå€¼æ·»åŠ åˆ°ç´¯åŠ å™¨é‡Œé¢ã€‚æ¯ç§’<span>512KB</span>æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€‚ä¸­çš„ä¼°è®¡ï¼Œæ„å‘³ä½ å¯ä»¥æ¯ç§’å‘é€<span>64000</span>ä¸ªå­—èŠ‚ã€‚æ¯ç§’<span>1MB</span>æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ¿€è¿›çš„ä¼°è®¡ï¼Œæ„å‘³ä½ å¯ä»¥æ¯ç§’å‘é€<span>125000</span>ä¸ªå­—èŠ‚ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œåœ¨æ¯æ¬¡æ›´æ–°çš„æ—¶å€™ä½ å°±å¯ä»¥ç´¯åŠ ä½ è¢«å…è®¸å‘é€çš„å­—èŠ‚æ•°äº†ï¼Œè¿™æ ·å½“ä½ å¯ä»¥æŒ‰ç…§é¢„ç®—æ¥å‘é€æœ€å¤§æ•°é‡çš„ç‰‡æ®µæ•°æ®åŒ…ï¼Œå¦‚æœè¿˜æœ‰æ•°æ®æ²¡æœ‰å‘å®Œçš„è¯ï¼Œä¼šç­‰åˆ°ä¸‹ä¸€å¸§çš„æ—¶å€™å†å°è¯•å‘é€ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¯¹äºå‘é€æ–¹è€Œè¨€æœ‰ä¸€ç‚¹æ¯”è¾ƒå¾®å¦™ï¼Œå®ç°ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…é‡æ–°å‘é€çš„æœ€å°å»¶è¿Ÿæ˜¯ä¸€ä¸ªå¾ˆæ£’çš„ä¸»æ„ï¼Œå¦‚æœä¸è¿™ä¹ˆåšçš„è¯ï¼Œå°±å¯èƒ½ä¼šå‡ºç°è¿™ç§ä¸€æ ·æƒ…å†µï¼Œå¯¹äºå¾ˆå°çš„å—æ•°æ®æˆ–è€…ä¸€ä¸ªå—çš„æœ€åå‡ ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œå¾ˆå®¹æ˜“ä¸åœçš„å‘é€å®ƒä»¬æŠŠæ•´ä¸ªç½‘ç»œéƒ½å¡æ»¡ã€‚æ­£æ˜¯å› ä¸ºè¿™ä¸€åŸå› ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªæ•°ç»„æ¥è®°å½•æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„ä¸Šä¸€æ¬¡å‘é€æ—¶é—´ã€‚é‡æ–°å‘é€å»¶è¿Ÿçš„ä¸€ä¸ªé€‰æ‹©æ˜¯ä½¿ç”¨ä¸€ä¸ªä¼°è®¡çš„ç½‘ç»œå¾€è¿”æ—¶å»¶ï¼Œæˆ–è€…åªæœ‰åœ¨è¶…è¿‡ä¸Šä¸€æ¬¡å‘é€æ—¶é—´ç½‘ç»œå¾€è¿”æ—¶å»¶<span>*1.25</span>è¿˜æ²¡æœ‰æ”¶åˆ°ç¡®è®¤æ•°æ®åŒ…çš„æƒ…å†µæ‰ä¼šé‡æ–°å‘é€ã€‚æˆ–è€…ï¼Œä½ å¯ä»¥è¯´<span>â€œ</span>è¿™æ ¹æœ¬å°±æ— æ‰€è°“<span>â€</span>ï¼Œåªè¦è¶…è¿‡ä¸Šä¸€æ¬¡å‘é€æ—¶é—´<span>100</span>æ¯«ç§’äº†å°±é‡æ–°å‘é€ã€‚æˆ‘åªæ˜¯åˆ—ä¸¾é€‚åˆæˆ‘è‡ªå·±çš„æ–¹æ¡ˆï¼</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="color: rgb(34, 34, 34);"> </span> </span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><h2 id="æŠŠå‘é€æ–¹å®ç°çš„æ›´å®Œç¾ä¸€ç‚¹"><span style="font-size: 18pt; color: rgb(34, 34, 34);">æŠŠå‘é€æ–¹å®ç°çš„æ›´å®Œç¾ä¸€ç‚¹</span></h2> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¦‚æœä½ ä»”ç»†ç”¨æ•°å­¦è®¡ç®—ä¸€ä¸‹çš„è¯ï¼Œä½ ä¼šæ³¨æ„åˆ°å¯¹äºä¸€ä¸ª<span>256K </span>çš„æ•°æ®å—è€Œè¨€ï¼Œå®ƒè¦åœ¨ç½‘ç»œä¸Šå‘é€å®Œæ¯•ä»ç„¶éœ€è¦å‘é€å¾ˆé•¿çš„æ—¶é—´ï¼š</span> </span></p><ul type="disc"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt;">å¦‚æœç½‘ç»œé€Ÿç‡æ˜¯æ¯ç§’<span>1M</span>çš„è¯ï¼Œå°±éœ€è¦<span>2</span>ç§’é’Ÿçš„æ—¶é—´ã€‚</span> </span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt;">å¦‚æœç½‘ç»œé€Ÿç‡æ˜¯æ¯ç§’<span>512KB</span>çš„è¯ï¼Œå°±éœ€è¦<span>4</span>ç§’é’Ÿçš„æ—¶é—´ã€‚</span> </span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt;">å¦‚æœç½‘ç»œé€Ÿç‡æ˜¯æ¯ç§’<span>256KB</span>çš„è¯ï¼Œå°±éœ€è¦<span>8</span>ç§’é’Ÿçš„æ—¶é—´ã€‚</span> </span></li></ul><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™å¯æœ‰ç‚¹ç³Ÿç³•ã€‚æˆ‘ä»¬å®ç°ç³»ç»Ÿçš„é‡ç‚¹æ˜¯å¿«é€Ÿå’Œå¯é æ€§ã€‚å†æ¬¡å¼ºè°ƒä¸‹éœ€è¦èƒ½å¤Ÿå¿«é€Ÿä¼ é€’ã€‚å¦‚æœå—ç³»ç»Ÿçš„ä¼ è¾“ä¸èƒ½åšåˆ°å¿«é€Ÿçš„è¯ï¼Œè¿™æ˜¯ä¸æ˜¯ä¼šä¸å¤ªå¥½ï¼Ÿå—ç³»ç»Ÿçš„ä¸€äº›å…¸å‹ç”¨ä¾‹ä¼šæ”¯æŒè¿™ä¸€ç‚¹ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼Œå½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¿æ¥ä¸ŠæœåŠ¡å™¨çš„æ—¶å€™ï¼Œä¸€å¤§å—æ•°æ®éœ€è¦ç«‹åˆ»å‘é€ç»™å®¢æˆ·ç«¯ï¼Œæˆ–è€…åœ¨å®¢æˆ·ç«¯é€€å‡ºåŠ è½½ç•Œé¢å¼€å§‹æ¸¸æˆçš„æ—¶å€™éœ€è¦èƒ½å¤Ÿå¤§é‡æ•°æ®å¿«é€Ÿä¸‹å‘ç»™å®¢æˆ·ç«¯ã€‚ä½ æƒ³è¦å°½å¿«çš„ä¼ é€’å®Œéœ€è¦çš„æ•°æ®ï¼Œè€Œä¸”åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯¹äºè‡ªå·±çš„å¸¦å®½å¹¶æ²¡æœ‰ä»€ä¹ˆå¤ªå¤šå…¶ä»–çš„ç”¨é€”ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸ä½¿ç”¨å°½å¯èƒ½å¤šçš„å¸¦å®½<span>?</span></span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span><br></span></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åœ¨è¿‡å»æˆ‘æ›¾ç»å°è¯•è¿‡ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯åœ¨ä¸€å¼€å§‹çš„æ—¶å€™å°½é‡ä¼ é€’ï¼Œè¿™å–å¾—äº†å¾ˆå¥½çš„æ•ˆæœã€‚å‡è®¾ä½ çš„å—å¤§å°å¹¶ä¸æ˜¯é‚£ä¹ˆå¤§ï¼Œè€Œä¸”ä½ çš„å—å‘é€é¢‘ç‡å¹¶ä¸é‚£ä¹ˆé¢‘ç¹ï¼Œæˆ‘æ²¡æ‰¾åˆ°ä»€ä¹ˆç†ç”±ä¸ºä»€ä¹ˆä½ ä¸èƒ½åœ¨ä¸€å¼€å§‹å°±æŠŠæ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…éƒ½å‘é€å‡ºå»ï¼Œå¡«å……æ»¡è´·æ¬¾ï¼Œç„¶åç­‰å¾…<span>100</span>æ¯«ç§’ï¼Œåœ¨æ¢å¤æˆæ­£å¸¸çš„å¸¦å®½å—é™çš„ç‰‡æ®µæ•°æ®åŒ…å‘é€ç­–ç•¥ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ä¸ºä»€ä¹ˆè¿™æ ·ä¼šå–å¾—è‰¯å¥½çš„æ•ˆæœï¼Ÿå¦‚æœç”¨æˆ·æœ‰ä¸€ä¸ªè‰¯å¥½çš„ç½‘ç»œè¿æ¥ï¼ˆå¯ä»¥æ¯ç§’å‘é€è¶…è¿‡<span>10MB</span>çš„æ•°æ®ç”šè‡³æ›´å¤šã€‚ã€‚ã€‚ï¼‰ï¼Œäº‹å®ä¸Šï¼Œç‰‡æ®µæ•°æ®åŒ…åœ¨ç½‘ç»œä¸Šçš„ä¼ è¾“éå¸¸çš„å¿«é€Ÿã€‚å¦‚æœæ˜¯è¿æ¥çš„æƒ…å†µå¹¶ä¸æ˜¯é‚£ä¹ˆå¥½çš„æƒ…å†µä¸‹ï¼Œå¤§éƒ¨åˆ†çš„ç‰‡æ®µæ•°æ®åŒ…ä¼šå¾—åˆ°ç¼“å†²ï¼Œå¤§éƒ¨åˆ†çš„ç‰‡æ®µæ•°æ®åŒ…å—é™äºå¸¦å®½ä½†æ˜¯ä¼šå°½å¯èƒ½å¿«çš„å‘é€å‡ºå»ã€‚å¤„ç†å®Œè¿™äº›æ•°æ®åŒ…ä¹‹åï¼Œå°±ä¼šåˆ‡æ¢åˆ°å¸¸è§„çš„ç­–ç•¥ï¼Œä»é‚£äº›ç¬¬ä¸€æ¬¡æ²¡æœ‰å‘é€å‡ºå»çš„ç‰‡æ®µæ•°æ®åŒ…é€‰æ‹©åˆé€‚çš„è¿›è¡Œå‘é€ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™ä¼¼ä¹æœ‰ç‚¹å†’é™©ï¼Œæ‰€ä»¥è®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ã€‚å¦‚æœå‡ºç°å¤§é‡æ•°æ®éœ€è¦ä¼ è¾“ä½†æ˜¯å·²ç»è¶…è¿‡å¸¦å®½é™åˆ¶çš„æƒ…å†µï¼Œäº’è”ç½‘ä¸Šçš„è·¯ç”±å™¨ä¼šå€¾å‘äºç¼“å†²è¿™äº›æ•°æ®åŒ…ï¼Œè€Œä¸æ˜¯ä¸æƒœä»£ä»·çš„æŠ›å¼ƒå®ƒä»¬ã€‚è¿™å°±æ˜¯<span>TCP</span>åè®®ä¼šåšçš„äº‹æƒ…ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘è®¨åŒè¿™ä¸ªæœºåˆ¶å› ä¸ºå®ƒä¼šè¯±å‘å»¶è¿Ÿè€Œä¸”ä¼šå¼„ä¹±é‚£äº›ä½ æƒ³è¦å°½å¿«äº¤ä»˜çš„æ¸¸æˆæ•°æ®åŒ…ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹å®ƒæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„è¡Œä¸ºï¼Œè¿™æ˜¯å› ä¸ºç©å®¶çœŸçš„æ²¡æœ‰å…¶ä»–äº‹æƒ…å¯ä»¥åšï¼Œæ™ºèƒ½ç­‰å¾…ä½ çš„å—æ•°æ®èµ¶ç´§ä¼ è¾“å®Œæ¯•ã€‚åªæ˜¯åœ¨ä½ çš„å—æ•°æ®ä¼ è¾“å®Œæ¯•ä»¥åï¼Œä¼šæœ‰ä¸€äº›åƒåœ¾æ•°æ®æˆ–è€…äº¤é€šæ‹¥å µï¼Œå®ƒä¼šå½±å“ä½ çš„æ¸¸æˆå¼€å§‹çš„å‡ ç§’é’Ÿã€‚å¦å¤–ï¼Œè¯·ç¡®ä¿ä½ å¢åŠ äº†ç½‘ç»œä¸¤ç«¯çš„åŠ æ“ä½œç³»ç»Ÿçš„å¥—æ¥å­—ç¼“å†²åŒºçš„å¤§å°ï¼Œè¿™æ ·å®ƒä»¬æ‰å¯ä»¥æ¯”ä½ æœ€å¤§çš„å—æ•°æ®çš„å¤§å°è¦å¤§<span>(</span>æˆ‘å»ºè®®è‡³å°‘å¢åŠ ä¸€å€<span>)</span>ï¼Œå¦åˆ™åœ¨è¶…è¿‡ç½‘ç»œå¸¦å®½çš„é™åˆ¶ä¹‹å‰ä½ å°±ä¼šå‡ºç°ä¸¢å¼ƒæ®µæ•°æ®åŒ…çš„æƒ…å†µã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æœ€åï¼Œæˆ‘æƒ³æˆä¸ºä¸€ä¸ªè´Ÿè´£ä»»çš„ç½‘ç»œå…¬æ°‘ï¼Œè™½ç„¶åœ¨è¿™é‡Œæˆ‘æ¨èåœ¨æœ€å¼€å§‹è¿æ¥çš„æ—¶å€™ä¸€æ¬¡å‘é€æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…ï¼Œæ‰€ä»¥å¯¹æˆ‘æ¥è¯´ä»‹ç»ä¸‹æˆ‘è®¤ä¸ºè¿™çœŸçš„æ˜¯é€‚å½“çš„æ˜¯éå¸¸éå¸¸é‡è¦çš„ï¼Œåœ¨<span>2016</span>å¹´çš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œå‘é€å‡ ç™¾ä¸ª<span>KB</span>é‡çº§çš„æ•°æ®åŒ…æ˜¯æ²¡ä»€ä¹ˆå¤§ä¸äº†çš„è¡Œä¸ºï¼Œè€Œä¸”åªä¼šå‘ç”Ÿåœ¨æ²¡æœ‰å…¶ä»–å…³é”®æ•°æ®åŒæ—¶å‘é€çš„æƒ…å†µä¸‹ã€‚è®©æˆ‘ä»¬ä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼Œå¦‚æœç”¨æˆ·æ­£åœ¨ç©ä½ çš„æ¸¸æˆï¼Œé‚£ä¹ˆå½“ä½ å‘é€å¤§å—æ•°æ®çš„æ—¶å€™ï¼Œä½¿ç”¨ä¿å®ˆçš„ç­–ç•¥ã€‚å¦‚æœä¸è¿™ä¹ˆåšçš„è¯ï¼Œå°±ä¼šå†’å½±å“ç”¨æˆ·æ¸¸æˆä½“éªŒçš„é£é™©ï¼Œè¿™æ˜¯å› ä¸ºä½ çš„å‘é€è¡Œä¸ºå¯èƒ½ä¼šè¯±å¯¼é¢å¤–çš„ç½‘ç»œå»¶è¿Ÿæˆ–è€…å‡ºç°æ•°æ®åŒ…ä¸¢å¤±çš„æƒ…å†µã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åŒæ ·ï¼Œå¦‚æœä½ çš„å—æ•°æ®éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚è¯´æ˜¯åå‡ <span>MB</span>çš„æƒ…å†µï¼Œé‚£ä¹ˆè¯·ä¸è¦ä½¿ç”¨è¿™ç§é‡è›®å‘é€çš„ç­–ç•¥ï¼Œè¿™æ˜¯å› ä¸ºè¿™ç§æ–¹æ³•å¤ªè¿‡äºä¾èµ–é™Œç”Ÿäººçš„ä»æ…ˆï¼Œä¹Ÿå°±æ˜¯åœ¨ä½ å’Œä½ çš„æ•°æ®åŒ…ç›®çš„åœ°ä¹‹é—´çš„è·¯ç”±å™¨ç¼“å†²åŒºã€‚å¦‚æœè¦æŒç»­å‘é€éå¸¸å¤§çš„æ•°æ®å—ä¿æŒä¸€ä¸ªé«˜ååé‡æœ‰å¿…è¦å®æ–½ä¸€äº›æ›´èªæ˜çš„æ–¹æ³•ã€‚è¿™æ˜¯æŸç§è‡ªé€‚åº”çš„æ–¹æ³•ï¼Œå®ƒä¼šè¯•å›¾å°½å¿«å‘é€æ•°æ®ï¼Œä½†æ˜¯ä¸€æ—¦æ£€æµ‹åˆ°å› ä¸ºè¿æ¥ä¸Šæœ‰å¤ªå¤šçš„æ•°æ®åœ¨ä¼ è¾“å¯¼è‡´å¤ªå¤šçš„å»¶è¿Ÿæˆ–è€…æ•°æ®åŒ…çš„ä¸¢å¤±ï¼Œå°±èƒ½åˆ‡æ¢å›ä¸€ä¸ªä½é€Ÿçš„æ–¹å¼ã€‚è¿™æ ·ä¸€ä¸ªç³»ç»Ÿè¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><h2 id="æ¥æ”¶æ–¹çš„å®ç°"><span style="font-size: 18pt; color: rgb(34, 34, 34);">æ¥æ”¶æ–¹çš„å®ç°</span></h2> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç°åœ¨æˆ‘ä»¬å·²ç»è§£å†³äº†å‘é€æ–¹å®ç°çš„æ‰€æœ‰ç»†èŠ‚å’Œå°é—®é¢˜ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬å¼€å§‹å®ç°æ¥æ”¶æ–¹ã€‚æ­£å¦‚ä¹‹å‰æåˆ°çš„é‚£æ ·ï¼Œä¸ä¹‹å‰æ–‡ç« ä»‹ç»çš„æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿä¸åŒï¼Œå—ç³»ç»Ÿåœ¨åŒä¸€æ—¶é—´åªèƒ½ç”±ä¸€ä¸ªå—æ­£åœ¨ä¼ è¾“ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™ä½¿å¾—å—ç³»ç»Ÿçš„æ¥æ”¶æ–¹å¯ä»¥å®ç°çš„æ›´åŠ ç®€å•ï¼Œä½ å¯ä»¥çœ‹ä¸‹é¢çš„å®ç°<span>:</span></span> </span></p><div><div id="highlighter_415734" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">class</code> <code class="cpp plain">ChunkReceiver</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">receiving;</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">readyToRead;</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp plain">uint16_t chunkId;</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">chunkSize;</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">numSlices;</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">numReceivedSlices;</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">received[MaxSlicesPerChunk];</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">    </code><code class="cpp plain">uint8_t chunkData[MaxChunkSize];</code></div><div class="line number11 index10 alt2"><code class="cpp plain">};</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="text-indent: 21pt; line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="color: rgb(34, 34, 34);"> </span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æˆ‘ä»¬æœ‰ä¸€ä¸ªçŠ¶æ€æ¥è®°å½•æˆ‘ä»¬æ˜¯å¦æ­£åœ¨ç½‘ç»œä¸Šâ€œæ¥æ”¶â€ä¸€ä¸ªå—æ•°æ®ï¼ŒåŠ ä¸Šâ€œ<span>readyToReadâ€™</span>â€çŠ¶æ€æ¥è¡¨æ˜æ˜¯å¦å·²ç»æœ‰ä¸€ä¸ªå—çš„æ‰€æœ‰ç‰‡æ®µæ•°æ®åŒ…éƒ½å·²ç»æ”¶åˆ°ã€å·²ç»å‡†å¤‡å¥½è¢«ç”¨æˆ·å¼¹å‡ºè¿›è¡Œè¯»å–å¤„ç†äº†ã€‚æ¥æ”¶é˜Ÿåˆ—çš„æœ€å°é•¿åº¦æ˜¯<span>1</span>ï¼Œè¿™æ˜¯éå¸¸æœ‰æ•ˆçš„ã€‚å¦‚æœä½ ä¸å–œæ¬¢è¿™ä¸ªçš„è¯ï¼Œä½ å½“ç„¶å¯ä»¥ç«‹å³ä»å—æ•°æ®æ¥æ”¶å™¨é‡Œé¢å°†è¿™ä¸ªæ•°æ®å¼¹å‡ºå¹¶æŠŠå®ƒæ’å…¥å®é™…çš„æ¥æ”¶é˜Ÿåˆ—ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åœ¨è¿™ä¸ªæ•°æ®ç»“æ„ä¸­æˆ‘ä»¬è¿˜è®°å½•äº†å—æ•°æ®çš„å¤§å°ï¼ˆå°½ç®¡ä¸æ˜¯å®Œå…¨å‡†ç¡®ï¼Œç›´åˆ°æ”¶åˆ°æœ€åä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…æ‰èƒ½å‡†ç¡®çš„è®¡ç®—å—æ•°æ®çš„å¤§å°ï¼‰ã€ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ã€å·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡è¿˜æœ‰é’ˆå¯¹æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„ä¸€ä¸ªæ¥æ”¶æ ‡è®°ã€‚é’ˆå¯¹æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ¥æ”¶æ ‡è®°å¯ä»¥è®©æˆ‘ä»¬ä¸¢å¼ƒé‚£äº›æˆ‘ä»¬å·²ç»æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…ï¼Œå¹¶è®¡ç®—åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ï¼ˆå› ä¸ºæˆ‘ä»¬å¯èƒ½ä¼šå¤šæ¬¡æ”¶åˆ°åŒä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œä½†æ˜¯æˆ‘ä»¬åªä¼šåœ¨ç¬¬ä¸€æ¬¡æ”¶åˆ°è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ‰ä¼šå¢åŠ è®¡æ•°å™¨çš„å€¼ï¼‰ã€‚å®ƒä¹Ÿè¢«ç”¨åœ¨ç”Ÿæˆç¡®è®¤æ•°æ®åŒ…ä¸Šã€‚å½“å·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ç­‰äºç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡çš„æ—¶å€™ï¼Œä»æ¥æ”¶æ–¹çš„è§’åº¦çœ‹è¿™ä¸ªå—æ•°æ®çš„æ¥æ”¶æ‰ç®—å®Œæˆã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">é¦–å…ˆï¼Œæ¥æ”¶æ–¹çš„è®¾ç½®ä¼šä»å—<span>0</span>å¼€å§‹ã€‚å½“ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…ä»ç½‘ç»œä¸Šä¼ é€’è¿‡æ¥ï¼Œå¹¶ä¸”èƒ½å¤ŸåŒ¹é…è¿™ä¸ªå—<span>id</span>çš„è¯ï¼Œâ€œ<span>receivingâ€</span>çŠ¶æ€ä¼šä»<span>false</span>ç¿»è½¬ä¸º<span>true</span>ï¼Œç¬¬ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ•°æ®ä¼šæ’å…¥â€<span> chunkData</span>â€œå˜é‡çš„åˆé€‚ä½ç½®ï¼Œç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ä¼šæ ¹æ®ç¬¬ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…é‡Œé¢çš„æ•°æ®è¿›è¡Œæ­£ç¡®çš„è®¾ç½®ï¼Œå·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ä¼šåŠ ä¸€ï¼Œä¹Ÿå°±æ˜¯ä»<span>0</span>åˆ°<span>1</span>ï¼Œé’ˆå¯¹æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ¥æ”¶æ ‡è®°é‡Œé¢å¯¹åº”è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„é¡¹ä¼šå˜ä¸º<span>true</span>ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">éšç€è¿™ä¸ªå—æ•°æ®çš„å…¶ä»–ç‰‡æ®µæ•°æ®åŒ…çš„åˆ°æ¥ï¼Œä¼šå¯¹æ¯ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…è¿›è¡Œæ£€æµ‹ï¼Œåˆ¤æ–­å®ƒä»¬çš„<span>id</span>æ˜¯å¦ä¸å½“å‰å—çš„<span>id</span>ç›¸åŒï¼Œå¦‚æœä¸ç›¸åŒçš„è¯å°±ä¼šè¢«ä¸¢å¼ƒã€‚å¦‚æœè¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…å·²ç»æ”¶åˆ°è¿‡çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…ä¹Ÿä¼šè¢«ä¸¢å¼ƒã€‚å¦åˆ™ï¼Œè¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ•°æ®ä¼šæ’å…¥â€<span> chunkData</span>â€œå˜é‡çš„åˆé€‚ä½ç½®ã€å·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ä¼šåŠ ä¸€ã€é’ˆå¯¹æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ¥æ”¶æ ‡è®°é‡Œé¢å¯¹åº”è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„é¡¹ä¼šå˜ä¸º<span>true</span>ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™ä¸€è¿‡ç¨‹ä¼šæŒç»­è¿›è¡Œï¼Œç›´åˆ°æ¥æ”¶åˆ°æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…ã€‚ä¸€æ—¦æ¥æ”¶åˆ°æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…ï¼ˆä¹Ÿå°±æ˜¯å·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ç­‰äºç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡çš„æ—¶å€™ï¼‰ï¼Œæ¥æ”¶æ–¹ä¼šæŠŠâ€œ<span>receiving </span>â€œçŠ¶æ€æ”¹ä¸º<span>false</span>ï¼Œè€ŒæŠŠâ€<span>readyToRead</span>â€œçŠ¶æ€æ”¹ä¸º<span>true</span>ã€‚å½“<span>â€readyToReadâ€</span>çŠ¶æ€ä¸º<span>true</span>çš„æ—¶å€™ï¼Œæ‰€æœ‰æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œè¿™ä¸ªå¤„ç†è¿‡ç¨‹é€šå¸¸éå¸¸çš„çŸ­ï¼Œä¼šåœ¨æ”¶åˆ°ç‰‡æ®µæ•°æ®åŒ…çš„åŒä¸€å¸§è¿›è¡Œå¤„ç†ï¼Œè°ƒç”¨è€…ä¼šæ£€æŸ¥<span>â€</span>æˆ‘æœ‰ä¸€å—æ•°æ®è¦è¯»å–ä¹ˆï¼Ÿ<span>â€œ</span>å¹¶å¤„ç†å—æ•°æ®ã€‚ç„¶åä¼šé‡ç½®æ•°æ®å—æ¥æ”¶å™¨çš„æ‰€æœ‰æ•°æ®ä¸ºé»˜è®¤å€¼ï¼Œé™¤äº†å—æ•°æ®çš„<span>id</span>ä»<span>0</span>å¢åŠ åˆ°<span>1</span>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å‡†å¤‡å¥½æ¥æ”¶ä¸‹ä¸€ä¸ªå—äº†ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><h2 id="æµ¸æ³¡æµ‹è¯•çš„é‡è¦æ€§å’Œç¡®è®¤æ•°æ®åŒ…"><span style="font-size: 18pt; color: rgb(34, 34, 34);">æµ¸æ³¡æµ‹è¯•çš„é‡è¦æ€§å’Œç¡®è®¤æ•°æ®åŒ…</span></h2> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç¬¬ä¸€çœ¼çœ‹ä¸Šå»ï¼Œç¡®è®¤æ•°æ®åŒ…è¿™ä¸ªç³»ç»Ÿä¼¼ä¹å¾ˆç®€å•ï¼š</span> </span></p><p class="MsoListParagraph" align="left" style="margin-left: 21pt; text-indent: -21pt; line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">1ï¼‰è®°å½•å·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…ã€‚</span> </span></p><p class="MsoListParagraph" align="left" style="margin-left: 21pt; text-indent: -21pt; line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">2ï¼‰å½“ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…æ”¶åˆ°ä»¥åï¼Œå›å¤ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç¡®è®¤æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…ä¿¡æ¯çš„ç¡®è®¤æ•°æ®åŒ…ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™çœ‹ä¸Šå»å®ç°èµ·æ¥ä¼¼ä¹ç›¸å½“çš„ç®€å•ï¼Œä½†æ˜¯åƒå¤§å¤šæ•°å‘ç”Ÿåœ¨<span>UDP</span>åè®®çš„äº‹æƒ…ä¸€æ ·ï¼Œå½“æ¶‰åŠåˆ°æ•°æ®åŒ…ä¸¢å¤±çš„æ—¶å€™ï¼Œå°±æœ‰ä¸€äº›å¾®å¦™çš„ç‚¹è®©å®ƒçš„å¤„ç†æœ‰ç‚¹æ£˜æ‰‹ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ä¸€ä¸ªå¯¹äºç¡®è®¤æ•°æ®åŒ…æ¯”è¾ƒå¤©çœŸçš„å®ç°å¯èƒ½æ˜¯è¿™æ ·å­çš„ã€‚æ¯æ¬¡æ”¶åˆ°ç‰‡æ®µæ•°æ®åŒ…ï¼Œå°±å›å¤ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç¡®è®¤æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…ä¿¡æ¯çš„ç¡®è®¤æ•°æ®åŒ…ï¼ˆä¹Ÿä¼šåŒ…æ‹¬åˆšæ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„ä¿¡æ¯ï¼‰ã€‚è¿™çœ‹ä¸Šå»éå¸¸ç¬¦åˆé€»è¾‘ï¼Œä½†æ˜¯è¿™ä½¿å¾—å—åè®®ç»™æ¶æ„å‘é€è€…ä¸€ä¸ªæ¼æ´ä½¿å¾—å®ƒä»¬å¯ä»¥å—åè®®ä½œä¸ºä¸€ä¸ªDDosçš„å·¥å…·ã€‚å¦‚ä½•ä½œä¸ºä¸€ä¸ªDDosçš„å·¥å…·<span>?</span>å¦‚æœä½ å¯¹æ¯ä¸ªæ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…éƒ½ä¼šå›å¤ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…çš„è¯ï¼Œé‚£ä¹ˆå‘é€æ–¹èƒ½å¤Ÿæ„é€ ä¸€ä¸ªå¾ˆå°çš„ç‰‡æ®µæ•°æ®åŒ…å‘é€ç»™ä½ ï¼Œè€Œä½ ä¼šå›å¤ä¸€ä¸ªæ¯”å‘é€ç»™ä½ çš„ç‰‡æ®µæ•°æ®åŒ…è¿˜å¤§çš„ç¡®è®¤æ•°æ®åŒ…ï¼Œè¿™æ ·ä½ çš„æœåŠ¡å™¨å°±å˜æˆäº†ä¸€ä¸ªå¯ä»¥è¢«äººåˆ©ç”¨æ¥è¿›è¡ŒDDosæ”¾å¤§æ”»å‡»çš„å·¥å…·ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç°åœ¨ä¹Ÿè®¸æ˜¯å› ä¸ºæˆ‘å¯¹DDosè¿™ä¸ªäº‹æƒ…æœ‰ä¸€ç‚¹åæ‰§ï¼ˆæˆ‘ç¡®å®æ˜¯æœ‰ä¸€ç‚¹ï¼‰ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´ä½ å¯ä»¥é˜²æ­¢å¯¹DDosçš„æ”¾å¤§ï¼Œæ°¸è¿œä¸è¦è®¾è®¡ä¸€ä¸ªåŒ…å«å¯¹æ¥æ”¶åˆ°çš„æ•°æ®åŒ…è¿›è¡Œä¸€å¯¹ä¸€çš„æ˜ å°„å“åº”çš„åè®®ã€‚è®©æˆ‘ä»¬ä¸¾ä¸ªç®€å•ä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœæœ‰äººç»™ä½ å‘é€<span>1000</span>ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œæ°¸è¿œä¸è¦ç»™ä»–å›å¤<span>1000</span>ä¸ªç¡®è®¤æ•°æ®åŒ…ã€‚ç›¸ååªå‘ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…ï¼Œè€Œä¸”æœ€å¤šæ¯<span>50</span>æ¯«ç§’æˆ–è€…<span>100</span>æ¯«ç§’æ‰å‘é€ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…ã€‚å¦‚æœä½ æ˜¯è¿™æ ·è®¾è®¡çš„è¯ï¼Œé‚£ä¹ˆæ»¥ç”¨ä½ çš„<span>UDP</span>åè®®å¯¹DDosè¿›è¡Œæ”¾å¤§å°±æ˜¯å®Œå…¨ä¸å¯èƒ½çš„ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿˜æœ‰å…¶ä»–çš„æ–¹æ³•è®©è¿™ä¸ªç¡®è®¤ç³»ç»Ÿå®¹æ˜“å‡ºé”™ï¼Œè€Œè¿™äº›éƒ½å¾€å¾€è¡¨ç°ä¸º<span>â€</span>å‘é€æŒ‚èµ·<span>â€œ</span>ã€‚æ¢å¥è¯è¯´ï¼Œæ¥æ”¶æ–¹å·²ç»çŸ¥é“è¿™ä¸ªå—å·²ç»å‘é€å®Œæ¯•äº†ï¼Œä½†æ˜¯ç”±äºç¨‹åºå‘˜çš„é”™è¯¯ï¼Œå‘é€æ–¹é”™è¿‡äº†ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…<span>(</span>å¯èƒ½æ˜¯é’ˆå¯¹æœ€åä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„ç¡®è®¤æ•°æ®åŒ…<span>)</span>å¹¶ä¸”å¡å…¥åˆ°ä¸€ä¸ªçŠ¶æ€ï¼Œä¼šä¸åœçš„åå¤é‡å‘è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…è€Œæ²¡æœ‰å¾—åˆ°ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…çš„å“åº”ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åœ¨è¿‡å»<span>10</span>å¹´é‡Œï¼Œæˆ‘å¯èƒ½è‡³å°‘<span>5</span>æ¬¡ä»å¤´å¼€å§‹å®ç°è¿™ä¸ªå—ç³»ç»Ÿï¼Œæ¯æ¬¡æˆ‘éƒ½æ‰¾åˆ°æ–°çš„å’Œä»¤äººå…´å¥‹çš„æ–¹å¼æ¥è®©å‘é€æ–¹æŒ‚èµ·ã€‚æˆ‘å¼€å‘å’Œæµ‹è¯•å—ç³»ç»Ÿçš„ç­–ç•¥æ˜¯é¦–å…ˆè¿›è¡Œç¼–ç ç¡®è®¤å®ƒèƒ½å¤Ÿè·‘èµ·æ¥ï¼Œç„¶åè®¾ç½®ä¸€ä¸ªæµ‹è¯•å·¥å…·åœ¨æœ‰å¤§é‡çš„æ•°æ®åŒ…ä¸¢å¤±ã€æ•°æ®åŒ…ä¹±åºå’Œé‡å¤çš„æƒ…å†µä¸‹éšæœºå‘é€éšæœºå¤§å°çš„å—ã€‚è¿™å¾€å¾€ä¼šæ¸…é™¤ä»»ä½•æŒ‚èµ·ã€‚æˆ‘æ›¾ç»å®ç°è¿‡çš„å—ç³»ç»Ÿéƒ½è‡³å°‘æœ‰ä¸€ä¸ªæŒ‚èµ·å­˜åœ¨ï¼Œé€šå¸¸ä¼šæœ‰<span>2</span>åˆ°<span>3</span>ä¸ªæŒ‚èµ·ã€‚æ‰€ä»¥å¦‚æœä½ æ˜¯æ‰“ç®—ä»å¤´å¼€å§‹å®ç°è¿™ä¸ªå—ç³»ç»Ÿçš„è¯ï¼Œè¯·ä¸è¦è½»æ•Œã€‚è¯·è®¾ç½®ä¸€ä¸ªæµ¸æ³¡æµ‹è¯•ã€‚ä½ ä¼šæ„Ÿè°¢æˆ‘åœ¨è¿™é‡Œçš„æé†’çš„ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æˆ‘é€šå¸¸é‡åˆ°çš„ç¬¬ä¸€æ¬¡æŒ‚èµ·æ˜¯ç”±äºå¯¹åŒä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„å¤šæ¬¡æ”¶åˆ°ä¸ä¼šå›å¤ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…ã€‚å®ƒæœ‰ç‚¹åƒè¿™æ ·ï¼š<span>â€ </span>å“¦ï¼Œè¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…å·²ç»æ”¶åˆ°è¿‡äº†ä¹ˆï¼Ÿå·²ç»æ”¶åˆ°è¿‡äº†å°±ä¸¢å¼ƒå®ƒ<span>â€</span>ï¼Œç„¶åå¿˜è®°åœ¨ç¡®è®¤æ•°æ®åŒ…é‡Œé¢è®¾ç½®æ ‡è®°ã€‚è¿™å¯¹äºå‘é€æ–¹æ¥è¯´æ˜¯ä¸€ä¸ªå›°æ‰°ï¼Œå› ä¸ºè¿™æ ·çš„è¯å°±ä¸ä¼šæœ‰ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…ï¼Œé‚£ä¹ˆå¦‚æœå‡ºç°è¿™ç§æƒ…å†µçš„è¯ï¼Œåˆæ°å¥½é‡åˆ°ç¬¬ä¸€æ¬¡æ”¶åˆ°è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ—¶å€™å‘é€çš„ç¡®è®¤æ•°æ®åŒ…å‡ºç°ä¸¢åŒ…çš„æƒ…å†µï¼Œå‘é€æ–¹æ ¹æœ¬å°±ä¸çŸ¥é“è¿™ä¸ªä»–åœ¨åå¤å‘é€çš„ç‰‡æ®µæ•°æ®åŒ…å…¶å®å·²ç»è¢«æ”¶åˆ°äº†ã€‚å¦‚æœä½ å°±æ˜¯è¿™ä¹ˆä¸å·§ï¼Œé‡ä¸Šäº†ç¬¬ä¸€æ¬¡æ”¶åˆ°è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ—¶å€™å‘é€çš„ç¡®è®¤æ•°æ®åŒ…å‡ºç°ä¸¢åŒ…çš„æƒ…å†µï¼Œé‚£ä¹ˆå°±é‡ä¸Šäº†æŒ‚èµ·çš„æƒ…å†µã€‚å¦‚æœä½ æƒ³åœ¨ä½ çš„ä»£ç é‡Œé¢é‡ç°è¿™ä¸ªæƒ…å†µçš„è¯ï¼Œå¯ä»¥åœ¨æ”¶åˆ°æœ€åä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ—¶å€™ä¸å‘é€ç¡®è®¤æ•°æ®åŒ…ï¼Œé‚£ä¹ˆå‡ºç°çš„æƒ…å†µå°±æ˜¯è¿™ç§æŒ‚èµ·äº†ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ä¸‹ä¸€ä¸ªæŒ‚èµ·ä¼šå‘ç”Ÿåœ¨æ¥æ”¶æ–¹åœ¨å‘é€æ–¹çŸ¥é“ä¹‹å‰å°±å·²ç»çŸ¥é“å—å‘é€å®Œæ¯•å¹¶åˆ‡æ¢å®ƒçš„çŠ¶æ€å˜é‡â€œ<span>readyToReadâ€</span>æ¥ä¸¢å¼ƒåç»­ä¼ å…¥çš„ç‰‡æ®µæ•°æ®åŒ…ã€‚åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œå³ä½¿æ¥æ”¶æ–¹è®¤ä¸ºå—å·²ç»å®Œå…¨æ¥æ”¶å®Œæ¯•ï¼Œä½†æ˜¯å‘é€æ–¹è¿˜ä¸çŸ¥é“è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥æœ‰å¿…è¦è®¾ç½®ç¡®è®¤æ•°æ®åŒ…å¯¹åº”çš„æ ‡å¿—ä½ï¼Œå³ä½¿å—å·²ç»å®Œå…¨æ¥æ”¶å®Œæ¯•ï¼Œè¿™æ ·å‘é€æ–¹æ‰èƒ½ä¸€ç›´æ¥æ”¶åˆ°æç¤ºå—å·²ç»å…¨éƒ¨å‘é€å®Œæ¯•çš„ç¡®è®¤æ•°æ®åŒ…ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">é€šå¸¸é‡åˆ°çš„æœ€åä¸€ä¸ªæŒ‚èµ·æƒ…å†µæ˜¯åœ¨è¯»å–å®Œå—æ•°æ®ä»¥åçš„çŠ¶æ€åˆ‡æ¢é‡Œé¢ï¼Œé‚£ä¸ªæ—¶å€™çŠ¶æ€å˜é‡â€œ<span>readyToReadâ€</span>å·²ç»åˆ‡å›<span>false</span>è€Œå—çš„<span>id</span>ä¹ŸåŠ ä¸€äº†ã€‚è®©æˆ‘ä»¬ä¸¾ä¸ªç®€å•ä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œå—<span>0</span>å·²ç»å®Œæˆæ¥æ”¶ï¼Œç”¨æˆ·å·²ç»å®Œæˆå¯¹å—<span>0</span>çš„è¯»å–å¹¶ä¸”å—<span>id</span>å·²ç»é€’å¢åˆ°<span>1</span>äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½æ¥æ”¶å—<span>1</span>çš„ç‰‡æ®µæ•°æ®åŒ…äº†ï¼ˆæˆ‘ä»¬ä¼šä¸¢å¼ƒä»»ä½•ä¸æˆ‘ä»¬å½“å‰æ­£åœ¨æ¥æ”¶å—<span>ID</span>ä¸åŒçš„ç‰‡æ®µæ•°æ®åŒ…ï¼‰ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å†ä¸€æ¬¡å‡ºç°è¿™ç§æƒ…å†µï¼Œå°±æ˜¯è¿™é‡Œçš„å‘é€æ–¹å› ä¸ºç¡®è®¤æ•°æ®åŒ…çš„ä¸¢å¤±å¯¼è‡´ä¿¡æ¯æœ‰ä¸€ç‚¹æ»åï¼Œå¯èƒ½æ˜¯å› ä¸ºæ²¡æœ‰æ”¶åˆ°ç¬¬ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰å¿…è¦å…³æ³¨ç‰‡æ®µæ•°æ®åŒ…ï¼Œå¦‚æœæˆ‘ä»¬æ­£å¤„äºè¿™ä¹ˆä¸€ä¸ªçŠ¶æ€ï¼šæˆ‘ä»¬å°šæœªæ”¶åˆ°ç¬¬<span>n</span>ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œä½†æ˜¯å‰é¢<span>n â€“ 1</span>ä¸ªç‰‡æ®µæ•°æ®åŒ…éƒ½å·²ç»æ”¶åˆ°äº†ï¼Œæˆ‘ä»¬å¿…é¡»è®¾ç½®ä¸€ä¸ªç‰¹æ®Šçš„æ ‡è®°ä½ç„¶åæˆ‘ä»¬ä¼šå‘é€ä¸€ä¸ªåŒ…å«æ‰€æœ‰å‰é¢<span>n â€“ 1</span>ä¸ªç‰‡æ®µæ•°æ®åŒ…éƒ½å·²ç»æ”¶åˆ°ä¿¡æ¯çš„ç¡®è®¤æ•°æ®åŒ…ï¼Œå¦åˆ™å‘é€æ–¹ä¸ä¼šæ„è¯†åˆ°å—æ•°æ®å·²ç»æ”¶åˆ°å¹¶ä¸”å‘é€æ–¹å·²ç»å‡†å¤‡æŒ‚èµ·äº†ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„é‚£æ ·ï¼Œç¡®è®¤æ•°æ®åŒ…çš„å®ç°æ˜¯æœ‰ä¸€ç‚¹å¾®å¦™çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰ç‚¹å¥‡æ€ªçš„è¿‡ç¨‹å› ä¸ºå½“ç‰‡æ®µæ•°æ®åŒ…åœ¨ç½‘ç»œçš„ä¸€ç«¯æ”¶åˆ°çš„æ—¶å€™ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½æ¥å‘é€ç¡®è®¤æ•°æ®åŒ…ç›´åˆ°å‘é€æ–¹çŸ¥é“éƒ½æœ‰å“ªäº›å‘é€çš„ç‰‡æ®µæ•°æ®åŒ…è¢«æˆåŠŸæ¥æ”¶ä¸ºæ­¢ã€‚å¦‚æœä½ æ‰“ç ´äº†ç‰‡æ®µæ•°æ®åŒ…<span>-&gt;</span>ç¡®è®¤æ•°æ®åŒ…è¿™ä¸ªé“¾æ¥çš„è¯ï¼Œé‚£ä¹ˆæ•´ä¸ªç³»ç»Ÿå°±å°†æŒ‚èµ·ã€‚æˆ‘é¼“åŠ±ä½ ä»”ç»†çœ‹çœ‹è¿™ç¯‡æ–‡ç« çš„æºä»£ç ææ¸…æ¥šè¿›ä¸€æ­¥çš„ç»†èŠ‚ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><h2 id="æ€»ç»“"><span style="font-size: 18pt; color: rgb(34, 34, 34);">æ€»ç»“</span></h2> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å—ç³»ç»Ÿåœ¨æ¦‚å¿µä¸Šæ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯å®ƒçš„å…·ä½“å®ç°è‚¯å®šä¸æ˜¯å¾®ä¸è¶³é“çš„ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œå®ç°å‘é€è€…è®¾è®¡è¿™ä¸€å—æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å­¦ä¹ ç»éªŒï¼Œå½“ä½ ä»å¤´å¼€å§‹å®ç°è¿™æ ·çš„ç³»ç»Ÿçš„æ—¶å€™ä¸€å®šæœ‰å¾ˆå¤šä¸œè¥¿éœ€è¦å­¦ä¹ ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ä¸ªç³»ç»Ÿçš„è®¾è®¡ï¼Œå¹¶è¯•ç€è‡ªå·±åŠ¨æ‰‹ä»å¤´å¼€å§‹å®ç°å®ƒã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å­¦ä¹ ç»å†ã€‚æ­¤å¤–ï¼Œæˆ‘é¼“åŠ±ä½ åœ¨<span>patreon</span>ä¸Šæ”¯æŒæˆ‘ï¼Œä½œä¸ºå›æŠ¥ï¼Œä½ ä¼šå¾—åˆ°æœ¬æ–‡çš„ç¤ºä¾‹æºä»£ç <span>(</span>ä»¥åŠæœ¬ç³»åˆ—çš„å…¶ä»–æ–‡ç« çš„ç¤ºä¾‹æºä»£ç <span>)</span>ï¼Œè¿˜åŒ…æ‹¬æˆ‘åœ¨<span>GDC 2015</span>ä¸Šå…³äºç½‘ç»œç‰©ç†çš„æ¼”è®²çš„æºä»£ç ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ä»·å€¼çš„è¯ï¼Œè¯·åœ¨<span>patreon</span>ä¸Šæ”¯æŒæˆ‘çš„å†™ä½œï¼Œè¿™æ ·æˆ‘ä¼šå†™çš„æ›´å¿«ã€‚ä½ å¯ä»¥åœ¨<span>BSD 3.0</span>è®¸å¯ä¸‹è®¿é—®åˆ°è¿™ç¯‡æ–‡ç« é‡Œé¢çš„ä»£ç ã€‚éå¸¸æ„Ÿè°¢ä½ çš„æ”¯æŒï¼</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ã€ç‰ˆæƒå£°æ˜ã€‘</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åŸæ–‡ä½œè€…æœªåšæƒåˆ©å£°æ˜ï¼Œè§†ä¸ºå…±äº«çŸ¥è¯†äº§æƒè¿›å…¥å…¬å…±é¢†åŸŸï¼Œè‡ªåŠ¨è·å¾—æˆæƒã€‚</span> </span></p><p class="MsoNormal"><span style="font-family:å¾®è½¯é›…é»‘;"><span> </span> </span></p><p class="MsoNormal"><span><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span> </p></div>                    <br>                

          
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/packet_fragmentation_and_reassembly/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/packet_fragmentation_and_reassembly/" itemprop="url">æ„å»ºæ¸¸æˆç½‘ç»œåè®®ä¸‰ä¹‹æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-26T03:13:35+00:00">
                02-26-2017
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GS/" itemprop="url" rel="index">
                    <span itemprop="name">GS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          
            <h1 id="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"><a href="#æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“" class="headerlink" title="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"></a>æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“</h1><p>æœ¬ç¯‡ä¸»è¦è®²äº†æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„é—®é¢˜, åˆ°åº•æ•°æ®åŒ…å¤šå¤§æ‰å¥½å‘¢?æ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½å‘¢?åŒ…å¤ªå¤§äº†æ€ä¹ˆåŠå‘¢?<br>è¯·çœ‹æ€»ç»“, ä¸æ˜ä¹‹å¤„å†çœ‹æ–‡ä¸­å…·ä½“è®²è§£.</p>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿ</h2><p>æ¯å°è®¡ç®—æœº(è·¯ç”±å™¨)ä¼šæ²¿ç€è·¯ç”±å¼ºåˆ¶è¦æ±‚æ•°æ®åŒ…çš„å¤§å°ä¼šæœ‰ä¸€ä¸ªæœ€å¤§çš„ä¸Šé™ï¼Œè¿™ä¸ªä¸Šé™å°±æ˜¯æ‰€è°“çš„æœ€å¤§ä¼ è¾“å•å…ƒMTUã€‚å¦‚æœä»»æ„ä¸€ä¸ªè·¯ç”±å™¨æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…çš„å¤§å°è¶…è¿‡è¿™ä¸ªæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œå®ƒæœ‰è¿™ä¹ˆä¸¤ä¸ªé€‰æ‹©ï¼Œa)åœ¨IPå±‚å¯¹è¿™ä¸ªæ•°æ®åŒ…è¿›è¡Œåˆ†åŒ…ï¼Œå¹¶å°†åˆ†åŒ…åçš„æ•°æ®åŒ…ç»§ç»­ä¼ é€’ï¼Œb)ä¸¢å¼ƒè¿™ä¸ªæ•°æ®åŒ…ç„¶åå‘Šè¯‰ä½ æ•°æ®åŒ…è¢«ä¸¢å¼ƒäº†ï¼Œä½ è‡ªå·±è´Ÿè´£æ‘†å¹³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><strong>å®ä¾‹</strong> : è¿™å„¿æœ‰ä¸€ä¸ªæˆ‘ä¼šç»å¸¸é‡åˆ°çš„æƒ…å†µã€‚äººä»¬åœ¨ç¼–å†™å¤šäººåœ¨çº¿æ¸¸æˆçš„æ—¶å€™ï¼Œæ•°æ®åŒ…çš„å¹³å‡å¤§å°éƒ½ä¼šéå¸¸çš„å°ï¼Œè®©æˆ‘ä»¬å‡è®¾ä¸‹ï¼Œè¿™äº›æ•°æ®åŒ…çš„å¹³å‡å¤§å°å¤§æ¦‚åªæœ‰å‡ ç™¾å­—èŠ‚ï¼Œä½†æ—¶ä¸æ—¶ä¼šåœ¨ä»–ä»¬çš„æ¸¸æˆä¸­åŒæ—¶å‘ç”Ÿå¤§é‡çš„äº‹æƒ…å¹¶ä¸”å‘å‡ºå»çš„æ•°æ®åŒ…ä¼šå‡ºç°ä¸¢å¤±çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™æ•°æ®åŒ…ä¼šæ¯”é€šå¸¸çš„æƒ…å†µä¸‹è¦å¤§ã€‚çªç„¶ä¹‹é—´ï¼Œæ¸¸æˆçš„æ•°æ®åŒ…çš„å¤§å°å°±ä¼šè¶…è¿‡æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œè¿™æ ·å°±åªæœ‰å¾ˆå°‘ä¸€éƒ¨åˆ†ç©å®¶èƒ½å¤Ÿæ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…ï¼Œç„¶åæ•´ä¸ªé€šä¿¡å°±å´©æºƒäº†ã€‚</p>
<h2 id="æœ¬ç¯‡åŸºæœ¬æœ¯è¯­"><a href="#æœ¬ç¯‡åŸºæœ¬æœ¯è¯­" class="headerlink" title="æœ¬ç¯‡åŸºæœ¬æœ¯è¯­"></a>æœ¬ç¯‡åŸºæœ¬æœ¯è¯­</h2><ul>
<li>æ•°æ®åŒ…packets</li>
<li>åˆ†åŒ…fragments</li>
</ul>
<h2 id="åˆ†åŒ…çš„æ•°æ®ç»“æ„"><a href="#åˆ†åŒ…çš„æ•°æ®ç»“æ„" class="headerlink" title="åˆ†åŒ…çš„æ•°æ®ç»“æ„"></a>åˆ†åŒ…çš„æ•°æ®ç»“æ„</h2><p>æˆ‘ä»¬å°†å…è®¸ä¸€ä¸ªæ•°æ®åŒ…æœ€å¤šå¯ä»¥åˆ†æˆ256ä¸ªæ•°æ®åŒ…ï¼Œå¹¶ä¸”æ¯ä¸ªåˆ†åŒ…åçš„æ•°æ®åŒ…çš„å¤§å°ä¸ä¼šè¶…è¿‡1024ä¸ªå­—èŠ‚ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™æ ·ä¸€ä¸ªç³»ç»Ÿæ¥å‘é€å¤§å°æœ€å¤§ä¸º256kçš„æ•°æ®åŒ…</p>
<pre><del>[protocol id] (32 bits)</del>   // not actually sent, but used to calc crc32
[crc32] (32 bits)  
[sequence] (16 bits)  // æ•°æ®åŒ…åºå·
[packet type = 0] (2 bits)
<strong>[fragment id] (8 bits) // åˆ†åŒ…ID
[num fragments] (8 bits)
[pad zero bits to nearest byte index] // ç”¨äºå­—èŠ‚å¯¹é½çš„bits
&lt;fragment data&gt;</strong>
</pre>

<h2 id="å‘é€åˆ†åŒ…åçš„æ•°æ®åŒ…"><a href="#å‘é€åˆ†åŒ…åçš„æ•°æ®åŒ…" class="headerlink" title="å‘é€åˆ†åŒ…åçš„æ•°æ®åŒ…"></a>å‘é€åˆ†åŒ…åçš„æ•°æ®åŒ…</h2><p>å‘é€åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…æ˜¯ä¸€ä»¶éå¸¸å®¹æ˜“çš„äº‹æƒ…ã€‚å¦‚æœæ•°æ®åŒ…çš„å¤§å°å°äºä¿å®ˆä¼°è®¡çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ã€‚é‚£ä¹ˆå°±æŒ‰æ­£å¸¸çš„æ–¹æ³•è¿›è¡Œå‘é€ã€‚å¦åˆ™çš„è¯ï¼Œå°±è®¡ç®—è¿™ä¸ªæ•°æ®åŒ…åˆ°åº•è¯¥åˆ†æˆå¤šå°‘ä¸ª1024å­—èŠ‚çš„æ•°æ®åŒ…åˆ†åŒ…ï¼Œç„¶åæ„å»ºè¿™äº›åˆ†åŒ…å¹¶æŒ‰ç…§ä¹‹å‰å‘é€æ­£å¸¸æ•°æ®åŒ…çš„æ–¹æ³•è¿›è¡Œå‘é€ã€‚</p>
<p>å‘é€å‡ºå»ä»¥åä¹Ÿä¸è®°å½•å‘é€çš„æ•°æ®åŒ…çš„å†…å®¹ï¼Œè¿™ç§å‘é€ä»¥åä¸è®°å½•å‘é€çš„æ•°æ®åŒ…çš„å†…å®¹çš„æ–¹æ³•æœ‰ä¸€ä¸ªåæœï¼Œå°±æ˜¯æ•°æ®åŒ…çš„ä»»æ„ä¸€ä¸ªåˆ†åŒ…å¦‚æœä¸¢å¤±çš„è¯ï¼Œé‚£ä¹ˆæ•´ä¸ªæ•°æ®åŒ…å°±éƒ½è¦ä¸¢å¼ƒã€‚éšç€åˆ†åŒ…æ•°é‡çš„å¢åŠ ï¼Œæ•´ä¸ªæ•°æ®åŒ…è¢«ä¸¢å¼ƒçš„æ¦‚ç‡ä¹Ÿéšä¹‹å¢åŠ .ç”±æ­¤å¯è§ï¼Œå½“ä½ éœ€è¦å‘é€è¦ç»™256Kçš„æ•°æ®åŒ…çš„æ—¶å€™è¦å‘é€256ä¸ªåˆ†åŒ…ï¼Œå¦‚æœæœ‰ä¸€ä¸ªåˆ†åŒ…ä¸¢å¤±çš„è¯ï¼Œä½ å°±è¦é‡æ–°æŠŠè¿™ä¸ª256kçš„æ•°æ®åŒ…å†åˆ†ä¸€æ¬¡åŒ…ç„¶åå†å‘é€å‡ºå»ã€‚</p>
<h2 id="ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿå‘¢"><a href="#ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿå‘¢" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿå‘¢"></a>ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿå‘¢</h2><p>å› ä¸ºå‘é€å‡ºå»ä»¥åä¹Ÿä¸è®°å½•å‘é€çš„æ•°æ®åŒ…, éšç€åˆ†åŒ…æ•°é‡çš„å¢åŠ ï¼Œæ•´ä¸ªæ•°æ®åŒ…è¢«ä¸¢å¼ƒçš„æ¦‚ç‡ä¹Ÿéšä¹‹å¢åŠ , è€Œä¸€ä¸ªç‰‡æ®µçš„ä¸¢å¤±å°±ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®åŒ…éƒ½è¦è¢«ä¸¢å¼ƒæ‰.æ‰€ä»¥æˆ‘å»ºè®®ä½ è¦å°å¿ƒåˆ†åŒ…ä»¥åçš„æ•°é‡ã€‚</p>
<p><strong>è¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿæœ€å¥½æ˜¯åªå¯¹2-4ä¸ªåˆ†åŒ…çš„æƒ…å†µè¿›è¡Œä½¿ç”¨ï¼Œè€Œä¸”æœ€å¥½æ˜¯é’ˆå¯¹é‚£ç§å¯¹æ—¶é—´ä¸æ€ä¹ˆæ•æ„Ÿçš„æ•°æ®ä½¿ç”¨æˆ–è€…æ˜¯å°±ç®—åˆ†åŒ…lostäº†ä¹Ÿæ— æ‰€è°“çš„æƒ…å†µã€‚</strong>ç»å¯¹ä¸è¦åªæ˜¯ä¸ºäº†çœäº‹å°±æŠŠä¸€å¤§å †ä¾èµ–é¡ºåºçš„äº‹ä»¶æ‰“åˆ°ä¸€ä¸ªå¤§æ•°æ®åŒ…é‡Œé¢ç„¶åä¾èµ–æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„æœºåˆ¶è¿›è¡Œå‘é€ã€‚è¿™ä¼šè®©äº‹æƒ…å˜å¾—æ›´åŠ éº»çƒ¦ã€‚</p>
<p>æ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿçš„å…³é”®å¼±ç‚¹æ˜¯ä¸€ä¸ªç‰‡æ®µçš„ä¸¢å¤±å°±ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®åŒ…éƒ½è¦è¢«ä¸¢å¼ƒæ‰, æƒ³è¦è§£å†³è¿™ä¸ªå¼±ç‚¹å¾—ä½¿ç”¨å¤§å—æ•°æ®å‘é€ç­–ç•¥, è§ä¸‹ä¸€ç¯‡æ–‡ç«  <a href="/sending_large_blocks_of_data/" title="æ„å»ºæ¸¸æˆç½‘ç»œåè®®å››ä¹‹å‘é€å¤§å—æ•°æ®">æ„å»ºæ¸¸æˆç½‘ç»œåè®®å››ä¹‹å‘é€å¤§å—æ•°æ®</a>.</p>
<h2 id="æ¥æ”¶åˆ†åŒ…åçš„æ•°æ®åŒ…"><a href="#æ¥æ”¶åˆ†åŒ…åçš„æ•°æ®åŒ…" class="headerlink" title="æ¥æ”¶åˆ†åŒ…åçš„æ•°æ®åŒ…"></a>æ¥æ”¶åˆ†åŒ…åçš„æ•°æ®åŒ…</h2><p>ä¹‹æ‰€ä»¥å¯¹åˆ†åŒ…åçš„æ•°æ®åŒ…è¿›è¡Œæ¥æ”¶å¾ˆå›°éš¾çš„åŸå› æ˜¯æˆ‘ä»¬ä¸ä»…éœ€è¦ç»™ç¼“å†²åŒºå»ºç«‹ä¸€ä¸ªæ•°æ®ç»“æ„è¿˜è¦æŠŠè¿™äº›åˆ†åŒ…é‡ç»„æˆåŸå§‹çš„æ•°æ®åŒ…ï¼Œæˆ‘ä»¬ä¹Ÿè¦ç‰¹åˆ«å°å¿ƒå¦‚æœæœ‰äººè¯•å›¾è®©æˆ‘ä»¬çš„ç¨‹åºäº§ç”Ÿå´©æºƒè€Œç»™æˆ‘ä»¬å‘é€æ¶æ„çš„æ•°æ®åŒ…ã€‚</p>
<p>è¦éå¸¸å°å¿ƒæ£€æŸ¥ä¸€åˆ‡å¯èƒ½çš„æƒ…å†µã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„äº‹æƒ…è¦æ³¨æ„ï¼šè®©åˆ†åŒ…ä¿å­˜åœ¨ä¸€ä¸ªæ•°æ®ç»“æ„é‡Œé¢ï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…çš„æ‰€æœ‰åˆ†åŒ…éƒ½åˆ°è¾¾ä»¥åï¼ˆé€šè¿‡è®¡æ•°æ¥åˆ¤æ–­æ˜¯å¦å…¨éƒ¨åˆ°è¾¾ï¼‰ï¼Œå°†è¿™äº›åˆ†åŒ…é‡ç»„æˆä¸€ä¸ªå¤§çš„æ•°æ®åŒ…ï¼Œå¹¶æŠŠè¿™ä¸ªé‡ç»„åçš„å¤§æ•°æ®åŒ…è¿”å›ç»™æ¥æ”¶æ–¹ã€‚</p>
<p>ä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„åœ¨è¿™é‡Œæ˜¯æœ‰æ„ä¹‰çš„?è¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„æ•°æ®ç»“æ„!æˆ‘ä½¿ç”¨çš„æ˜¯ä¸€ç§æˆ‘å–œæ¬¢ç§°ä¹‹ä¸ºåºåˆ—ç¼“å†²åŒºçš„ä¸œè¥¿ã€‚æˆ‘æƒ³å’Œä½ åˆ†äº«çš„æœ€æ ¸å¿ƒçš„æŠ€å·§æ˜¯å¦‚ä½•è®©è¿™ä¸ªæ•°æ®ç»“æ„å˜å¾—é«˜æ•ˆï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const int MaxEntries = 256;</span><br><span class="line"> </span><br><span class="line">struct SequenceBuffer</span><br><span class="line">&#123;</span><br><span class="line">    bool exists[MaxEntries];</span><br><span class="line">    uint16_t sequence[MaxEntries];</span><br><span class="line">    Entry entries[MaxEntries];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h1 id="åŸæ–‡"><a href="#åŸæ–‡" class="headerlink" title="åŸæ–‡"></a>åŸæ–‡</h1><p><a href="https://gafferongames.com/post/packet_fragmentation_and_reassembly/" target="_blank" rel="noopener">åŸæ–‡å‡ºå¤„</a></p>
<p>åŸæ–‡æ ‡é¢˜ : <strong>Packet Fragmentation and Reassembly</strong> (<em>How to send and receive packets larger than MTU</em>)</p>
<hr>
<p></p><h2 id="introduction">Introduction</h2><p></p>
<p>Hi, Iâ€™m <a href="https://gafferongames.com/about" target="_blank" rel="noopener">Glenn Fiedler</a> and welcome to <strong><a href="https://gafferongames.com/categories/building-a-game-network-protocol/" target="_blank" rel="noopener">Building a Game Network Protocol</a></strong>.</p><br><p>In the <a href="https://gafferongames.com/post/serialization_strategies/" target="_blank" rel="noopener">previous article</a> we discussed how to unify packet read and write into a single serialize function and added a bunch of safety features to packet read.</p><br><p>Now we are ready to start putting interesting things in our packets and sending them over the network, but immediately we run into an interesting question: <em>how big should our packets be?</em></p><br><p>To answer this question properly we need a bit of background about how packets are actually sent over the Internet.</p><br><h2 id="background">Background</h2><br><p>Perhaps the most important thing to understand about the internet is that there&rsquo;s no direct connection between the source and destination IP address. What actually happens is that packets hop from one computer to another to reach their destination.</p><br><p>Each computer along this route enforces a maximum packet size called the maximum transmission unit, or MTU. According to the IP standard, if any computer recieves a packet larger than its MTU, it has the option of a) fragmenting that packet, or b) dropping the packet.</p><br><p>So here&rsquo;s how this usually goes down. People write a multiplayer game where the average packet size is quite small, lets say a few hundred bytes, but every now and then when a lot of stuff is happening in their game and a burst of packet loss occurs, packets get a lot larger than usual, going above MTU for the route, and suddenly all packets start getting dropped!</p><br><p>Just last year (2015) I was talking with Alex Austin at Indiecade about networking in his game <a href="http://subrosagame.com" target="_blank" rel="noopener">Sub Rosa</a>. He had this strange networking bug he couldn&rsquo;t reproduce. For some reason, players would randomly get disconnected from the game, but only when a bunch of stuff was going on. It was extremely rare and he was unable to reproduce it. Alex told me looking at the logs it seemed like <em>packets just stopped getting through</em>.</p><br><p>This sounded <em>exactly</em> like an MTU issue to me, and sure enough, when Alex limited his maximum packet size to a reasonable value the bug went away.</p><br><h2 id="mtu-in-the-real-world">MTU in the real world</h2><br><p>So what&rsquo;s a reasonable maximum packet size?</p><br><p>On the Internet today (2016, IPv4) the real-world MTU is 1500 bytes.</p><br><p>Give or take a few bytes for UDP/IP packet header and you&rsquo;ll find that the typical number before packets start to get dropped or fragmented is somewhere around 1472.</p><br><p>You can try this out for yourself by running this command on MacOS X:</p><br><pre>ping -g 56 -G 1500 -h 10 -D 8.8.4.4</pre><br><p>On my machine it conks out around just below 1500 bytes as expected:</p><br><pre>1404 bytes from 8.8.4.4: icmp_seq=134 ttl=56 time=11.945 ms<br>1414 bytes from 8.8.4.4: icmp_seq=135 ttl=56 time=11.964 ms<br>1424 bytes from 8.8.4.4: icmp_seq=136 ttl=56 time=13.492 ms<br>1434 bytes from 8.8.4.4: icmp_seq=137 ttl=56 time=13.652 ms<br>1444 bytes from 8.8.4.4: icmp_seq=138 ttl=56 time=133.241 ms<br>1454 bytes from 8.8.4.4: icmp_seq=139 ttl=56 time=17.463 ms<br>1464 bytes from 8.8.4.4: icmp_seq=140 ttl=56 time=12.307 ms<br>1474 bytes from 8.8.4.4: icmp_seq=141 ttl=56 time=11.987 ms<br>ping: sendto: Message too long<br>ping: sendto: Message too long<br>Request timeout for icmp_seq 142</pre><br><p>Why 1500? That&rsquo;s the default MTU for MacOS X. It&rsquo;s also the default MTU on Windows. So now we have an upper bound for your packet size assuming you actually care about packets getting through to Windows and Mac boxes without IP level fragmentation or a chance of being dropped: <strong>1472 bytes</strong>.</p><br><p>So what&rsquo;s the lower bound? Unfortunately for the routers in between your computer and the destination the IPv4 standard says <strong>576</strong>. Does this mean we have to limit our packets to 400 bytes or less? In practice, not really.</p><br><p>MacOS X lets me set MTU values in range 1280 to 1500 so considering packet header overhead, my first guess for a conservative lower bound on the IPv4 Internet today would be <strong>1200 bytes</strong>. Moving forward, in IPv6 this is also a good value, as any packet of 1280 bytes or less is guaranteed to get passed on without IP level fragmentation.</p><br><p>This lines up with numbers that I&rsquo;ve seen throughout my career. In my experience games rarely try anything complicated like attempting to discover path MTU, they just assume a reasonably conservative MTU and roll with that, something like 1000 to 1200 bytes of payload data. If a packet larger than this needs to be sent, it&rsquo;s split up into fragments by the game protocol and re-assembled on the other side.</p><br><p>And that&rsquo;s <em>exactly</em> what I&rsquo;m going to show you how to do in this article.</p><br><h2 id="fragment-packet-structure">Fragment Packet Structure</h2><br><p>Let&rsquo;s get started with implementation.</p><br><p>The first thing we need to decide is how we&rsquo;re going to represent fragment packets over the network so they are distinct from non-fragmented packets.</p><br><p>Ideally, we would like fragmented and non-fragmented packets to be compatible with the existing packet structure we&rsquo;ve already built, with as little overhead as possible in the common case when we are sending packets smaller than MTU.</p><br><p>Here&rsquo;s the packet structure from the previous article:</p><br><pre><del>[protocol id] (64 bits)</del> // not actually sent, but used to calc crc32<br>[crc32] (32 bits)<br>[packet type] (2 bits for 3 distinct packet types)<br>(variable length packet data according to packet type)<br>[end of packet serialize check] (32 bits)<br></pre><br><p>In our protocol we have three packet types: A, B and C.</p><br><p>Let&rsquo;s make one of these packet types generate really large packets:</p><br><pre>static const int MaxItems = 4096 * 4;<br><br>struct TestPacketB : public Packet<br>{<br>    int numItems;<br>    int items[MaxItems];<br><br>    TestPacketB() : Packet( TEST_PACKET_B )<br>    {<br>        numItems = random_int( 0, MaxItems );<br>        for ( int i = 0; i &lt; numItems; ++i )<br>            items[i] = random_int( -100, +100 );<br>    }<br><br>    template &lt;typename Stream&gt; bool Serialize( Stream &amp; stream )<br>    {<br>        serialize_int( stream, numItems, 0, MaxItems );<br>        for ( int i = 0; i &lt; numItems; ++i )<br>        {<br>            serialize_int( stream, items[i], -100, +100 );<br>        }<br>        return true;<br>    }<br>};<br></pre><br><p>This may seem somewhat contrived but these situations really do occur. For example, if you have a strategy where you send all un-acked events from server to client and you hit a burst of packet loss, you can easily end up with packets larger than MTU, even though your average packet size is quite small.</p><br><p>Another common case is delta encoded snapshots in a first person shooter. Here packet size is proportional to the amount of state changed between the baseline and current snapshots for each client. If there are a lot of differences between the snapshots the delta packet is large and there&rsquo;s nothing you can do about it except break it up into fragments and re-assemble them on the other side.</p><br><p>Getting back to packet structure. It&rsquo;s fairly common to add a sequence number at the header of each packet. This is just a packet number that increases with each packet sent. I like to use 16 bits for sequence numbers even though they wrap around in about 15 minutes @ 60 packets-per-second, because it&rsquo;s extremely unlikely that a packet will be delivered 15 minutes late.</p><br><p>Sequence numbers are useful for a bunch of things like acks, reliability and detecting and discarding out of order packets. In our case, we&rsquo;re going to use the sequence number to identify which packet a fragment belongs to:</p><br><pre><del>[protocol id] (64 bits)</del>   // not actually sent, but used to calc crc32<br>[crc32] (32 bits)<br><strong>[sequence] (16 bits)</strong><br>[packet type] (2 bits)<br>(variable length packet data according to packet type)<br>[end of packet serialize check] (32 bits)<br></pre><br><p>Here&rsquo;s the interesting part. Sure we could just add a bit <strong>is_fragment</strong> to the header, but then in the common case of non-fragmented packets you&rsquo;re wasting one bit that is always set to zero.</p><br><p>What I do instead is add a special fragment packet type:</p><br><pre>enum TestPacketTypes<br>{<br>    PACKET_FRAGMENT = 0,     // RESERVED<br>    TEST_PACKET_A,<br>    TEST_PACKET_B,<br>    TEST_PACKET_C,<br>    TEST_PACKET_NUM_TYPES<br>};<br></pre><br><p>And it just happens to be <em>free</em> because four packet types fit into 2 bits. Now when a packet is read, if the packet type is zero we know it&rsquo;s a fragment packet, otherwise we run through the ordinary, non-fragmented read packet codepath.</p><br><p>Lets design what this fragment packet looks like. We&rsquo;ll allow a maximum of 256 fragments per-packet and have a fragment size of 1024 bytes. This gives a maximum packet size of 256k that we can send through this system, which should be enough for anybody, but please don&rsquo;t quote me on this.</p><br><p>With a small fixed size header, UDP header and IP header a fragment packet be well under the conservative MTU value of 1200. Plus, with 256 max fragments per-packet we can represent a fragment id in the range [0,255] and the total number of fragments per-packet [1,256] with 8 bits.</p><br><pre><del>[protocol id] (32 bits)</del>   // not actually sent, but used to calc crc32<br>[crc32] (32 bits)<br>[sequence] (16 bits)<br>[packet type = 0] (2 bits)<br><strong>[fragment id] (8 bits)<br>[num fragments] (8 bits)<br>[pad zero bits to nearest byte index]<br>&lt;fragment data&gt;</strong><br></pre><br><p>Notice that we pad bits up to the next byte before writing out the fragment data. Why do this? Two reasons: 1) it&rsquo;s faster to copy fragment data into the packet via memcpy than bitpacking each byte, and 2) we can now save a small amount of bandwidth by inferring the fragment size by subtracting the start of the fragment data from the total size of the packet.</p><br><h2 id="sending-packet-fragments">Sending Packet Fragments</h2><br><p>Sending packet fragments is <em>easy</em>. For any packet larger than conservative MTU, simply calculate how many 1024 byte fragments it needs to be split into, and send those fragment packets over the network. Fire and forget!</p><br><p>One consequence of this is that if <em>any</em> fragment of that packet is lost then the entire packet is lost. It follows that if you have packet loss then sending a 256k packet as 256 fragments is not a very good idea, because the probability of dropping a packet increases significantly as the number of fragments increases. Not quite linearly, but in an interesting way that you can read more about <a href="https://www.fourmilab.ch/rpkp/experiments/statistics.html" target="_blank" rel="noopener">here</a>.</p><br><p>In short, to calculate the probability of losing a packet, you must calculate the probability of all fragments being delivered successfully and subtract that from one, giving you the probability that at least one fragment was dropped.</p><br><pre>1 - probability_of_fragment_being_delivered ^ num_fragments<br></pre><br><p>For example, if we send a non-fragmented packet over the network with 1% packet loss, there is naturally a <sup>1</sup>&frasl;<sub>100</sub> chance the packet will be dropped.</p><br><p>As the number of fragments increase, packet loss is amplified:<br><ul><br><li>Two fragments: 1 - (<sup>99</sup>&frasl;<sub>100</sub>) ^ 2 = <strong>2%</strong></li><br><li>Ten fragments: 1 - (<sup>99</sup>&frasl;<sub>100</sub>) ^ 10 = <strong>9.5%</strong></li><br><li>100 fragments: 1 - (<sup>99</sup>&frasl;<sub>100</sub>) ^ 100 = <strong>63.4%</strong></li><br><li>256 fragments: 1 - (<sup>99</sup>&frasl;<sub>100</sub>) ^ 256 = <strong>92.4%</strong></li><br></ul></p><br><p>So I recommend you take it easy with the number of fragments. It&rsquo;s best to use this strategy only for packets in the 2-4 fragment range, and only for time critical data that doesn&rsquo;t matter too much if it gets dropped. It&rsquo;s <em>definitely not</em> a good idea to fire down a bunch of reliable-ordered events in a huge packet and rely on packet fragmentation and reassembly to save your ass.</p><br><p>Another typical use case for large packets is when a client initially joins a game. Here you usually want to send a large block of data down reliably to that client, for example, representing the initial state of the world for late join. Whatever you do, don&rsquo;t send that block of data down using the fragmentation and re-assembly technique in this article.</p><br><p>Instead, check out the technique in <a href="https://gafferongames.com/post/sending-large-blocks-of-data.html" target="_blank" rel="noopener">next article</a> which handles packet loss by resending fragments until they are all received.</p><br><h2 id="receiving-packet-fragments">Receiving Packet Fragments</h2><br><p>It&rsquo;s time to implement the code that receives and processed packet fragments. This is a bit tricky because we have to be particularly careful of somebody trying to attack us with malicious packets.</p><br><p>Here&rsquo;s a list of all the ways I can think of to attack the protocol:</p><br><ul><br><li><p>Try to send out of bound fragments ids trying to get you to crash memory. eg: send fragments [0,255] in a packet that has just two fragments.</p></li><br><li><p>Send packet n with some maximum fragment count of say 2, and then send more fragment packets belonging to the same packet n but with maximum fragments of 256 hoping that you didn&rsquo;t realize I widened the maximum number of fragments in the packet after the first one you received, and you trash memory.</p></li><br><li><p>Send really large fragment packets with fragment data larger than 1k hoping to get you to trash memory as you try to copy that fragment data into the data structure, or blow memory budget trying to allocate fragments</p></li><br><li><p>Continually send fragments of maximum size (<sup>256</sup>&frasl;<sub>256</sub> fragments) in hope that it I could make you allocate a bunch of memory and crash you out. Lets say you have a sliding window of 256 packets, 256 fragments per-packet max, and each fragment is 1k. That&rsquo;s 64 mb per-client.</p></li><br><li><p>Can I fragment the heap with a bunch of funny sized fragment packets sent over and over? Perhaps the server shares a common allocator across clients and I can make allocations fail for other clients in the game because the heap becomes fragmented.</p></li><br></ul><br><p>Aside from these concerns, implementation is reasonably straightforward: store received fragments somewhere and when all fragments arrive for a packet, reassemble them into the original packet and return that to the user.</p><br><h2 id="data-structure-on-receiver-side">Data Structure on Receiver Side</h2><br><p>The first thing we need is some way to store fragments before they are reassembled. My favorite data structure is something I call a <em>sequence buffer</em>:</p><br><pre>const int MaxEntries = 256;<br><br>struct SequenceBuffer<br>{<br>    uint32_t sequence[MaxEntries];<br>    Entry entries[MaxEntries];<br>};<br></pre><br><p>Indexing into the arrays is performed with modulo arithmetic, giving us a fast O(1) lookup of entries by sequence number:</p><br><pre>const int index = sequence % MaxEntries;<br></pre><br><p>A sentinel value of 0xFFFFFFFF is used to represent empty entries. This value cannot possibly occur with 16 bit sequence numbers, thus providing us with a fast test to see if an entry exists for a given sequence number, without an additional branch to test if that entry exists.</p><br><p>This data structure is used as follows. When the first fragment of a new packet comes in, the sequence number is mapped to an entry in the sequence buffer. If an entry doesn&rsquo;t exist, it&rsquo;s added and the fragment data is stored in there, along with information about the fragment, eg. how many fragments there are, how many fragments have been received so far, and so on.</p><br><p>Each time a new fragment arrives, it looks up the entry by the packet sequence number. When an entry already exists, the fragment data is stored and number of fragments received is incremented. Eventually, once the number of fragments received matches the number of fragments in the packet, the packet is reassembled and delivered to the user.</p><br><p>Since it&rsquo;s possible for old entries to stick around (potentially with allocated blocks), great care must be taken to clean up any stale entries when inserting new entries in the sequence buffer. These stale entries correspond to packets that didn&rsquo;t receive all fragments.</p><br><p>And that&rsquo;s basically it at a high level. For further details on this approach please refer to the example source code for this article. </p><br><p><a href="https://www.patreon.com/gafferongames" target="_blank" rel="noopener">Click here to get the example source code for this article series</a>.</p><br><h2 id="test-driven-development">Test Driven Development</h2><br><p>One thing I&rsquo;d like to close this article out on.</p><br><p>Writing a custom UDP network protocol is <em>hard</em>. It&rsquo;s so hard that even though I&rsquo;ve done this from scratch at least 10 times, each time I still manage to fuck it up in a new and exciting ways. You&rsquo;d think eventually I&rsquo;d learn, but this stuff is complicated. You can&rsquo;t just write low-level netcode and expect it to just work.</p><br><p>You have to test it!</p><br><p>My strategy when testing low-level netcode is as follows:</p><br><ul><br><li><p>Code defensively. Assert everywhere. These asserts will fire and they&rsquo;ll be important clues you need when something goes wrong.</p></li><br><li><p>Add functional tests and make sure stuff is working as you are writing it. Put your code through its paces at a basic level as you write it and make sure it&rsquo;s working as you build it up. Think hard about the essential cases that need to be property handled and add tests that cover them.</p></li><br><li><p>But just adding a bunch of functional tests is not enough. There are of course cases you didn&rsquo;t think of! Now you have to get really mean. I call this soak testing and I&rsquo;ve never, not even once, have coded a network protocol that hasn&rsquo;t subsequently had problems found in it by soak testing.</p></li><br><li><p>When soak testing just loop forever and just do a mix of random stuff that puts your system through its paces, eg. random length packets in this case with a huge amount of packet loss, out of order and duplicates through a packet simulator. Your soak test passes when it runs overnight and doesn&rsquo;t hang or assert.</p></li><br><li><p>If you find anything wrong with soak testing. You may need to go back and add detailed logs to the soak test to work out how you got to the failure case. Once you know what&rsquo;s going on, stop. Don&rsquo;t fix it immediately and just run the soak test again.</p></li><br><li><p>Instead, add a unit test that reproduces that problem you are trying to fix, verify your test reproduces the problem, and that it problem goes away with your fix. Only after this, go back to the soak test and make sure they run overnight. This way the unit tests document the correct behavior of your system and can quickly be run in future to make sure you don&rsquo;t break this thing moving forward when you make other changes.</p></li><br><li><p>Add a bunch of logs. High level errors, info asserts showing an overview of what is going on, but also low-level warnings and debug logs that show what went wrong after the fact. You&rsquo;re going to need these logs to diagnose issues that don&rsquo;t occur on your machine. Make sure the log level can be adjusted dynamically.</p></li><br><li><p>Implement network simulators and make sure code handles the worst possible network conditions imaginable. 99% packet loss, 10 seconds of latency and +/- several seconds of jitter. Again, you&rsquo;ll be surprised how much this uncovers. Testing is the time where you want to uncover and fix issues with bad network conditions, not the night before your open beta.</p></li><br><li><p>Implement fuzz tests where appropriate to make sure your protocol doesn&rsquo;t crash when processing random packets. Leave fuzz tests running overnight to feel confident that your code is reasonably secure against malicious packets and doesn&rsquo;t crash.</p></li><br><li><p>Surprisingly, I&rsquo;ve consistently found issues that only show up when I loop the set of unit tests over and over, perhaps these issues are caused by different random numbers in tests, especially with the network simulator being driven by random numbers. This is a great way to take a rare test that fails once every few days and make it fail every time. So before you congratulate yourself on your tests passing 100%, add a mode where your unit tests can be looped easily, to uncover such errors.</p></li><br><li><p>Test simultaneously on multiple platforms. I&rsquo;ve never written a low-level library that worked first time on MacOS, Windows and Linux. There are always interesting compiler specific issues and crashes. Test on multiple platforms as you develop, otherwise it&rsquo;s pretty painful fixing all these at the end.</p></li><br><li><p>This about how people can attack the protocol. Implement code to defend against these attacks. Add functional tests that mimic these attacks and make sure that your code handles them correctly.</p></li><br></ul><br><p>This is my process and it seems to work pretty well. If you are writing a low-level network protocol, the rest of your game depends on this code working correctly. You need to be absolutely sure it works before you build on it, otherwise it&rsquo;s basically a stack of cards.</p><br><p>In my experience, game neworking is hard enough without having suspicions that that your low-level network protocol has bugs that only show up under extreme network conditions. That&rsquo;s exactly where you need to be able to trust your code works correctly. <strong>So test it!</strong></p>



<h1 id="è¯‘æ–‡">è¯‘æ–‡</h1>


<p><a href="http://gad.qq.com/program/translateview/7164496" target="_blank" rel="noopener">è¯‘æ–‡å‡ºå¤„</a></p>
<div class="WordSection1"><b><span style="font-family:å¾®è½¯é›…é»‘;"><span style="color: rgb(34, 34, 34); font-size: 12pt;">è¯‘è€…ï¼šå´”å˜‰è‰º</span><span style="color: rgb(34, 34, 34); font-size: 12pt;">(milan21) </span><span style="color: rgb(34, 34, 34); font-size: 12pt;">å®¡æ ¡ï¼šå´”å›½å†›ï¼ˆæ˜Ÿé™…è¿·èˆªï¼‰</span></span></b><div><span style="color: rgb(34, 34, 34); font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></div><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ ¼ä¼¦Â·è²å¾·å‹’ã€‚æ¬¢è¿å¤§å®¶é˜…è¯»ç³»åˆ—æ•™ç¨‹ã€Šæ„å»ºæ¸¸æˆç½‘ç»œåè®®ã€‹çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ã€‚</span><span style="color: rgb(34, 34, 34); font-size: 12pt;">åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•å°†æ•°æ®åŒ…çš„è¯»å–å’Œå†™å…¥ç”¨ä¸€ä¸ªå•ç‹¬çš„åºåˆ—åŒ–å‡½æ•°æ¥å®ç°ã€‚</span></span></p><p class="MsoNormal" align="left"><span style="color: rgb(34, 34, 34); font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç°åœ¨æˆ‘ä»¬è¦å¼€å§‹æŠŠä¸€äº›æœ‰è¶£çš„äº‹æƒ…æ”¾åˆ°è¿™äº›æ•°æ®åŒ…ä¸­ï¼Œ<span>,</span>ä½†æ­£å¦‚ä½ å³å°†å¼€å§‹ç¼–ç çš„ä»¤äººæƒŠå¹çš„å¤šäººåœ¨çº¿åŠ¨ä½œã€ç¬¬ä¸€äººç§°å°„å‡»ã€å¤§å‹å¤šäººåœ¨çº¿è§’è‰²æ‰®æ¼”æ¸¸æˆã€å¤šäººåœ¨çº¿æˆ˜æœ¯ç«æŠ€æ¸¸æˆä¼šå‘ç”Ÿçš„é‚£æ ·ï¼Œå½“ä½ ä»¥æ¯ç§’<span>120</span>æ¬¡çš„é¢‘ç‡å‘é€<span>8k</span>å¤§å°çš„æ•°æ®åŒ…ï¼Œæ¸¸æˆç½‘ç»œä¸­ä¼šä¼ æ¥ä¸€ä¸ªå£°éŸ³å‘¼å–Šç€ä½ <span>:</span></span><span style="font-size: 12pt; color: rgb(34, 34, 34);">â€œ</span><span style="font-size: 12pt; color: rgb(34, 34, 34);">ä¸è¦å‘é€è¶…è¿‡<span>1200</span>å­—èŠ‚å¤§å°çš„æ•°æ®åŒ…<span>!â€</span></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä½†æ˜¯éƒ½å·²ç»<span>2016</span>å¹´äº†ï¼Œä½ çœŸçš„è¦æ³¨æ„æœ€å¤§ä¼ è¾“å•å…ƒè¿™ä¸ªä¸œè¥¿ä¹ˆ<span>?</span></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸å¹¸çš„æ˜¯ï¼Œç­”æ¡ˆæ˜¯æ˜¯çš„ï¼</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><h2 id="æœ€å¤§ä¼ è¾“å•å…ƒMTU"><span style="font-family:å¾®è½¯é›…é»‘;">æœ€å¤§ä¼ è¾“å•å…ƒMTU</span></h2><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä½ å¯èƒ½å·²ç»å¬è¯´è¿‡æœ€å¤§ä¼ è¾“å•å…ƒäº†ã€‚åœ¨ç½‘ç»œç¨‹åºå‘˜ä¸­æµä¼ ç€å¤§é‡æœ‰å…³æœ€å¤§ä¼ è¾“å•å…ƒé—®é¢˜çš„æ•…äº‹ã€‚é‚£ä¹ˆè¿™åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿç©¶ç«Ÿä»€ä¹ˆæ˜¯æœ€å¤§ä¼ è¾“å•å…ƒ<span>?</span>ä¸ºä»€ä¹ˆä½ è¦åœ¨ä¹æœ€å¤§ä¼ è¾“å•å…ƒè¿™ä¸ªäº‹æƒ…ï¼Ÿ</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">å½“ä½ é€šè¿‡äº’è”ç½‘æ¥å‘é€æ•°æ®åŒ…çš„æ—¶å€™åˆ°åº•èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿè¿™äº›æ•°æ®åŒ…è¦ä»ä¸€å°è®¡ç®—æœº<span>(</span>è·¯ç”±å™¨<span>)</span>è·³åˆ°å¦ä¸€ä¸ªè®¡ç®—æœº<span>(</span>è·¯ç”±å™¨<span>)</span>ä¸Šï¼Œå¦‚æ­¤å¾€å¤å¤šæ¬¡æ‰èƒ½åˆ°è¾¾è‡ªå·±çš„ç›®çš„åœ°ã€‚è¿™æ˜¯ä¸€ä¸ªåˆ†ç»„äº¤æ¢ç½‘ç»œå…·ä½“å¦‚ä½•è¿ä½œçš„æ–¹å¼ã€‚åœ¨å¤§éƒ¨åˆ†æ—¶é—´é‡Œï¼Œå®ƒçš„å·¥ä½œæ–¹å¼ä¸åƒæ˜¯åœ¨æºå’Œç›®çš„åœ°ä¹‹é—´å­˜åœ¨ä¸€æ¡ç›´æ¥çš„è¿æ¥ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä½†æ„å¤–çš„æ˜¯ï¼šæ¯å°è®¡ç®—æœº<span>(</span>è·¯ç”±å™¨<span>)</span>ä¼šæ²¿ç€è·¯ç”±å¼ºåˆ¶è¦æ±‚æ•°æ®åŒ…çš„å¤§å°ä¼šæœ‰ä¸€ä¸ªæœ€å¤§çš„ä¸Šé™ï¼Œè¿™ä¸ªä¸Šé™å°±æ˜¯æ‰€è°“çš„æœ€å¤§ä¼ è¾“å•å…ƒã€‚å¦‚æœä»»æ„ä¸€ä¸ªè·¯ç”±å™¨æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…çš„å¤§å°è¶…è¿‡è¿™ä¸ªæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œå®ƒæœ‰è¿™ä¹ˆä¸¤ä¸ªé€‰æ‹©ï¼Œ<span>a)</span>åœ¨<span>IP</span>å±‚å¯¹è¿™ä¸ªæ•°æ®åŒ…è¿›è¡Œåˆ†åŒ…ï¼Œå¹¶å°†åˆ†åŒ…åçš„æ•°æ®åŒ…ç»§ç»­ä¼ é€’ï¼Œ<span>b)</span>ä¸¢å¼ƒè¿™ä¸ªæ•°æ®åŒ…ç„¶åå‘Šè¯‰ä½ æ•°æ®åŒ…è¢«ä¸¢å¼ƒäº†ï¼Œä½ è‡ªå·±è´Ÿè´£æ‘†å¹³è¿™ä¸ªé—®é¢˜ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™å„¿æœ‰ä¸€ä¸ªæˆ‘ä¼šç»å¸¸é‡åˆ°çš„æƒ…å†µã€‚äººä»¬åœ¨ç¼–å†™å¤šäººåœ¨çº¿æ¸¸æˆçš„æ—¶å€™ï¼Œæ•°æ®åŒ…çš„å¹³å‡å¤§å°éƒ½ä¼šéå¸¸çš„å°ï¼Œè®©æˆ‘ä»¬å‡è®¾ä¸‹ï¼Œè¿™äº›æ•°æ®åŒ…çš„å¹³å‡å¤§å°å¤§æ¦‚åªæœ‰å‡ ç™¾å­—èŠ‚ï¼Œä½†æ—¶ä¸æ—¶ä¼šåœ¨ä»–ä»¬çš„æ¸¸æˆä¸­åŒæ—¶å‘ç”Ÿå¤§é‡çš„äº‹æƒ…å¹¶ä¸”å‘å‡ºå»çš„æ•°æ®åŒ…ä¼šå‡ºç°ä¸¢å¤±çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™æ•°æ®åŒ…ä¼šæ¯”é€šå¸¸çš„æƒ…å†µä¸‹è¦å¤§ã€‚çªç„¶ä¹‹é—´ï¼Œæ¸¸æˆçš„æ•°æ®åŒ…çš„å¤§å°å°±ä¼šè¶…è¿‡æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œè¿™æ ·å°±åªæœ‰å¾ˆå°‘ä¸€éƒ¨åˆ†ç©å®¶èƒ½å¤Ÿæ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…ï¼Œç„¶åæ•´ä¸ªé€šä¿¡å°±å´©æºƒäº†ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span><br></span>å°±åœ¨å»å¹´<span>(2015</span>å¹´<span>)</span>ï¼Œæˆ‘ä¸äºšå†å…‹æ–¯<span>Â·</span>å¥¥æ–¯æ±€åœ¨<span>Indiecade</span>è°ˆè®ºä»–çš„æ¸¸æˆ<span>â€ </span></span><span><a rel="noopener" href="http://subrosagame.com/" target="_blank"><span style="font-size: 12pt; color: rgb(34, 34, 34); text-decoration: none;">Sub Rosa</span></a></span><span style="font-size: 12pt; color: rgb(34, 34, 34);"> â€œ</span><span style="font-size: 12pt; color: rgb(34, 34, 34);">ä¸­çš„ç½‘ç»œéƒ¨åˆ†ã€‚ä»–é‡åˆ°äº†ä¸€äº›å¥‡æ€ªçš„æ— æ³•é‡ç°çš„ç½‘ç»œ<span>bug</span>ã€‚å‡ºäºæŸç§åŸå› ï¼Œä¸€äº›å®¢æˆ·ç«¯ï¼ˆåœ¨æ‰€æœ‰ç©å®¶é‡Œé¢æ€»æ˜¯æœ‰é‚£ä¹ˆä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªï¼‰ä¼šéšæœºçš„ä»æ¸¸æˆä¸­æ–­å¼€è¿æ¥å¹¶ä¸”å…¶ä»–äººéƒ½èƒ½å¤Ÿæ­£å¸¸æ¸¸æˆã€‚æŸ¥çœ‹æ—¥å¿—çš„è¯ï¼Œäºšå†å…‹æ–¯åˆè§‰å¾—ä¸€åˆ‡éƒ½æ˜¯æ­£å¸¸çš„ï¼Œåªæ˜¯çœ‹ä¸Šå»å¥½åƒæ•°æ®åŒ…çªç„¶åœæ­¢è¿›è¡Œä¼ é€’äº†ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><span><br></span>å¯¹æˆ‘æ¥è¯´ï¼Œè¿™å¬ä¸Šå»å°±åƒæ˜¯ä¸€ä¸ªæœ€å¤§ä¼ è¾“å•å…ƒæ‰€å¼•èµ·çš„é—®é¢˜ï¼Œå¹¶ä¸”æˆ‘éå¸¸ç¡®ä¿¡ã€‚å½“äºšå†å…‹æ–¯æŠŠä»–æœ€å¤§çš„æ•°æ®åŒ…å¤§å°é™åˆ¶åœ¨ä¸€ä¸ªåˆç†çš„å€¼ä¹‹å†…ï¼Œè¿™ä¸ª<span>bug</span>å°±å†ä¹Ÿæ²¡æœ‰å‡ºç°äº†ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><h2 id="çœŸå®ä¸–ç•Œä¸­çš„æœ€å¤§ä¼ è¾“å•å…ƒMTU"><span style="font-family:å¾®è½¯é›…é»‘;">çœŸå®ä¸–ç•Œä¸­çš„æœ€å¤§ä¼ è¾“å•å…ƒMTU</span></h2><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">æ‰€ä»¥ä»€ä¹ˆæ˜¯â€œä¸€ä¸ªåˆç†çš„æ•°æ®åŒ…çš„å¤§å°â€ï¼Ÿ</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">åœ¨ä»Šå¤©çš„äº’è”ç½‘ä¸Š<span>(2016</span>å¹´ï¼Œè¿˜æ˜¯åŸºäº<span>IPv4)</span>ï¼Œå…¸å‹çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°æ˜¯<span>1500</span>å­—èŠ‚ã€‚åœ¨<span>UDP/IP</span>æ•°æ®åŒ…çš„åŒ…å¤´æ·»åŠ æˆ–è€…å»æ‰å‡ ä¸ªå­—èŠ‚ï¼Œä½ ä¼šå‘ç°åœ¨æ•°æ®åŒ…å¼€å§‹å‡ºç°è¢«ä¸¢å¼ƒæˆ–è€…è¢«åˆ†åŒ…æƒ…å†µçš„ä¸€ä¸ªå…¸å‹çš„è¾¹ç•Œå€¼æ˜¯<span>1472</span>ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä½ å¯ä»¥è‡ªå·±åœ¨<span>MacOS X</span>å°è¯•è¿è¡Œä¸‹ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼š</span></span></p><div style="border:solid #F0F0F0 1.0pt;border-left:solid #E0E0E0 2.25pt;padding:0cm 0cm 0cm 0cm;background:whitesmoke"><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ping-g 56 -G 1500 -h 10 -D 8.8.4.4</span></span></p></div><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œè¿™ä¸ªç»“æœåœ¨ç•¥å¾®ä½äº<span>1500</span>å­—èŠ‚çš„å¤§å°ä¸Šä¸‹æµ®åŠ¨ï¼Œç¬¦åˆé¢„æœŸï¼š</span></span></p><div style="border:solid #F0F0F0 1.0pt;border-left:solid #E0E0E0 2.25pt;padding:0cm 0cm 0cm 0cm;background:whitesmoke"><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1404bytes from 8.8.4.4: icmp_seq=134 ttl=56 time=11.945 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1414bytes from 8.8.4.4: icmp_seq=135 ttl=56 time=11.964 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1424bytes from 8.8.4.4: icmp_seq=136 ttl=56 time=13.492 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1434bytes from 8.8.4.4: icmp_seq=137 ttl=56 time=13.652 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1444bytes from 8.8.4.4: icmp_seq=138 ttl=56 time=133.241 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1454bytes from 8.8.4.4: icmp_seq=139 ttl=56 time=17.463 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1464bytes from 8.8.4.4: icmp_seq=140 ttl=56 time=12.307 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1474bytes from 8.8.4.4: icmp_seq=141 ttl=56 time=11.987 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ping:sendto: Message too long</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ping:sendto: Message too long</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">Requesttimeout for icmp_seq 142</span></span></p></div><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸ºä»€ä¹ˆæ˜¯<span>1500</span>å­—èŠ‚ï¼Ÿè¿™æ˜¯<span>MacOS X</span>ä¸Šé»˜è®¤çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ã€‚è¿™ä¹Ÿæ˜¯<span>Windows</span>å¹³å°ä¸Šé»˜è®¤çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ã€‚æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å¯¹æ•°æ®åŒ…çš„å¤§å°æœ‰äº†ä¸€ä¸ªä¸Šé™ï¼ˆä¹Ÿå°±æ˜¯ä¸èƒ½è¶…è¿‡è¿™ä¸ªé»˜è®¤çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼‰ï¼Œå‡å¦‚ä½ çœŸçš„å…³å¿ƒæ•°æ®åŒ…é€šè¿‡<span>Windows</span>å¹³å°æˆ–è€…<span>Mac</span>å¹³å°è¿›è¡Œä¼ æ’­è€Œä¸å¸Œæœ›æ•°æ®åŒ…åœ¨<span>IP</span>å±‚è¿›è¡Œåˆ†åŒ…æˆ–è€…æœ‰è¢«ä¸¢å¼ƒçš„å¯èƒ½çš„è¯ï¼Œé‚£ä¹ˆå°±è¦ä¿è¯æ•°æ®åŒ…çš„å¤§å°ä¸èƒ½è¶…è¿‡è¿™ä¸ªä¸Šé™ï¼š<span>1472</span>ä¸ªå­—èŠ‚ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">é‚£ä¹ˆè¿™ä¸ªæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°çš„ä¸‹é™æ˜¯å¤šå°‘å‘¢ï¼Ÿ<span>MacOS X</span>å…è®¸è®¾ç½®çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°çš„å€¼æ˜¯åœ¨<span>1280</span>åˆ°<span>1500</span>ï¼Œæ‰€ä»¥æˆ‘å¯¹ç°åœ¨äº’è”ç½‘ä¸Šé€šè¿‡<span>IPv4</span>è¿›è¡Œä¼ æ’­çš„æ•°æ®åŒ…çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°çš„ä¸‹é™æœ‰ä¸€ä¸ªæ¯”è¾ƒä¿å®ˆçš„ä¼°è®¡ï¼Œå°±æ˜¯<span>1200</span>å­—èŠ‚ã€‚å¦‚æœæ˜¯åœ¨é€šè¿‡<span>IPv4</span>è¿›è¡Œä¼ æ’­çš„æƒ…å†µä¸‹è¿™ä¸ªæ¯”è¾ƒä¿å®ˆçš„å¤§ä¼ è¾“å•å…ƒçš„å¤§å°çš„ä¸‹é™ä¹Ÿä¼šæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¼°è®¡å€¼ï¼Œä»»æ„æ•°æ®åŒ…åªè¦å¤§å°å°äº<span>1280</span>å­—èŠ‚éƒ½èƒ½ä¿è¯åœ¨æ²¡æœ‰<span>IP</span>å±‚åˆ†åŒ…çš„æƒ…å†µä¸‹é¡ºåˆ©çš„ä¼ æ’­ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™ä¸ªä¼°è®¡ä¸æˆ‘åœ¨èŒä¸šç”Ÿæ¶¯ä¸­æ„Ÿå—åˆ°çš„æƒ…å†µæ˜¯æ¯”è¾ƒä¸€è‡´çš„ã€‚ä»¥æˆ‘çš„ç»éªŒæ¥çœ‹ï¼Œå¾ˆå°‘æœ‰æ¸¸æˆä¼šè¯•å›¾åšè¿™äº›å¤æ‚çš„äº‹æƒ…ï¼Œè¯¸å¦‚å°è¯•å‘ç°è·¯å¾„ä¸Šçš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ä¹‹ç±»çš„ï¼Œå®ƒä»¬ä¸€èˆ¬éƒ½æ˜¯å‡å®šä¸€ä¸ªåˆç†åˆä¿å®ˆçš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ç„¶åä¸€ç›´éµå¾ªè¿™ä¸ªå€¼ã€‚å¦‚æœå‡ºç°ä¸€ä¸ªè¦å‘é€çš„æ•°æ®åŒ…æ¯”è¿™ä¸ªä¿å®ˆçš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°è¦å¤§çš„æƒ…å†µï¼Œæ¸¸æˆåè®®ä¼šå°†è¿™ä¸ªæ•°æ®åŒ…åˆ†æˆå‡ ä¸ªåŒ…ç„¶ååœ¨ç½‘ç»œçš„å¦å¤–ä¸€ä¾§è¿›è¡Œé‡ç»„ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è€Œè¿™æ­£æ˜¯æˆ‘è¦åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢è¦å‘ä½ ä¼ æˆçš„å†…å®¹ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="åˆ†åŒ…åçš„æ•°æ®åŒ…çš„ç»“æ„"><span style="color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;font-size:x-large;">åˆ†åŒ…åçš„æ•°æ®åŒ…çš„ç»“æ„</span></span></h2><p></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è®©æˆ‘ä»¬ä»å†³å®šè¯¥å¯¹ç½‘ç»œä¸Šä¼ è¾“çš„æ•°æ®åˆ†åŒ…åé‡‡ç”¨ä»€ä¹ˆçš„ç»“æ„è¿›è¡Œè¡¨ç¤ºæ¥å¼€å§‹æ„å»ºæˆ‘ä»¬çš„æ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„æœºåˆ¶ã€‚åœ¨ç†æƒ³çŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…å’Œæœªåˆ†åŒ…çš„æ•°æ®åŒ…å…¼å®¹æˆ‘ä»¬ç°åœ¨å·²ç»å»ºç«‹å¥½çš„æ•°æ®åŒ…ç»“æ„ï¼Œè¿™æ ·å½“æˆ‘ä»¬å‘é€å°äºæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°çš„æ•°æ®åŒ…çš„æ—¶å€™ï¼Œç½‘ç»œåè®®æ²¡æœ‰ä»»ä½•å¤šä½™çš„è´Ÿè½½ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸‹é¢æ˜¯åœ¨å‰ä¸€ç¯‡æ–‡ç« ç»“æŸçš„æ—¶å€™å¾—åˆ°çš„æ•°æ®åŒ…çš„ç»“æ„ï¼š</span></span></p><br><br><pre><del>[protocol id] (64 bits)</del> // not actually sent, but used to calc crc32<br>[crc32] (32 bits)<br>[packet type] (2 bits for 3 distinct packet types)<br>(variable length packet data according to packet type)<br>[end of packet serialize check] (32 bits)<br></pre><br><br><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¹‹ä¸­ï¼Œæˆ‘ä»¬ä¸€å…±æœ‰ä¸‰ä¸ªæ•°æ®åŒ…çš„ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ï¼¡ã€ï¼¢å’Œï¼£ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è®©æˆ‘ä»¬ç”¨è¿™ä¸‰ä¸ªæ•°æ®åŒ…ç±»å‹ä¸­çš„ä¸€ä¸ªåˆ¶é€ ä¸€ä¸ªæ¯”æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°è¿˜è¦å¤§ä¸€äº›çš„æ•°æ®åŒ…ï¼š</span></span></p><div><div id="highlighter_44479" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">1</span></div><div class="line number2 index1 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">2</span></div><div class="line number3 index2 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">3</span></div><div class="line number4 index3 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">4</span></div><div class="line number5 index4 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">5</span></div><div class="line number6 index5 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">6</span></div><div class="line number7 index6 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">7</span></div><div class="line number8 index7 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">8</span></div><div class="line number9 index8 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">9</span></div><div class="line number10 index9 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">10</span></div><div class="line number11 index10 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">11</span></div><div class="line number12 index11 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">12</span></div><div class="line number13 index12 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">13</span></div><div class="line number14 index13 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">14</span></div><div class="line number15 index14 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">15</span></div><div class="line number16 index15 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">16</span></div><div class="line number17 index16 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">17</span></div><div class="line number18 index17 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">18</span></div><div class="line number19 index18 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">19</span></div><div class="line number20 index19 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">20</span></div><div class="line number21 index20 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">21</span></div><div class="line number22 index21 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">22</span></div><div class="line number23 index22 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">23</span></div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp keyword bold">static</code> <code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">MaxItems = 4096 * 4;</code></span></div><div class="line number2 index1 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></div><div class="line number3 index2 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp keyword bold">struct</code> <code class="cpp plain">TestPacketB : </code><code class="cpp keyword bold">public</code> <code class="cpp plain">protocol2::Packet</code></span></div><div class="line number4 index3 alt1"><code class="cpp plain"><span style="font-family:å¾®è½¯é›…é»‘;">{</span></code></div><div class="line number5 index4 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">numItems;</code></span></div><div class="line number6 index5 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">items[MaxItems];</code></span></div><div class="line number7 index6 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></div><div class="line number8 index7 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">TestPacketB() : Packet( TEST_PACKET_B )</code></span></div><div class="line number9 index8 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">{</code></span></div><div class="line number10 index9 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">        </code><code class="cpp plain">numItems = random_int( 0, MaxItems );</code></span></div><div class="line number11 index10 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">        </code><code class="cpp keyword bold">for</code> <code class="cpp plain">( </code><code class="cpp color1 bold">int</code> <code class="cpp plain">i = 0; i &lt; numItems; ++i )</code></span></div><div class="line number12 index11 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">            </code><code class="cpp plain">items[i] = random_int( -100, +100 );</code></span></div><div class="line number13 index12 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">}</code></span></div><div class="line number14 index13 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></div><div class="line number15 index14 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp keyword bold">template</code> <code class="cpp plain">&lt;</code><code class="cpp keyword bold">typename</code> <code class="cpp plain">stream</code><code class="cpp string"></code><code class="cpp plain">&gt; </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">Serialize( Stream &amp; stream )</code></span></div><div class="line number16 index15 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">{</code></span></div><div class="line number17 index16 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">        </code><code class="cpp plain">serialize_int( stream, numItems, 0, MaxItems );</code></span></div><div class="line number18 index17 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">        </code><code class="cpp keyword bold">for</code> <code class="cpp plain">( </code><code class="cpp color1 bold">int</code> <code class="cpp plain">i = 0; i &lt; numItems; ++i )</code></span></div><div class="line number19 index18 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">            </code><code class="cpp plain">serialize_int( stream, items[i], -100, +100 );</code></span></div><div class="line number20 index19 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></div><div class="line number21 index20 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp keyword bold">true</code><code class="cpp plain">;</code></span></div><div class="line number22 index21 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">}</code></span></div><div class="line number23 index22 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp plain">};</code><code class="cpp keyword bold"></code><code class="cpp plain"></code></span></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™å¯èƒ½çœ‹èµ·æ¥ä¸æ€ä¹ˆè‡ªç„¶ï¼Œä½†åœ¨ç°å®ä¸–ç•Œä¸­è¿™äº›æƒ…å†µçœŸçš„ä¼šå‘ç”Ÿã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥æ˜¯ä»æœåŠ¡å™¨å¾€å®¢æˆ·ç«¯å‘é€æ‰€æœ‰çš„æœªç¡®è®¤çš„äº‹ä»¶ï¼Œä½ ä¼šå¾—åˆ°ä¸€ç»„å¯ä¿¡èµ–ä¹Ÿæœ‰åºçš„äº‹ä»¶ï¼Œä½†æ˜¯ä¹Ÿä¼šé‡åˆ°å¤§é‡æ•°æ®åŒ…çš„ä¸¢å¤±çš„æƒ…å†µï¼Œä½ ä¼šè½»æ˜“çš„é‡åˆ°æ•°æ®åŒ…æ¯”æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°è¿˜è¦å¤§çš„æƒ…å†µï¼Œå³ä½¿ä½ çš„æ•°æ®åŒ…çš„å¹³å‡å¤§å°éå¸¸å°ã€‚ï¼ˆè¯‘æ³¨ï¼šè¿™æ˜¯ç”±äºä¸¢åŒ…é‡ä¼ å¯¼è‡´çš„ä¸åœé‡å‘ï¼Œè€Œé‡å‘çš„æ•°æ®åŒ…åœ¨<span>UDP</span>æˆ–è€…<span>TCP</span>ä¸Šä¼šè¿›è¡Œåˆå¹¶ã€‚æ‰€ä»¥å³ä½¿æ•°æ®åŒ…çš„å¹³å‡å¤§å°è¿œå°äºæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œä½†æ˜¯ç”±äºå¤§é‡è¿™æ ·çš„æ•°æ®åŒ…çš„åˆå¹¶ï¼Œè¿˜æ˜¯å¾ˆå®¹æ˜“å‡ºç°è¶…è¿‡æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°çš„æƒ…å†µï¼‰ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">åœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å®ç°è¿™ä¹ˆä¸€ä¸ªç­–ç•¥ï¼šåœ¨ä¸€ä¸ªæ•°æ®åŒ…é‡Œé¢åªåŒ…å«å¾ˆå°‘ä¸€ç»„äº‹ä»¶æˆ–è€…çŠ¶æ€æ›´æ–°æ¥é¿å…æ•°æ®åŒ…çš„å¤§å°è¶…è¿‡æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œé‡‡ç”¨è¿™ç§ç­–ç•¥ä»¥åå¯ä»¥æœ‰æ•ˆçš„è§„é¿ä¸Šé¢çš„é‚£ç§æƒ…å†µã€‚è¿™ç§è§„åˆ’åœ¨å¾ˆå¤šæƒ…å†µä¸‹éƒ½å·¥ä½œçš„å¾ˆæ£’ã€‚ã€‚ã€‚ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µä¸‹è¿™ç§ç­–ç•¥ä¹Ÿæ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œè¿™ç§æƒ…å†µå°±æ˜¯å¢é‡ç¼–ç ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ç”±ä¸€ä¸ªå¢é‡ç¼–ç å™¨åˆ›å»ºçš„æ•°æ®åŒ…çš„å¤§å°æ˜¯ä¸å½“å‰çŠ¶æ€ä¸ä¹‹å‰çŠ¶æ€ä¹‹é—´æ‰€å‘ç”Ÿçš„çŠ¶æ€å˜åŒ–çš„æ•°é‡æˆæ­£æ¯”çš„ã€‚å¦‚æœè¿™ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´æœ‰å¤§é‡çš„ä¸åŒçš„è¯ï¼Œé‚£ä¹ˆå¢é‡ä¹Ÿå°†å¾ˆå¤§å¹¶ä¸”ä½ å¯¹è¿™ç§æƒ…å†µå…¶å®æ˜¯æ²¡æœ‰ä»€ä¹ˆåŠæ³•çš„ã€‚å¦‚æœå‡ºç°ä¸€ä¸ªå¢é‡æ°å¥½æ¯”æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°è¦å¤§çš„æƒ…å†µï¼Œå½“ç„¶è¿™æ˜¯ä¸€ä¸ªåè¿æ°”ä¸‹æ‰ä¼šå‡ºç°çš„æƒ…å†µï¼Œä½†æ˜¯ä½ ä»ç„¶è¦å‘é€è¿™ä¸ªè¶…è¿‡æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°çš„æ•°æ®åŒ…ï¼æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¢é‡ç¼–ç çš„æƒ…å†µä¸‹ï¼Œä½ çœŸçš„ä¸èƒ½é™åˆ¶æ•°æ®åŒ…çš„æœ€å¤§å¤§å°ä¸€å®šå°äºæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ç­–ç•¥å°±æœ‰äº†ç”¨æ­¦ä¹‹åœ°ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è®©æˆ‘ä»¬å›åˆ°æ•°æ®åŒ…çš„ç»“æ„ä¸Šé¢æ¥ã€‚åœ¨æ¯ä¸ªæ•°æ®åŒ…çš„åŒ…å¤´çš„åœ°æ–¹æ·»åŠ ä¸€ä¸ªåºå·æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„åšæ³•ã€‚è¿™å¹¶æ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„ã€‚è¿™åªæ˜¯ä¸€ä¸ªæ•°æ®åŒ…çš„åºå·ï¼Œä¼šåœ¨æ¯ä¸ªæ•°æ®åŒ…è¿›è¡Œå‘é€çš„æ—¶å€™ä¾æ¬¡åŠ ä¸€ã€‚ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œå°±æ˜¯<span>0</span>ã€<span>1</span>ã€<span>2</span>ã€<span>3</span>è¿™ä¹ˆç®€å•ã€‚æˆ‘å–œæ¬¢ç”¨<span>16</span>æ¯”ç‰¹æ¥è¡¨ç¤ºè¿™ä¸ªåºå·ï¼Œå³ä½¿åœ¨æ¯ç§’å‘é€<span>60</span>ä¸ªæ•°æ®åŒ…çš„æƒ…å†µä¸‹ï¼Œåªè¦<span>15</span>åˆ†é’Ÿåºå·å°±ä¼šè¢«ç”¨å®Œä¸€éï¼Œéœ€è¦å†æ¬¡ä»å¤´å¼€å§‹é‡ç”¨ï¼Œä½†æ˜¯è¿™ä¹ˆåšä¹Ÿæ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œä¸»è¦æ˜¯å› ä¸ºä½ åœ¨ç½‘ç»œä¸Šæ”¶åˆ°ä¸€ä¸ª<span>15</span>åˆ†é’Ÿä¹‹å‰å‘é€å‡ºå»çš„æ•°æ®åŒ…æ˜¯ä¸€ä¸ªéå¸¸ç½•è§çš„äº‹æƒ…ï¼Œæ‰€ä»¥ä½ å¾ˆå°‘ä¼šæœ‰æœºä¼šå›°æƒ‘è¿™åˆ°åº•æ˜¯ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…è¿˜æ˜¯ä¸€ä¸ªæ—§çš„æ•°æ®åŒ…ï¼ˆå› ä¸º<span>IP</span>å±‚åœ¨åŒ…å¤´çš„åœ°æ–¹æœ‰ä¸ªè·³è½¬è®¡æ•°ï¼Œè¶…å‡ºä¸€å®šè·³è½¬æ¬¡æ•°çš„æ•°æ®åŒ…ä¼šè¢«ä¸¢å¼ƒæ‰ï¼Œæ‰€ä»¥åŸºæœ¬ä¸ç”¨æ‹…å¿ƒè¿™ç§æƒ…å†µï¼‰ã€‚å¦‚æœä½ ç¡®å®å…³å¿ƒè¿™ä¸ªé—®é¢˜çš„è¯ï¼Œè¯·ä½¿ç”¨<span>32</span>æ¯”ç‰¹çš„åºå·è¿›è¡Œä»£æ›¿ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">æ— è®ºä½ é€‰æ‹©ç”¨å¤šå°‘æ¯”ç‰¹æ¥è¡¨ç¤ºè¿™ä¸ªåºå·ï¼Œå®ƒä»¬å¯¹äºå¾ˆå¤šäº‹æƒ…éƒ½æ˜¯æœ‰ç”¨çš„ï¼Œæ¯”å¦‚è¯´å¯ä¾èµ–æ€§ã€æ£€æµ‹å’Œä¸¢å¼ƒä¹±åºçš„æ•°æ®åŒ…ç­‰ç­‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°æ®åŒ…åºå·çš„åŸå› æ˜¯åœ¨å¯¹æ•°æ®åŒ…è¿›è¡Œåˆ†åŒ…çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æŸä¸ªæ–¹æ³•æ¥ç¡®å®šè¿™ä¸ªæ•°æ®åŒ…çš„åˆ†åŒ…åˆ°åº•æ˜¯å±äºå“ªä¸ªæ•°æ®åŒ…çš„ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„æ•°æ®åŒ…çš„ç»“æ„é‡Œé¢åŠ ä¸Šåºå·è¿™ä¸ªä¸œè¥¿ï¼š</span></span></p><br><br><pre><del>[protocol id] (64 bits)</del>   // not actually sent, but used to calc crc32<br>[crc32] (32 bits)<br><strong>[sequence] (16 bits)</strong><br>[packet type] (2 bits)<br>(variable length packet data according to packet type)<br>[end of packet serialize check] (32 bits)<br></pre><br><br><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™æ˜¯æœ€æœ‰è¶£çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®åŒ…çš„å¤´éƒ¨åªæ·»åŠ ä¸€ä¸ªæ¯”ç‰¹çš„æ ‡è¯†<span> is_fragment</span>ï¼Œä½†æ˜¯å¯¹äºé€šå¸¸æƒ…å†µä¸‹æ ¹æœ¬ä¸éœ€è¦åˆ†åŒ…çš„æ•°æ®åŒ…æ¥è¯´ï¼Œä½ å°±æµªè´¹äº†ä¸€ä¸ªæ¯”ç‰¹ï¼Œå› ä¸ºå®ƒæ€»æ˜¯è¦è¢«ç½®ä¸º<span>0</span>ã€‚è¿™ä¸æ˜¯å¾ˆå¥½ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ç›¸åï¼Œæˆ‘çš„é€‰æ‹©æ˜¯åœ¨æ•°æ®åŒ…çš„ç»“æ„é‡Œé¢æ·»åŠ äº†ä¸€ä¸ªç‰¹æ®Šçš„<span>â€</span>åˆ†åŒ…åçš„æ•°æ®åŒ…<span>â€œ</span>çš„ç±»å‹ï¼š</span></span></p><div><div id="highlighter_815496" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">1</span></div><div class="line number2 index1 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">2</span></div><div class="line number3 index2 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">3</span></div><div class="line number4 index3 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">4</span></div><div class="line number5 index4 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">5</span></div><div class="line number6 index5 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">6</span></div><div class="line number7 index6 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">7</span></div><div class="line number8 index7 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">8</span></div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp keyword bold">enum</code> <code class="cpp plain">TestPacketTypes</code></span></div><div class="line number2 index1 alt1"><code class="cpp plain"><span style="font-family:å¾®è½¯é›…é»‘;">{</span></code></div><div class="line number3 index2 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">PACKET_FRAGMENT = 0,     </code><code class="cpp comments">// RESERVED</code></span></div><div class="line number4 index3 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">TEST_PACKET_A,</code></span></div><div class="line number5 index4 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">TEST_PACKET_B,</code></span></div><div class="line number6 index5 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">TEST_PACKET_C,</code></span></div><div class="line number7 index6 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">TEST_PACKET_NUM_TYPES</code></span></div><div class="line number8 index7 alt1"><code class="cpp plain"><span style="font-family:å¾®è½¯é›…é»‘;">};</span></code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="margin-bottom: 12pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="color: rgb(34, 34, 34); font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™æ°å¥½ä¸éœ€è¦å æ®ä»»ä½•çš„ç©ºé—´ï¼Œæ˜¯å› ä¸ºå››ä¸ªæ•°æ®åŒ…ç±»å‹æ­£å¥½å¯ä»¥ç”¨ä¸¤ä¸ªæ¯”ç‰¹æ¥è¡¨ç¤ºï¼Œè€Œè¿™ä¸¤ä¸ªæ¯”ç‰¹çš„ç©ºé—´å·²ç»ç”¨äºè¡¨ç¤ºæ•°æ®åŒ…ç±»å‹äº†ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨åŸæ¥çš„æšä¸¾ä¸Šæ–°åŠ äº†ä¸€ä¸ªç±»å‹ã€‚è¿™ä¹ˆå¤„ç†ä»¥åï¼Œæ¯æ¬¡å½“æˆ‘ä»¬è¯»å–ä¸€ä¸ªæ•°æ®åŒ…çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®åŒ…çš„ç±»å‹æ˜¯<span>0</span>çš„è¯ï¼Œæˆ‘ä»¬å°±çŸ¥é“è¿™ä¸ªæ•°æ®åŒ…æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…ï¼Œå®ƒçš„å†…å­˜å¸ƒå±€å¯ä»¥é€šè¿‡æ•°æ®åŒ…çš„ç±»å‹å¾—çŸ¥ï¼Œå¦åˆ™çš„è¯ï¼Œæˆ‘ä»¬å°±èµ°å›åŸæ¥çš„é€šç”¨çš„å¯¹éåˆ†åŒ…çš„æ•°æ®åŒ…è¿›è¡Œè¯»å–å’Œå¤„ç†çš„æ–¹æ³•ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è®©æˆ‘ä»¬è®¾è®¡ä¸‹è¿™ä¸ªåˆ†åŒ…åçš„æ•°æ®åŒ…çœ‹èµ·æ¥åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚æˆ‘ä»¬å°†å…è®¸ä¸€ä¸ªæ•°æ®åŒ…æœ€å¤šå¯ä»¥åˆ†æˆ<span>256</span>ä¸ªæ•°æ®åŒ…ï¼Œå¹¶ä¸”æ¯ä¸ªåˆ†åŒ…åçš„æ•°æ®åŒ…çš„å¤§å°ä¸ä¼šè¶…è¿‡<span>1024</span>ä¸ªå­—èŠ‚ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™æ ·ä¸€ä¸ªç³»ç»Ÿæ¥å‘é€å¤§å°æœ€å¤§ä¸º<span>256k</span>çš„æ•°æ®åŒ…ï¼Œè¿™å¯¹äºä»»æ„ç³»ç»Ÿä»»æ„æƒ…å†µæ¥è¯´éƒ½åº”è¯¥æ˜¯è¶³å¤Ÿçš„ï¼Œä½†æ˜¯è¿™åªæ˜¯æˆ‘ä¸ªäººçš„ä¸€ä¸ªçœ‹æ³•ï¼Œå¦‚æœæœ‰ç‰¹æ®Šçš„æƒ…å†µï¼Œè¿˜è¯·ç»“åˆå®é™…æƒ…å†µè¿›è¡Œå…·ä½“åˆ†æã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">æœ‰äº†è¿™ä¹ˆä¸€ä¸ªä¸å¤§çš„å›ºå®šå¤§å°çš„æ•°æ®åŒ…åŒ…å¤´ç»“æ„ï¼Œå†åŠ ä¸Š<span>UDP</span>çš„åŒ…å¤´ç»“æ„ä»¥åŠ<span>IP</span>çš„åŒ…å¤´ç»“æ„ï¼Œä¸€ä¸ªåˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…ä¼šå°äºä¹‹å‰æˆ‘ä»¬ä¿å®ˆä¼°è®¡çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼š<span>1200</span>å­—èŠ‚ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå› ä¸ºä¸€ä¸ªæ•°æ®åŒ…æœ€å¤šå¯ä»¥åˆ†åŒ…æˆ<span>256</span>ä¸ªæ•°æ®åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ã€<span>0</span>ï¼Œ<span>255</span>ã€‘è¿™ä¸ªèŒƒå›´æ¥è¡¨ç¤ºåˆ†åŒ…çš„<span>id</span>å’Œåºå·ï¼Œè¿™æ ·æ¯ä¸ªåˆ†åŒ…é‡Œé¢è¿˜éœ€è¦æœ‰<span>8</span>æ¯”ç‰¹æ¥è¡¨ç¤ºè¿™ä¸ªåºå·ã€‚</span></span></p><br><br><pre><del>[protocol id] (32 bits)</del>   // not actually sent, but used to calc crc32<br>[crc32] (32 bits)<br>[sequence] (16 bits)<br>[packet type = 0] (2 bits)<br><strong>[fragment id] (8 bits)<br>[num fragments] (8 bits)<br>[pad zero bits to nearest byte index]<br>&lt;fragment data&gt;</strong><br></pre><br><br><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æŠŠè¿™å‡ ä¸ªæ¯”ç‰¹å¯¹é½åˆ°äº†ä¸‹ä¸€ä¸ªå­—èŠ‚ï¼Œç„¶åæ‰æŠŠå¯¹é½ä»¥åçš„æ•°æ®å†™å…¥åˆ°æ•°æ®åŒ…é‡Œé¢ã€‚æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿè¿™ä¹ˆåšå…¶å®æ˜¯æœ‰ä¸¤ä¸ªåŸå› çš„<span>: 1) </span>è¿™ä¹ˆå¤„ç†ä»¥åå¯ä»¥é€šè¿‡<span>memcpy</span>å‡½æ•°æ›´å¿«çš„æŠŠåˆ†åŒ…çš„æ•°æ®æ‹·è´åˆ°æ•°æ®åŒ…é‡Œé¢è€Œä¸éœ€è¦ä½¿ç”¨ä½æ‰“åŒ…å™¨æ¥å¯¹æ¯ä¸ªå­—èŠ‚è¿›è¡Œå¤„ç†ã€‚<span>2) </span>æˆ‘ä»¬é€šè¿‡ä¸å‘é€åˆ†åŒ…æ•°æ®çš„å¤§å°èŠ‚çœäº†ä¸€å°éƒ¨åˆ†å¸¦å®½ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»æ•°æ®åŒ…çš„æ•´ä½“å¤§å°å‡å»åˆ†åŒ…æ•°æ®èµ·å§‹ä½ç½®çš„å­—èŠ‚åºå·æ¥æ¨æ–­å‡ºè¿™ä¸ªåˆ†åŒ…çš„å¤§å°ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="å‘é€åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…"><span style="color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;font-size:x-large;">å‘é€åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…</span></span></h2><p></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">å‘é€åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…æ˜¯ä¸€ä»¶éå¸¸å®¹æ˜“çš„äº‹æƒ…ã€‚å¦‚æœæ•°æ®åŒ…çš„å¤§å°å°äºä¿å®ˆä¼°è®¡çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ã€‚é‚£ä¹ˆå°±æŒ‰æ­£å¸¸çš„æ–¹æ³•è¿›è¡Œå‘é€ã€‚å¦åˆ™çš„è¯ï¼Œå°±è®¡ç®—è¿™ä¸ªæ•°æ®åŒ…åˆ°åº•è¯¥åˆ†æˆå¤šå°‘ä¸ª<span>1024</span>å­—èŠ‚çš„æ•°æ®åŒ…åˆ†åŒ…ï¼Œç„¶åæ„å»ºè¿™äº›åˆ†åŒ…å¹¶æŒ‰ç…§ä¹‹å‰å‘é€æ­£å¸¸æ•°æ®åŒ…çš„æ–¹æ³•è¿›è¡Œå‘é€ã€‚å‘é€å‡ºå»ä»¥åä¹Ÿä¸è®°å½•å‘é€çš„æ•°æ®åŒ…çš„å†…å®¹ï¼Œè¿™æ²¡ä»€ä¹ˆå›°éš¾çš„ï¼</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™ç§å‘é€ä»¥åä¸è®°å½•å‘é€çš„æ•°æ®åŒ…çš„å†…å®¹çš„æ–¹æ³•æœ‰ä¸€ä¸ªåæœï¼Œå°±æ˜¯æ•°æ®åŒ…çš„ä»»æ„ä¸€ä¸ªåˆ†åŒ…å¦‚æœä¸¢å¤±çš„è¯ï¼Œé‚£ä¹ˆæ•´ä¸ªæ•°æ®åŒ…å°±éƒ½è¦ä¸¢å¼ƒã€‚ç”±æ­¤å¯è§ï¼Œå½“ä½ éœ€è¦å‘é€è¦ç»™<span>256K</span>çš„æ•°æ®åŒ…çš„æ—¶å€™è¦å‘é€<span>256</span>ä¸ªåˆ†åŒ…ï¼Œå¦‚æœæœ‰ä¸€ä¸ªåˆ†åŒ…ä¸¢å¤±çš„è¯ï¼Œä½ å°±è¦é‡æ–°æŠŠè¿™ä¸ª<span>256k</span>çš„æ•°æ®åŒ…å†åˆ†ä¸€æ¬¡åŒ…ç„¶åå†å‘é€å‡ºå»ã€‚è¿™ç»å¯¹ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™æ˜¾ç„¶æ˜¯ä¸€ä¸ªå¾ˆç³Ÿç³•çš„åŠæ³•ï¼Œå› ä¸ºéšç€åˆ†åŒ…æ•°ç›®çš„å¢å¤šï¼Œå‘ç”Ÿä¸¢å¤±çš„æ¦‚ç‡è‚¯å®šæ˜¯æ˜¾è‘—çš„å¢å¤§ã€‚è¿™ç§å¢é•¿å…³ç³»ä¸æ˜¯çº¿æ€§çš„ï¼Œè€Œæ˜¯ä¸€ç§ç›¸å½“å¤æ‚çš„å…³ç³»ï¼Œå¦‚æœä½ å¯¹è¿™ä¸ªè®¡ç®—æ„Ÿå…´è¶£çš„è¯ï¼Œä½ å¯ä»¥è¯»ä¸‹<a rel="noopener" href="http://www.fourmilab.ch/rpkp/experiments/statistics.html" target="_blank">è¿™ç¯‡æ–‡ç« </a></span><span style="font-size: 12pt; color: rgb(34, 34, 34);">ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ç®€è€Œè¨€ä¹‹ï¼Œå¦‚æœä½ è¦è®¡ç®—ä¸€ä¸ªæ•°æ®åŒ…ä¼šè¢«ä¸¢å¼ƒçš„æ¦‚ç‡ï¼Œä½ å¿…é¡»è¦è®¡ç®—æ‰€æœ‰åˆ†åŒ…è¢«æˆåŠŸå‘é€åˆ°ç›®çš„åœ°çš„æ¦‚ç‡ï¼Œç„¶åä»<span>1</span>ä¸­å‡å»è¿™ä¸ªæ¦‚ç‡ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯è‡³å°‘æœ‰ä¸€ä¸ªåˆ†åŒ…ä¸¢å¤±çš„æ¦‚ç‡ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸‹é¢è¿™ä¸ªå…¬å¼å¯ä»¥ç”¨æ¥è®¡ç®—å› ä¸ºåˆ†åŒ…ä¸¢å¤±å¯¼è‡´æ•´ä¸ªæ•°æ®åŒ…è¢«ä¸¢å¼ƒçš„æ¦‚ç‡ï¼š</span></span></p><p class="MsoNormal" align="left" style="margin-bottom: 12pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="font-size: 10pt; color: rgb(40, 40, 40);"><span style="font-family:å¾®è½¯é›…é»‘;">ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼</span></span></p><div style="border:solid #F0F0F0 1.0pt;border-left:solid #E0E0E0 2.25pt;padding:0cm 0cm 0cm 0cm;background:whitesmoke"><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1- ( probability of fragment being delivered ) ^ num_fragments</span></span></p></div><p class="MsoNormal" align="left" style="margin-bottom: 12pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="font-size: 10pt; color: rgb(40, 40, 40);"><span style="font-family:å¾®è½¯é›…é»‘;">ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è®©æˆ‘ä»¬ä¸¾ä¸ªç®€å•çš„ä¾‹å­å¯¹ä¸Šé¢è¿™ä¸ªå…¬å¼è¿›è¡Œè¯´æ˜ï¼Œå¦‚æœæˆ‘ä»¬å‘é€çš„ä¸€ä¸ªä¸éœ€è¦åˆ†åŒ…çš„æ•°æ®åŒ…ï¼Œå¦‚æœå®ƒåœ¨ç½‘ç»œä¸Šä¼ è¯´çš„æ—¶å€™ä¸¢å¤±çš„æ¦‚ç‡æ˜¯<span>1%</span>ï¼Œé‚£ä¹ˆåªæœ‰ç™¾åˆ†ä¹‹ä¸€çš„æ¦‚ç‡ä¼šå‡ºç°è¿™ä¸ªæ•°æ®åŒ…è¢«ä¸¢å¼ƒçš„æƒ…å†µï¼Œæˆ–è€…æˆ‘ä»¬ä¸è¦å«Œéº»çƒ¦ï¼ŒæŠŠè¿™äº›æ•°æ®ä»£å…¥åˆ°ä¸Šé¢è¿™ä¸ªå…¬å¼é‡Œé¢<span>: 1 â€“ (99/100) ^ 1 = 1/100 = 1%</span>ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">éšç€åˆ†åŒ…æ•°é‡çš„å¢åŠ ï¼Œæ•´ä¸ªæ•°æ®åŒ…è¢«ä¸¢å¼ƒçš„æ¦‚ç‡ä¹Ÿéšä¹‹å¢åŠ ï¼š</span></span></p><ul type="disc"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸¤ä¸ªåˆ†åŒ…çš„æƒ…å†µï¼š<span> 1 â€“ (99/100) ^ 2 = <b><span style="border:none windowtext 1.0pt;     padding:0cm">2%</span></b></span><b><span style="border:none windowtext 1.0pt;     padding:0cm">ã€‚</span></b></span></span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">åä¸ªåˆ†åŒ…çš„æƒ…å†µï¼š<span> 1 â€“ (99/100) ^ 10 = <b><span style="border:none windowtext 1.0pt;     padding:0cm">9.5%</span></b></span><b><span style="border:none windowtext 1.0pt;     padding:0cm">ã€‚</span></b></span></span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸€ç™¾ä¸ªåˆ†åŒ…çš„æƒ…å†µï¼š<span> 1 â€“ (99/100) ^ 100 = <b><span style="border:none windowtext 1.0pt;     padding:0cm">63.4%</span></b></span><b><span style="border:none windowtext 1.0pt;     padding:0cm">ã€‚</span></b></span></span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">äºŒç™¾äº”åå…­ä¸ªåˆ†åŒ…çš„æƒ…å†µï¼š<span> 1 â€“ (99/100) ^ 256 = <b><span style="border:none windowtext 1.0pt;     padding:0cm">92.4%</span></b></span><b><span style="border:none windowtext 1.0pt;     padding:0cm">ã€‚</span></b></span></span></li></ul><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">æ‰€ä»¥æˆ‘å»ºè®®ä½ è¦å°å¿ƒåˆ†åŒ…ä»¥åçš„æ•°é‡ã€‚è¿™ä¸ªç­–ç•¥æœ€å¥½æ˜¯åªå¯¹<span>2-4</span>ä¸ªåˆ†åŒ…çš„æƒ…å†µè¿›è¡Œä½¿ç”¨ï¼Œè€Œä¸”æœ€å¥½æ˜¯é’ˆå¯¹é‚£ç§å¯¹æ—¶é—´ä¸æ€ä¹ˆæ•æ„Ÿçš„æ•°æ®ä½¿ç”¨æˆ–è€…æ˜¯å°±ç®—åˆ†åŒ…lostäº†ä¹Ÿæ— æ‰€è°“çš„æƒ…å†µã€‚ç»å¯¹ä¸è¦åªæ˜¯ä¸ºäº†çœäº‹å°±æŠŠä¸€å¤§å †ä¾èµ–é¡ºåºçš„äº‹ä»¶æ‰“åˆ°ä¸€ä¸ªå¤§æ•°æ®åŒ…é‡Œé¢ç„¶åä¾èµ–æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„æœºåˆ¶è¿›è¡Œå‘é€ã€‚è¿™ä¼šè®©äº‹æƒ…å˜å¾—æ›´åŠ éº»çƒ¦ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">å¤§æ•°æ®åŒ…çš„å¦å¤–ä¸€ç§å…¸å‹çš„ç”¨é€”æ˜¯å½“å®¢æˆ·ç«¯æ–°è¿å…¥ä¸€ä¸ªæ¸¸æˆæœåŠ¡å™¨çš„æ—¶å€™ã€‚æ¸¸æˆæœåŠ¡å™¨é€šå¸¸ä¼šæŠŠå¤§å—çš„æ•°æ®ä»¥ä¸€ç§å¯é çš„æ–¹å¼ä¸‹å‘ç»™å®¢æˆ·ç«¯ã€‚å¯¹äºåæœŸæ‰åŠ å…¥çš„å®¢æˆ·ç«¯è€Œè¨€ï¼Œè¿™äº›å¤§å—çš„æ•°æ®ä¹Ÿè®¸ä»£è¡¨äº†ä¸–ç•Œçš„åˆå§‹çŠ¶æ€ã€‚æ— è®ºè¿™äº›æ•°æ®åŒ…å«äº†æ€ä¹ˆæ ·çš„ä¿¡æ¯ï¼Œè¯·ä¸è¦ä½¿ç”¨æœ¬ç¯‡æ–‡ç« çš„åˆ†åŒ…æŠ€å·§æ¥ç»™å®¢æˆ·ç«¯ä¸‹å‘å¤§å—çš„æ•°æ®ã€‚ç›¸åï¼Œè¯·æŸ¥é˜…è¿™ä¸ªç³»åˆ—æ•™ç¨‹çš„ä¸‹ç¯‡æ–‡ç« ï¼Œåœ¨é‚£ç¯‡æ–‡ç« é‡Œé¢å°†è®²è§£å¦‚ä½•åœ¨æœ‰æ•°æ®åŒ…å¯èƒ½å‘ç”Ÿä¸¢å¤±çš„æƒ…å†µä¸‹ï¼Œå¿«é€Ÿå¯é çš„å‘é€å¤§å—çš„æ•°æ®ç›´åˆ°è¿™äº›å¤§å—çš„æ•°æ®å®Œå…¨è¢«ç¡®è®¤æ¥æ”¶ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="å¯¹åˆ†åŒ…åçš„æ•°æ®åŒ…çš„æ¥æ”¶"><span style="color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;font-size:x-large;">å¯¹åˆ†åŒ…åçš„æ•°æ®åŒ…çš„æ¥æ”¶</span></span></h2><p></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">å°½ç®¡å‘é€åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…æ˜¯ä¸€ä»¶ç›¸åŒç®€å•çš„äº‹æƒ…ï¼Œä½†æ˜¯å¯¹åˆ†åŒ…åçš„æ•°æ®åŒ…è¿›è¡Œæ¥æ”¶å°±ç›¸å¯¹éœ€è¦æŠ€å·§äº†ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä¹‹æ‰€ä»¥å¯¹åˆ†åŒ…åçš„æ•°æ®åŒ…è¿›è¡Œæ¥æ”¶å¾ˆå›°éš¾çš„åŸå› æ˜¯æˆ‘ä»¬ä¸ä»…éœ€è¦ç»™ç¼“å†²åŒºå»ºç«‹ä¸€ä¸ªæ•°æ®ç»“æ„è¿˜è¦æŠŠè¿™äº›åˆ†åŒ…é‡ç»„æˆåŸå§‹çš„æ•°æ®åŒ…ï¼Œæˆ‘ä»¬ä¹Ÿè¦ç‰¹åˆ«å°å¿ƒå¦‚æœæœ‰äººè¯•å›¾è®©æˆ‘ä»¬çš„ç¨‹åºäº§ç”Ÿå´©æºƒè€Œç»™æˆ‘ä»¬å‘é€æ¶æ„çš„æ•°æ®åŒ…ã€‚</span></span></p><br><br><pre><del>[protocol id] (32 bits)</del>   // not actually sent, but used to calc crc32<br>[crc32] (32 bits)<br>[sequence] (16 bits)<br>[packet type = 0] (2 bits)<br><strong>[fragment id] (8 bits)<br>[num fragments] (8 bits)<br>[pad zero bits to nearest byte index]<br>&lt;fragment data&gt;</strong><br></pre><br><br><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸‹é¢åˆ—å‡ºçš„æ˜¯æˆ‘èƒ½æƒ³åˆ°çš„å¦‚ä½•æ”»å‡»ä½ çš„åè®®ä»¥ä¾¿è®©ä½ çš„æœåŠ¡å™¨å´©æºƒçš„æ‰€æœ‰æ–¹æ³•ï¼š</span></span></p><ul type="disc"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">å°è¯•å‘é€åˆ†åŒ…<span>ID</span>åœ¨ä¸€ä¸ªé™åˆ¶èŒƒå›´å†…çš„åˆ†åŒ…ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½è®©ä½ çš„ç¨‹åºå´©æºƒã€‚ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œä¹Ÿè®¸è¿™ä¸ªæ•°æ®åŒ…åªæœ‰ä¸¤ä¸ªåˆ†åŒ…ï¼Œä½†æ˜¯æˆ‘ä¼šå‘é€å¤šä¸ªåˆ†åŒ…<span>ID</span>åœ¨ã€ï¼ï¼Œï¼’ï¼•ï¼•ã€‘ä¹‹å†…çš„åˆ†åŒ…ã€‚</span></span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">å‘é€ä¸€ä¸ªæ•°æ®åŒ…ï¼Œè®©æˆ‘ä»¬å‡è®¾è¿™ä¸ªä¹¦åŒ…çš„æœ€å¤§åˆ†åŒ…æ•°é‡æ˜¯<span>2</span>ï¼Œç„¶åå‘é€å¤šä¸ªå±äºè¿™ä¸ªæ•°æ®åŒ…çš„åˆ†åŒ…ï¼Œä½†æ˜¯åœ¨åˆ†åŒ…çš„æ•°æ®åŒ…æŠ¥å¤´é‡Œé¢æŠŠæœ€å¤§åˆ†åŒ…çš„æ•°é‡æ”¹ä¸º<span>256</span>ï¼Œæ¥å¸Œæœ›ä½ åœ¨æ¥æ”¶å®Œç¬¬ä¸€ä¸ªåˆ†åŒ…ä»¥åï¼Œä¸ä¼šå‘ç°åˆ†åŒ…çš„æœ€å¤§æ•°é‡ä¿¡æ¯è¢«æ”¹å˜äº†ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½é€ æˆä½ çš„å†…å­˜å´©æºƒã€‚</span></span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">å‘é€éå¸¸å¤§çš„åˆ†åŒ…ï¼Œè®©åˆ†åŒ…é‡Œé¢çš„æ•°æ®è¶…è¿‡<span>1k</span>ï¼Œæµ‹è¯•ä¸‹ä½ åœ¨è¯•å›¾æŠŠåˆ†åŒ…æ•°æ®æ‹·è´åˆ°æ•°æ®ç»“æ„çš„æ—¶å€™æ˜¯å¦æœ‰è‰¯å¥½çš„åˆ¤æ–­ï¼Œå¦‚æœæ²¡æœ‰è‰¯å¥½çš„åˆ¤æ–­çš„è¯ï¼Œè¿™ä¹Ÿè®¸ä¼šè®©ä½ çš„å†…å­˜å´©æºƒï¼Œæˆ–è€…å ç”¨å¤§é‡çš„å†…å®¹è®©ä½ åœ¨åˆ†é…æ–°çš„åˆ†åŒ…çš„æ—¶å€™æ²¡æœ‰ç©ºé—´ã€‚ </span></span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">æŒç»­çš„ç»™ä½ çš„ç¨‹åºå‘é€æœ€å¤§åˆ†åŒ…æ•°ç›®çš„åˆ†åŒ…ï¼ˆä¹Ÿå°±æ˜¯å¦‚æœæœ€å¤§åˆ†åŒ…æ•°ç›®æ˜¯<span>256</span>çš„è¯ï¼Œå°±æŒç»­ä¸æ–­çš„å‘é€åˆ†åŒ…<span>ID</span>æ˜¯<span>256</span>çš„æ•°æ®åŒ…ï¼‰ï¼Œå¸Œæœ›ä½ ä¼šåˆ†é…å¤§é‡çš„å†…å®¹æ¥å®¹çº³è¿™äº›åˆ†åŒ…ç„¶åè®©ä½ çš„å†…å­˜å´©æºƒã€‚è®©æˆ‘ä»¬å‡è®¾ä½ çš„ç¨‹åºä¸­æœ‰ä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼Œè¿™ä¸ªæ»‘åŠ¨çª—å£æœ‰<span>256</span>ä¸ªæ•°æ®åŒ…ï¼Œæ¯ä¸ªæ•°æ®åŒ…æœ€å¤šå¯ä»¥æœ‰<span>256</span>ä¸ªåˆ†åŒ…ï¼Œæ¯ä¸ªåˆ†åŒ…é¢„ç•™çš„ç©ºé—´æ˜¯<span>1k</span>ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯ä¼šç»™æ¯ä¸ªå®¢æˆ·ç«¯é¢„ç•™<span>67,108,864</span>å­—èŠ‚æˆ–è€…<span>64mb</span>çš„ç©ºé—´ã€‚æˆ‘å¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•è®©æœåŠ¡å™¨å´©æºƒä¹ˆï¼Ÿæˆ‘èƒ½ç”¨ä¸€å †å¤§å°æœ‰è¶£çš„åˆ†åŒ…æ¥è€—å°½çš„ä½ åœ°å€ç©ºé—´çš„<span>heap</span>ç©ºé—´ä¹ˆï¼Ÿå› ä¸ºæœåŠ¡å™¨çš„ç¨‹åºæ˜¯ä½ æ¥è®¾è®¡å®ç°çš„ï¼Œæ‰€ä»¥åªæœ‰ä½ æ‰çŸ¥é“è¿™ä¸ªé—®é¢˜çš„ç¡®åˆ‡ç­”æ¡ˆã€‚å®ƒå–å†³äºä½ çš„å†…å­˜é¢„ç®—ä»¥åŠå¦‚ä½•åˆ†é…å†…å­˜æ¥å­˜å‚¨åˆ†åŒ…ã€‚å¦‚æœä½ è€ƒè™‘è¿‡äº†è§‰å¾—è¿™ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆå°±é™åˆ¶ä¸‹ç¼“å†²åŒºä¸­åˆ†åŒ…çš„æ•°ç›®æˆ–è€ƒè™‘å‡å°‘æ¯ä¸ªæ•°æ®åŒ…çš„åˆ†åŒ…çš„æœ€å¤§æ•°ç›®ã€‚è€ƒè™‘ç»™æ¯ä¸ªåˆ†åŒ…é™æ€åˆ†é…æ•°æ®ç»“æœæˆ–è€…ä½¿ç”¨ä¸€ä¸ªå†…å­˜æ± æ¥å‡å°‘å†…å­˜ç¢ç‰‡ã€‚</span></span></li></ul><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ¥æ”¶ç«¯ä»£ç æ˜¯éå¸¸è„†å¼±çš„ï¼Œè¦éå¸¸å°å¿ƒæ£€æŸ¥ä¸€åˆ‡å¯èƒ½çš„æƒ…å†µã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„äº‹æƒ…è¦æ³¨æ„ï¼šè®©åˆ†åŒ…ä¿å­˜åœ¨ä¸€ä¸ªæ•°æ®ç»“æ„é‡Œé¢ï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…çš„æ‰€æœ‰åˆ†åŒ…éƒ½åˆ°è¾¾ä»¥åï¼ˆé€šè¿‡è®¡æ•°æ¥åˆ¤æ–­æ˜¯å¦å…¨éƒ¨åˆ°è¾¾ï¼‰ï¼Œå°†è¿™äº›åˆ†åŒ…é‡ç»„æˆä¸€ä¸ªå¤§çš„æ•°æ®åŒ…ï¼Œå¹¶æŠŠè¿™ä¸ªé‡ç»„åçš„å¤§æ•°æ®åŒ…è¿”å›ç»™æ¥æ”¶æ–¹ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„åœ¨è¿™é‡Œæ˜¯æœ‰æ„ä¹‰çš„<span>?</span>è¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„æ•°æ®ç»“æ„<span>!</span>æˆ‘ä½¿ç”¨çš„æ˜¯ä¸€ç§æˆ‘å–œæ¬¢ç§°ä¹‹ä¸ºåºåˆ—ç¼“å†²åŒºçš„ä¸œè¥¿ã€‚æˆ‘æƒ³å’Œä½ åˆ†äº«çš„æœ€æ ¸å¿ƒçš„æŠ€å·§æ˜¯å¦‚ä½•è®©è¿™ä¸ªæ•°æ®ç»“æ„å˜å¾—é«˜æ•ˆï¼š</span></span></p><div><div id="highlighter_81070" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">1</span></div><div class="line number2 index1 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">2</span></div><div class="line number3 index2 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">3</span></div><div class="line number4 index3 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">4</span></div><div class="line number5 index4 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">5</span></div><div class="line number6 index5 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">6</span></div><div class="line number7 index6 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">7</span></div><div class="line number8 index7 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">8</span></div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">MaxEntries = 256;</code></span></div><div class="line number2 index1 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></div><div class="line number3 index2 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp keyword bold">struct</code> <code class="cpp plain">SequenceBuffer</code></span></div><div class="line number4 index3 alt1"><code class="cpp plain"><span style="font-family:å¾®è½¯é›…é»‘;">{</span></code></div><div class="line number5 index4 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">exists[MaxEntries];</code></span></div><div class="line number6 index5 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">uint16_t sequence[MaxEntries];</code></span></div><div class="line number7 index6 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">Entry entries[MaxEntries];</code></span></div><div class="line number8 index7 alt1"><code class="cpp plain"><span style="font-family:å¾®è½¯é›…é»‘;">};</span></code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="margin-bottom: 12pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™é‡Œé¢æœ‰å‡ ä»¶äº‹æƒ…å€¼å¾—æ³¨æ„ã€‚é¦–å…ˆï¼Œä½¿ç”¨ç±»ä¼¼æ•°ç»„çš„ç»“æ„å¯ä»¥å…è®¸å¯¹ç»™å®šæ¡ç›®æ˜¯å¦å­˜åœ¨äºä¸€ä¸ªåºåˆ—ç¼“å†²åŒºçš„å­˜åœ¨æ€§è¿›è¡Œå¿«é€Ÿæµ‹è¯•å¹¶ä¸”å°†æµ‹è¯•ç»“æœè¿›è¡Œç¼“å­˜ï¼Œå³ä½¿æ¯ä¸ªæ•°æ®åŒ…çš„æ¡ç›®ç»“æ„æ˜¯éå¸¸å¤§çš„ï¼ˆè€Œä¸”è¿™ç§ç»“æ„å¯¹äºæ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„æ¥è¯´æ˜¯éå¸¸æ£’çš„ï¼‰ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ•°æ®ç»“æ„ï¼Ÿå½“ä½ æ¥æ”¶åˆ°ä¸€ä¸ªåˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…ä»¥åï¼Œè¿™ä¸ªæ•°æ®åŒ…ä¼šæºå¸¦ä¸€ä¸ªåºå·æŒ‡å®šå®ƒæ˜¯å±äºå“ªä¸ªæ•°æ®åŒ…çš„åˆ†åŒ…ã€‚è¿™ä¸ªåºå·ä¼šéšç€å‘é€è€Œä¸åœçš„å¢å¤§<span>(</span>æ‰€æœ‰åºå·å…¨éƒ¨ç”¨å®Œå¯¼è‡´å‘ç”Ÿç¯ç»•é™¤å¤–<span>)</span>ï¼Œ æ‰€ä»¥æœ€å…³é”®çš„æŠ€å·§æ˜¯ä½ è¦å¯¹åºå·è¿›è¡Œæ•£åˆ—è®©æ•£åˆ—åçš„åºå·è¿›å…¥ä¸€ä¸ªæ•°ç»„ä¸­æŸä¸ªç»™å®šçš„ä½ç½®ï¼Œå…·ä½“å¤„ç†è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</span></span></p><div style="border:solid #F0F0F0 1.0pt;border-left:solid #E0E0E0 2.25pt;padding:0cm 0cm 0cm 0cm;background:whitesmoke"><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">int index = sequence % MaxEntries;</span></span></p></div><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ç°åœ¨ä½ å¯ä»¥ç”¨<span>O(1)</span>çš„æ—¶é—´å¤æ‚åº¦è¿›è¡Œä¸€ä¸ªå¿«é€Ÿæµ‹è¯•ï¼Œæ¥é€šè¿‡åºå·çœ‹ä¸‹ä¸€ä¸ªç»™å®šçš„æ¡ç›®æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”åˆ¤æ–­ä¸‹è¿™ä¸ªæ¡ç›®æ˜¯å¦å’Œä½ æƒ³è¦è¯»å–æˆ–è€…å†™å…¥çš„æ•°æ®åŒ…åºå·ç›¸åŒ¹é…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ æ—¢éœ€è¦æµ‹è¯•å­˜åœ¨æ€§åˆéœ€è¦æµ‹è¯•åºå·æ˜¯å¦æ˜¯é¢„æœŸçš„åºå·ï¼Œè¿™æ˜¯å› ä¸ºæ‰€æœ‰çš„åºå·éƒ½æ˜¯æœ‰æ•ˆçš„æ•°å­—<span>(</span>æ¯”å¦‚è¯´æ˜¯<span>0)</span>ï¼Œè¿˜æœ‰å°±æ˜¯å› ä¸ºæ ¹æ®ä¸€ä¸ªç‰¹å®šçš„æ•°æ®åŒ…åºå·æŸ¥æ‰¾åˆ°çš„æ¡ç›®å¯èƒ½æ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯å®ƒå±äºè¿‡å»çš„ä¸€ä¸ªåºå·ï¼ˆæ¯”å¦‚è¯´ï¼Œè¿™æ˜¯æŸä¸ªå…¶ä»–çš„åºå·ï¼Œä½†æ˜¯æ°å·§é€šè¿‡å–æ¨¡çš„è®¡ç®—å¾—åˆ°ç›¸åŒçš„åºå·ï¼‰ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">æ‰€ä»¥å½“ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…çš„ç¬¬ä¸€ä¸ªåˆ†åŒ…åˆ°è¾¾çš„æ—¶å€™ï¼Œä½ éœ€è¦æŠŠæ•°æ®åŒ…çš„åºå·æ•£åˆ—æˆä¸€ä¸ªç´¢å¼•ï¼Œå¦‚æœå‘ç°è¿™ä¸ªç´¢å¼•å¯¹åº”çš„å†…å®¹è¿˜ä¸å­˜åœ¨çš„è¯ï¼Œä½ éœ€è¦è®¾ç½®<span>exists[index] = 1</span>ï¼Œå¹¶è®¾ç½®<span>sequence[index]</span>æ¥åŒ¹é…ä½ æ­£åœ¨å¤„ç†çš„æ•°æ®åŒ…ï¼Œå¹¶æŠŠè¿™ä¸ªåˆ†åŒ…å‚¨å­˜åœ¨åºå·ç¼“å†²åŒºå¯¹åº”çš„æ¡ç›®é‡Œé¢ã€‚è¿™æ ·å½“ä¸‹ä¸€æ¬¡æœ‰åˆ†åŒ…å®é™…åˆ°è¾¾çš„æ—¶å€™ï¼Œä½ ä¼šå¾—åˆ°ç›¸åŒçš„åºå·ï¼Œç„¶åå¾—åˆ°ä¸€ä¸ªç›¸å½“çš„ç´¢å¼•ï¼Œåœ¨æŸ¥æ‰¾çš„æ—¶å€™ä¼šå‘ç°å¯¹åº”è¿™ä¸ªç´¢å¼•çš„å†…å®¹å·²ç»å­˜åœ¨äº†ï¼Œå¹¶ä¸”è¿™ä¸ªæ¡ç›®çš„åºå·æ­£å¥½èƒ½å’Œåˆšåˆšæ¥æ”¶åˆ°çš„æ•°æ®åŒ…çš„åºå·åŒ¹é…ï¼Œæ‰€ä»¥ä½ å°±å¯ä»¥æŠŠè¿™ä¸ªåˆ†åŒ…ç´¯åŠ åˆ°è¿™ä¸ªæ¡ç›®ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´é‡å¤ç›´åˆ°è¿™ä¸ªæ•°æ®åŒ…çš„æ‰€æœ‰åˆ†åŒ…éƒ½è¢«æ¥æ”¶åˆ°ä¸ºæ­¢ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">å¦‚æœä»æ¯”è¾ƒæŠ½è±¡çš„å±‚æ¬¡æ¥è§£é‡Šè¿™ä¸ªäº‹æƒ…çš„è¯ï¼ŒåŸºæœ¬åŸç†å¤§æ¦‚å°±æ˜¯è¿™æ ·çš„ã€‚è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªæ›´å®Œæ•´çš„è§£é‡Šè¯·å‚é˜…æœ¬æ–‡çš„ç¤ºä¾‹æºä»£ç ã€‚åœ¨åœ°å€<span><a href="https://www.patreon.com/gafferongames" target="_blank" rel="noopener">https://www.patreon.com/gafferongames</a></span>å¯ä»¥è·å–æœ¬ç³»åˆ—æ–‡ç« ç¤ºä¾‹çš„æºä»£ç ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="ç½‘ç»œåè®®çš„æµ‹è¯•é©±åŠ¨å¼€å‘"><span style="color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;font-size:x-large;">ç½‘ç»œåè®®çš„æµ‹è¯•é©±åŠ¨å¼€å‘</span></span></h2><p></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿˜æœ‰ä¸€ä»¶äº‹æƒ…æˆ‘æƒ³åœ¨æ–‡ç« çš„æœ«å°¾è¿›è¡Œè¡¥å……è¯´æ˜ã€‚æˆ‘æ„Ÿè§‰å¦‚æœæˆ‘ä¸å‘æˆ‘çš„è¯»è€…æåŠè¿™ä¸ªæ–¹æ³•çš„è¯ï¼Œå°±æ˜¯å¯¹ä»–ä»¬çš„ä¸€ä¸ªä¼¤å®³ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ç¼–å†™ä¸€ä¸ªå®šåˆ¶çš„ç½‘ç»œåè®®æ˜¯éå¸¸å›°éš¾çš„ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å¦‚æ­¤çš„è‹¦éš¾ä»¥è‡³äºæˆ‘ä»å¤´å¼€å§‹è‡³å°‘ç¼–å†™äº†<span>10</span>æ¬¡ç½‘ç»œåè®®ï¼Œä½†æ˜¯æ¯æ¬¡æˆ‘éƒ½è§‰å¾—æˆ‘åœ¨ç”¨ä¸€ç§å…¨æ–°çš„æœ‰è¶£çš„æ–¹æ³•åœ¨åšè¿™ä¸ªäº‹æƒ…ã€‚ä¹Ÿè®¸ä½ ä¼šè®¤ä¸ºæ˜¯æˆ‘åœ¨æŒ‘æˆ˜è‡ªå·±ï¼Œç”¨ä¸€äº›æ–°å¥‡çš„æ–¹æ³•æ¥å®ç°è¿™ä¸ªè¿‡ç¨‹ï¼Œä½†å…¶å®æ˜¯è¿™ä¸ªè¿‡ç¨‹å¤ªå¤æ‚äº†ï¼Œå®Œå…¨æ²¡æœ‰åŠæ³•æŒ‰ç…§é¢„æœŸçš„é‚£æ ·å†™å®Œä»£ç å°±æœŸå¾…å®ƒä»¬èƒ½å¤Ÿæ­£ç¡®çš„å·¥ä½œã€‚ä½ éœ€è¦å¯¹å†™å‡ºæ¥çš„ä»£ç è¿›è¡Œæµ‹è¯•ï¼</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">å½“ç¼–å†™åº•å±‚ç½‘ç»œåè®®å±‚çš„ä»£ç çš„æ—¶å€™ï¼Œæˆ‘çš„ç­–ç•¥æ˜¯<span>:</span></span></span></p><p style=" margin: 6pt 0cm 6pt 21pt ; ; ; ; "><span style="font-family:å¾®è½¯é›…é»‘;font-size:medium;"><span style="color: rgb(34, 34, 34);">1ã€</span><span style="color: rgb(34, 34, 34);">é˜²å¾¡æ€§ç¼–ç¨‹ã€‚åœ¨ä¸€åˆ‡å¯èƒ½çš„åœ°æ–¹è¿›è¡Œæ–­è¨€ã€‚å½“æŸäº›åœ°æ–¹å‡ºç°é”™è¯¯çš„æ—¶å€™è¿™äº›æ–­è¨€ä¼šèµ·ä½œç”¨ï¼Œå¹¶ä¸”å°†æˆä¸ºæŸ¥æ‰¾é—®é¢˜çš„é‡è¦çº¿ç´¢ã€‚</span></span></p><p style=" margin: 6pt 0cm 6pt 21pt ; ; ; ; "><span style="font-family:å¾®è½¯é›…é»‘;font-size:medium;"><span style="color: rgb(34, 34, 34);">2ã€</span><span style="color: rgb(34, 34, 34);">æ·»åŠ å‡½æ•°çš„åŠŸèƒ½æµ‹è¯•ï¼Œç¡®ä¿å®ƒä»¬æ˜¯å¦‚ä½ çš„é¢„æœŸé‚£æ ·å·¥ä½œçš„ã€‚æŠŠä½ çš„ä»£ç æ”¾åˆ°ä¸€ä¸ªå¯ä»¥è¿è¡Œå’Œæµ‹è¯•çš„ç¯å¢ƒä¸‹ï¼Œè¿™æ ·å¯ä»¥ä¸æ—¶åœ°å¯¹å®ƒä»¬è¿›è¡Œæµ‹è¯•ä»¥ä¾¿å¯ä»¥ç¡®ä¿å®ƒä¸€ç›´ä¼šåƒä½ èµ·åˆåˆ›å»ºå®ƒä»¬æ—¶å€™é‚£æ ·è‰¯å¥½çš„å·¥ä½œã€‚ä»”ç»†è€ƒè™‘æœ‰å“ªäº›æƒ…å†µéœ€è¦æ­£ç¡®çš„å¤„ç†å¹¶ç»™è¿™äº›æƒ…å†µæ·»åŠ æµ‹è¯•ã€‚</span></span></p><p style=" margin: 6pt 0cm 6pt 21pt ; ; ; ; "><span style="font-family:å¾®è½¯é›…é»‘;font-size:medium;"><span style="color: rgb(34, 34, 34);">3ã€</span><span style="color: rgb(34, 34, 34);">è™½ç„¶å‡½æ•°æµ‹è¯•éå¸¸æœ‰å¿…è¦ï¼Œä½†æ˜¯åªæ˜¯æ·»åŠ ä¸€äº›å‡½æ•°æµ‹è¯•æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚æ— è®ºå¦‚ä½•éƒ½æœ‰é‡åˆ°ä½ æ²¡æœ‰é¢„æ–™åˆ°çš„æƒ…å†µ<span>! </span>ç°åœ¨ä½ å¿…é¡»æŠŠå®ƒä»¬æ”¾åˆ°ä¸€ä¸ªçœŸå®çš„ç¯å¢ƒä¸‹çœ‹çœ‹åˆ°åº•ä¼šå‘ç”Ÿä»€ä¹ˆã€‚æˆ‘æŠŠè¿™ä¸ªç§°ä¹‹ä¸ºæµ¸æ³¡æµ‹è¯•ï¼Œå¹¶ä¸”åœ¨æˆ‘ä¹‹å‰ç¼–å†™ç½‘ç»œåè®®çš„è¿‡ç¨‹ä¸­è¿˜ä»æ¥æ²¡æœ‰è¿‡åœ¨æµ¸æ³¡æµ‹è¯•çš„è¿‡ç¨‹ä¸­æ²¡æœ‰å‘ç°é—®é¢˜çš„æƒ…å†µã€‚æµ¸æ³¡æµ‹è¯•åªæ˜¯åœ¨ä¸åœçš„å¾ªç¯ï¼Œå¹¶ä¼šéšæœºçš„åšä¸€äº›äº‹æƒ…è®©ä½ çš„ç³»ç»Ÿåœ¨å®ƒçš„ç©ºé—´ä¸­å¤„ç†ä¸€äº›æƒ…å†µï¼Œè®©æˆ‘ä»¬ä¸¾äº›ç®€å•çš„ä¾‹å­å¯¹å®ƒè¿›è¡Œä¸€äº›ç®€å•çš„è¯´æ˜ï¼Œæ¯”å¦‚è¯´æ„é€ å‡ºéšæœºé•¿åº¦çš„æ•°æ®åŒ…ï¼Œè€Œä¸”è¿™äº›æ•°æ®åŒ…æœ‰ä¸€ä¸ªéå¸¸é«˜çš„ä¸¢å¤±ç‡ï¼Œé€šè¿‡æ•°æ®åŒ…æ¨¡æ‹Ÿå™¨å‘å‡ºçš„å¤§é‡ä¹±åºå¹¶ä¸”é‡å¤çš„æ•°æ®åŒ…ç­‰ç­‰ã€‚å¦‚æœä½ çš„ç¨‹åºèƒ½å¤Ÿåœ¨ä¸€æ™šä¸Šçš„æ—¶é—´é‡Œé¢ä¸æŒ‚èµ·æˆ–è€…é‡åˆ°æ–­è¨€ï¼Œé‚£ä¹ˆå°±ç®—ä½ çš„ç¨‹åºé€šè¿‡äº†æµ¸æ³¡æµ‹è¯•ã€‚</span></span></p><p style=" margin: 6pt 0cm 6pt 21pt ; ; ; ; "><span style="font-family:å¾®è½¯é›…é»‘;font-size:medium;"><span style="color: rgb(34, 34, 34);">4ã€</span><span style="color: rgb(34, 34, 34);">å¦‚æœä½ çš„ç¨‹åºåœ¨æµ¸æ³¡æµ‹è¯•çš„è¿‡ç¨‹ä¸­å‘ç°äº†æŸäº›é—®é¢˜ã€‚ä½ å¯èƒ½éœ€è¦åœ¨ä»£ç é‡Œé¢æ·»åŠ ä¸€äº›è¯¦ç»†çš„æ—¥å¿—ä»¥ä¾¿ä¸‹æ¬¡åœ¨æµ¸æ³¡æµ‹è¯•çš„æ—¶å€™å¦‚æœé‡åˆ°äº†åŒæ ·çš„é—®é¢˜ä½ å¯ä»¥æ‰¾åˆ°å‡ºç°é—®é¢˜çš„åŸå› ã€‚ä¸€æ—¦ä½ çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œå°±å¯ä»¥åœæ­¢äº†ã€‚ä¸è¦ç«‹å³çš„ä¿®å¤è¿™ä¸ªé—®é¢˜å¹¶ä¸”å†æ¬¡è¿è¡Œæµ¸æ³¡æµ‹è¯•ã€‚è¿™ç§åšæ³•éå¸¸çš„æ„šè ¢ã€‚ç›¸åï¼Œåˆ©ç”¨å•å…ƒæµ‹è¯•æ¥ä¸åœçš„é‡ç°ä½ éœ€è¦ä¿®å¤çš„é—®é¢˜ï¼Œç¡®ä¿å•å…ƒæµ‹è¯•èƒ½å¤Ÿé‡ç°é—®é¢˜ï¼Œè€Œä¸”è¿™ä¸ªé—®é¢˜å› ä¸ºä½ çš„ä¿®å¤å·²ç»å½»åº•ä¿®å¥½äº†ã€‚åªæœ‰åœ¨è¿™æ ·çš„å¤„ç†æµç¨‹ä¹‹åï¼Œæ‰èƒ½å›åˆ°æµ¸æ³¡æµ‹è¯•å¹¶ç¡®ä¿ç¨‹åºåœ¨æµ¸æ³¡æµ‹è¯•èƒ½æ­£å¸¸è¿è½¬ä¸€æ•´å¤œã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå•å…ƒæµ‹è¯•èƒ½å¤Ÿè®°å½•ä½ çš„ç³»ç»Ÿçš„æ­£ç¡®çš„è¡Œä¸ºå¹¶ä¸”åœ¨ä»¥åéœ€è¦çš„æ—¶å€™å¯ä»¥å¿«é€Ÿçš„è¿è¡Œèµ·æ¥ï¼Œç¡®ä¿å½“ä½ åšå…¶ä»–æ”¹å˜çš„æ—¶å€™ä¸ä¼šå¯¼è‡´ä¸€äº›åŸæ¥ä¿®è¿‡çš„é—®é¢˜é‡å¤çš„å‡ºç°ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™å°±æ˜¯æˆ‘çš„æ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„çš„å¤„ç†æµç¨‹äº†ï¼Œå®ƒä¼¼ä¹å·¥ä½œçš„ä¸é”™ã€‚å¦‚æœä½ åœ¨è¿›è¡Œä¸€äº›åº•å±‚çš„ç½‘ç»œåè®®çš„è®¾è®¡ï¼Œä½ çš„æ¸¸æˆçš„å…¶ä»–çš„éƒ¨åˆ†å°†ä¾èµ–äºåº•å±‚çš„ç½‘ç»œåè®®çš„è®¾è®¡ã€‚åœ¨ä½ ç»§ç»­æ„å»ºå…¶ä»–çš„åŠŸèƒ½ä¹‹å‰ï¼Œä½ éœ€è¦ç»å¯¹çš„ç¡®è®¤åº•å±‚çš„ç½‘ç»œåè®®æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸çš„å·¥ä½œï¼Œå¦åˆ™å°±åƒä¸€å †èƒ¡ä¹±å †ç§¯çš„å¡ç‰‡ï¼Œå¾ˆå®¹æ˜“å°±æ•£æ¶äº†ã€‚å¤šäººåœ¨çº¿æ¸¸æˆçš„ç½‘ç»œéƒ¨åˆ†æ˜¯éå¸¸å›°éš¾çš„ï¼Œå¦‚æœä¸å°å¿ƒè®¾è®¡çš„è¯ï¼Œå¾ˆå®¹æ˜“å°±ä¼šå‡ºç°åº•å±‚ç½‘ç»œåè®®å¯èƒ½æ— æ³•æ­£å¸¸çš„å·¥ä½œæˆ–è€…å­˜åœ¨ç¼ºé™·ã€‚æ‰€ä»¥è¯·ç¡®ä¿ä½ æ˜¯çŸ¥é“ä½ çš„åº•å±‚ç½‘ç»œåè®®æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼</span></span></p><b><span style="font-size: 12pt; line-height: 156%; font-weight: normal;"><span style="font-family:å¾®è½¯é›…é»‘;">å³å°†åˆ°æ¥çš„æ–‡ç« çš„é¢„å‘Š</span></span></b><div><span style="font-size: 12pt; line-height: 156%; font-weight: normal;"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸‹ä¸€ç¯‡æ–‡ç« æ˜¯<span>: </span>ã€Šå‘é€å¤§å—çš„æ•°æ®ã€‹</span></span></p><p class="MsoNormal" align="left" style="line-height: 18pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¯·ç»§ç»­é˜…è¯»æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œåœ¨å“ªç¯‡æ–‡ç« é‡Œé¢æˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•é€šè¿‡æ•°æ®åŒ…å¿«é€Ÿå¯ä¿¡èµ–çš„å‘é€å¤§å—çš„æ•°æ®ï¼Œå¦‚æœå…¶ä¸­ä¸€å—æ•°æ®ä¸¢å¤±äº†ä¹Ÿä¸éœ€è¦ä¸¢å¼ƒæ•´ä¸ªæ•°æ®åŒ…ï¼</span></span></p><p class="MsoNormal" align="left" style="line-height: 18pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ä»·å€¼çš„è¯ï¼Œè¯·åœ¨<span>patreon</span>ä¸Šæ”¯æŒæˆ‘çš„å†™ä½œï¼Œè¿™æ ·æˆ‘ä¼šå†™çš„æ›´å¿«ã€‚ä½ å¯ä»¥åœ¨<span>BSD 3.0</span>è®¸å¯ä¸‹è®¿é—®åˆ°è¿™ç¯‡æ–‡ç« é‡Œé¢çš„ä»£ç ã€‚éå¸¸æ„Ÿè°¢ä½ çš„æ”¯æŒï¼</span></span></p><p class="MsoNormal" align="left" style="line-height: 18pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 18pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ã€ç‰ˆæƒå£°æ˜ã€‘</span></span></p><p class="MsoNormal"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">åŸæ–‡ä½œè€…æœªåšæƒåˆ©å£°æ˜ï¼Œè§†ä¸ºå…±äº«çŸ¥è¯†äº§æƒè¿›å…¥å…¬å…±é¢†åŸŸï¼Œè‡ªåŠ¨è·å¾—æˆæƒã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span></p><p class="MsoNormal"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span></p></div>                    <br>                

          
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/serialization_strategies/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/serialization_strategies/" itemprop="url">æ„å»ºæ¸¸æˆç½‘ç»œåè®®äºŒä¹‹åºåˆ—åŒ–ç­–ç•¥</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-25T17:13:35+00:00">
                02-25-2017
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GS/" itemprop="url" rel="index">
                    <span itemprop="name">GS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          <h1 id="è‡ªæˆ‘æ€»ç»“æœ¬ç¯‡æ¦‚è¦"><a href="#è‡ªæˆ‘æ€»ç»“æœ¬ç¯‡æ¦‚è¦" class="headerlink" title="è‡ªæˆ‘æ€»ç»“æœ¬ç¯‡æ¦‚è¦"></a>è‡ªæˆ‘æ€»ç»“æœ¬ç¯‡æ¦‚è¦</h1><ul>
<li>è¯»å–æ•°æ®çš„æ—¶å€™è¦ç‰¹åˆ«å°å¿ƒï¼Œ å› ä¸ºå¯èƒ½ä¼šæœ‰æ”»å‡»è€…å‘é€è¿‡æ¥çš„æ¶æ„çš„æ•°æ®åŒ…ä»¥åŠé”™è¯¯çš„åŒ…ï¼Œ åœ¨å†™å…¥æ•°æ®çš„æ—¶å€™ä½ å¯èƒ½ä¼šè½»æ¾å¾ˆå¤šï¼Œå› ä¸ºå¦‚æœæœ‰ä»»ä½•äº‹æƒ…å‡ºé”™äº†ï¼Œé‚£å‡ ä¹è‚¯å®šæ˜¯ä½ è‡ªå·±å¯¼è‡´çš„é”™è¯¯</li>
<li><p><strong>ç»Ÿä¸€çš„æ•°æ®åŒ…åºåˆ—åŒ–åŠŸèƒ½</strong> ï¼šè¯€çªåœ¨äºè®©æµç±»å‹çš„åºåˆ—åŒ–å‡½æ•°æ¨¡æ¿åŒ–ã€‚åœ¨æˆ‘çš„ç³»ç»Ÿä¸­æœ‰ä¸¤ä¸ªæµç±»å‹ï¼šReadStreamç±»å’ŒWriteStreamç±»ã€‚æ¯ä¸ªç±»éƒ½æœ‰ç›¸åŒçš„ä¸€å¥—æ–¹æ³•ï¼Œä½†å®é™…ä¸Šå®ƒä»¬æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚ä¸€ä¸ªç±»è´Ÿè´£ä»æ¯”ç‰¹æµè¯»å–å€¼åˆ°å˜é‡ä¸­ï¼Œå¦å¤–ä¸€ä¸ªç±»è´Ÿè´£æŠŠå˜é‡çš„å€¼å†™åˆ°æµä¸­ã€‚<br>åœ¨æ¨¡æ¿é‡Œç±»ä¼¼è¿™æ ·å†™, é€šè¿‡ <code>Stream::IsWriting</code> å’Œ <code>Stream::IsReading</code> æ¨¡æ¿ä¼šè‡ªåŠ¨åŒºåˆ†,ç„¶åå¸®ä½ ç”Ÿäº§ä½ æƒ³è¦çš„ä»£ç , ç®€æ´æ¼‚äº®</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WriteStream</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">enum</span> &#123; IsWriting = <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">enum</span> &#123; IsReading = <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadStream</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">enum</span> &#123; IsWriting = <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="keyword">enum</span> &#123; IsReading = <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Stream&gt;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">serialize</span><span class="params">( Stream &amp; stream, <span class="keyword">float</span> &amp; value )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">union</span> FloatInt</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">float</span> float_value;</span><br><span class="line">       <span class="keyword">uint32_t</span> int_value;</span><br><span class="line">   &#125;;</span><br><span class="line">  </span><br><span class="line">   FloatInt tmp;</span><br><span class="line">   <span class="keyword">if</span> ( Stream::IsWriting )</span><br><span class="line">       tmp.float_value = value;</span><br><span class="line">  </span><br><span class="line">   <span class="keyword">bool</span> result = stream.SerializeBits( tmp.int_value, <span class="number">32</span> );</span><br><span class="line">  </span><br><span class="line">   <span class="keyword">if</span> ( Stream::IsReading )</span><br><span class="line">       value = tmp.float_value;</span><br><span class="line">  </span><br><span class="line">   <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è¾¹ç•Œæ£€æŸ¥å’Œç»ˆæ­¢è¯»å–</strong> ï¼š æŠŠå…è®¸çš„å¤§å°èŒƒå›´ä¹Ÿä¼ ç»™åºåˆ—åŒ–å‡½æ•°è€Œä¸ä»…ä»…æ˜¯æ‰€éœ€çš„æ¯”ç‰¹æ•°é‡ã€‚</p>
</li>
<li><p><strong>åºåˆ—åŒ–æµ®ç‚¹æ•°å’Œå‘é‡</strong> ï¼š è®¡ç®—æœºæ ¹æœ¬ä¸çŸ¥é“å†…å­˜ä¸­çš„è¿™ä¸ª32ä½çš„å€¼åˆ°åº•æ˜¯ä¸€ä¸ªæ•´æ•°è¿˜æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°è¿˜æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„éƒ¨åˆ†ã€‚å®ƒçŸ¥é“çš„å°±æ˜¯è¿™ä»…ä»…æ˜¯ä¸€ä¸ª32ä½çš„å€¼ã€‚ä»£ç å¦‚ä¸‹(å¯ä»¥é€šè¿‡ä¸€ä¸ªè”åˆä½“æ¥è®¿é—®çœ‹ä¸Šå»æ˜¯æ•´æ•°çš„æµ®ç‚¹æ•°).<br>æœ‰äº›æ—¶å€™ï¼Œä½ å¹¶ä¸æƒ³æŠŠä¸€ä¸ªå®Œæ•´ç²¾åº¦çš„æµ®ç‚¹æ•°è¿›è¡Œä¼ é€’ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•å‹ç¼©è¿™ä¸ªæµ®ç‚¹å€¼ï¼Ÿç¬¬ä¸€æ­¥æ˜¯å°†å®ƒçš„å€¼é™åˆ¶åœ¨æŸä¸ªç¡®å®šçš„èŒƒå›´å†…ç„¶åç”¨ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºæ–¹å¼æ¥å°†å®ƒé‡åŒ–ã€‚<br>ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œå¦‚æœä½ çŸ¥é“ä¸€ä¸ªæµ®ç‚¹ç±»å‹çš„å€¼æ˜¯åœ¨åŒºé—´[-10,+10]ï¼Œå¯¹äºè¿™ä¸ªå€¼æ¥è¯´å¯ä»¥æ¥å—çš„ç²¾ç¡®åº¦æ˜¯0.01ï¼Œé‚£ä¹ˆä½ å¯ä»¥æŠŠè¿™ä¸ªæµ®ç‚¹æ•°ä¹˜ä»¥100.0è®©å®ƒçš„å€¼åœ¨åŒºé—´[-1000,+1000]å¹¶åœ¨ç½‘ç»œä¸Šå°†å…¶ä½œä¸ºä¸€ä¸ªæ•´æ•°è¿›è¡Œåºåˆ—åŒ–ã€‚è€Œåœ¨æ¥æ”¶çš„é‚£ä¸€ç«¯ï¼Œä»…ä»…éœ€è¦å°†å®ƒé™¤ä»¥100.0æ¥å¾—åˆ°æœ€åˆçš„æµ®ç‚¹å€¼. </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">union</span> FloatInt</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">float</span> float_value;</span><br><span class="line">   <span class="keyword">uint32_t</span> int_value;</span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line">FloatInt tmp;</span><br><span class="line">tmp.float_value= <span class="number">10.0f</span>;</span><br><span class="line"><span class="built_in">printf</span>(â€œ<span class="keyword">float</span> value as an integer: %x\nâ€, tmp.int_value );</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>åºåˆ—åŒ–å­—ç¬¦ä¸²å’Œæ•°ç»„</strong> : ä¸ºä»€ä¹ˆè¦è´¹é‚£ä¹ˆå¤§ç²¾åŠ›æŠŠä¸€ä¸ªå­—èŠ‚æ•°ç»„æŒ‰æ¯”ç‰¹æ‰“åŒ…åˆ°ä½ çš„æ¯”ç‰¹æµé‡Œ?ä¸ºä»€ä¹ˆä¸åœ¨åºåˆ—åŒ–å†™å…¥ä¹‹å‰è¿›è¡ŒæŒ‰å­—èŠ‚è¿›è¡Œå¯¹é½ï¼ŸWhy not align to byte so you can <strong>memcpy</strong> the array of bytes directly into the packet?<br>å¦‚ä½•å°†æ¯”ç‰¹æµæŒ‰å­—èŠ‚å¯¹é½ï¼Ÿåªéœ€è¦åœ¨æµçš„å½“å‰ä½ç½®åšäº›è®¡ç®—å°±å¯ä»¥äº†ï¼Œæ‰¾å‡ºè¿˜å·®å†™å…¥å¤šå°‘ä¸ªæ¯”ç‰¹å°±èƒ½è®©å½“å‰æ¯”ç‰¹æµçš„æ¯”ç‰¹æ•°é‡è¢«8æ•´é™¤ï¼Œç„¶åæŒ‰ç…§è¿™ä¸ªæ•°å­—æ’å…¥å¡«å……æ¯”ç‰¹ï¼ˆæ¯”å¦‚å½“å‰æ¯”ç‰¹æµçš„æ¯”ç‰¹æ•°é‡æ˜¯323ï¼Œé‚£ä¹ˆ323+5æ‰èƒ½è¢«8æ•´é™¤ï¼Œæ‰€ä»¥éœ€è¦æ’å…¥5ä¸ªå¡«å……æ¯”ç‰¹ï¼‰ã€‚å¯¹äºå¡«å……æ¯”ç‰¹æ¥è¯´ï¼Œå¡«å……çš„æ¯”ç‰¹å€¼éƒ½æ˜¯0ï¼Œè¿™æ ·å½“ä½ åºåˆ—åŒ–è¯»å–çš„æ—¶å€™ä½ å¯ä»¥è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœæ£€æµ‹çš„ç»“æœæ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆå°±ç¡®å®æ˜¯åœ¨è¯»å–å¡«å……çš„éƒ¨åˆ†ï¼Œå¹¶ä¸”å¡«å……çš„éƒ¨åˆ†ç¡®å®æ˜¯0ã€‚ä¸€ç›´è¯»å–åˆ°ä¸‹ä¸€ä¸ªå®Œæ•´å­—èŠ‚çš„æ¯”ç‰¹èµ·å§‹ä½ç½®ï¼ˆå¯ä»¥è¢«8æ•´é™¤çš„ä½ç½®ï¼‰ã€‚å¦‚æœæ£€æµ‹çš„ç»“æœæ˜¯åœ¨åº”è¯¥å¡«å……çš„åœ°æ–¹å‘ç°äº†é0çš„æ¯”ç‰¹å€¼ï¼Œé‚£ä¹ˆå°±ä¸­æ­¢åºåˆ—åŒ–è¯»å–å¹¶ä¸¢å¼ƒè¿™ä¸ªæ•°æ®åŒ…ã€‚</p>
</li>
<li><strong>åºåˆ—åŒ–æ•°ç»„çš„å­é›†</strong> : å½“å®ç°ä¸€ä¸ªæ¸¸æˆç½‘ç»œåè®®çš„æ—¶å€™ï¼Œæˆ–æ—©æˆ–æ™šæ€»ä¼šéœ€è¦åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡æ•°ç»„ç„¶ååœ¨ç½‘ç»œä¸Šä¼ é€’ã€‚æ¯”å¦‚è¯´æœåŠ¡å™¨ä¹Ÿè®¸éœ€è¦æŠŠæ‰€æœ‰çš„ç‰©ä½“å‘é€ç»™å®¢æˆ·ç«¯ï¼Œæˆ–è€…æœ‰æ—¶å€™éœ€è¦å‘é€ä¸€ç»„äº‹ä»¶æˆ–è€…æ¶ˆæ¯ã€‚å¦‚æœä½ è¦å‘é€æ‰€æœ‰çš„ç‰©ä½“åˆ°å®¢æˆ·ç«¯ï¼Œè¿™æ˜¯ç›¸å½“ç®€å•ç›´è§‚çš„ï¼Œä½†æ˜¯å¦‚æœä½ åªæ˜¯æƒ³å‘é€ä¸€ä¸ªæ•°ç»„çš„ä¸€ä¸ªå­é›†æ€ä¹ˆåŠï¼Ÿ<br>æœ€å…ˆæƒ³åˆ°ä¹Ÿæ˜¯æœ€å®¹æ˜“çš„åŠæ³•æ˜¯éå†æ•°ç»„çš„æ‰€æœ‰ç‰©ä½“ç„¶ååºåˆ—åŒ–ä¸€ä¸ªboolæ•°ç»„ï¼Œè¿™ä¸ªboolæ•°ç»„æ ‡è®°çš„æ˜¯å¯¹åº”çš„ç‰©ä½“æ˜¯å¦é€šè¿‡ç½‘ç»œå‘é€ã€‚å¦‚æœboolå€¼ä¸º1é‚£ä¹ˆåé¢ä¼šè·Ÿç€ç‰©ä½“çš„æ•°æ®ï¼Œå¦åˆ™å°±ä¼šè¢«å¿½ç•¥ç„¶åä¸‹ä¸€ä¸ªç‰©ä½“çš„boolå€¼å–å†³äºæµçš„ä¸‹ä¸€ä¸ªå€¼ã€‚<br>å¦‚æœæœ‰å¤§é‡çš„ç‰©ä½“éœ€è¦å‘é€ï¼Œä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œæ•´ä¸ªåœºæ™¯ä¸­æœ‰4000ä¸ªç‰©ä½“ï¼Œæœ‰ä¸€åŠçš„ç‰©ä½“ä¹Ÿå°±æ˜¯2000ä¸ªéœ€è¦é€šè¿‡ç½‘ç»œè¿›è¡Œå‘é€ã€‚æ¯ä¸ªç‰©ä½“éœ€è¦ä¸€ä¸ªåºå·ï¼Œé‚£ä¹ˆå°±éœ€è¦2000ä¸ªåºå·ï¼Œæ¯ä¸ªåºå·éœ€è¦12æ¯”ç‰¹ã€‚ã€‚ã€‚ã€‚è¿™å°±æ˜¯è¯´æ•°æ®åŒ…é‡Œé¢24000æ¯”ç‰¹æˆ–è€…è¯´æ¥è¿‘30000æ¯”ç‰¹ï¼ˆå‡ ä¹æ˜¯30000ï¼Œä¸æ˜¯ä¸¥æ ¼æ˜¯ï¼Œè¯‘æ³¨ï¼šåŸæ–‡å¦‚æ­¤ï¼‰çš„æ•°æ®è¢«åºå·æµªè´¹æ‰äº†.<br>å¯ä»¥æŠŠåºå·çš„ç¼–ç æ–¹å¼ä¿®æ”¹ä¸‹æ¥èŠ‚çœæ•°æ®ï¼Œåºå·ä¸å†æ˜¯å…¨å±€åºå·ï¼Œè€Œæ˜¯ç›¸å¯¹ä¸Šä¸€ä¸ªç‰©ä½“çš„ç›¸å¯¹åºå·ã€‚</li>
<li><strong>å¦‚ä½•åº”å¯¹æ¶æ„æ•°æ®åŒ…å’Œé”™è¯¯åŒ…</strong> : å¦‚æœæŸäº›äººå‘é€ä¸€äº›åŒ…å«éšæœºä¿¡æ¯çš„æ¶æ„æ•°æ®åŒ…ç»™ä½ çš„æœåŠ¡å™¨ã€‚ä½ ä¼šä¸ä¼šåœ¨è§£æçš„æ—¶å€™æŠŠæœåŠ¡å™¨å¼„å´©æºƒæ‰ï¼Ÿ<br>æœ‰ä¸‰ç§æŠ€æœ¯åº”å¯¹ : <ul>
<li>åè®®ID : åœ¨ä½ çš„æ•°æ®åŒ…é‡Œé¢åŒ…å«åè®®IDã€‚ä¸€èˆ¬å…¸å‹çš„åšæ³•æ˜¯ï¼Œå¤´4ä¸ªå­—èŠ‚ä½ å¯ä»¥è®¾å®šä¸€äº›æ¯”è¾ƒç½•è§è€Œä¸”ç‹¬ç‰¹çš„å€¼ï¼Œä½ å¯ä»¥é€šè¿‡è¿™ï¼“ï¼’æ¯”ç‰¹çš„æ•°æ®åˆ¤æ–­å‡ºæ¥æ ¹æœ¬å°±ä¸æ˜¯ä½ çš„åº”ç”¨ç¨‹åºçš„åŒ…ï¼Œç„¶åå°±å¯ä»¥ç›´æ¥ä¸¢å¼ƒäº†ã€‚</li>
<li>CRC32 : å¯¹ä½ çš„æ•°æ®åŒ…æ•´ä½“åšä¸€ä¸ªCRC32çš„æ ¡éªŒï¼Œå¹¶æŠŠè¿™ä¸ªæ ¡éªŒç æ”¾åˆ°æ•°æ®åŒ…çš„åŒ…å¤´ã€‚å¯ä»¥ä¸å‘é€è¿™ä¸ªåè®®IDï¼Œä½†æ˜¯å‘é€æ–¹å’Œæ¥æ”¶æ–¹æå‰ç¡®è®¤è¿‡è¿™ä¸ªåè®®IDæ˜¯ä»€ä¹ˆï¼Œå¹¶åœ¨è®¡ç®—æ•°æ®åŒ…CRC32å€¼çš„æ—¶å€™è£…ä½œè¿™ä¸ªæ•°æ®åŒ…å¸¦ä¸Šäº†è¿™ä¸ªåè®®IDçš„å‰ç¼€æ¥å‚ä¸è®¡ç®—ã€‚è¿™æ ·å¦‚æœå‘é€æ–¹ä½¿ç”¨çš„åè®®IDä¸æ¥æ”¶æ–¹ä¸ä¸€è‡´çš„æ—¶å€™ï¼ŒCRC32çš„æ ¡éªŒå°±ä¼šå¤±è´¥ï¼Œè¿™å°†ä¸ºæ¯ä¸ªæ•°æ®åŒ…èŠ‚çœ4ä¸ªå­—èŠ‚.</li>
<li>åºåˆ—åŒ–æ£€æµ‹ : æ˜¯åœ¨åŒ…çš„ä¸­é—´ï¼Œåœ¨ä¸€æ®µå¤æ‚çš„åºåˆ—åŒ–å†™å…¥ä¹‹å‰æˆ–è€…ä¹‹åå†™ä¸Šä¸€ä¸ªå·²çŸ¥çš„32æ¯”ç‰¹æ•´æ•°ï¼Œå¹¶åœ¨å¦å¤–ä¸€ç«¯åºåˆ—åŒ–è¯»å–çš„æ—¶å€™ç”¨ç›¸åŒçš„å€¼è¿›è¡Œæ£€æµ‹åˆ¤æ–­ã€‚å¦‚æœåºåˆ—åŒ–æ£€æŸ¥å€¼æ˜¯ä¸æ­£ç¡®çš„ï¼Œé‚£ä¹ˆå°±ä¸­æ­¢åºåˆ—åŒ–è¯»å–å¹¶ä¸¢å¼ƒè¿™ä¸ªæ•°æ®åŒ…ã€‚<br><strong>. . .</strong>
          <!--noindex-->
          
          <!--/noindex-->
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </li></ul></li></ul></div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/20/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="page-number" href="/page/12/">12</a><a class="page-number" href="/page/13/">13</a><a class="page-number" href="/page/14/">14</a><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><a class="page-number" href="/page/17/">17</a><a class="page-number" href="/page/18/">18</a><a class="page-number" href="/page/19/">19</a><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><a class="page-number" href="/page/25/">25</a><a class="page-number" href="/page/26/">26</a><a class="page-number" href="/page/27/">27</a><a class="page-number" href="/page/28/">28</a><a class="page-number" href="/page/29/">29</a><a class="page-number" href="/page/30/">30</a><a class="page-number" href="/page/31/">31</a><span class="space">&hellip;</span><a class="page-number" href="/page/38/">38</a><a class="extend next" rel="next" href="/page/22/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  

  <aside id="sidebar" class="sidebar">

    
      
        <div id="sidebar-dimmer"></div>
      
    

    <div class="sidebar-inner">
    
      <div class="sidebar-toggle-inside motion-element">
        <div class="sidebar-toggle-line-wrap">
          <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
          <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
          <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
        </div>
      </div>

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a href="/" class="site-author-image" rel="start" style="border:none">
            <img class="site-author-image" itemprop="image" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/uploads/avatar.png" alt="Mike">
          </a>
          <p class="site-author-name" itemprop="name">Mike</p>
           
              <p class="site-description motion-element" itemprop="description">ğŸš™ ğŸš— ğŸ’¨ ğŸ’¨ If you want to create a blog like this, just follow my open-source project, "hexo-theme-neo", click the GitHub button below and check it out ^_^ . It is recommended to use Chrome, Safari, or Edge to read this blog since this blog was developed on Edge (Chromium kernel version) and tested on Safari.</p>
          
        </div>

        <nav class="site-state motion-element">

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">298</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">111</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

          <div class="site-state-item site-state-about">
            <a href="/about/">
              <span class="site-state-item-about fa fa-fw fa-user"></span>
              <span class="site-state-item-name">about</span>
            </a>
          </div>
          
        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/no5ix" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://open.spotify.com/user/313duq77ekebrfyak3xijqewzss4?si=e7653b829a9747bf" target="_blank" title="Spotify">
                  
                    <i class="fa fa-fw fa-spotify"></i>
                  
                    
                      Spotify
                    
                </a>
              </span>
            
          
          
          <!-- ç½‘æ˜“äº‘éŸ³ä¹ -->
            <!-- <div class="netease-cloud-music"> -->
              <!-- <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=280 height=110 src="//music.163.com/outchain/player?type=0&id=992743594&auto=0&height=90"></iframe> -->
            <!-- </div> -->
          <!-- ç½‘æ˜“äº‘éŸ³ä¹ -->

        </div>

        
        

        
        

        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mike</span>
</div>



        

        
      </div>
    </footer>

    <!--
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      
        <span id="scrollpercent"><span>0</span>%</span>
      
    </div>
    -->

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>










  















  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/mediumzoom/medium-zoom.js?v=1.1.0"></script>





  




  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>


  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

    <script src="/js/src/local-search.js"></script>





  

  

  

  

  

  


  <script type="text/javascript" src="/lib/wobble_window/wobblewindow.js"> </script>
<script type="text/javascript" src="/js/src/custom.js"></script>
</body>
</html>






<script type="text/javascript" src="/js/src/headroom.js"></script>

<!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½ -->
<script type="text/javascript" src="/js/src/code-highlight-modification.js"></script>

<!-- Flashcards Script -->
<script type="text/javascript" src="/js/src/flashcards.js"></script>
