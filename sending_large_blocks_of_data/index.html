<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


  <meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">

<script>
    (function(){
        if(''){
            let localStoragePasswdKey = 'æ„å»ºæ¸¸æˆç½‘ç»œåè®®å››ä¹‹å‘é€å¤§å—æ•°æ®' + '_last_passwd';
            let tryCnt = 0;
            function checkPassword(password) {
                password = password == null ? null : password.trim();
                if (password !== '') {
                    if (password != null) {
                        // å¦‚æœç”¨æˆ·ç‚¹å‡»äº†ç¡®è®¤è€Œä¸”å¯†ç é”™è¯¯çš„æ—¶å€™, å› ä¸ºå½“password == nullçš„æ—¶å€™è¯´æ˜ç”¨æˆ·ç‚¹äº†å–æ¶ˆ
                        alert('Error!');
                        if (++tryCnt < 3) {
                            password = prompt('Open Sesame');
                            checkPassword(password);
                            return;
                        }
                    }

                    // if (history.length > 1) {
                    //     alert('back!');
                    //     history.back();
                    // } else {
                        // alert('blankkkk!');
                    //     window.location.href = "about:blank";
                    // }
                    if (document.referrer) {
                        window.location.href = document.referrer;
                    } else {
                        window.location.href = "about:blank";; // fallback if no referrer
                    }

                } else {
                    localStorage.setItem(localStoragePasswdKey, password);
                }
            }

            var password_verify_on_local = false;
            const hostname = window.location.hostname;
            if (password_verify_on_local || (!(hostname === "localhost" || hostname === "127.0.0.1" || hostname === "::1" || hostname.startsWith("192")))) {
                const lspk = localStorage.getItem(localStoragePasswdKey) || "";
                if (lspk !== '') {
                    var password = prompt('Open Sesame');
                    checkPassword(password);
                }
            }
        }
    })();
</script>








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">





















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="GafferOnGames,">








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2">






<meta name="description" content="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“æœ‰äº†æœ¬ç³»åˆ—ä¸Šç¯‡æ–‡ç« ä¸­çš„åˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿä¸ºä½•è¿˜è¦è¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ?æ˜¯å¦æ˜¯å¤šä½™çš„?æ˜¯é›·åŒçš„å—?è¯·çœ‹æ€»ç»“æ¦‚è¦ç†æ¸…æ€è·¯, å†ç»†çœ‹æ–‡ç« . ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿç¬¬ä¸€çœ¼çœ‹ä¸Šå»ï¼Œè¿™ç§æ›¿ä»£æ€§çš„æŠ€æœ¯ä¼¼ä¹éå¸¸ç±»ä¼¼äºæ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ï¼Œä½†æ˜¯å®ƒçš„å®ç°æ˜¯å®Œå…¨ä¸åŒçš„ã€‚è¿™ç§å®ç°ä¸Šçš„å·®å¼‚çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³æ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„çš„ä¸€ä¸ªå…³é”®å¼±ç‚¹ : ä¸€ä¸ªç‰‡æ®µçš„ä¸¢å¤±å°±ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®åŒ…éƒ½è¦è¢«ä¸¢å¼ƒæ‰ç„¶åé‡æ–°åˆ†åŒ…é‡å‘ã€‚ ä½ å¯">
<meta name="keywords" content="GafferOnGames">
<meta property="og:type" content="article">
<meta property="og:title" content="æ„å»ºæ¸¸æˆç½‘ç»œåè®®å››ä¹‹å‘é€å¤§å—æ•°æ®">
<meta property="og:url" content="https://hulinhong.com/sending_large_blocks_of_data/index.html">
<meta property="og:site_name" content="ğŸš™">
<meta property="og:description" content="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“æœ‰äº†æœ¬ç³»åˆ—ä¸Šç¯‡æ–‡ç« ä¸­çš„åˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿä¸ºä½•è¿˜è¦è¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ?æ˜¯å¦æ˜¯å¤šä½™çš„?æ˜¯é›·åŒçš„å—?è¯·çœ‹æ€»ç»“æ¦‚è¦ç†æ¸…æ€è·¯, å†ç»†çœ‹æ–‡ç« . ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿç¬¬ä¸€çœ¼çœ‹ä¸Šå»ï¼Œè¿™ç§æ›¿ä»£æ€§çš„æŠ€æœ¯ä¼¼ä¹éå¸¸ç±»ä¼¼äºæ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ï¼Œä½†æ˜¯å®ƒçš„å®ç°æ˜¯å®Œå…¨ä¸åŒçš„ã€‚è¿™ç§å®ç°ä¸Šçš„å·®å¼‚çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³æ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„çš„ä¸€ä¸ªå…³é”®å¼±ç‚¹ : ä¸€ä¸ªç‰‡æ®µçš„ä¸¢å¤±å°±ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®åŒ…éƒ½è¦è¢«ä¸¢å¼ƒæ‰ç„¶åé‡æ–°åˆ†åŒ…é‡å‘ã€‚ ä½ å¯">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2025-12-17T18:31:29.674Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="æ„å»ºæ¸¸æˆç½‘ç»œåè®®å››ä¹‹å‘é€å¤§å—æ•°æ®">
<meta name="twitter:description" content="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“æœ‰äº†æœ¬ç³»åˆ—ä¸Šç¯‡æ–‡ç« ä¸­çš„åˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿä¸ºä½•è¿˜è¦è¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ?æ˜¯å¦æ˜¯å¤šä½™çš„?æ˜¯é›·åŒçš„å—?è¯·çœ‹æ€»ç»“æ¦‚è¦ç†æ¸…æ€è·¯, å†ç»†çœ‹æ–‡ç« . ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿç¬¬ä¸€çœ¼çœ‹ä¸Šå»ï¼Œè¿™ç§æ›¿ä»£æ€§çš„æŠ€æœ¯ä¼¼ä¹éå¸¸ç±»ä¼¼äºæ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ï¼Œä½†æ˜¯å®ƒçš„å®ç°æ˜¯å®Œå…¨ä¸åŒçš„ã€‚è¿™ç§å®ç°ä¸Šçš„å·®å¼‚çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³æ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„çš„ä¸€ä¸ªå…³é”®å¼±ç‚¹ : ä¸€ä¸ªç‰‡æ®µçš„ä¸¢å¤±å°±ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®åŒ…éƒ½è¦è¢«ä¸¢å¼ƒæ‰ç„¶åé‡æ–°åˆ†åŒ…é‡å‘ã€‚ ä½ å¯">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":12,"scrollpercent":true,"onmobile":true,"dimmer":true,"body_content_height":0,"display_duration":150},
    local_search: {"enable":true,"trigger":"auto","top_n_per_article":1},
    fancybox: false,
    mediumzoom: true,
    darkmode_js: false,
    tabs: true,
    motion: {"enable":true,"async":false,"duration":188,"transition":{"header":"fadeIn","menu":"fadeIn","logo":"fadeIn","post_block_else":"fadeIn","post_header":"fadeIn","post_body":"fadeIn","coll_header":"fadeIn","footer":"fadeIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>








  <title>æ„å»ºæ¸¸æˆç½‘ç»œåè®®å››ä¹‹å‘é€å¤§å—æ•°æ® | ğŸš™</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ğŸš™</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ğŸ’¨ ğŸ’¨ ğŸ’¨</p>
      
  </div>

  <div class="menu-item sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div class="menu-item site-search">
    
  
  <div class="site-search-div">
    <button class="search-icon" id="search-button">
      <i class="fa fa-search"></i>
    </button>
    <input type="text" id="local-search-input" class="st-search-input">
    <i id="local-search-close">Ã—</i>
  </div>


<script type="text/javascript" id="local.search.active">
    {/* var inputArea       = document.querySelector("#local-search-input");
    inputArea.onclick   = function(){ getSearchFile(); this.focus(); }
    inputArea.onkeydown = function(){ if(event.keyCode == 13) return false } */}
</script>



  </div>
  <div id="local-search-result-pc" class="local-search-result-cls"></div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

       
    </ul>
  

  
    
  
</nav>



 </div>
    </header>

    <div id="local-search-result-mobile" class="local-search-result-cls"></div>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/sending_large_blocks_of_data/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">æ„å»ºæ¸¸æˆç½‘ç»œåè®®å››ä¹‹å‘é€å¤§å—æ•°æ®</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-28T15:13:35+00:00">
                02-28-2017
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GS/" itemprop="url" rel="index">
                    <span itemprop="name">GS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            <div class="post-tags">
              
                <a href="/tags/GafferOnGames/" rel="tag"><i class="fa fa-tag"></i> GafferOnGames</a>
              
            </div>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/packet_fragmentation_and_reassembly/" rel="next" title="æ„å»ºæ¸¸æˆç½‘ç»œåè®®ä¸‰ä¹‹æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„">
                <i class="fa fa-chevron-left"></i> 
                <p class="post-nav-pre-next-title">
                  æ„å»ºæ¸¸æˆç½‘ç»œåè®®ä¸‰ä¹‹æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„
                </p> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/kbe_ue4_demo/" rel="prev" title="KBEçš„UE4çš„demoå¤§ä½“è§£è¯»">
              <p class="post-nav-pre-next-title">
                  KBEçš„UE4çš„demoå¤§ä½“è§£è¯»
              </p> 
              <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      

      
      

      
        <h1 id="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"><a href="#æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“" class="headerlink" title="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"></a>æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“</h1><p>æœ‰äº†æœ¬ç³»åˆ—ä¸Šç¯‡æ–‡ç« ä¸­çš„åˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿä¸ºä½•è¿˜è¦è¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ?æ˜¯å¦æ˜¯å¤šä½™çš„?æ˜¯é›·åŒçš„å—?<br>è¯·çœ‹æ€»ç»“æ¦‚è¦ç†æ¸…æ€è·¯, å†ç»†çœ‹æ–‡ç« .</p>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ</h2><p>ç¬¬ä¸€çœ¼çœ‹ä¸Šå»ï¼Œè¿™ç§æ›¿ä»£æ€§çš„æŠ€æœ¯ä¼¼ä¹éå¸¸ç±»ä¼¼äºæ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ï¼Œä½†æ˜¯å®ƒçš„å®ç°æ˜¯å®Œå…¨ä¸åŒçš„ã€‚è¿™ç§å®ç°ä¸Šçš„å·®å¼‚çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³æ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„çš„ä¸€ä¸ªå…³é”®å¼±ç‚¹ : ä¸€ä¸ªç‰‡æ®µçš„ä¸¢å¤±å°±ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®åŒ…éƒ½è¦è¢«ä¸¢å¼ƒæ‰ç„¶åé‡æ–°åˆ†åŒ…é‡å‘ã€‚</p>
<p>ä½ å¯èƒ½éœ€è¦è¿™æ ·åšçš„ä¸€äº›å¸¸è§çš„ä¾‹å­åŒ…æ‹¬ï¼šå®¢æˆ·ç«¯åœ¨é¦–æ¬¡åŠ å…¥çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éœ€è¦ä¸‹å‘ä¸€ä¸ªå¤§çš„æ•°æ®å—ç»™å®¢æˆ·ç«¯(å¯èƒ½æ˜¯ä¸–ç•Œçš„åˆå§‹çŠ¶æ€)ã€ä¸€å¼€å§‹ç”¨æ¥åšå¢é‡ç¼–ç çš„åŸºçº¿æˆ–è€…æ˜¯åœ¨ä¸€ä¸ªå¤šäººåœ¨çº¿ç½‘ç»œæ¸¸æˆé‡Œé¢å®¢æˆ·ç«¯åœ¨åŠ è½½ç•Œé¢æ‰€ç­‰å¾…çš„å¤§å—æ•°æ®ã€‚</p>
<p>åœ¨è¿™äº›æƒ…å†µä¸‹éå¸¸é‡è¦çš„æ˜¯ä¸ä»…è¦ä¼˜é›…åœ°å¤„ç†æ•°æ®åŒ…çš„ä¸¢å¤±ï¼Œè¿˜è¦å°½å¯èƒ½çš„åˆ©ç”¨å¯ç”¨çš„å¸¦å®½å¹¶å°½å¯èƒ½å¿«çš„å‘é€å¤§å—æ•°æ®ã€‚</p>
<p>è¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿå¤§è‡´å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªåœ¨åŸæ¥åˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿçš„åŸºç¡€ä¸Šå¢åŠ äº†åˆ†åŒ…ç¡®è®¤åŠŸèƒ½, ä¹Ÿå°±æ˜¯è¯´å¢åŠ äº†å¯é æ€§çš„éƒ¨åˆ†.</p>
<h2 id="æœ¬ç¯‡åŸºæœ¬æœ¯è¯­"><a href="#æœ¬ç¯‡åŸºæœ¬æœ¯è¯­" class="headerlink" title="æœ¬ç¯‡åŸºæœ¬æœ¯è¯­"></a>æœ¬ç¯‡åŸºæœ¬æœ¯è¯­</h2><p>In this new system blocks of data are called chunks. Chunks are split up into slices. This name change keeps the chunk system terminology (chunks/slices) distinct from packet fragmentation and reassembly (packets/fragments).</p>
<ul>
<li>å— : åœ¨è¿™ä¸ªæ–°ç³»ç»Ÿä¸­ï¼Œå¤§å—çš„æ•°æ®è¢«ç§°ä¸ºâ€å—â€(chunks)</li>
<li>ç‰‡æ®µ : è€Œå—è¢«åˆ†æˆçš„åˆ†åŒ…è¢«ç§°ä¸ºâ€ç‰‡æ®µâ€(slices)</li>
</ul>
<h2 id="æ•°æ®åŒ…çš„ç»“æ„è®¾è®¡"><a href="#æ•°æ®åŒ…çš„ç»“æ„è®¾è®¡" class="headerlink" title="æ•°æ®åŒ…çš„ç»“æ„è®¾è®¡"></a>æ•°æ®åŒ…çš„ç»“æ„è®¾è®¡</h2><p>è¿™ä¸ªç³»ç»Ÿåœ¨ç½‘ç»œä¸Šå‘é€çš„æ•°æ®åŒ…ç±»å‹ä¸€å…±æœ‰ä¸¤ç§ç±»å‹ï¼š</p>
<ul>
<li><p>Slice packetç‰‡æ®µæ•°æ®åŒ… : è¿™åŒ…æ‹¬äº†ä¸€ä¸ªå—çš„ç‰‡æ®µï¼Œæœ€å¤šå¤§å°ä¸º1kã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SliceSize = <span class="number">1024</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MaxSlicesPerChunk = <span class="number">256</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MaxChunkSize = SliceSize  MaxSlicesPerChunk;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SlicePacket</span> :</span> <span class="keyword">public</span> protocol2::Packet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">uint16_t</span> chunkId;</span><br><span class="line">    <span class="keyword">int</span> sliceId;</span><br><span class="line">    <span class="keyword">int</span> numSlices;</span><br><span class="line">    <span class="keyword">int</span> sliceBytes;</span><br><span class="line">    <span class="keyword">uint8_t</span> data[SliceSize];</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> stream&gt; <span class="function"><span class="keyword">bool</span> <span class="title">Serialize</span><span class="params">( Stream &amp; stream )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        serialize_bits( stream, chunkId, <span class="number">16</span> );</span><br><span class="line">        serialize_int( stream, sliceId, <span class="number">0</span>, MaxSlicesPerChunk - <span class="number">1</span> );</span><br><span class="line">        serialize_int( stream, numSlices, <span class="number">1</span>, MaxSlicesPerChunk );</span><br><span class="line">        <span class="keyword">if</span> ( sliceId == numSlices - <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            serialize_int( stream, sliceBytes, <span class="number">1</span>, SliceSize );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( Stream::IsReading )</span><br><span class="line">        &#123;</span><br><span class="line">            sliceBytes = SliceSize;</span><br><span class="line">        &#125;</span><br><span class="line">        serialize_bytes( stream, data, sliceBytes );</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Ack packetç¡®è®¤æ•°æ®åŒ… : ä¸€ä¸ªä½åŸŸbitfieldæŒ‡ç¤ºå“ªäº›ç‰‡æ®µå·²ç»æ”¶åˆ°, we just send the entire state of all acked slices in each ack packet. When the ack packet is received (including the slice that was just received).</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AckPacket</span> :</span> <span class="keyword">public</span> protocol2::Packet </span><br><span class="line">&#123; </span><br><span class="line">    <span class="keyword">uint16_t</span> chunkId; </span><br><span class="line">    <span class="keyword">int</span> numSlices; </span><br><span class="line">    <span class="keyword">bool</span> acked[MaxSlicesPerChunk]; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Serialize</span><span class="params">( Stream &amp; stream )</span></span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        serialize_bits( stream, chunkId, <span class="number">16</span> ); </span><br><span class="line">        serialize_int( stream, numSlices, <span class="number">1</span>, MaxSlicesPerChunk ); </span><br><span class="line">        <span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numSlices; ++i ) </span><br><span class="line">            serialize_bool( stream, acked[i] ); <span class="keyword">return</span> <span class="literal">true</span>; &#125; &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="å‘é€æ–¹çš„å®ç°"><a href="#å‘é€æ–¹çš„å®ç°" class="headerlink" title="å‘é€æ–¹çš„å®ç°"></a>å‘é€æ–¹çš„å®ç°</h2><p>ä¸ä¹‹å‰æ–‡ç« ä»‹ç»çš„æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿä¸åŒï¼Œå—ç³»ç»Ÿåœ¨åŒä¸€æ—¶é—´åªèƒ½ç”±ä¸€ä¸ªå—æ­£åœ¨ä¼ è¾“ã€‚<br>å‘é€æ–¹çš„ç­–ç•¥æ˜¯ï¼š</p>
<ul>
<li>æŒç»­çš„å‘é€ç‰‡æ®µæ•°æ®åŒ…ï¼Œç›´åˆ°æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…éƒ½è¢«ç¡®è®¤ã€‚</li>
<li>ä¸å†å¯¹å·²ç»ç¡®è®¤è¿‡çš„ç‰‡æ®µæ•°æ®åŒ…è¿›è¡Œå‘é€ã€‚</li>
</ul>
<p>å¯¹äºå‘é€æ–¹è€Œè¨€æœ‰ä¸€ç‚¹æ¯”è¾ƒå¾®å¦™ï¼Œå®ç°ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…é‡æ–°å‘é€çš„æœ€å°å»¶è¿Ÿæ˜¯ä¸€ä¸ªå¾ˆæ£’çš„ä¸»æ„ï¼Œå¦‚æœä¸è¿™ä¹ˆåšçš„è¯ï¼Œå°±å¯èƒ½ä¼šå‡ºç°è¿™ç§ä¸€æ ·æƒ…å†µï¼Œå¯¹äºå¾ˆå°çš„å—æ•°æ®æˆ–è€…ä¸€ä¸ªå—çš„æœ€åå‡ ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œå¾ˆå®¹æ˜“ä¸åœçš„å‘é€å®ƒä»¬æŠŠæ•´ä¸ªç½‘ç»œéƒ½å¡æ»¡ã€‚æ­£æ˜¯å› ä¸ºè¿™ä¸€åŸå› ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªæ•°ç»„æ¥è®°å½•æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„ä¸Šä¸€æ¬¡å‘é€æ—¶é—´ã€‚é‡æ–°å‘é€å»¶è¿Ÿçš„ä¸€ä¸ªé€‰æ‹©æ˜¯ä½¿ç”¨ä¸€ä¸ªä¼°è®¡çš„ç½‘ç»œå¾€è¿”æ—¶å»¶ï¼Œæˆ–è€…åªæœ‰åœ¨è¶…è¿‡ä¸Šä¸€æ¬¡å‘é€æ—¶é—´ç½‘ç»œå¾€è¿”æ—¶å»¶*1.25è¿˜æ²¡æœ‰æ”¶åˆ°ç¡®è®¤æ•°æ®åŒ…çš„æƒ…å†µæ‰ä¼šé‡æ–°å‘é€ã€‚æˆ–è€…ï¼Œä½ å¯ä»¥è¯´â€œè¿™æ ¹æœ¬å°±æ— æ‰€è°“â€ï¼Œåªè¦è¶…è¿‡ä¸Šä¸€æ¬¡å‘é€æ—¶é—´100æ¯«ç§’äº†å°±é‡æ–°å‘é€ã€‚æˆ‘åªæ˜¯åˆ—ä¸¾é€‚åˆæˆ‘è‡ªå·±çš„æ–¹æ¡ˆï¼</p>
<p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹çš„æ•°æ®ç»“æ„æ¥æè¿°å‘é€æ–¹ï¼š<br><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChunkSender</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">bool</span> sending;</span><br><span class="line">    <span class="keyword">uint16_t</span> chunkId;</span><br><span class="line">    <span class="keyword">int</span> chunkSize;</span><br><span class="line">    <span class="keyword">int</span> numSlices;</span><br><span class="line">    <span class="keyword">int</span> numAckedSlices;</span><br><span class="line">    <span class="keyword">int</span> currentSliceId;</span><br><span class="line">    <span class="keyword">bool</span> acked[MaxSlicesPerChunk];</span><br><span class="line">    <span class="keyword">uint8_t</span> chunkData[MaxChunkSize];</span><br><span class="line">    <span class="keyword">double</span> timeLastSent[MaxSlicesPerChunk];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="æ¥æ”¶æ–¹çš„å®ç°æ€è·¯"><a href="#æ¥æ”¶æ–¹çš„å®ç°æ€è·¯" class="headerlink" title="æ¥æ”¶æ–¹çš„å®ç°æ€è·¯"></a>æ¥æ”¶æ–¹çš„å®ç°æ€è·¯</h2><p>é¦–å…ˆï¼Œæ¥æ”¶æ–¹çš„è®¾ç½®ä¼šä»å—0å¼€å§‹ã€‚å½“ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…ä»ç½‘ç»œä¸Šä¼ é€’è¿‡æ¥ï¼Œå¹¶ä¸”èƒ½å¤ŸåŒ¹é…è¿™ä¸ªå—idçš„è¯ï¼Œâ€œreceivingâ€çŠ¶æ€ä¼šä»falseç¿»è½¬ä¸ºtrueï¼Œç¬¬ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ•°æ®ä¼šæ’å…¥â€ chunkDataâ€œå˜é‡çš„åˆé€‚ä½ç½®ï¼Œç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ä¼šæ ¹æ®ç¬¬ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…é‡Œé¢çš„æ•°æ®è¿›è¡Œæ­£ç¡®çš„è®¾ç½®ï¼Œå·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ä¼šåŠ ä¸€ï¼Œä¹Ÿå°±æ˜¯ä»0åˆ°1ï¼Œé’ˆå¯¹æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ¥æ”¶æ ‡è®°é‡Œé¢å¯¹åº”è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„é¡¹ä¼šå˜ä¸ºtrueã€‚</p>
<p>éšç€è¿™ä¸ªå—æ•°æ®çš„å…¶ä»–ç‰‡æ®µæ•°æ®åŒ…çš„åˆ°æ¥ï¼Œä¼šå¯¹æ¯ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…è¿›è¡Œæ£€æµ‹ï¼Œåˆ¤æ–­å®ƒä»¬çš„idæ˜¯å¦ä¸å½“å‰å—çš„idç›¸åŒï¼Œå¦‚æœä¸ç›¸åŒçš„è¯å°±ä¼šè¢«ä¸¢å¼ƒã€‚å¦‚æœè¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…å·²ç»æ”¶åˆ°è¿‡çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…ä¹Ÿä¼šè¢«ä¸¢å¼ƒã€‚å¦åˆ™ï¼Œè¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ•°æ®ä¼šæ’å…¥â€ chunkDataâ€œå˜é‡çš„åˆé€‚ä½ç½®ã€å·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ä¼šåŠ ä¸€ã€é’ˆå¯¹æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ¥æ”¶æ ‡è®°é‡Œé¢å¯¹åº”è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„é¡¹ä¼šå˜ä¸ºtrueã€‚</p>
<p>è¿™ä¸€è¿‡ç¨‹ä¼šæŒç»­è¿›è¡Œï¼Œç›´åˆ°æ¥æ”¶åˆ°æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…ã€‚ä¸€æ—¦æ¥æ”¶åˆ°æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…ï¼ˆä¹Ÿå°±æ˜¯å·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ç­‰äºç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡çš„æ—¶å€™ï¼‰ï¼Œæ¥æ”¶æ–¹ä¼šæŠŠâ€œreceiving â€œçŠ¶æ€æ”¹ä¸ºfalseï¼Œè€ŒæŠŠâ€readyToReadâ€œçŠ¶æ€æ”¹ä¸ºtrueã€‚å½“â€readyToReadâ€çŠ¶æ€ä¸ºtrueçš„æ—¶å€™ï¼Œæ‰€æœ‰æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œè¿™ä¸ªå¤„ç†è¿‡ç¨‹é€šå¸¸éå¸¸çš„çŸ­ï¼Œä¼šåœ¨æ”¶åˆ°ç‰‡æ®µæ•°æ®åŒ…çš„åŒä¸€å¸§è¿›è¡Œå¤„ç†ï¼Œè°ƒç”¨è€…ä¼šæ£€æŸ¥â€æˆ‘æœ‰ä¸€å—æ•°æ®è¦è¯»å–ä¹ˆï¼Ÿâ€œå¹¶å¤„ç†å—æ•°æ®ã€‚ç„¶åä¼šé‡ç½®æ•°æ®å—æ¥æ”¶å™¨çš„æ‰€æœ‰æ•°æ®ä¸ºé»˜è®¤å€¼ï¼Œé™¤äº†å—æ•°æ®çš„idä»0å¢åŠ åˆ°1ï¼Œè¿™æ ·æˆ‘ä»¬å°±å‡†å¤‡å¥½æ¥æ”¶ä¸‹ä¸€ä¸ªå—äº†ã€‚<br><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChunkReceiver</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">bool</span> receiving;</span><br><span class="line">    <span class="keyword">bool</span> readyToRead;</span><br><span class="line">    <span class="keyword">uint16_t</span> chunkId;</span><br><span class="line">    <span class="keyword">int</span> chunkSize;</span><br><span class="line">    <span class="keyword">int</span> numSlices;</span><br><span class="line">    <span class="keyword">int</span> numReceivedSlices;</span><br><span class="line">    <span class="keyword">bool</span> received[MaxSlicesPerChunk];</span><br><span class="line">    <span class="keyword">uint8_t</span> chunkData[MaxChunkSize];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="é˜²DDos"><a href="#é˜²DDos" class="headerlink" title="é˜²DDos"></a>é˜²DDos</h2><p>å¦‚æœä½ å¯¹æ¯ä¸ªæ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…éƒ½ä¼šå›å¤ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…çš„è¯ï¼Œé‚£ä¹ˆå‘é€æ–¹èƒ½å¤Ÿæ„é€ ä¸€ä¸ªå¾ˆå°çš„ç‰‡æ®µæ•°æ®åŒ…å‘é€ç»™ä½ ï¼Œè€Œä½ ä¼šå›å¤ä¸€ä¸ªæ¯”å‘é€ç»™ä½ çš„ç‰‡æ®µæ•°æ®åŒ…è¿˜å¤§çš„ç¡®è®¤æ•°æ®åŒ…ï¼Œè¿™æ ·ä½ çš„æœåŠ¡å™¨å°±å˜æˆäº†ä¸€ä¸ªå¯ä»¥è¢«äººåˆ©ç”¨æ¥è¿›è¡ŒDDosæ”¾å¤§æ”»å‡»çš„å·¥å…·ã€‚</p>
<p>æ°¸è¿œä¸è¦è®¾è®¡ä¸€ä¸ªåŒ…å«å¯¹æ¥æ”¶åˆ°çš„æ•°æ®åŒ…è¿›è¡Œä¸€å¯¹ä¸€çš„æ˜ å°„å“åº”çš„åè®®ã€‚è®©æˆ‘ä»¬ä¸¾ä¸ªç®€å•ä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœæœ‰äººç»™ä½ å‘é€1000ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œæ°¸è¿œä¸è¦ç»™ä»–å›å¤1000ä¸ªç¡®è®¤æ•°æ®åŒ…ã€‚ç›¸ååªå‘ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…ï¼Œè€Œä¸”æœ€å¤šæ¯50æ¯«ç§’æˆ–è€…100æ¯«ç§’æ‰å‘é€ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…ã€‚å¦‚æœä½ æ˜¯è¿™æ ·è®¾è®¡çš„è¯ï¼Œé‚£ä¹ˆDDosæ”»å‡»å®Œå…¨ä¸å¯èƒ½çš„ã€‚</p>
<h1 id="åŸæ–‡"><a href="#åŸæ–‡" class="headerlink" title="åŸæ–‡"></a>åŸæ–‡</h1><p><a href="https://gafferongames.com/post/sending_large_blocks_of_data/" target="_blank" rel="noopener">åŸæ–‡å‡ºå¤„</a></p>
<p>åŸæ–‡æ ‡é¢˜ : <strong>Sending Large Blocks of Data</strong> (<em>How to send blocks quickly and reliably over UDP</em>)</p>
<hr>
<p></p><h2 id="introduction">Introduction</h2><p></p>
<p>Hi, Iâ€™m <a href="https://gafferongames.com/about" target="_blank" rel="noopener">Glenn Fiedler</a> and welcome to <strong><a href="https://gafferongames.com/categories/building-a-game-network-protocol/" target="_blank" rel="noopener">Building a Game Network Protocol</a></strong>.</p><br><p>In the <a href="https://gafferongames.com/post/packet_fragmentation_and_reassembly/" target="_blank" rel="noopener">previous article</a> we implemented packet fragmentation and reassembly so we can send packets larger than MTU.</p><br><p>This approach works great when the data block you&rsquo;re sending is time critical and can be dropped, but in other cases you need to send large blocks of quickly and reliably over packet loss, and you need the data to get through.</p><br><p>In this situation, a different technique gives much better results.</p><br><h2 id="background">Background</h2><br><p>It&rsquo;s common for servers to send large block of data to the client on connect, for example, the initial state of the game world for late join.</p><br><p>Let&rsquo;s assume this data is 256k in size and the client needs to receive it before they can join the game. The client is stuck behind a load screen waiting for the data, so obviously we want it to be transmitted as quickly as possible.</p><br><p>If we send the data with the technique from the previous article, we get <em>packet loss amplification</em> because a single dropped fragment results in the whole packet being lost. The effect of this is actually quite severe. Our example block split into 256 fragments and sent over 1% packet loss now has a whopping 92.4% chance of being dropped!</p><br><p>Since we just need the data to get across, we have no choice but to keep sending it until it gets through. On average, we have to send the block 10 times before it&rsquo;s received. You may laugh but this actually happened on a AAA game I worked on!</p><br><p>To fix this, I implemented a new system for sending large blocks, one that handles packet loss by resends fragments until they are acked. Then I took the problematic large blocks and piped them through this system, fixing a bunch of players stalling out on connect, while continuing to send time critical data (snapshots) via packet fragmentation and reassembly.</p><br><h2 id="chunks-and-slices">Chunks and Slices</h2><br><p>In this new system blocks of data are called <em>chunks</em>. Chunks are split up into <em>slices</em>. This name change keeps the chunk system terminology (chunks/slices) distinct from packet fragmentation and reassembly (packets/fragments).</p><br><p>The basic idea is that slices are sent over the network repeatedly until they all get through. Since we are implementing this over UDP, simple in concept becomes a little more complicated in implementation because have to build in our own basic reliability system so the sender knows which slices have been received.</p><br><p>This reliability gets quite tricky if we have a bunch of different chunks in flight, so we&rsquo;re going to make a simplifying assumption up front: we&rsquo;re only going to send one chunk over the network at a time. This doesn&rsquo;t mean the sender can&rsquo;t have a local send queue for chunks, just that in terms of network traffic there&rsquo;s only ever one chunk <em>in flight</em> at any time.</p><br><p>This makes intuitive sense because the whole point of the chunk system is to send chunks reliably and in-order. If you are for some reason sending chunk 0 and chunk 1 at the same time, what&rsquo;s the point? You can&rsquo;t process chunk 1 until chunk 0 comes through, because otherwise it wouldn&rsquo;t be reliable-ordered.</p><br><p>That said, if you dig a bit deeper you&rsquo;ll see that sending one chunk at a time does introduce a small trade-off, and that is that it adds a delay of RTT between chunk n being received and the send starting for chunk n+1 from the receiver&rsquo;s point of view.</p><br><p>This trade-off is totally acceptable for the occasional sending of large chunks like data sent once on client connect, but it&rsquo;s definitely <em>not</em> acceptable for data sent 10 or 20 times per-second like snapshots. So remember, this system is useful for large, infrequently sent blocks of data, not for time critical data.</p><br><h2 id="packet-structure">Packet Structure</h2><br><p>There are two sides to the chunk system, the <strong>sender</strong> and the <strong>receiver</strong>.</p><br><p>The sender is the side that queues up the chunk and sends slices over the network. The receiver is what reads those slice packets and reassembles the chunk on the other side. The receiver is also responsible for communicating back to the sender which slices have been received via acks.</p><br><p>The netcode I work on is usually client/server, and in this case I usually want to be able to send blocks of data from the server to the client <em>and</em> from the client to the server. In that case, there are two senders and two receivers, a sender on the client corresponding to a receiver on the server and vice-versa.</p><br><p>Think of the sender and receiver as end points for this chunk transmission protocol that define the direction of flow. If you want to send chunks in a different direction, or even extend the chunk sender to support peer-to-peer, just add sender and receiver end points for each direction you need to send chunks.</p><br><p>Traffic over the network for this system is sent via two packet types:</p><br><ul><br><li><strong>Slice packet</strong> - contains a slice of a chunk up to 1k in size.</li><br><li><strong>Ack packet</strong> - a bitfield indicating which slices have been received so far.</li><br></ul><br><p>The slice packet is sent from the sender to the receiver. It is the payload packet that gets the chunk data across the network and is designed so each packet fits neatly under a conservative MTU of 1200 bytes. Each slice is a maximum of 1k and there is a maximum of 256 slices per-chunk, therefore the largest data you can send over the network with this system is 256k.</p><br><pre><code>const int SliceSize = 1024;<br>const int MaxSlicesPerChunk = 256;<br>const int MaxChunkSize = SliceSize <em> MaxSlicesPerChunk;<br><br>struct SlicePacket : public protocol2::Packet<br>{<br>    uint16_t chunkId;<br>    int sliceId;<br>    int numSlices;<br>    int sliceBytes;<br>    uint8_t data[SliceSize];<br><br>    template &amp;lt;typename Stream&amp;gt; bool Serialize( Stream &amp;amp; stream )<br>    {<br>        serialize_bits( stream, chunkId, 16 );<br>        serialize_int( stream, sliceId, 0, MaxSlicesPerChunk - 1 );<br>        serialize_int( stream, numSlices, 1, MaxSlicesPerChunk );<br>        if ( sliceId == numSlices - 1 )<br>        {<br>            serialize_int( stream, sliceBytes, 1, SliceSize );<br>        }<br>        else if ( Stream::IsReading )<br>        {<br>            sliceBytes = SliceSize;<br>        }<br>        serialize_bytes( stream, data, sliceBytes );<br>        return true;<br>    }<br>};<br></em></code></pre><br><p>There are two points I&rsquo;d like to make about the slice packet. The first is that even though there is only ever one chunk in flight over the network, it&rsquo;s still necessary to include the chunk id (0,1,2,3, etc&hellip;) because packets sent over UDP can be received out of order.</p><br><p>Second point. Due to the way chunks are sliced up we know that all slices except the last one must be SliceSize (1024 bytes). We take advantage of this to save a small bit of bandwidth sending the slice size only in the last slice, but there is a trade-off: the receiver doesn&rsquo;t know the exact size of a chunk until it receives the last slice.</p><br><p>The other packet sent by this system is the ack packet. This packet is sent in the opposite direction, from the receiver back to the sender. This is the reliability part of the chunk network protocol. Its purpose is to lets the sender know which slices have been received.</p><br><pre><code>struct AckPacket : public protocol2::Packet<br>{<br>    uint16_t chunkId;<br>    int numSlices;<br>    bool acked[MaxSlicesPerChunk];<br><br>    bool Serialize( Stream &amp;amp; stream )<br>    {<br>        serialize_bits( stream, chunkId, 16 );<br>        serialize_int( stream, numSlices, 1, MaxSlicesPerChunk );<br>        for ( int i = 0; i &amp;lt; numSlices; ++i )<br>        {<br>            serialize_bool( stream, acked[i] ); return true; } };<br>        }<br>    }<br>};<br></code></pre><br><p>Acks are short for &lsquo;acknowledgments&rsquo;. So an ack for slice 100 means the receiver is <em>acknowledging</em> that it has received slice 100. This is critical information for the sender because not only does it let the sender determine when all slices have been received so it knows when to stop, it also allows the sender to use bandwidth more efficiently by only sending slices that haven&rsquo;t been acked.</p><br><p>Looking a bit deeper into the ack packet, at first glance it seems a bit <em>redundant</em>. Why are we sending acks for all slices in every packet? Well, ack packets are sent over UDP so there is no guarantee that all ack packets are going to get through. You certainly don&rsquo;t want a desync between the sender and the receiver regarding which slices are acked.</p><br><p>So we need some reliability for acks, but we don&rsquo;t want to implement an <em>ack system for acks</em> because that would be a huge pain in the ass. Since the worst case ack bitfield is just 256 bits or 32 bytes, we just send the entire state of all acked slices in each ack packet. When the ack packet is received, we consider a slice to be acked the instant an ack packet comes in with that slice marked as acked and locally that slice is not seen as acked yet.</p><br><p>This last step, biasing in the direction of non-acked to ack, like a fuse getting blown, means we can handle out of order delivery of ack packets.</p><br><h2 id="sender-implementation">Sender Implementation</h2><br><p>Let&rsquo;s get started with the implementation of the sender.</p><br><p>The strategy for the sender is:</p><br><ul><br><li>Keep sending slices until all slices are acked</li><br><li>Don&rsquo;t resend slices that have already been acked</li><br></ul><br><p>We use the following data structure for the sender:</p><br><pre><code>class ChunkSender<br>{<br>    bool sending;<br>    uint16_t chunkId;<br>    int chunkSize;<br>    int numSlices;<br>    int numAckedSlices;<br>    int currentSliceId;<br>    bool acked[MaxSlicesPerChunk];<br>    uint8_t chunkData[MaxChunkSize];<br>    double timeLastSent[MaxSlicesPerChunk];<br>};<br></code></pre><br><p>As mentioned before, only one chunk is sent at a time, so there is a &lsquo;sending&rsquo; state which is true if we are currently sending a chunk, false if we are in an idle state ready for the user to send a chunk. In this implementation, you can&rsquo;t send another chunk while the current chunk is still being sent over the network. If you don&rsquo;t like this, stick a queue in front of the sender.</p><br><p>Next, we have the id of the chunk we are currently sending, or, if we are not sending a chunk, the id of the next chunk to be sent, followed by the size of the chunk and the number of slices it has been split into. We also track, per-slice, whether that slice has been acked, which lets us count the number of slices that have been acked so far while ignoring redundant acks. A chunk is considered fully received from the sender&rsquo;s point of view when numAckedSlices == numSlices.</p><br><p>We also keep track of the current slice id for the algorithm that determines which slices to send, which works like this. At the start of a chunk send, start at slice id 0 and work from left to right and wrap back around to 0 again when you go past the last slice. Eventually, you stop iterating across because you&rsquo;ve run out of bandwidth to send slices. At this point, remember our current slice index via current slice id so you can pick up from where you left off next time. This last part is important because it distributes sends across all slices, not just the first few.</p><br><p>Now let&rsquo;s discuss bandwidth limiting. Obviously you don&rsquo;t just blast slices out continuously as you&rsquo;d flood the connection in no time, so how do we limit the sender bandwidth? My implementation works something like this: as you walk across slices and consider each slice you want to send, estimate roughly how many bytes the slice packet will take eg: roughly slice bytes + some overhead for your protocol and UDP/IP header. Then compare the amount of bytes required vs. the available bytes you have to send in your bandwidth budget. If you don&rsquo;t have enough bytes accumulated, stop. Otherwise, subtract the bytes required to send the slice and repeat the process for the next slice.</p><br><p>Where does the available bytes in the send budget come from? Each frame before you update the chunk sender, take your target bandwidth (eg. 256kbps), convert it to bytes per-second, and add it multiplied by delta time (dt) to an accumulator.</p><br><p>A conservative send rate of 256kbps means you can send 32000 bytes per-second, so add 32000  dt to the accumulator. A middle ground of 512kbit/sec is 64000 bytes per-second. A more aggressive 1mbit is 125000 bytes per-second. This way each update you <em>accumulate</em> a number of bytes you are allowed to send, and when you&rsquo;ve sent all the slices you can given that budget, any bytes left over stick around for the next time you try to send a slice.</p><br><p>One subtle point with the chunk sender and is that it&rsquo;s a good idea to implement some minimum resend delay per-slice, otherwise you get situations where for small chunks, or the last few slices of a chunk that the same few slices get spammed over the network.</p><br><p>For this reason we maintain an array of last send time per-slice. One option for this resend delay is to maintain an estimate of RTT and to only resend a slice if it hasn&rsquo;t been acked within RTT * 1.25 of its last send time. Or, you could just resend the slice it if it hasn&rsquo;t been sent in the last 100ms. Works for me!</p><br><h2 id="kicking-it-up-a-notch">Kicking it up a notch</h2><br><p>Do the math you&rsquo;ll notice it still takes a long time for a 256k chunk to get across:</p><br><ul><br><li>1mbps = 2 seconds</li><br><li>512kbps = 4 seconds</li><br><li>256kbps = <strong>8 seconds :(</strong></li><br></ul><br><p>Which kinda sucks. The whole point here is quickly and reliably. Emphasis on <em>quickly</em>. Wouldn&rsquo;t it be nice to be able to get the chunk across faster? The typical use case of the chunk system supports this. For example, a large block of data sent down to the client immediately on connect or a block of data that has to get through before the client exits a load screen and starts to play. You want this to be over as quickly as possible and in both cases the user really doesn&rsquo;t have anything better to do with their bandwidth, so why not use as much of it as possible?</p><br><p>One thing I&rsquo;ve tried in the past with excellent results is an initial burst. Assuming your chunk size isn&rsquo;t so large, and your chunk sends are infrequent, I can see no reason why you can&rsquo;t just fire across the entire chunk, all slices of it, in separate packets in one glorious burst of bandwidth, wait 100ms, and then resume the regular bandwidth limited slice sending strategy.</p><br><p>Why does this work? In the case where the user has a good internet connection (some multiple of 10mbps or greater&hellip;), the slices get through very quickly indeed. In the situation where the connection is not so great, the burst gets buffered up and <em>most</em> slices will be delivered as quickly as possible limited only by the amount bandwidth available. After this point switching to the regular strategy at a lower rate picks up any slices that didn&rsquo;t get through the first time.</p><br><p>This seems a bit risky so let me explain. In the case where the user can&rsquo;t quite support this bandwidth what you&rsquo;re relying on here is that routers on the Internet <em>strongly prefer</em> to buffer packets rather than discard them at almost any cost. It&rsquo;s a TCP thing. Normally, I hate this because it induces latency in packet delivery and messes up your game packets which you want delivered as quickly as possible, but in this case it&rsquo;s good behavior because the player really has nothing else to do but wait for your chunk to get through.</p><br><p>Just don&rsquo;t go too overboard with the spam or the congestion will persist after your chunk send completes and it will affect your game for the first few seconds. Also, make sure you increase the size of your OS socket buffers on both ends so they are larger than your maximum chunk size (I recommend at least double), otherwise you&rsquo;ll be dropping slices packets before they even hit the wire.</p><br><p>Finally, I want to be a responsible network citizen here so although I recommend sending all slices once in an initial burst, it&rsquo;s important for me to mention that I think this really is only appropriate, and only really <em>borderline appropriate</em> behavior for small chunks in the few 100s of k range in 2016, and only when your game isn&rsquo;t sending anything else that is time-critical.</p><br><p>Please don&rsquo;t use this burst strategy if your chunk is really large, eg: megabytes of data, because that&rsquo;s way too big to be relying on the kindness of strangers, AKA. the buffers in the routers between you and your packet&rsquo;s destination. For this it&rsquo;s necessary to implement something much smarter. Something adaptive that tries to send data as quickly as it can, but backs off when it detects too much latency and/or packet loss as a result of flooding the connection. Such a system is outside of the scope of this article.</p><br><h2 id="receiver-implementation">Receiver Implementation</h2><br><p>Now that we have the sender all sorted out let&rsquo;s move on to the reciever. </p><br><p>As mentioned previously, unlike the packet fragmentation and reassembly system from the previous article, the chunk system only ever has one chunk in flight.</p><br><p>This makes the reciever side of the chunk system much simpler:</p><br><pre><code>class ChunkReceiver<br>{<br>    bool receiving;<br>    bool readyToRead;<br>    uint16_t chunkId;<br>    int chunkSize;<br>    int numSlices;<br>    int numReceivedSlices;<br>    bool received[MaxSlicesPerChunk];<br>    uint8_t chunkData[MaxChunkSize];<br>};<br></code></pre><br><p>We have a state whether we are currently &lsquo;receiving&rsquo; a chunk over the network, plus a &rsquo;readyToRead&rsquo; state which indicates that a chunk has received all slices and is ready to be popped off by the user. This is effectively a minimal receive queue of length 1. If you don&rsquo;t like this, of course you are free to add a queue.</p><br><p>In this data structure we also keep track of chunk size (although it is not known with complete accuracy until the last slice arrives), num slices and num received slices, as well as a received flag per-slice. This per-slice received flag lets us discard packets containing slices we have already received, and count the number of slices received so far (since we may receive the slice multiple times, we only increase this count the first time we receive a particular slice). It&rsquo;s also used when generating ack packets. The chunk receive is completed from the receiver&rsquo;s point of view when numReceivedSlices == numSlices.</p><br><p>So what does it look like end-to-end receiving a chunk?</p><br><p>First, the receiver sets up set to start at chunk 0. When the a slice packet comes in over the network matching the chunk id 0, &lsquo;receiving&rsquo; flips from false to true, data for that first slice is inserted into &lsquo;chunkData&rsquo; at the correct position, numSlices is set to the value in that packet, numReceivedSlices is incremented from 0 -&gt; 1, and the received flag in the array entry corresponding to that slice is set to true.</p><br><p>As the remaining slice packets for the chunk come in, each of them are checked that they match the current chunk id and numSlices that are being received and are ignored if they don&rsquo;t match. Packets are also ignored if they contain a slice that has already been received. Otherwise, the slice data is copied into the correct place in the chunkData array, numReceivedSlices is incremented and received flag for that slice is set to true.</p><br><p>This process continues until all slices of the chunk are received, at which point the receiver sets receiving to &lsquo;false&rsquo; and &lsquo;readyToRead&rsquo; to true. While &lsquo;readyToRead&rsquo; is true, incoming slice packets are discarded. At this point, the chunk receive packet processing is performed, typically on the same frame. The caller checks &lsquo;do I have a chunk to read?&rsquo; and processes the chunk data. All chunk receive data is cleared back to defaults, except chunk id which is incremented from 0 -&gt; 1, and we are ready to receive the next chunk.</p><br><h2 id="conclusion">Conclusion</h2><br><p>The chunk system is simple in concept, but the implementation is certainly not. I encourage you to take a close look at the <a href="http://www.patreon.com/gafferongames" target="_blank" rel="noopener">source code</a> for this article for further details.</p>


<h1 id="è¯‘æ–‡">è¯‘æ–‡</h1>


<p><a href="http://gad.qq.com/program/translateview/7165598" target="_blank" rel="noopener">è¯‘æ–‡å‡ºå¤„</a></p>
<div class="WordSection1"><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç¿»è¯‘ï¼šå¼ åæ ‹<span> (wcby)     </span>å®¡æ ¡ï¼šç‹ç£Š<span>(</span>æœªæ¥çš„æœªæ¥<span>)</span></span> </span></p><p class="MsoNormal" align="left"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ ¼ä¼¦Â·è²å¾·å‹’ã€‚æ¬¢è¿å¤§å®¶é˜…è¯»ç³»åˆ—æ•™ç¨‹ã€Šæ„å»ºæ¸¸æˆç½‘ç»œåè®®ã€‹çš„ç¬¬å››ç¯‡æ–‡ç« ã€‚</span></span><span style="color: rgb(34, 34, 34); font-size: 12pt; font-family: å¾®è½¯é›…é»‘;">åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•åœ¨æ¸¸æˆåè®®è¿™ä¸€å±‚å®ç°å¯¹æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ã€‚</span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç°åœ¨åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢ï¼Œæˆ‘ä»¬å°†ç»§ç»­é€šè¿‡æ¢ç´¢åœ¨<span>UDP</span>åè®®ä¸Šå‘é€å¤§å—æ•°æ®çš„æ›¿ä»£æ–¹æ¡ˆæ¥ç»§ç»­æˆ‘ä»¬æ„å»ºä¸€ä¸ªä¸“ä¸šçº§åˆ«çš„æ¸¸æˆç½‘ç»œåè®®çš„å¾ç¨‹ã€‚</span> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç¬¬ä¸€çœ¼çœ‹ä¸Šå»ï¼Œè¿™ç§æ›¿ä»£æ€§çš„æŠ€æœ¯ä¼¼ä¹éå¸¸ç±»ä¼¼äºæ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ï¼Œä½†æ˜¯å®ƒçš„å®ç°æ˜¯å®Œå…¨ä¸åŒçš„ã€‚è¿™ç§å®ç°ä¸Šçš„å·®å¼‚çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³æ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„çš„ä¸€ä¸ªå…³é”®å¼±ç‚¹<span>-</span>ä¸€ä¸ªç‰‡æ®µçš„ä¸¢å¤±å°±ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®åŒ…éƒ½è¦è¢«ä¸¢å¼ƒæ‰ã€‚è¿™ç§è¡Œä¸ºæ˜¯éå¸¸ä¸å¥½çš„ï¼Œå› ä¸ºå®ƒä¼šéšç€åˆ†åŒ…æ•°é‡çš„å¢åŠ è€Œæ”¾å¤§æ•°æ®åŒ…ä¸¢å¤±çš„æ¦‚ç‡ã€‚å½“ä½ é‡åˆ°å¤§å—æ•°æ®åŒ…çš„æ—¶å€™ï¼Œè¿™ç§æ”¾å¤§æ˜¯å¦‚æ­¤çš„æ˜æ˜¾ï¼ŒåŠ å…¥<span>256 k</span>å¤§å°çš„åˆ†åŒ…ä¸¢å¤±ç‡æ˜¯<span>1%</span>çš„è¯ï¼Œé‚£ä¹ˆåŸå§‹æ•°æ®åŒ…å°±æœ‰<span>92.4%</span>çš„æ¦‚ç‡è¢«ä¸¢å¼ƒã€‚å¹³å‡æ¥è¯´ï¼Œä½ éœ€è¦å‘é€åŸå§‹æ•°æ®åŒ…<span>10</span>æ¬¡ï¼Œå®ƒæ‰èƒ½é¡ºåˆ©çš„åˆ°è¾¾ç½‘ç»œçš„å¦å¤–ä¸€ç«¯ï¼</span> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¦‚æœä½ éœ€è¦åœ¨ä¸€ä¸ªå¯èƒ½ä¼šæœ‰æ•°æ®åŒ…ä¸¢å¤±çš„ç½‘ç»œä¸Šæ¯”å¦‚è¯´äº’è”ç½‘ï¼Œå¿«é€Ÿå’Œå¯é åœ°å‘é€å¤§é‡çš„æ•°æ®ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™æ ·çš„æ–¹æ³•æ˜¯å®Œå…¨ä¸å¯æ¥å—çš„ã€‚ä½ å¯èƒ½éœ€è¦è¿™æ ·åšçš„ä¸€äº›å¸¸è§çš„ä¾‹å­åŒ…æ‹¬ï¼šå®¢æˆ·ç«¯åœ¨é¦–æ¬¡åŠ å…¥çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éœ€è¦ä¸‹å‘ä¸€ä¸ªå¤§çš„æ•°æ®å—ç»™å®¢æˆ·ç«¯<span>(</span>å¯èƒ½æ˜¯ä¸–ç•Œçš„åˆå§‹çŠ¶æ€<span>)</span>ã€ä¸€å¼€å§‹ç”¨æ¥åšå¢é‡ç¼–ç çš„åŸºçº¿æˆ–è€…æ˜¯åœ¨ä¸€ä¸ªå¤šäººåœ¨çº¿ç½‘ç»œæ¸¸æˆé‡Œé¢å®¢æˆ·ç«¯åœ¨åŠ è½½ç•Œé¢æ‰€ç­‰å¾…çš„å¤§å—æ•°æ®ã€‚</span> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åœ¨è¿™äº›æƒ…å†µä¸‹éå¸¸é‡è¦çš„æ˜¯ä¸ä»…è¦ä¼˜é›…åœ°å¤„ç†æ•°æ®åŒ…çš„ä¸¢å¤±ï¼Œè¿˜è¦å°½å¯èƒ½çš„åˆ©ç”¨å¯ç”¨çš„å¸¦å®½å¹¶å°½å¯èƒ½å¿«çš„å‘é€å¤§å—æ•°æ®ã€‚</span></span><span style="color: rgb(34, 34, 34); font-size: 12pt; font-family: å¾®è½¯é›…é»‘;">è¿™æ­£æ˜¯æˆ‘è¦åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢å‘Šè¯‰ä½ è¯¥å¦‚ä½•åšçš„å†…å®¹ã€‚</span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><h2 id="å—å’Œç‰‡æ®µ"><span style="color: rgb(34, 34, 34);"><span style="font-size:x-large;">å—å’Œç‰‡æ®µ</span></span></h2> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è®©æˆ‘ä»¬å¼€å§‹ä½¿ç”¨åŸºæœ¬æœ¯è¯­ã€‚åœ¨è¿™ä¸ªæ–°ç³»ç»Ÿä¸­ï¼Œå¤§å—çš„æ•°æ®è¢«ç§°ä¸º<span>â€</span>å—<span>â€œ</span>ï¼Œè€Œå®ƒä»¬è¢«åˆ†æˆçš„åˆ†åŒ…è¢«ç§°ä¸º<span>â€</span>ç‰‡æ®µ<span>â€</span>ã€‚ è¿™ä¸ªåå­—ä¸Šçš„æ”¹å˜ä½¿çš„å—ç³»ç»Ÿçš„æœ¯è¯­<span>(</span>å—å’Œç‰‡æ®µ<span>)</span>ä¸åŒäºæ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„çš„æœ¯è¯­<span>(</span>æ•°æ®åŒ…å’Œåˆ†åŒ…<span>)</span>ã€‚è¿™æ˜¯æˆ‘è®¤ä¸ºå¾ˆé‡è¦çš„ä¸€ä¸ªäº‹æƒ…ï¼Œå› ä¸ºè¿™äº›ç³»ç»Ÿæ˜¯åœ¨è§£å†³ä¸åŒçš„é—®é¢˜ï¼Œæ²¡æœ‰ç†ç”±ä½ ä¸èƒ½åœ¨ç›¸åŒçš„ç½‘ç»œåè®®ä¸­åŒæ—¶è¿™ä¸¤ä¸ªç³»ç»Ÿã€‚äº‹å®ä¸Šï¼Œæˆ‘ç»å¸¸æŠŠè¿™ä¸¤ä¸ªç»“åˆèµ·æ¥ï¼Œåœ¨æ—¶é—´æ¯”è¾ƒå…³é”®çš„å¢é‡æ•°æ®åŒ…é‡Œé¢ä½¿ç”¨æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ï¼Œå½“å®¢æˆ·ç«¯åŠ å…¥æ¸¸æˆçš„æ—¶å€™ï¼Œä½¿ç”¨å—ç³»ç»Ÿæ¥ä¸‹å‘æ•´ä¸ªæ¸¸æˆä¸–ç•Œçš„åˆå§‹çŠ¶æ€ä¸‹<span>(</span>éå¸¸å¤§çš„æ•°æ®åŒ…<span>)</span>ã€‚</span> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å—ç³»ç»Ÿçš„åŸºæœ¬æ€æƒ³ï¼ŒçœŸæ˜¯ä¸€ç‚¹éƒ½ä¸å¤æ‚ï¼Œæ˜¯æŠŠå—åˆ†æˆå¾ˆå¤šç‰‡æ®µï¼Œç„¶åé€šè¿‡ç½‘ç»œå¤šæ¬¡å‘é€ç‰‡æ®µï¼Œç›´åˆ°ä»–ä»¬éƒ½é¡ºåˆ©çš„åˆ°è¾¾ç½‘ç»œçš„å¦å¤–ä¸€ç«¯ã€‚å½“ç„¶ï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨<span>UDP</span>åè®®ä¸Šå®ç°è¿™ä¸ªåŠŸèƒ½ï¼ŒåŒæ—¶è¿˜æœ‰å¯èƒ½æ•°æ®åŒ…ä¼šä¸¢å¤±ã€æ•°æ®åŒ…ä¹±åºåˆ°è¾¾ä»¥åŠæ•°æ®åŒ…é‡å¤åˆ°è¾¾çš„æƒ…å†µï¼Œç®€å•çš„æ¦‚å¿µåœ¨å®ç°ä¸­ä¹Ÿä¼šå˜å¾—éå¸¸å¤æ‚ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»åœ¨<span>UDP</span>åè®®ä¸Šå»ºç«‹æˆ‘ä»¬è‡ªå·±çš„å…·æœ‰åŸºæœ¬å¯é æ€§çš„ç³»ç»Ÿï¼Œè¿™æ ·å‘é€æ–¹æ‰èƒ½çŸ¥é“è¿™ä¸ªç‰‡æ®µå·²ç»è¢«ç½‘ç»œçš„å¦å¤–ä¸€ç«¯æˆåŠŸæ”¶åˆ°ã€‚</span> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¦‚æœæˆ‘ä»¬æœ‰ä¸€ç»„ä¸åŒçš„å—æ­£åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­<span>(</span>å°±åƒæˆ‘ä»¬åœ¨æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ä¸­æ‰€åšçš„é‚£æ ·<span>)</span>ï¼Œé‚£ä¹ˆå¯é æ€§çš„é—®é¢˜å°±ä¼šå˜å¾—éå¸¸æ£˜æ‰‹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åšä¸€ä¸ªç®€åŒ–çš„å‡è®¾ã€‚æˆ‘ä»¬ä¸€æ¬¡åªä¼šé€šè¿‡ç½‘ç»œå‘é€ä¸€ä¸ªå—çš„æ•°æ®ã€‚è¿™å¹¶ä¸æ„å‘³ç€å‘é€è€…ä¸èƒ½åœ¨æœ¬åœ°æœ‰ä¸€ä¸ªå—çš„å‘é€é˜Ÿåˆ—ï¼Œè¿™åªæ˜¯æ„å‘³ç€åœ¨å®é™…çš„ç½‘ç»œä¼ è¾“ä¸­åªæœ‰ä¸€ä¸ªå—çš„æ•°æ®ä¼šæ­£åœ¨ä¼ é€’ã€‚</span> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™ä¹ˆåšä¹‹æ‰€ä»¥æœ‰æ„ä¹‰ï¼Œæ˜¯å› ä¸ºæœ‰äº†è¿™ä¸€ç‚¹å‡è®¾ä»¥åå°±èƒ½ä¿è¯å—ç³»ç»Ÿèƒ½å¤Ÿå¯é æœ‰åºçš„å‘é€å—ã€‚å¦‚æœä½ å› ä¸ºæŸäº›åŸå› åœ¨åŒä¸€æ—¶é—´å‘é€å—<span>0</span>å’Œå—<span>1</span>ï¼Œè¿™ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿä½ ä¸èƒ½åœ¨å—<span>0</span>åˆ°æ¥ä¹‹å‰å¤„ç†å—<span>1</span>ï¼Œå¦åˆ™è¿™ä¸ªä¼ è¾“è¿‡ç¨‹å°±ä¸æ˜¯æœ‰åºå¯é äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æŒ–å¾—æ·±ä¸€äº›çš„è¯ï¼Œä½ ä¼šå‘ç°ä¸€æ¬¡åªèƒ½å‘é€ä¸€ä¸ªå—ç¡®å®å¼•å…¥äº†ä¸€ä¸ªå°çš„æƒè¡¡ï¼Œå®ƒç»™æ­£åœ¨æ¥æ”¶çš„å—ï¼®å¢åŠ äº†ä¸€ä¸ªç½‘ç»œå¾€è¿”å»¶è¿Ÿï¼Œä»¥åŠä»æ¥æ”¶æ–¹çš„è§’åº¦çœ‹å—ï¼®ï¼‹ï¼‘çš„å‘é€å¼€å§‹æ—¶é—´ä¹Ÿè¢«å»¶è¿Ÿäº†ä¸€ä¸ªç½‘ç»œå¾€è¿”å»¶è¿Ÿã€‚</span> </span></p><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™ä¸ªä»£ä»·æ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºå‘é€å¤§å—æ•°æ®æ˜¯ä¸€ä¸ªéå¸¸å¶ç„¶çš„äº‹æƒ…ï¼ˆä¸¾äº›ç®€å•çš„ä¾‹å­æ¥è¯´ï¼Œå½“å®¢æˆ·ç«¯è¿æ¥ä¸Šæ¥çš„æ—¶å€™ä¼šå‘é€å¤§å—æ•°æ®ï¼Œå½“æ–°çš„å…³å¡éœ€è¦è¿›è¡ŒåŠ è½½çš„æ—¶å€™æ‰ä¼šå‘é€å¤§å—æ•°æ®ã€‚ã€‚ã€‚ï¼‰ï¼Œä½†æ˜¯å¦‚æœ<span>1</span>ç§’é’Ÿå†…<span>10</span>æ¬¡æˆ–è€…<span>20</span>æ¬¡å‘é€å—æ•°æ®çš„è¯è¿™å°±æ˜¯ç»å¯¹ä¸èƒ½è¢«æ¥å—çš„äº†ã€‚æ‰€ä»¥æˆ‘å¸Œæœ›ä½ èƒ½çœ‹åˆ°è¿™ä¸ªç³»ç»Ÿæ˜¯ä¸“ä¸ºä»€ä¹ˆç›®çš„è®¾è®¡çš„ä»¥åŠä¸æ˜¯ä¸ºä»€ä¹ˆç›®çš„è®¾è®¡çš„ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><h2 id="æ•°æ®åŒ…çš„ç»“æ„"><span style="font-size: 18pt; color: rgb(34, 34, 34);">æ•°æ®åŒ…çš„ç»“æ„</span></h2> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åœ¨å—ç³»ç»Ÿä¸­æœ‰ä¸¤æ–¹ä¼šå‚ä¸ï¼Œåˆ†åˆ«æ˜¯å‘é€æ–¹å’Œæ¥æ”¶æ–¹ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å‘é€æ–¹æ˜¯è´Ÿè´£å°†å—å‹å…¥é˜Ÿåˆ—å¹¶é€šè¿‡ç½‘ç»œå‘é€ç‰‡æ®µã€‚æ¥æ”¶æ–¹æ˜¯è´Ÿè´£åœ¨ç½‘ç»œçš„å¦å¤–ä¸€ç«¯è¯»å–è¿™äº›ç‰‡æ®µå¹¶è¿›è¡Œé‡ç»„ã€‚æ¥æ”¶æ–¹è¿˜è´Ÿè´£é€šè¿‡å‘é€<span>â€œ</span>ç¡®è®¤<span>â€</span>æ•°æ®åŒ…ç»™å‘é€æ–¹æ¥ä¸å‘é€æ–¹äº¤æµè¡¨æ˜è¿™ä¸ªç‰‡æ®µå·²ç»æ”¶åˆ°ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æˆ‘å·¥ä½œè¿‡çš„ç½‘ç»œæ¨¡å¼é€šå¸¸æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„é€šä¿¡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘é€šå¸¸å¸Œæœ›èƒ½å¤Ÿä»æœåŠ¡å™¨å¾€å®¢æˆ·ç«¯å‘é€å¤§å—æ•°æ®ï¼Œä»¥åŠä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨å‘é€å¤§å—æ•°æ®ã€‚æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰ä¸¤ä¸ªå‘é€æ–¹å’Œä¸¤ä¸ªæ¥æ”¶æ–¹ï¼Œä¸€ä¸ªå‘é€æ–¹åœ¨å®¢æˆ·ç«¯å¯¹åº”ç€åœ¨æœåŠ¡å™¨é‚£è¾¹æœ‰ä¸€ä¸ªæ¥æ”¶æ–¹ï¼Œåè¿‡æ¥ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¯ä»¥æŠŠå‘é€æ–¹å’Œæ¥æ”¶æ–¹è®¤ä¸ºæ˜¯å—ä¼ è¾“åè®®çš„ç»ˆç‚¹ï¼Œè¿™æ ·ä¹Ÿå°±å®šä¹‰äº†ç½‘ç»œæµçš„æ–¹å‘ã€‚å¦‚æœä½ æƒ³åœ¨ä¸åŒçš„æ–¹å‘å‘é€å—ï¼Œç”šè‡³æ˜¯æ‰©å±•å—çš„å‘é€æ–¹æ¥æ”¯æŒç‚¹å¯¹ç‚¹çš„å‘é€ï¼Œåªéœ€è¦åœ¨ä½ éœ€è¦å‘é€å—çš„æ¯ä¸ªæ–¹å‘æ·»åŠ ä¸€ä¸ªå‘é€æ–¹å’Œä¸€ä¸ªæ¥æ”¶æ–¹ä½œä¸ºç»ˆç‚¹ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™ä¸ªç³»ç»Ÿåœ¨ç½‘ç»œä¸Šå‘é€çš„æ•°æ®åŒ…ç±»å‹ä¸€å…±æœ‰ä¸¤ç§ç±»å‹ï¼š</span> </span></p><p class="MsoListParagraph" align="left" style="margin-left: 21pt; text-indent: -21pt; line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">1ï¼‰ç‰‡æ®µæ•°æ®åŒ…<span>-</span>è¿™åŒ…æ‹¬äº†ä¸€ä¸ªå—çš„ç‰‡æ®µï¼Œæœ€å¤šå¤§å°ä¸º<span>1k</span>ã€‚</span> </span></p><p class="MsoListParagraph" align="left" style="margin-left: 21pt; text-indent: -21pt; line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">2ï¼‰ç¡®è®¤æ•°æ®åŒ…<span>-</span>ä¸€ä¸ªä½åŸŸæŒ‡ç¤ºå“ªäº›ç‰‡æ®µå·²ç»æ”¶åˆ°ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç‰‡æ®µæ•°æ®åŒ…æ˜¯ä»å‘é€æ–¹å‘é€åˆ°æ¥æ”¶å™¨çš„ã€‚è¿™æ˜¯é€šè¿‡ç½‘ç»œå¯¹å—æ•°æ®è¿›è¡Œä¼ é€’çš„æœ‰æ•ˆè½½è·æ•°æ®åŒ…ï¼Œåœ¨è®¾è®¡çš„æ—¶å€™æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„å¤§å°éƒ½è´´è¿‘ä¸€ä¸ªä¿å®ˆçš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯<span> 1200</span>å­—èŠ‚ã€‚æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…æœ€å¤§æ˜¯<span>1 k</span>ï¼Œæ¯ä¸ªå—æœ€å¤šæœ‰<span>256</span>ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œæ‰€ä»¥é€šè¿‡è¿™ä¸ªç³»ç»Ÿå¯ä»¥é€šè¿‡ç½‘ç»œå‘é€çš„æœ€å¤§çš„æ•°æ®æ˜¯<span>256k</span>ï¼ˆå¦‚æœä½ æ„¿æ„çš„è¯ï¼Œä½ å¯ä»¥å¢åŠ è¿™ä¸ªç‰‡æ®µçš„æœ€å¤§æ•°ç›®ï¼‰ã€‚æˆ‘å»ºè®®ä¿æŒç‰‡æ®µçš„å¤§å°ä¸º<span>1k</span>ï¼Œè¿™ä¸»è¦æ˜¯åŸºäºæœ€å¤§ä¼ è¾“å•å…ƒæ–¹é¢çš„è€ƒè™‘ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="color: rgb(43, 43, 43); background: rgb(248, 248, 248);"> </span></span></p><div><div id="highlighter_653417" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">SliceSize = 1024;</code></div><div class="line number2 index1 alt1"><code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">MaxSlicesPerChunk = 256;</code></div><div class="line number3 index2 alt2"><code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">MaxChunkSize = SliceSize <em> MaxSlicesPerChunk;</em></code></div><div class="line number4 index3 alt1"> </div><div class="line number5 index4 alt2"><code class="cpp keyword bold">struct</code> <code class="cpp plain">SlicePacket : </code><code class="cpp keyword bold">public</code> <code class="cpp plain">protocol2::Packet</code></div><div class="line number6 index5 alt1"><code class="cpp plain">{</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">    </code><code class="cpp plain">uint16_t chunkId;</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">sliceId;</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">numSlices;</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">sliceBytes;</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">    </code><code class="cpp plain">uint8_t data[SliceSize];</code></div><div class="line number12 index11 alt1"><code class="cpp spaces"> </code> </div><div class="line number13 index12 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">template</code> <code class="cpp plain">&lt;</code><code class="cpp keyword bold">typename</code> <code class="cpp plain">stream</code><code class="cpp string"></code><code class="cpp plain">&gt; </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">Serialize( Stream &amp; stream )</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number15 index14 alt2"><code class="cpp spaces">        </code><code class="cpp plain">serialize_bits( stream, chunkId, 16 );</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">        </code><code class="cpp plain">serialize_int( stream, sliceId, 0, MaxSlicesPerChunk - 1 );</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">        </code><code class="cpp plain">serialize_int( stream, numSlices, 1, MaxSlicesPerChunk );</code></div><div class="line number18 index17 alt1"><code class="cpp spaces">        </code><code class="cpp keyword bold">if</code> <code class="cpp plain">( sliceId == numSlices - 1 )</code></div><div class="line number19 index18 alt2"><code class="cpp spaces">        </code><code class="cpp plain">{</code></div><div class="line number20 index19 alt1"><code class="cpp spaces">            </code><code class="cpp plain">serialize_int( stream, sliceBytes, 1, SliceSize );</code></div><div class="line number21 index20 alt2"><code class="cpp spaces">        </code><code class="cpp plain">}</code></div><div class="line number22 index21 alt1"><code class="cpp spaces">        </code><code class="cpp keyword bold">else</code> <code class="cpp keyword bold">if</code> <code class="cpp plain">( Stream::IsReading )</code></div><div class="line number23 index22 alt2"><code class="cpp spaces">        </code><code class="cpp plain">{</code></div><div class="line number24 index23 alt1"><code class="cpp spaces">            </code><code class="cpp plain">sliceBytes = SliceSize;</code></div><div class="line number25 index24 alt2"><code class="cpp spaces">        </code><code class="cpp plain">}</code></div><div class="line number26 index25 alt1"><code class="cpp spaces">        </code><code class="cpp plain">serialize_bytes( stream, data, sliceBytes );</code></div><div class="line number27 index26 alt2"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp keyword bold">true</code><code class="cpp plain">;</code></div><div class="line number28 index27 alt1"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number29 index28 alt2"><code class="cpp plain">};</code><code class="cpp keyword bold"></code><code class="cpp plain"></code></div></div></td></tr></table></div></div><br><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åœ¨è¿™é‡Œæˆ‘æƒ³å¯¹ç‰‡æ®µæ•°æ®åŒ…è¿›è¡Œä¸¤ç‚¹è¯´æ˜ã€‚ç¬¬ä¸€ç‚¹æ˜¯å³ä½¿åªæœ‰ä¸€ä¸ªå—åœ¨ç½‘ç»œä¸Šè¿›è¡Œä¼ è¾“ï¼Œä»ç„¶æ˜¯æœ‰å¿…è¦åœ¨æ•°æ®åŒ…é‡Œé¢åŒ…å«ä¸€ä¸ªå—çš„<span>id(</span>æ¯”å¦‚è¯´ï¼Œ<span>0</span>ã€<span>1</span>ã€<span>2</span>ã€<span>3</span>ã€ç­‰ç­‰ç­‰<span>)</span>ï¼Œè¿™æ˜¯<span>,</span>å› ä¸ºé€šè¿‡<span>UDP</span>åè®®å‘é€çš„æ•°æ®åŒ…å¯ä»¥æ˜¯ä¹±åºåˆ°è¾¾çš„ã€‚é€šè¿‡è¿™ç§æ–¹å¼çš„è¯ï¼Œå¦‚æœä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…åˆ°è¾¾çš„æ—¶å€™å¯¹åº”ç€ä¸€ä¸ªå·²ç»æ¥å—è¿‡çš„å—ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼Œä½ æ­£åœ¨æ¥å—å—<span>2</span>çš„æ•°æ®ï¼Œä½†æ˜¯å—<span>1</span>çš„ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…ç°åœ¨åˆ°è¾¾äº†ï¼Œä½ å¯ä»¥ç›´æ¥æ‹’ç»è¿™ä¸ªæ•°æ®åŒ…ï¼Œè€Œä¸æ˜¯æ¥å—å®ƒçš„æ•°æ®åŒ…å¹¶æŠŠå®ƒçš„æ•°æ®æ’å…¥åˆ°å—<span>2</span>ä»è€ŒæŠŠå—<span>2</span>çš„æ•°æ®ç»™å¼„æ··äº†ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç¬¬äºŒç‚¹ã€‚ç”±äºæˆ‘ä»¬çŸ¥é“å—åˆ†æˆç‰‡æ®µçš„æ–¹æ³•ä¼šæŠŠæ‰€æœ‰çš„ç‰‡æ®µé™¤äº†æœ€åä¸€ä¸ªä»¥å¤–éƒ½å¼„æˆå¿…é¡»<span>SliceSize</span>çš„å¤§å°<span>(</span>ä¹Ÿå°±æ˜¯<span>1024</span>å­—èŠ‚<span>)</span>ã€‚æˆ‘ä»¬åˆ©ç”¨è¿™ä¸€ç‚¹æ¥èŠ‚çœä¸€ç‚¹å¸¦å®½ï¼Œæˆ‘ä»¬åªåœ¨æœ€åä¸€ä¸ªç‰‡æ®µé‡Œé¢å‘é€ç‰‡æ®µçš„å¤§å°ï¼Œä½†è¿™æ˜¯ä¸€ç§æƒè¡¡<span>:</span>æ¥æ”¶æ–¹ä¸çŸ¥é“å—çš„ç¡®åˆ‡å¤§å°åˆ°åº•æ˜¯å¤šå°‘å­—èŠ‚ï¼Œç›´åˆ°å®ƒæ¥æ”¶åˆ°æœ€åä¸€ä¸ªç‰‡æ®µæ‰èƒ½çŸ¥é“ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¯ä»¥è®©è¿™ä¸ªç³»ç»Ÿç»§ç»­å¾€åå‘é€æ–°çš„æ•°æ®åŒ…çš„æœºåˆ¶æ˜¯ç¡®è®¤æ•°æ®åŒ…ã€‚è¿™ä¸ªæ•°æ®åŒ…æ˜¯æ²¿ç€å¦å¤–ä¸€ä¸ªæ–¹å‘è¿›è¡Œå‘é€çš„ï¼Œä¹Ÿå°±æ˜¯ä»æ¥æ”¶æ–¹å‘å›ç»™å‘é€æ–¹ï¼Œè¿™ä¹Ÿæ˜¯å—ç½‘ç»œåè®®ä¸­è´Ÿè´£å¯é æ€§çš„éƒ¨åˆ†ã€‚å®ƒå­˜åœ¨çš„ç›®çš„æ˜¯è®©å‘é€æ–¹çŸ¥é“è¿™ä¸ªç‰‡æ®µå·²ç»è¢«å‘é€æ–¹æ”¶åˆ°ã€‚</span></span></p><div><div id="highlighter_476828" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">struct</code> <code class="cpp plain">AckPacket : </code><code class="cpp keyword bold">public</code> <code class="cpp plain">protocol2::Packet </code></div><div class="line number2 index1 alt1"><code class="cpp plain">{ </code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp plain">uint16_t chunkId; </code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">numSlices; </code></div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">acked[MaxSlicesPerChunk]; </code></div><div class="line number6 index5 alt1"> </div><div class="line number7 index6 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">Serialize( Stream &amp; stream )</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">    </code><code class="cpp plain">{ </code></div><div class="line number9 index8 alt2"><code class="cpp spaces">        </code><code class="cpp plain">serialize_bits( stream, chunkId, 16 ); </code></div><div class="line number10 index9 alt1"><code class="cpp spaces">        </code><code class="cpp plain">serialize_int( stream, numSlices, 1, MaxSlicesPerChunk ); </code></div><div class="line number11 index10 alt2"><code class="cpp spaces">        </code><code class="cpp keyword bold">for</code> <code class="cpp plain">( </code><code class="cpp color1 bold">int</code> <code class="cpp plain">i = 0; i &lt; numSlices; ++i ) </code></div><div class="line number12 index11 alt1"><code class="cpp spaces">            </code><code class="cpp plain">serialize_bool( stream, acked[i] ); </code><code class="cpp keyword bold">return</code> <code class="cpp keyword bold">true</code><code class="cpp plain">; } };</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number14 index13 alt1"><code class="cpp plain">};</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ack</span><span style="font-size: 12pt; color: rgb(34, 34, 34);">æ˜¯<span>â€œ</span>ç¡®è®¤<span>â€</span>çš„ç¼©å†™ã€‚æ‰€ä»¥ä¸€ä¸ªå¯¹ç‰‡æ®µ<span>100</span>çš„ç¡®è®¤æ•°æ®åŒ…æ„å‘³ç€æ¥æ”¶æ–¹ç¡®è®¤å®ƒå·²ç»æ¥æ”¶åˆ°äº†ç‰‡æ®µ<span>100</span>ã€‚è¿™å¯¹äºå‘é€æ–¹æ¥è¯´æ˜¯ä¸€æ¡å…³é”®ä¿¡æ¯ï¼Œå› ä¸ºå®ƒä¸ä»…è®©å‘é€æ–¹çŸ¥é“ä»€ä¹ˆæ—¶å€™æ‰€æœ‰çš„ç‰‡æ®µéƒ½å·²ç»è¢«æˆåŠŸæ¥æ”¶ï¼Œè¿™æ ·å‘é€æ–¹å°±å¯ä»¥åœæ­¢å‘é€äº†ï¼Œå®ƒè¿˜å…è®¸å‘é€æ–¹åªé‡å‘é‚£äº›è¿˜æ²¡æœ‰è¢«ç¡®è®¤çš„ç‰‡æ®µï¼Œè¿™æ ·å°±èƒ½è®©å‘é€æ–¹æ›´æœ‰æ•ˆç‡çš„åˆ©ç”¨å¸¦å®½ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è®©æˆ‘ä»¬å¯¹ç¡®è®¤æ•°æ®åŒ…å†æ·±å…¥ä¸€ç‚¹æ€è€ƒï¼Œä¼¼ä¹åœ¨ä¸€å¼€å§‹çœ‹ä¸Šå»å¯¹äºæ¯ä¸ªæ•°æ®åŒ…çš„æ‰€æœ‰åˆ†ç‰‡éƒ½å‘é€ç¡®è®¤åŒ…ä¼¼ä¹æœ‰ç‚¹å¤šä½™ã€‚æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåš<span>?</span>æ˜¯çš„ï¼Œè¿™æ˜¯å› ä¸ºç¡®è®¤æ•°æ®åŒ…æ˜¯é€šè¿‡<span>UDP</span>åè®®å‘é€çš„ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•ä¿è¯æ‰€æœ‰çš„ç¡®è®¤æ•°æ®åŒ…éƒ½ä¼šæˆåŠŸçš„åˆ°è¾¾ç½‘ç»œçš„å¦å¤–ä¸€ç«¯ï¼Œä½ å½“ç„¶ä¸ä¼šå¸Œæœ›å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¹‹é—´å¯¹äºç›®å‰ç¡®è®¤åˆ°é‚£ä¸ªç‰‡æ®µçš„ä¿¡æ¯éƒ½æ˜¯ä¸åŒæ­¥çš„ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€äº›ç¡®è®¤æ•°æ®åŒ…ä¼ è¾“çš„å¯é æ€§ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›å®ç°ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…çš„ç¡®è®¤ç³»ç»Ÿï¼Œå› ä¸ºè¿™å°†ä¼šæ˜¯ä¸€ä¸ªéå¸¸ç—›è‹¦å’Œéº»çƒ¦çš„è¿‡ç¨‹ã€‚å› ä¸ºåœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œç¡®è®¤æ•°æ®åŒ…çš„å¤§å°æ˜¯<span>256</span>ä½æˆ–<span>32</span>å­—èŠ‚ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä¹Ÿæ˜¯æœ€å¥½çš„ã€‚we just send the entire state of all acked slices in each ack packet. When the ack packet is received, we consider a slice to be acked the instant an ack packet comes in with that slice marked as acked and locally that slice is not seen as acked yet.</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"></span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><h2 id="åŸºæœ¬çš„å‘é€æ–¹å®ç°"><span style="font-size: 18pt; color: rgb(34, 34, 34);">åŸºæœ¬çš„å‘é€æ–¹å®ç°</span></h2> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†è¿™ä¸ªç³»ç»ŸèƒŒåçš„åŸºæœ¬æ¦‚å¿µï¼Œè®©æˆ‘ä»¬ä»å‘é€æ–¹çš„å®ç°å¼€å§‹å®ç°æ•´ä¸ªç³»ç»Ÿã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å‘é€æ–¹çš„ç­–ç•¥æ˜¯ï¼š</span> </span></p><p class="MsoListParagraph" align="left" style="margin-left: 21pt; text-indent: -21pt; line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">1ï¼‰æŒç»­çš„å‘é€ç‰‡æ®µæ•°æ®åŒ…ï¼Œç›´åˆ°æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…éƒ½è¢«ç¡®è®¤ã€‚</span> </span></p><p class="MsoListParagraph" align="left" style="margin-left: 21pt; text-indent: -21pt; line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="color: rgb(34, 34, 34);">2ï¼‰</span><span style="font-size: 12pt; color: rgb(34, 34, 34);">ä¸å†å¯¹å·²ç»ç¡®è®¤è¿‡çš„ç‰‡æ®µæ•°æ®åŒ…è¿›è¡Œå‘é€ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹çš„æ•°æ®ç»“æ„æ¥æè¿°å‘é€æ–¹ï¼š</span></span></p><div><div id="highlighter_252465" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">class</code> <code class="cpp plain">ChunkSender</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">sending;</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp plain">uint16_t chunkId;</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">chunkSize;</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">numSlices;</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">numAckedSlices;</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">currentSliceId;</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">acked[MaxSlicesPerChunk];</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">    </code><code class="cpp plain">uint8_t chunkData[MaxChunkSize];</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">double</code> <code class="cpp plain">timeLastSent[MaxSlicesPerChunk];</code></div><div class="line number12 index11 alt1"><code class="cpp plain">};</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æ­£å¦‚ä¹‹å‰æåˆ°çš„é‚£æ ·ï¼Œä¸€æ¬¡åªä¼šå‘é€ä¸€ä¸ªå—çš„æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬æ­£åœ¨å‘é€ä¸€ä¸ªå—çš„æ•°æ®çš„æ—¶å€™ï¼Œé‚£ä¹ˆå…³äº<span>â€œ</span>å‘é€<span>â€</span>çš„çŠ¶æ€æ˜¯<span>true</span>ï¼Œå‡å¦‚æˆ‘ä»¬å¤„äºé—²ç½®çŠ¶æ€ã€æ­£åœ¨å‡†å¤‡å‘é€ä¸€ä¸ªå—çš„æ•°æ®çš„æ—¶å€™ï¼Œé‚£ä¹ˆå…³äº<span>â€œ</span>å‘é€<span>â€</span>çš„çŠ¶æ€æ˜¯<span>false</span>ã€‚åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œå¦‚æœå½“å‰æœ‰ä¸€ä¸ªå—çš„æ•°æ®ä»åœ¨é€šè¿‡ç½‘ç»œè¿›è¡Œå‘é€çš„è¯ï¼Œä½ ä¸èƒ½å‘é€å¦å¤–ä¸€ä¸ªå—çš„æ•°æ®ã€‚ä½ å¿…é¡»ç­‰å¾…å½“å‰å—çš„æ•°æ®å‘é€å®Œæ¯•ä¹‹åæ‰å¯ä»¥å‘é€å¦å¤–ä¸€ä¸ªå—çš„æ•°æ®ã€‚å¦‚æœä½ ä¸å–œæ¬¢çš„è¯ï¼Œåœ¨å—çš„å‘é€å™¨çš„å‰ç«¯æŒ‰ç…§ä½ çš„æ„æ„¿å¯ä»¥æ”¾ç½®ä¸€ä¸ªå‘é€é˜Ÿåˆ—ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æœ‰æˆ‘ä»¬æ­£åœ¨å‘é€çš„å—æ•°æ®çš„<span>id</span>ï¼Œæˆ–è€…å¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨å‘é€å—æ•°æ®çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰è¦å‘é€çš„ä¸‹ä¸€ä¸ªå—æ•°æ®çš„<span>id</span>ã€ä»¥åŠè¿™ä¸ªå—æ‰€åˆ†æˆçš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ã€‚æˆ‘ä»¬ä¹Ÿä¼šè·Ÿè¸ªæ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œæ¥è®°å½•è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«ç¡®è®¤ï¼Œè¿™å¯ä»¥è®©æˆ‘ä»¬é¿å…é‡å‘é‚£äº›å·²ç»æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜ä¼šè®°å½•è¿„ä»Šä¸ºæ­¢å·²ç»ç¡®è®¤æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ï¼Œè¿™ä¸ªæ•°é‡ä¼šå»æ‰å†—ä½™çš„ç¡®è®¤ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„ç¡®è®¤åªç®—ä¸€æ¬¡ã€‚ä»å‘é€æ–¹çš„è§‚ç‚¹æ¥çœ‹ï¼Œåªæœ‰å½“ç¡®è®¤çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ç­‰äºè¿™ä¸ªå—æ‰€åˆ†æˆçš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡çš„æ—¶å€™æ‰ä¼šè¿™ä¸ªå—æ•°æ®å·²ç»è¢«å®Œå…¨æ”¶åˆ°äº†ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æˆ‘ä»¬è¿˜éœ€è¦ä¸ºè¿™ä¸ªç®—æ³•è®°å½•å½“å‰å‘é€çš„ç‰‡æ®µæ•°æ®åŒ…çš„<span>id</span>ï¼Œå› ä¸ºè¿™å°†å†³å®šäº†å“ªäº›ç‰‡æ®µæ•°æ®åŒ…å°†è¢«å‘é€ã€‚å®ƒçš„å·¥ä½œæœºåˆ¶å¤§è‡´æ˜¯è¿™æ ·ï¼šä¸€ä¸ªå—æ•°æ®å¼€å§‹å‘é€çš„æ—¶å€™ï¼Œæ˜¯ä»<span>id</span>ä¸º<span>0</span>çš„ç‰‡æ®µæ•°æ®åŒ…å¼€å§‹å‘é€çš„ï¼Œç„¶åä¾æ¬¡ä»å·¦åˆ°å³å¼€å§‹å‘é€ç›´åˆ°ç»è¿‡æœ€åä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…<span>(</span>ä¹Ÿå°±æ˜¯<span>id</span>ä¸ºåˆ†åŒ…æ•°é‡çš„å¤§å°<span>-1)</span>çš„æ—¶å€™ä¼šå›å¤´ä»<span>id</span>ä¸º<span>0</span>çš„ç‰‡æ®µæ•°æ®åŒ…ç»§ç»­å‘é€ã€‚æœ€ç»ˆï¼Œä½ ä¼šåœæ­¢è¿™ä¸ªè¿­ä»£å› ä¸ºå‘é€çš„ç‰‡æ®µæ•°æ®åŒ…å·²ç»è€—å°½äº†å¸¦å®½ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡è®°å½•å½“å‰å‘é€çš„ç‰‡æ®µæ•°æ®åŒ…çš„<span>id</span>å°±èƒ½è®°ä½æˆ‘ä»¬å½“å‰éå†çš„ç‰‡æ®µæ•°æ®åŒ…çš„ç´¢å¼•ï¼Œè¿™æ ·åœ¨ä¸‹ä¸€æ¬¡å¼€å§‹éå†çš„æ—¶å€™ä½ å°±å¯ä»¥ç»§ç»­ä»è¿™ä¸ªä½ç½®å¼€å§‹å‘é€ç‰‡æ®µæ•°æ®åŒ…ã€‚æœ€åä¸€éƒ¨åˆ†æ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™æ˜¯å› ä¸ºå®ƒå¯ä»¥æŠŠå‘é€ä¸€ä¸ªå—æ•°æ®æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…è¿™ä¸ªäº‹æƒ…æ˜¯åˆ†æ•£å¼€ï¼Œè€Œä¸æ˜¯åœ¨ä¸€èµ·å°±å…¨éƒ¨å‘å‡ºå»ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç°åœ¨è®©æˆ‘ä»¬è®¨è®ºä¸‹å¸¦å®½é™åˆ¶ã€‚æ˜¾ç„¶ä½ ä¸èƒ½æŠŠæ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…ä¸€æ¬¡å…¨éƒ¨å‘å®Œï¼Œå› ä¸ºå¦‚æœè¿™ä¹ˆåšçš„è¯ï¼Œä¼šæŠŠæ•´ä¸ªé“¾æ¥å µä½ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•é™åˆ¶å‘é€æ–¹æ‰€ä½¿ç”¨çš„å¸¦å®½<span>?</span>æˆ‘çš„å®ç°æœºåˆ¶å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼šå½“ä½ å¯¹å…¨éƒ¨çš„ç‰‡æ®µæ•°æ®åŒ…è¿›è¡Œéå†å¹¶ä¸”è€ƒè™‘ä½ æƒ³è¦å‘é€çš„æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ—¶å€™ï¼Œå¤§æ¦‚ä¼°è®¡ä¸‹è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…ä¼šéœ€è¦å æ®å¤šå°‘å­—èŠ‚ï¼Œæ¯”å¦‚å¯ä»¥ç”¨è¿™ç§ä¼°è®¡ç®—æ³•ï¼šå¤§æ¦‚è¿™ä¸ªç‰‡æ®µçš„å­—èŠ‚æ•°<span>+</span>ä¸€äº›åè®®çš„å¼€é”€å’Œ<span>UDP / IP</span>çš„æŠ¥å¤´ã€‚ç„¶åç”¨æ‰€éœ€çš„å­—èŠ‚æ•°å’Œä½ å¸¦å®½é¢„ç®—é‡Œé¢å¯ç”¨æ¥è¿›è¡Œå‘é€çš„å­—èŠ‚æ•°è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå¸¦å®½é¢„ç®—é‡Œé¢æ²¡æœ‰è¶³å¤Ÿå¯ç”¨çš„å­—èŠ‚æ•°ï¼Œé‚£ä¹ˆå°±åœæ­¢å‘é€ã€‚å¦åˆ™çš„è¯ï¼Œä»å¸¦å®½é¢„ç®—é‡Œé¢å‡å»å‘é€è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…æ‰€éœ€çš„å­—èŠ‚æ•°ï¼Œç„¶åå¯¹äºä¸‹ä¸ªç‰‡æ®µæ•°æ®åŒ…é‡å¤æ•´ä¸ªè¿‡ç¨‹ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¸¦å®½é¢„ç®—é‡Œé¢å¯ç”¨çš„å­—èŠ‚å‘é€é¢„ç®—æ˜¯ä»å“ªé‡Œè®¡ç®—å¾—æ¥çš„ï¼Ÿåœ¨æ¯ä¸€å¸§æ›´æ–°å—çš„å‘é€æ–¹ä¹‹å‰ï¼ŒæŠŠä½ çš„ç›®æ ‡å¸¦å®½ï¼ˆæ¯”å¦‚è¯´æ¯ç§’<span>256KB</span>ï¼‰è½¬æ¢æˆæ¯ç§’å¯ä»¥å‘é€çš„å­—èŠ‚æ•°ï¼Œç„¶åç”¨å®ƒä¹˜ä»¥æ›´æ–°æ—¶é—´æ¥æŠŠè®°è¿‡æ”¾åˆ°ä¸€ä¸ªç´¯åŠ å™¨é‡Œé¢ã€‚æ¯ç§’<span>256KB</span>æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¿å®ˆçš„å‘é€é€Ÿç‡ï¼Œè¿™æ„å‘³ä½ å¯ä»¥æ¯ç§’å‘é€<span>32000</span>ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æŠŠ<span>32000  dt</span>è¿™ä¸ªå€¼æ·»åŠ åˆ°ç´¯åŠ å™¨é‡Œé¢ã€‚æ¯ç§’<span>512KB</span>æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€‚ä¸­çš„ä¼°è®¡ï¼Œæ„å‘³ä½ å¯ä»¥æ¯ç§’å‘é€<span>64000</span>ä¸ªå­—èŠ‚ã€‚æ¯ç§’<span>1MB</span>æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ¿€è¿›çš„ä¼°è®¡ï¼Œæ„å‘³ä½ å¯ä»¥æ¯ç§’å‘é€<span>125000</span>ä¸ªå­—èŠ‚ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œåœ¨æ¯æ¬¡æ›´æ–°çš„æ—¶å€™ä½ å°±å¯ä»¥ç´¯åŠ ä½ è¢«å…è®¸å‘é€çš„å­—èŠ‚æ•°äº†ï¼Œè¿™æ ·å½“ä½ å¯ä»¥æŒ‰ç…§é¢„ç®—æ¥å‘é€æœ€å¤§æ•°é‡çš„ç‰‡æ®µæ•°æ®åŒ…ï¼Œå¦‚æœè¿˜æœ‰æ•°æ®æ²¡æœ‰å‘å®Œçš„è¯ï¼Œä¼šç­‰åˆ°ä¸‹ä¸€å¸§çš„æ—¶å€™å†å°è¯•å‘é€ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¯¹äºå‘é€æ–¹è€Œè¨€æœ‰ä¸€ç‚¹æ¯”è¾ƒå¾®å¦™ï¼Œå®ç°ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…é‡æ–°å‘é€çš„æœ€å°å»¶è¿Ÿæ˜¯ä¸€ä¸ªå¾ˆæ£’çš„ä¸»æ„ï¼Œå¦‚æœä¸è¿™ä¹ˆåšçš„è¯ï¼Œå°±å¯èƒ½ä¼šå‡ºç°è¿™ç§ä¸€æ ·æƒ…å†µï¼Œå¯¹äºå¾ˆå°çš„å—æ•°æ®æˆ–è€…ä¸€ä¸ªå—çš„æœ€åå‡ ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œå¾ˆå®¹æ˜“ä¸åœçš„å‘é€å®ƒä»¬æŠŠæ•´ä¸ªç½‘ç»œéƒ½å¡æ»¡ã€‚æ­£æ˜¯å› ä¸ºè¿™ä¸€åŸå› ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªæ•°ç»„æ¥è®°å½•æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„ä¸Šä¸€æ¬¡å‘é€æ—¶é—´ã€‚é‡æ–°å‘é€å»¶è¿Ÿçš„ä¸€ä¸ªé€‰æ‹©æ˜¯ä½¿ç”¨ä¸€ä¸ªä¼°è®¡çš„ç½‘ç»œå¾€è¿”æ—¶å»¶ï¼Œæˆ–è€…åªæœ‰åœ¨è¶…è¿‡ä¸Šä¸€æ¬¡å‘é€æ—¶é—´ç½‘ç»œå¾€è¿”æ—¶å»¶<span>*1.25</span>è¿˜æ²¡æœ‰æ”¶åˆ°ç¡®è®¤æ•°æ®åŒ…çš„æƒ…å†µæ‰ä¼šé‡æ–°å‘é€ã€‚æˆ–è€…ï¼Œä½ å¯ä»¥è¯´<span>â€œ</span>è¿™æ ¹æœ¬å°±æ— æ‰€è°“<span>â€</span>ï¼Œåªè¦è¶…è¿‡ä¸Šä¸€æ¬¡å‘é€æ—¶é—´<span>100</span>æ¯«ç§’äº†å°±é‡æ–°å‘é€ã€‚æˆ‘åªæ˜¯åˆ—ä¸¾é€‚åˆæˆ‘è‡ªå·±çš„æ–¹æ¡ˆï¼</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="color: rgb(34, 34, 34);"> </span> </span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><h2 id="æŠŠå‘é€æ–¹å®ç°çš„æ›´å®Œç¾ä¸€ç‚¹"><span style="font-size: 18pt; color: rgb(34, 34, 34);">æŠŠå‘é€æ–¹å®ç°çš„æ›´å®Œç¾ä¸€ç‚¹</span></h2> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¦‚æœä½ ä»”ç»†ç”¨æ•°å­¦è®¡ç®—ä¸€ä¸‹çš„è¯ï¼Œä½ ä¼šæ³¨æ„åˆ°å¯¹äºä¸€ä¸ª<span>256K </span>çš„æ•°æ®å—è€Œè¨€ï¼Œå®ƒè¦åœ¨ç½‘ç»œä¸Šå‘é€å®Œæ¯•ä»ç„¶éœ€è¦å‘é€å¾ˆé•¿çš„æ—¶é—´ï¼š</span> </span></p><ul type="disc"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt;">å¦‚æœç½‘ç»œé€Ÿç‡æ˜¯æ¯ç§’<span>1M</span>çš„è¯ï¼Œå°±éœ€è¦<span>2</span>ç§’é’Ÿçš„æ—¶é—´ã€‚</span> </span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt;">å¦‚æœç½‘ç»œé€Ÿç‡æ˜¯æ¯ç§’<span>512KB</span>çš„è¯ï¼Œå°±éœ€è¦<span>4</span>ç§’é’Ÿçš„æ—¶é—´ã€‚</span> </span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt;">å¦‚æœç½‘ç»œé€Ÿç‡æ˜¯æ¯ç§’<span>256KB</span>çš„è¯ï¼Œå°±éœ€è¦<span>8</span>ç§’é’Ÿçš„æ—¶é—´ã€‚</span> </span></li></ul><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™å¯æœ‰ç‚¹ç³Ÿç³•ã€‚æˆ‘ä»¬å®ç°ç³»ç»Ÿçš„é‡ç‚¹æ˜¯å¿«é€Ÿå’Œå¯é æ€§ã€‚å†æ¬¡å¼ºè°ƒä¸‹éœ€è¦èƒ½å¤Ÿå¿«é€Ÿä¼ é€’ã€‚å¦‚æœå—ç³»ç»Ÿçš„ä¼ è¾“ä¸èƒ½åšåˆ°å¿«é€Ÿçš„è¯ï¼Œè¿™æ˜¯ä¸æ˜¯ä¼šä¸å¤ªå¥½ï¼Ÿå—ç³»ç»Ÿçš„ä¸€äº›å…¸å‹ç”¨ä¾‹ä¼šæ”¯æŒè¿™ä¸€ç‚¹ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼Œå½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¿æ¥ä¸ŠæœåŠ¡å™¨çš„æ—¶å€™ï¼Œä¸€å¤§å—æ•°æ®éœ€è¦ç«‹åˆ»å‘é€ç»™å®¢æˆ·ç«¯ï¼Œæˆ–è€…åœ¨å®¢æˆ·ç«¯é€€å‡ºåŠ è½½ç•Œé¢å¼€å§‹æ¸¸æˆçš„æ—¶å€™éœ€è¦èƒ½å¤Ÿå¤§é‡æ•°æ®å¿«é€Ÿä¸‹å‘ç»™å®¢æˆ·ç«¯ã€‚ä½ æƒ³è¦å°½å¿«çš„ä¼ é€’å®Œéœ€è¦çš„æ•°æ®ï¼Œè€Œä¸”åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯¹äºè‡ªå·±çš„å¸¦å®½å¹¶æ²¡æœ‰ä»€ä¹ˆå¤ªå¤šå…¶ä»–çš„ç”¨é€”ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸ä½¿ç”¨å°½å¯èƒ½å¤šçš„å¸¦å®½<span>?</span></span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span><br></span></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åœ¨è¿‡å»æˆ‘æ›¾ç»å°è¯•è¿‡ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯åœ¨ä¸€å¼€å§‹çš„æ—¶å€™å°½é‡ä¼ é€’ï¼Œè¿™å–å¾—äº†å¾ˆå¥½çš„æ•ˆæœã€‚å‡è®¾ä½ çš„å—å¤§å°å¹¶ä¸æ˜¯é‚£ä¹ˆå¤§ï¼Œè€Œä¸”ä½ çš„å—å‘é€é¢‘ç‡å¹¶ä¸é‚£ä¹ˆé¢‘ç¹ï¼Œæˆ‘æ²¡æ‰¾åˆ°ä»€ä¹ˆç†ç”±ä¸ºä»€ä¹ˆä½ ä¸èƒ½åœ¨ä¸€å¼€å§‹å°±æŠŠæ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…éƒ½å‘é€å‡ºå»ï¼Œå¡«å……æ»¡è´·æ¬¾ï¼Œç„¶åç­‰å¾…<span>100</span>æ¯«ç§’ï¼Œåœ¨æ¢å¤æˆæ­£å¸¸çš„å¸¦å®½å—é™çš„ç‰‡æ®µæ•°æ®åŒ…å‘é€ç­–ç•¥ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ä¸ºä»€ä¹ˆè¿™æ ·ä¼šå–å¾—è‰¯å¥½çš„æ•ˆæœï¼Ÿå¦‚æœç”¨æˆ·æœ‰ä¸€ä¸ªè‰¯å¥½çš„ç½‘ç»œè¿æ¥ï¼ˆå¯ä»¥æ¯ç§’å‘é€è¶…è¿‡<span>10MB</span>çš„æ•°æ®ç”šè‡³æ›´å¤šã€‚ã€‚ã€‚ï¼‰ï¼Œäº‹å®ä¸Šï¼Œç‰‡æ®µæ•°æ®åŒ…åœ¨ç½‘ç»œä¸Šçš„ä¼ è¾“éå¸¸çš„å¿«é€Ÿã€‚å¦‚æœæ˜¯è¿æ¥çš„æƒ…å†µå¹¶ä¸æ˜¯é‚£ä¹ˆå¥½çš„æƒ…å†µä¸‹ï¼Œå¤§éƒ¨åˆ†çš„ç‰‡æ®µæ•°æ®åŒ…ä¼šå¾—åˆ°ç¼“å†²ï¼Œå¤§éƒ¨åˆ†çš„ç‰‡æ®µæ•°æ®åŒ…å—é™äºå¸¦å®½ä½†æ˜¯ä¼šå°½å¯èƒ½å¿«çš„å‘é€å‡ºå»ã€‚å¤„ç†å®Œè¿™äº›æ•°æ®åŒ…ä¹‹åï¼Œå°±ä¼šåˆ‡æ¢åˆ°å¸¸è§„çš„ç­–ç•¥ï¼Œä»é‚£äº›ç¬¬ä¸€æ¬¡æ²¡æœ‰å‘é€å‡ºå»çš„ç‰‡æ®µæ•°æ®åŒ…é€‰æ‹©åˆé€‚çš„è¿›è¡Œå‘é€ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™ä¼¼ä¹æœ‰ç‚¹å†’é™©ï¼Œæ‰€ä»¥è®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ã€‚å¦‚æœå‡ºç°å¤§é‡æ•°æ®éœ€è¦ä¼ è¾“ä½†æ˜¯å·²ç»è¶…è¿‡å¸¦å®½é™åˆ¶çš„æƒ…å†µï¼Œäº’è”ç½‘ä¸Šçš„è·¯ç”±å™¨ä¼šå€¾å‘äºç¼“å†²è¿™äº›æ•°æ®åŒ…ï¼Œè€Œä¸æ˜¯ä¸æƒœä»£ä»·çš„æŠ›å¼ƒå®ƒä»¬ã€‚è¿™å°±æ˜¯<span>TCP</span>åè®®ä¼šåšçš„äº‹æƒ…ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘è®¨åŒè¿™ä¸ªæœºåˆ¶å› ä¸ºå®ƒä¼šè¯±å‘å»¶è¿Ÿè€Œä¸”ä¼šå¼„ä¹±é‚£äº›ä½ æƒ³è¦å°½å¿«äº¤ä»˜çš„æ¸¸æˆæ•°æ®åŒ…ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹å®ƒæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„è¡Œä¸ºï¼Œè¿™æ˜¯å› ä¸ºç©å®¶çœŸçš„æ²¡æœ‰å…¶ä»–äº‹æƒ…å¯ä»¥åšï¼Œæ™ºèƒ½ç­‰å¾…ä½ çš„å—æ•°æ®èµ¶ç´§ä¼ è¾“å®Œæ¯•ã€‚åªæ˜¯åœ¨ä½ çš„å—æ•°æ®ä¼ è¾“å®Œæ¯•ä»¥åï¼Œä¼šæœ‰ä¸€äº›åƒåœ¾æ•°æ®æˆ–è€…äº¤é€šæ‹¥å µï¼Œå®ƒä¼šå½±å“ä½ çš„æ¸¸æˆå¼€å§‹çš„å‡ ç§’é’Ÿã€‚å¦å¤–ï¼Œè¯·ç¡®ä¿ä½ å¢åŠ äº†ç½‘ç»œä¸¤ç«¯çš„åŠ æ“ä½œç³»ç»Ÿçš„å¥—æ¥å­—ç¼“å†²åŒºçš„å¤§å°ï¼Œè¿™æ ·å®ƒä»¬æ‰å¯ä»¥æ¯”ä½ æœ€å¤§çš„å—æ•°æ®çš„å¤§å°è¦å¤§<span>(</span>æˆ‘å»ºè®®è‡³å°‘å¢åŠ ä¸€å€<span>)</span>ï¼Œå¦åˆ™åœ¨è¶…è¿‡ç½‘ç»œå¸¦å®½çš„é™åˆ¶ä¹‹å‰ä½ å°±ä¼šå‡ºç°ä¸¢å¼ƒæ®µæ•°æ®åŒ…çš„æƒ…å†µã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æœ€åï¼Œæˆ‘æƒ³æˆä¸ºä¸€ä¸ªè´Ÿè´£ä»»çš„ç½‘ç»œå…¬æ°‘ï¼Œè™½ç„¶åœ¨è¿™é‡Œæˆ‘æ¨èåœ¨æœ€å¼€å§‹è¿æ¥çš„æ—¶å€™ä¸€æ¬¡å‘é€æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…ï¼Œæ‰€ä»¥å¯¹æˆ‘æ¥è¯´ä»‹ç»ä¸‹æˆ‘è®¤ä¸ºè¿™çœŸçš„æ˜¯é€‚å½“çš„æ˜¯éå¸¸éå¸¸é‡è¦çš„ï¼Œåœ¨<span>2016</span>å¹´çš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œå‘é€å‡ ç™¾ä¸ª<span>KB</span>é‡çº§çš„æ•°æ®åŒ…æ˜¯æ²¡ä»€ä¹ˆå¤§ä¸äº†çš„è¡Œä¸ºï¼Œè€Œä¸”åªä¼šå‘ç”Ÿåœ¨æ²¡æœ‰å…¶ä»–å…³é”®æ•°æ®åŒæ—¶å‘é€çš„æƒ…å†µä¸‹ã€‚è®©æˆ‘ä»¬ä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼Œå¦‚æœç”¨æˆ·æ­£åœ¨ç©ä½ çš„æ¸¸æˆï¼Œé‚£ä¹ˆå½“ä½ å‘é€å¤§å—æ•°æ®çš„æ—¶å€™ï¼Œä½¿ç”¨ä¿å®ˆçš„ç­–ç•¥ã€‚å¦‚æœä¸è¿™ä¹ˆåšçš„è¯ï¼Œå°±ä¼šå†’å½±å“ç”¨æˆ·æ¸¸æˆä½“éªŒçš„é£é™©ï¼Œè¿™æ˜¯å› ä¸ºä½ çš„å‘é€è¡Œä¸ºå¯èƒ½ä¼šè¯±å¯¼é¢å¤–çš„ç½‘ç»œå»¶è¿Ÿæˆ–è€…å‡ºç°æ•°æ®åŒ…ä¸¢å¤±çš„æƒ…å†µã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åŒæ ·ï¼Œå¦‚æœä½ çš„å—æ•°æ®éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚è¯´æ˜¯åå‡ <span>MB</span>çš„æƒ…å†µï¼Œé‚£ä¹ˆè¯·ä¸è¦ä½¿ç”¨è¿™ç§é‡è›®å‘é€çš„ç­–ç•¥ï¼Œè¿™æ˜¯å› ä¸ºè¿™ç§æ–¹æ³•å¤ªè¿‡äºä¾èµ–é™Œç”Ÿäººçš„ä»æ…ˆï¼Œä¹Ÿå°±æ˜¯åœ¨ä½ å’Œä½ çš„æ•°æ®åŒ…ç›®çš„åœ°ä¹‹é—´çš„è·¯ç”±å™¨ç¼“å†²åŒºã€‚å¦‚æœè¦æŒç»­å‘é€éå¸¸å¤§çš„æ•°æ®å—ä¿æŒä¸€ä¸ªé«˜ååé‡æœ‰å¿…è¦å®æ–½ä¸€äº›æ›´èªæ˜çš„æ–¹æ³•ã€‚è¿™æ˜¯æŸç§è‡ªé€‚åº”çš„æ–¹æ³•ï¼Œå®ƒä¼šè¯•å›¾å°½å¿«å‘é€æ•°æ®ï¼Œä½†æ˜¯ä¸€æ—¦æ£€æµ‹åˆ°å› ä¸ºè¿æ¥ä¸Šæœ‰å¤ªå¤šçš„æ•°æ®åœ¨ä¼ è¾“å¯¼è‡´å¤ªå¤šçš„å»¶è¿Ÿæˆ–è€…æ•°æ®åŒ…çš„ä¸¢å¤±ï¼Œå°±èƒ½åˆ‡æ¢å›ä¸€ä¸ªä½é€Ÿçš„æ–¹å¼ã€‚è¿™æ ·ä¸€ä¸ªç³»ç»Ÿè¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><h2 id="æ¥æ”¶æ–¹çš„å®ç°"><span style="font-size: 18pt; color: rgb(34, 34, 34);">æ¥æ”¶æ–¹çš„å®ç°</span></h2> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç°åœ¨æˆ‘ä»¬å·²ç»è§£å†³äº†å‘é€æ–¹å®ç°çš„æ‰€æœ‰ç»†èŠ‚å’Œå°é—®é¢˜ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬å¼€å§‹å®ç°æ¥æ”¶æ–¹ã€‚æ­£å¦‚ä¹‹å‰æåˆ°çš„é‚£æ ·ï¼Œä¸ä¹‹å‰æ–‡ç« ä»‹ç»çš„æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿä¸åŒï¼Œå—ç³»ç»Ÿåœ¨åŒä¸€æ—¶é—´åªèƒ½ç”±ä¸€ä¸ªå—æ­£åœ¨ä¼ è¾“ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™ä½¿å¾—å—ç³»ç»Ÿçš„æ¥æ”¶æ–¹å¯ä»¥å®ç°çš„æ›´åŠ ç®€å•ï¼Œä½ å¯ä»¥çœ‹ä¸‹é¢çš„å®ç°<span>:</span></span> </span></p><div><div id="highlighter_415734" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">class</code> <code class="cpp plain">ChunkReceiver</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">receiving;</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">readyToRead;</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp plain">uint16_t chunkId;</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">chunkSize;</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">numSlices;</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">numReceivedSlices;</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">received[MaxSlicesPerChunk];</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">    </code><code class="cpp plain">uint8_t chunkData[MaxChunkSize];</code></div><div class="line number11 index10 alt2"><code class="cpp plain">};</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="text-indent: 21pt; line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="color: rgb(34, 34, 34);"> </span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æˆ‘ä»¬æœ‰ä¸€ä¸ªçŠ¶æ€æ¥è®°å½•æˆ‘ä»¬æ˜¯å¦æ­£åœ¨ç½‘ç»œä¸Šâ€œæ¥æ”¶â€ä¸€ä¸ªå—æ•°æ®ï¼ŒåŠ ä¸Šâ€œ<span>readyToReadâ€™</span>â€çŠ¶æ€æ¥è¡¨æ˜æ˜¯å¦å·²ç»æœ‰ä¸€ä¸ªå—çš„æ‰€æœ‰ç‰‡æ®µæ•°æ®åŒ…éƒ½å·²ç»æ”¶åˆ°ã€å·²ç»å‡†å¤‡å¥½è¢«ç”¨æˆ·å¼¹å‡ºè¿›è¡Œè¯»å–å¤„ç†äº†ã€‚æ¥æ”¶é˜Ÿåˆ—çš„æœ€å°é•¿åº¦æ˜¯<span>1</span>ï¼Œè¿™æ˜¯éå¸¸æœ‰æ•ˆçš„ã€‚å¦‚æœä½ ä¸å–œæ¬¢è¿™ä¸ªçš„è¯ï¼Œä½ å½“ç„¶å¯ä»¥ç«‹å³ä»å—æ•°æ®æ¥æ”¶å™¨é‡Œé¢å°†è¿™ä¸ªæ•°æ®å¼¹å‡ºå¹¶æŠŠå®ƒæ’å…¥å®é™…çš„æ¥æ”¶é˜Ÿåˆ—ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åœ¨è¿™ä¸ªæ•°æ®ç»“æ„ä¸­æˆ‘ä»¬è¿˜è®°å½•äº†å—æ•°æ®çš„å¤§å°ï¼ˆå°½ç®¡ä¸æ˜¯å®Œå…¨å‡†ç¡®ï¼Œç›´åˆ°æ”¶åˆ°æœ€åä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…æ‰èƒ½å‡†ç¡®çš„è®¡ç®—å—æ•°æ®çš„å¤§å°ï¼‰ã€ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ã€å·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡è¿˜æœ‰é’ˆå¯¹æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„ä¸€ä¸ªæ¥æ”¶æ ‡è®°ã€‚é’ˆå¯¹æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ¥æ”¶æ ‡è®°å¯ä»¥è®©æˆ‘ä»¬ä¸¢å¼ƒé‚£äº›æˆ‘ä»¬å·²ç»æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…ï¼Œå¹¶è®¡ç®—åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ï¼ˆå› ä¸ºæˆ‘ä»¬å¯èƒ½ä¼šå¤šæ¬¡æ”¶åˆ°åŒä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œä½†æ˜¯æˆ‘ä»¬åªä¼šåœ¨ç¬¬ä¸€æ¬¡æ”¶åˆ°è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ‰ä¼šå¢åŠ è®¡æ•°å™¨çš„å€¼ï¼‰ã€‚å®ƒä¹Ÿè¢«ç”¨åœ¨ç”Ÿæˆç¡®è®¤æ•°æ®åŒ…ä¸Šã€‚å½“å·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ç­‰äºç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡çš„æ—¶å€™ï¼Œä»æ¥æ”¶æ–¹çš„è§’åº¦çœ‹è¿™ä¸ªå—æ•°æ®çš„æ¥æ”¶æ‰ç®—å®Œæˆã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">é¦–å…ˆï¼Œæ¥æ”¶æ–¹çš„è®¾ç½®ä¼šä»å—<span>0</span>å¼€å§‹ã€‚å½“ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…ä»ç½‘ç»œä¸Šä¼ é€’è¿‡æ¥ï¼Œå¹¶ä¸”èƒ½å¤ŸåŒ¹é…è¿™ä¸ªå—<span>id</span>çš„è¯ï¼Œâ€œ<span>receivingâ€</span>çŠ¶æ€ä¼šä»<span>false</span>ç¿»è½¬ä¸º<span>true</span>ï¼Œç¬¬ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ•°æ®ä¼šæ’å…¥â€<span> chunkData</span>â€œå˜é‡çš„åˆé€‚ä½ç½®ï¼Œç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ä¼šæ ¹æ®ç¬¬ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…é‡Œé¢çš„æ•°æ®è¿›è¡Œæ­£ç¡®çš„è®¾ç½®ï¼Œå·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ä¼šåŠ ä¸€ï¼Œä¹Ÿå°±æ˜¯ä»<span>0</span>åˆ°<span>1</span>ï¼Œé’ˆå¯¹æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ¥æ”¶æ ‡è®°é‡Œé¢å¯¹åº”è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„é¡¹ä¼šå˜ä¸º<span>true</span>ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">éšç€è¿™ä¸ªå—æ•°æ®çš„å…¶ä»–ç‰‡æ®µæ•°æ®åŒ…çš„åˆ°æ¥ï¼Œä¼šå¯¹æ¯ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…è¿›è¡Œæ£€æµ‹ï¼Œåˆ¤æ–­å®ƒä»¬çš„<span>id</span>æ˜¯å¦ä¸å½“å‰å—çš„<span>id</span>ç›¸åŒï¼Œå¦‚æœä¸ç›¸åŒçš„è¯å°±ä¼šè¢«ä¸¢å¼ƒã€‚å¦‚æœè¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…å·²ç»æ”¶åˆ°è¿‡çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…ä¹Ÿä¼šè¢«ä¸¢å¼ƒã€‚å¦åˆ™ï¼Œè¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ•°æ®ä¼šæ’å…¥â€<span> chunkData</span>â€œå˜é‡çš„åˆé€‚ä½ç½®ã€å·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ä¼šåŠ ä¸€ã€é’ˆå¯¹æ¯ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ¥æ”¶æ ‡è®°é‡Œé¢å¯¹åº”è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„é¡¹ä¼šå˜ä¸º<span>true</span>ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™ä¸€è¿‡ç¨‹ä¼šæŒç»­è¿›è¡Œï¼Œç›´åˆ°æ¥æ”¶åˆ°æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…ã€‚ä¸€æ—¦æ¥æ”¶åˆ°æ‰€æœ‰çš„ç‰‡æ®µæ•°æ®åŒ…ï¼ˆä¹Ÿå°±æ˜¯å·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡ç­‰äºç‰‡æ®µæ•°æ®åŒ…çš„æ•°é‡çš„æ—¶å€™ï¼‰ï¼Œæ¥æ”¶æ–¹ä¼šæŠŠâ€œ<span>receiving </span>â€œçŠ¶æ€æ”¹ä¸º<span>false</span>ï¼Œè€ŒæŠŠâ€<span>readyToRead</span>â€œçŠ¶æ€æ”¹ä¸º<span>true</span>ã€‚å½“<span>â€readyToReadâ€</span>çŠ¶æ€ä¸º<span>true</span>çš„æ—¶å€™ï¼Œæ‰€æœ‰æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œè¿™ä¸ªå¤„ç†è¿‡ç¨‹é€šå¸¸éå¸¸çš„çŸ­ï¼Œä¼šåœ¨æ”¶åˆ°ç‰‡æ®µæ•°æ®åŒ…çš„åŒä¸€å¸§è¿›è¡Œå¤„ç†ï¼Œè°ƒç”¨è€…ä¼šæ£€æŸ¥<span>â€</span>æˆ‘æœ‰ä¸€å—æ•°æ®è¦è¯»å–ä¹ˆï¼Ÿ<span>â€œ</span>å¹¶å¤„ç†å—æ•°æ®ã€‚ç„¶åä¼šé‡ç½®æ•°æ®å—æ¥æ”¶å™¨çš„æ‰€æœ‰æ•°æ®ä¸ºé»˜è®¤å€¼ï¼Œé™¤äº†å—æ•°æ®çš„<span>id</span>ä»<span>0</span>å¢åŠ åˆ°<span>1</span>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å‡†å¤‡å¥½æ¥æ”¶ä¸‹ä¸€ä¸ªå—äº†ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><h2 id="æµ¸æ³¡æµ‹è¯•çš„é‡è¦æ€§å’Œç¡®è®¤æ•°æ®åŒ…"><span style="font-size: 18pt; color: rgb(34, 34, 34);">æµ¸æ³¡æµ‹è¯•çš„é‡è¦æ€§å’Œç¡®è®¤æ•°æ®åŒ…</span></h2> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç¬¬ä¸€çœ¼çœ‹ä¸Šå»ï¼Œç¡®è®¤æ•°æ®åŒ…è¿™ä¸ªç³»ç»Ÿä¼¼ä¹å¾ˆç®€å•ï¼š</span> </span></p><p class="MsoListParagraph" align="left" style="margin-left: 21pt; text-indent: -21pt; line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">1ï¼‰è®°å½•å·²ç»æ¥æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…ã€‚</span> </span></p><p class="MsoListParagraph" align="left" style="margin-left: 21pt; text-indent: -21pt; line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">2ï¼‰å½“ä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…æ”¶åˆ°ä»¥åï¼Œå›å¤ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç¡®è®¤æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…ä¿¡æ¯çš„ç¡®è®¤æ•°æ®åŒ…ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™çœ‹ä¸Šå»å®ç°èµ·æ¥ä¼¼ä¹ç›¸å½“çš„ç®€å•ï¼Œä½†æ˜¯åƒå¤§å¤šæ•°å‘ç”Ÿåœ¨<span>UDP</span>åè®®çš„äº‹æƒ…ä¸€æ ·ï¼Œå½“æ¶‰åŠåˆ°æ•°æ®åŒ…ä¸¢å¤±çš„æ—¶å€™ï¼Œå°±æœ‰ä¸€äº›å¾®å¦™çš„ç‚¹è®©å®ƒçš„å¤„ç†æœ‰ç‚¹æ£˜æ‰‹ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ä¸€ä¸ªå¯¹äºç¡®è®¤æ•°æ®åŒ…æ¯”è¾ƒå¤©çœŸçš„å®ç°å¯èƒ½æ˜¯è¿™æ ·å­çš„ã€‚æ¯æ¬¡æ”¶åˆ°ç‰‡æ®µæ•°æ®åŒ…ï¼Œå°±å›å¤ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç¡®è®¤æ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…ä¿¡æ¯çš„ç¡®è®¤æ•°æ®åŒ…ï¼ˆä¹Ÿä¼šåŒ…æ‹¬åˆšæ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…çš„ä¿¡æ¯ï¼‰ã€‚è¿™çœ‹ä¸Šå»éå¸¸ç¬¦åˆé€»è¾‘ï¼Œä½†æ˜¯è¿™ä½¿å¾—å—åè®®ç»™æ¶æ„å‘é€è€…ä¸€ä¸ªæ¼æ´ä½¿å¾—å®ƒä»¬å¯ä»¥å—åè®®ä½œä¸ºä¸€ä¸ªDDosçš„å·¥å…·ã€‚å¦‚ä½•ä½œä¸ºä¸€ä¸ªDDosçš„å·¥å…·<span>?</span>å¦‚æœä½ å¯¹æ¯ä¸ªæ”¶åˆ°çš„ç‰‡æ®µæ•°æ®åŒ…éƒ½ä¼šå›å¤ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…çš„è¯ï¼Œé‚£ä¹ˆå‘é€æ–¹èƒ½å¤Ÿæ„é€ ä¸€ä¸ªå¾ˆå°çš„ç‰‡æ®µæ•°æ®åŒ…å‘é€ç»™ä½ ï¼Œè€Œä½ ä¼šå›å¤ä¸€ä¸ªæ¯”å‘é€ç»™ä½ çš„ç‰‡æ®µæ•°æ®åŒ…è¿˜å¤§çš„ç¡®è®¤æ•°æ®åŒ…ï¼Œè¿™æ ·ä½ çš„æœåŠ¡å™¨å°±å˜æˆäº†ä¸€ä¸ªå¯ä»¥è¢«äººåˆ©ç”¨æ¥è¿›è¡ŒDDosæ”¾å¤§æ”»å‡»çš„å·¥å…·ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç°åœ¨ä¹Ÿè®¸æ˜¯å› ä¸ºæˆ‘å¯¹DDosè¿™ä¸ªäº‹æƒ…æœ‰ä¸€ç‚¹åæ‰§ï¼ˆæˆ‘ç¡®å®æ˜¯æœ‰ä¸€ç‚¹ï¼‰ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´ä½ å¯ä»¥é˜²æ­¢å¯¹DDosçš„æ”¾å¤§ï¼Œæ°¸è¿œä¸è¦è®¾è®¡ä¸€ä¸ªåŒ…å«å¯¹æ¥æ”¶åˆ°çš„æ•°æ®åŒ…è¿›è¡Œä¸€å¯¹ä¸€çš„æ˜ å°„å“åº”çš„åè®®ã€‚è®©æˆ‘ä»¬ä¸¾ä¸ªç®€å•ä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœæœ‰äººç»™ä½ å‘é€<span>1000</span>ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œæ°¸è¿œä¸è¦ç»™ä»–å›å¤<span>1000</span>ä¸ªç¡®è®¤æ•°æ®åŒ…ã€‚ç›¸ååªå‘ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…ï¼Œè€Œä¸”æœ€å¤šæ¯<span>50</span>æ¯«ç§’æˆ–è€…<span>100</span>æ¯«ç§’æ‰å‘é€ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…ã€‚å¦‚æœä½ æ˜¯è¿™æ ·è®¾è®¡çš„è¯ï¼Œé‚£ä¹ˆæ»¥ç”¨ä½ çš„<span>UDP</span>åè®®å¯¹DDosè¿›è¡Œæ”¾å¤§å°±æ˜¯å®Œå…¨ä¸å¯èƒ½çš„ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿˜æœ‰å…¶ä»–çš„æ–¹æ³•è®©è¿™ä¸ªç¡®è®¤ç³»ç»Ÿå®¹æ˜“å‡ºé”™ï¼Œè€Œè¿™äº›éƒ½å¾€å¾€è¡¨ç°ä¸º<span>â€</span>å‘é€æŒ‚èµ·<span>â€œ</span>ã€‚æ¢å¥è¯è¯´ï¼Œæ¥æ”¶æ–¹å·²ç»çŸ¥é“è¿™ä¸ªå—å·²ç»å‘é€å®Œæ¯•äº†ï¼Œä½†æ˜¯ç”±äºç¨‹åºå‘˜çš„é”™è¯¯ï¼Œå‘é€æ–¹é”™è¿‡äº†ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…<span>(</span>å¯èƒ½æ˜¯é’ˆå¯¹æœ€åä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„ç¡®è®¤æ•°æ®åŒ…<span>)</span>å¹¶ä¸”å¡å…¥åˆ°ä¸€ä¸ªçŠ¶æ€ï¼Œä¼šä¸åœçš„åå¤é‡å‘è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…è€Œæ²¡æœ‰å¾—åˆ°ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…çš„å“åº”ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åœ¨è¿‡å»<span>10</span>å¹´é‡Œï¼Œæˆ‘å¯èƒ½è‡³å°‘<span>5</span>æ¬¡ä»å¤´å¼€å§‹å®ç°è¿™ä¸ªå—ç³»ç»Ÿï¼Œæ¯æ¬¡æˆ‘éƒ½æ‰¾åˆ°æ–°çš„å’Œä»¤äººå…´å¥‹çš„æ–¹å¼æ¥è®©å‘é€æ–¹æŒ‚èµ·ã€‚æˆ‘å¼€å‘å’Œæµ‹è¯•å—ç³»ç»Ÿçš„ç­–ç•¥æ˜¯é¦–å…ˆè¿›è¡Œç¼–ç ç¡®è®¤å®ƒèƒ½å¤Ÿè·‘èµ·æ¥ï¼Œç„¶åè®¾ç½®ä¸€ä¸ªæµ‹è¯•å·¥å…·åœ¨æœ‰å¤§é‡çš„æ•°æ®åŒ…ä¸¢å¤±ã€æ•°æ®åŒ…ä¹±åºå’Œé‡å¤çš„æƒ…å†µä¸‹éšæœºå‘é€éšæœºå¤§å°çš„å—ã€‚è¿™å¾€å¾€ä¼šæ¸…é™¤ä»»ä½•æŒ‚èµ·ã€‚æˆ‘æ›¾ç»å®ç°è¿‡çš„å—ç³»ç»Ÿéƒ½è‡³å°‘æœ‰ä¸€ä¸ªæŒ‚èµ·å­˜åœ¨ï¼Œé€šå¸¸ä¼šæœ‰<span>2</span>åˆ°<span>3</span>ä¸ªæŒ‚èµ·ã€‚æ‰€ä»¥å¦‚æœä½ æ˜¯æ‰“ç®—ä»å¤´å¼€å§‹å®ç°è¿™ä¸ªå—ç³»ç»Ÿçš„è¯ï¼Œè¯·ä¸è¦è½»æ•Œã€‚è¯·è®¾ç½®ä¸€ä¸ªæµ¸æ³¡æµ‹è¯•ã€‚ä½ ä¼šæ„Ÿè°¢æˆ‘åœ¨è¿™é‡Œçš„æé†’çš„ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æˆ‘é€šå¸¸é‡åˆ°çš„ç¬¬ä¸€æ¬¡æŒ‚èµ·æ˜¯ç”±äºå¯¹åŒä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„å¤šæ¬¡æ”¶åˆ°ä¸ä¼šå›å¤ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…ã€‚å®ƒæœ‰ç‚¹åƒè¿™æ ·ï¼š<span>â€ </span>å“¦ï¼Œè¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…å·²ç»æ”¶åˆ°è¿‡äº†ä¹ˆï¼Ÿå·²ç»æ”¶åˆ°è¿‡äº†å°±ä¸¢å¼ƒå®ƒ<span>â€</span>ï¼Œç„¶åå¿˜è®°åœ¨ç¡®è®¤æ•°æ®åŒ…é‡Œé¢è®¾ç½®æ ‡è®°ã€‚è¿™å¯¹äºå‘é€æ–¹æ¥è¯´æ˜¯ä¸€ä¸ªå›°æ‰°ï¼Œå› ä¸ºè¿™æ ·çš„è¯å°±ä¸ä¼šæœ‰ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…ï¼Œé‚£ä¹ˆå¦‚æœå‡ºç°è¿™ç§æƒ…å†µçš„è¯ï¼Œåˆæ°å¥½é‡åˆ°ç¬¬ä¸€æ¬¡æ”¶åˆ°è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ—¶å€™å‘é€çš„ç¡®è®¤æ•°æ®åŒ…å‡ºç°ä¸¢åŒ…çš„æƒ…å†µï¼Œå‘é€æ–¹æ ¹æœ¬å°±ä¸çŸ¥é“è¿™ä¸ªä»–åœ¨åå¤å‘é€çš„ç‰‡æ®µæ•°æ®åŒ…å…¶å®å·²ç»è¢«æ”¶åˆ°äº†ã€‚å¦‚æœä½ å°±æ˜¯è¿™ä¹ˆä¸å·§ï¼Œé‡ä¸Šäº†ç¬¬ä¸€æ¬¡æ”¶åˆ°è¿™ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ—¶å€™å‘é€çš„ç¡®è®¤æ•°æ®åŒ…å‡ºç°ä¸¢åŒ…çš„æƒ…å†µï¼Œé‚£ä¹ˆå°±é‡ä¸Šäº†æŒ‚èµ·çš„æƒ…å†µã€‚å¦‚æœä½ æƒ³åœ¨ä½ çš„ä»£ç é‡Œé¢é‡ç°è¿™ä¸ªæƒ…å†µçš„è¯ï¼Œå¯ä»¥åœ¨æ”¶åˆ°æœ€åä¸€ä¸ªç‰‡æ®µæ•°æ®åŒ…çš„æ—¶å€™ä¸å‘é€ç¡®è®¤æ•°æ®åŒ…ï¼Œé‚£ä¹ˆå‡ºç°çš„æƒ…å†µå°±æ˜¯è¿™ç§æŒ‚èµ·äº†ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ä¸‹ä¸€ä¸ªæŒ‚èµ·ä¼šå‘ç”Ÿåœ¨æ¥æ”¶æ–¹åœ¨å‘é€æ–¹çŸ¥é“ä¹‹å‰å°±å·²ç»çŸ¥é“å—å‘é€å®Œæ¯•å¹¶åˆ‡æ¢å®ƒçš„çŠ¶æ€å˜é‡â€œ<span>readyToReadâ€</span>æ¥ä¸¢å¼ƒåç»­ä¼ å…¥çš„ç‰‡æ®µæ•°æ®åŒ…ã€‚åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œå³ä½¿æ¥æ”¶æ–¹è®¤ä¸ºå—å·²ç»å®Œå…¨æ¥æ”¶å®Œæ¯•ï¼Œä½†æ˜¯å‘é€æ–¹è¿˜ä¸çŸ¥é“è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥æœ‰å¿…è¦è®¾ç½®ç¡®è®¤æ•°æ®åŒ…å¯¹åº”çš„æ ‡å¿—ä½ï¼Œå³ä½¿å—å·²ç»å®Œå…¨æ¥æ”¶å®Œæ¯•ï¼Œè¿™æ ·å‘é€æ–¹æ‰èƒ½ä¸€ç›´æ¥æ”¶åˆ°æç¤ºå—å·²ç»å…¨éƒ¨å‘é€å®Œæ¯•çš„ç¡®è®¤æ•°æ®åŒ…ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">é€šå¸¸é‡åˆ°çš„æœ€åä¸€ä¸ªæŒ‚èµ·æƒ…å†µæ˜¯åœ¨è¯»å–å®Œå—æ•°æ®ä»¥åçš„çŠ¶æ€åˆ‡æ¢é‡Œé¢ï¼Œé‚£ä¸ªæ—¶å€™çŠ¶æ€å˜é‡â€œ<span>readyToReadâ€</span>å·²ç»åˆ‡å›<span>false</span>è€Œå—çš„<span>id</span>ä¹ŸåŠ ä¸€äº†ã€‚è®©æˆ‘ä»¬ä¸¾ä¸ªç®€å•ä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œå—<span>0</span>å·²ç»å®Œæˆæ¥æ”¶ï¼Œç”¨æˆ·å·²ç»å®Œæˆå¯¹å—<span>0</span>çš„è¯»å–å¹¶ä¸”å—<span>id</span>å·²ç»é€’å¢åˆ°<span>1</span>äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½æ¥æ”¶å—<span>1</span>çš„ç‰‡æ®µæ•°æ®åŒ…äº†ï¼ˆæˆ‘ä»¬ä¼šä¸¢å¼ƒä»»ä½•ä¸æˆ‘ä»¬å½“å‰æ­£åœ¨æ¥æ”¶å—<span>ID</span>ä¸åŒçš„ç‰‡æ®µæ•°æ®åŒ…ï¼‰ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å†ä¸€æ¬¡å‡ºç°è¿™ç§æƒ…å†µï¼Œå°±æ˜¯è¿™é‡Œçš„å‘é€æ–¹å› ä¸ºç¡®è®¤æ•°æ®åŒ…çš„ä¸¢å¤±å¯¼è‡´ä¿¡æ¯æœ‰ä¸€ç‚¹æ»åï¼Œå¯èƒ½æ˜¯å› ä¸ºæ²¡æœ‰æ”¶åˆ°ç¬¬ä¸€ä¸ªç¡®è®¤æ•°æ®åŒ…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰å¿…è¦å…³æ³¨ç‰‡æ®µæ•°æ®åŒ…ï¼Œå¦‚æœæˆ‘ä»¬æ­£å¤„äºè¿™ä¹ˆä¸€ä¸ªçŠ¶æ€ï¼šæˆ‘ä»¬å°šæœªæ”¶åˆ°ç¬¬<span>n</span>ä¸ªç‰‡æ®µæ•°æ®åŒ…ï¼Œä½†æ˜¯å‰é¢<span>n â€“ 1</span>ä¸ªç‰‡æ®µæ•°æ®åŒ…éƒ½å·²ç»æ”¶åˆ°äº†ï¼Œæˆ‘ä»¬å¿…é¡»è®¾ç½®ä¸€ä¸ªç‰¹æ®Šçš„æ ‡è®°ä½ç„¶åæˆ‘ä»¬ä¼šå‘é€ä¸€ä¸ªåŒ…å«æ‰€æœ‰å‰é¢<span>n â€“ 1</span>ä¸ªç‰‡æ®µæ•°æ®åŒ…éƒ½å·²ç»æ”¶åˆ°ä¿¡æ¯çš„ç¡®è®¤æ•°æ®åŒ…ï¼Œå¦åˆ™å‘é€æ–¹ä¸ä¼šæ„è¯†åˆ°å—æ•°æ®å·²ç»æ”¶åˆ°å¹¶ä¸”å‘é€æ–¹å·²ç»å‡†å¤‡æŒ‚èµ·äº†ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„é‚£æ ·ï¼Œç¡®è®¤æ•°æ®åŒ…çš„å®ç°æ˜¯æœ‰ä¸€ç‚¹å¾®å¦™çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰ç‚¹å¥‡æ€ªçš„è¿‡ç¨‹å› ä¸ºå½“ç‰‡æ®µæ•°æ®åŒ…åœ¨ç½‘ç»œçš„ä¸€ç«¯æ”¶åˆ°çš„æ—¶å€™ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½æ¥å‘é€ç¡®è®¤æ•°æ®åŒ…ç›´åˆ°å‘é€æ–¹çŸ¥é“éƒ½æœ‰å“ªäº›å‘é€çš„ç‰‡æ®µæ•°æ®åŒ…è¢«æˆåŠŸæ¥æ”¶ä¸ºæ­¢ã€‚å¦‚æœä½ æ‰“ç ´äº†ç‰‡æ®µæ•°æ®åŒ…<span>-&gt;</span>ç¡®è®¤æ•°æ®åŒ…è¿™ä¸ªé“¾æ¥çš„è¯ï¼Œé‚£ä¹ˆæ•´ä¸ªç³»ç»Ÿå°±å°†æŒ‚èµ·ã€‚æˆ‘é¼“åŠ±ä½ ä»”ç»†çœ‹çœ‹è¿™ç¯‡æ–‡ç« çš„æºä»£ç ææ¸…æ¥šè¿›ä¸€æ­¥çš„ç»†èŠ‚ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><h2 id="æ€»ç»“"><span style="font-size: 18pt; color: rgb(34, 34, 34);">æ€»ç»“</span></h2> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å—ç³»ç»Ÿåœ¨æ¦‚å¿µä¸Šæ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯å®ƒçš„å…·ä½“å®ç°è‚¯å®šä¸æ˜¯å¾®ä¸è¶³é“çš„ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œå®ç°å‘é€è€…è®¾è®¡è¿™ä¸€å—æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å­¦ä¹ ç»éªŒï¼Œå½“ä½ ä»å¤´å¼€å§‹å®ç°è¿™æ ·çš„ç³»ç»Ÿçš„æ—¶å€™ä¸€å®šæœ‰å¾ˆå¤šä¸œè¥¿éœ€è¦å­¦ä¹ ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ä¸ªç³»ç»Ÿçš„è®¾è®¡ï¼Œå¹¶è¯•ç€è‡ªå·±åŠ¨æ‰‹ä»å¤´å¼€å§‹å®ç°å®ƒã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å­¦ä¹ ç»å†ã€‚æ­¤å¤–ï¼Œæˆ‘é¼“åŠ±ä½ åœ¨<span>patreon</span>ä¸Šæ”¯æŒæˆ‘ï¼Œä½œä¸ºå›æŠ¥ï¼Œä½ ä¼šå¾—åˆ°æœ¬æ–‡çš„ç¤ºä¾‹æºä»£ç <span>(</span>ä»¥åŠæœ¬ç³»åˆ—çš„å…¶ä»–æ–‡ç« çš„ç¤ºä¾‹æºä»£ç <span>)</span>ï¼Œè¿˜åŒ…æ‹¬æˆ‘åœ¨<span>GDC 2015</span>ä¸Šå…³äºç½‘ç»œç‰©ç†çš„æ¼”è®²çš„æºä»£ç ã€‚</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ä»·å€¼çš„è¯ï¼Œè¯·åœ¨<span>patreon</span>ä¸Šæ”¯æŒæˆ‘çš„å†™ä½œï¼Œè¿™æ ·æˆ‘ä¼šå†™çš„æ›´å¿«ã€‚ä½ å¯ä»¥åœ¨<span>BSD 3.0</span>è®¸å¯ä¸‹è®¿é—®åˆ°è¿™ç¯‡æ–‡ç« é‡Œé¢çš„ä»£ç ã€‚éå¸¸æ„Ÿè°¢ä½ çš„æ”¯æŒï¼</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ã€ç‰ˆæƒå£°æ˜ã€‘</span> </span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">åŸæ–‡ä½œè€…æœªåšæƒåˆ©å£°æ˜ï¼Œè§†ä¸ºå…±äº«çŸ¥è¯†äº§æƒè¿›å…¥å…¬å…±é¢†åŸŸï¼Œè‡ªåŠ¨è·å¾—æˆæƒã€‚</span> </span></p><p class="MsoNormal"><span style="font-family:å¾®è½¯é›…é»‘;"><span> </span> </span></p><p class="MsoNormal"><span><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span> </p></div>                    <br>                

      


      

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/GafferOnGames/" rel="tag"><i class="fa fa-tag"></i> GafferOnGames</a>
            
          </div>
        

        
        
        

        
          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/packet_fragmentation_and_reassembly/" rel="next" title="æ„å»ºæ¸¸æˆç½‘ç»œåè®®ä¸‰ä¹‹æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„">
                  <i class="fa fa-chevron-left"></i> 
                  <p class="post-nav-pre-next-title">
                    æ„å»ºæ¸¸æˆç½‘ç»œåè®®ä¸‰ä¹‹æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„
                  </p> 
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/kbe_ue4_demo/" rel="prev" title="KBEçš„UE4çš„demoå¤§ä½“è§£è¯»">
                <p class="post-nav-pre-next-title">
                    KBEçš„UE4çš„demoå¤§ä½“è§£è¯»
                </p> 
                <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        

        
        
      </footer>
      
    </div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  

  <aside id="sidebar" class="sidebar">

    
      
        <div id="sidebar-dimmer"></div>
      
    

    <div class="sidebar-inner">
    
      <div class="sidebar-toggle-inside motion-element">
        <div class="sidebar-toggle-line-wrap">
          <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
          <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
          <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
        </div>
      </div>

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a href="/" class="site-author-image" rel="start" style="border:none">
            <img class="site-author-image" itemprop="image" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/uploads/avatar.png" alt="Mike">
          </a>
          <p class="site-author-name" itemprop="name">Mike</p>
           
              <p class="site-description motion-element" itemprop="description">ğŸš™ ğŸš— ğŸ’¨ ğŸ’¨ If you want to create a blog like this, just follow my open-source project, "hexo-theme-neo", click the GitHub button below and check it out ^_^ . It is recommended to use Chrome, Safari, or Edge to read this blog since this blog was developed on Edge (Chromium kernel version) and tested on Safari.</p>
          
        </div>

        <nav class="site-state motion-element">

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">298</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">111</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

          <div class="site-state-item site-state-about">
            <a href="/about/">
              <span class="site-state-item-about fa fa-fw fa-user"></span>
              <span class="site-state-item-name">about</span>
            </a>
          </div>
          
        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/no5ix" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://open.spotify.com/user/313duq77ekebrfyak3xijqewzss4?si=e7653b829a9747bf" target="_blank" title="Spotify">
                  
                    <i class="fa fa-fw fa-spotify"></i>
                  
                    
                      Spotify
                    
                </a>
              </span>
            
          
          
          <!-- ç½‘æ˜“äº‘éŸ³ä¹ -->
            <!-- <div class="netease-cloud-music"> -->
              <!-- <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=280 height=110 src="//music.163.com/outchain/player?type=0&id=992743594&auto=0&height=90"></iframe> -->
            <!-- </div> -->
          <!-- ç½‘æ˜“äº‘éŸ³ä¹ -->

        </div>

        
        

        
        

        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"><span class="nav-text">æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ"><span class="nav-text">ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå‘é€å¤§å—æ•°æ®ç³»ç»Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ¬ç¯‡åŸºæœ¬æœ¯è¯­"><span class="nav-text">æœ¬ç¯‡åŸºæœ¬æœ¯è¯­</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ•°æ®åŒ…çš„ç»“æ„è®¾è®¡"><span class="nav-text">æ•°æ®åŒ…çš„ç»“æ„è®¾è®¡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‘é€æ–¹çš„å®ç°"><span class="nav-text">å‘é€æ–¹çš„å®ç°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ¥æ”¶æ–¹çš„å®ç°æ€è·¯"><span class="nav-text">æ¥æ”¶æ–¹çš„å®ç°æ€è·¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é˜²DDos"><span class="nav-text">é˜²DDos</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#åŸæ–‡"><span class="nav-text">åŸæ–‡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#introduction"><span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#background"><span class="nav-text">Background</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#chunks-and-slices"><span class="nav-text">Chunks and Slices</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#packet-structure"><span class="nav-text">Packet Structure</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sender-implementation"><span class="nav-text">Sender Implementation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#kicking-it-up-a-notch"><span class="nav-text">Kicking it up a notch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#receiver-implementation"><span class="nav-text">Receiver Implementation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#conclusion"><span class="nav-text">Conclusion</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#è¯‘æ–‡"><span class="nav-text">è¯‘æ–‡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å—å’Œç‰‡æ®µ"><span class="nav-text">å—å’Œç‰‡æ®µ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ•°æ®åŒ…çš„ç»“æ„"><span class="nav-text">æ•°æ®åŒ…çš„ç»“æ„</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åŸºæœ¬çš„å‘é€æ–¹å®ç°"><span class="nav-text">åŸºæœ¬çš„å‘é€æ–¹å®ç°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æŠŠå‘é€æ–¹å®ç°çš„æ›´å®Œç¾ä¸€ç‚¹"><span class="nav-text">æŠŠå‘é€æ–¹å®ç°çš„æ›´å®Œç¾ä¸€ç‚¹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ¥æ”¶æ–¹çš„å®ç°"><span class="nav-text">æ¥æ”¶æ–¹çš„å®ç°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æµ¸æ³¡æµ‹è¯•çš„é‡è¦æ€§å’Œç¡®è®¤æ•°æ®åŒ…"><span class="nav-text">æµ¸æ³¡æµ‹è¯•çš„é‡è¦æ€§å’Œç¡®è®¤æ•°æ®åŒ…</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€»ç»“"><span class="nav-text">æ€»ç»“</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mike</span>
</div>



        

        
      </div>
    </footer>

    <!--
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      
        <span id="scrollpercent"><span>0</span>%</span>
      
    </div>
    -->

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>










  















  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/mediumzoom/medium-zoom.js?v=1.1.0"></script>





  




  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>


  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

    <script src="/js/src/local-search.js"></script>





  

  

  

  

  

  


  <script type="text/javascript" src="/lib/wobble_window/wobblewindow.js"> </script>
<script type="text/javascript" src="/js/src/custom.js"></script>
</body>
</html>






<script type="text/javascript" src="/js/src/headroom.js"></script>

<!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½ -->
<script type="text/javascript" src="/js/src/code-highlight-modification.js"></script>

<!-- Flashcards Script -->
<script type="text/javascript" src="/js/src/flashcards.js"></script>
