<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


  <meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">

<script>
    (function(){
        if(''){
            let localStoragePasswdKey = 'æ„å»ºæ¸¸æˆç½‘ç»œåè®®ä¸‰ä¹‹æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„' + '_last_passwd';
            let tryCnt = 0;
            function checkPassword(password) {
                password = password == null ? null : password.trim();
                if (password !== '') {
                    if (password != null) {
                        // å¦‚æœç”¨æˆ·ç‚¹å‡»äº†ç¡®è®¤è€Œä¸”å¯†ç é”™è¯¯çš„æ—¶å€™, å› ä¸ºå½“password == nullçš„æ—¶å€™è¯´æ˜ç”¨æˆ·ç‚¹äº†å–æ¶ˆ
                        alert('Error!');
                        if (++tryCnt < 3) {
                            password = prompt('Open Sesame');
                            checkPassword(password);
                            return;
                        }
                    }

                    // if (history.length > 1) {
                    //     alert('back!');
                    //     history.back();
                    // } else {
                        // alert('blankkkk!');
                    //     window.location.href = "about:blank";
                    // }
                    if (document.referrer) {
                        window.location.href = document.referrer;
                    } else {
                        window.location.href = "about:blank";; // fallback if no referrer
                    }

                } else {
                    localStorage.setItem(localStoragePasswdKey, password);
                }
            }

            var password_verify_on_local = false;
            const hostname = window.location.hostname;
            if (password_verify_on_local || (!(hostname === "localhost" || hostname === "127.0.0.1" || hostname === "::1" || hostname.startsWith("192")))) {
                const lspk = localStorage.getItem(localStoragePasswdKey) || "";
                if (lspk !== '') {
                    var password = prompt('Open Sesame');
                    checkPassword(password);
                }
            }
        }
    })();
</script>








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">





















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="GafferOnGames,">








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2">






<meta name="description" content="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“æœ¬ç¯‡ä¸»è¦è®²äº†æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„é—®é¢˜, åˆ°åº•æ•°æ®åŒ…å¤šå¤§æ‰å¥½å‘¢?æ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½å‘¢?åŒ…å¤ªå¤§äº†æ€ä¹ˆåŠå‘¢?è¯·çœ‹æ€»ç»“, ä¸æ˜ä¹‹å¤„å†çœ‹æ–‡ä¸­å…·ä½“è®²è§£. ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿæ¯å°è®¡ç®—æœº(è·¯ç”±å™¨)ä¼šæ²¿ç€è·¯ç”±å¼ºåˆ¶è¦æ±‚æ•°æ®åŒ…çš„å¤§å°ä¼šæœ‰ä¸€ä¸ªæœ€å¤§çš„ä¸Šé™ï¼Œè¿™ä¸ªä¸Šé™å°±æ˜¯æ‰€è°“çš„æœ€å¤§ä¼ è¾“å•å…ƒMTUã€‚å¦‚æœä»»æ„ä¸€ä¸ªè·¯ç”±å™¨æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…çš„å¤§å°è¶…è¿‡è¿™ä¸ªæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œå®ƒæœ‰è¿™ä¹ˆä¸¤ä¸ªé€‰æ‹©ï¼Œa)åœ¨IPå±‚å¯¹è¿™ä¸ªæ•°æ®åŒ…è¿›è¡Œåˆ†">
<meta name="keywords" content="GafferOnGames">
<meta property="og:type" content="article">
<meta property="og:title" content="æ„å»ºæ¸¸æˆç½‘ç»œåè®®ä¸‰ä¹‹æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„">
<meta property="og:url" content="https://hulinhong.com/packet_fragmentation_and_reassembly/index.html">
<meta property="og:site_name" content="ğŸš™">
<meta property="og:description" content="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“æœ¬ç¯‡ä¸»è¦è®²äº†æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„é—®é¢˜, åˆ°åº•æ•°æ®åŒ…å¤šå¤§æ‰å¥½å‘¢?æ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½å‘¢?åŒ…å¤ªå¤§äº†æ€ä¹ˆåŠå‘¢?è¯·çœ‹æ€»ç»“, ä¸æ˜ä¹‹å¤„å†çœ‹æ–‡ä¸­å…·ä½“è®²è§£. ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿæ¯å°è®¡ç®—æœº(è·¯ç”±å™¨)ä¼šæ²¿ç€è·¯ç”±å¼ºåˆ¶è¦æ±‚æ•°æ®åŒ…çš„å¤§å°ä¼šæœ‰ä¸€ä¸ªæœ€å¤§çš„ä¸Šé™ï¼Œè¿™ä¸ªä¸Šé™å°±æ˜¯æ‰€è°“çš„æœ€å¤§ä¼ è¾“å•å…ƒMTUã€‚å¦‚æœä»»æ„ä¸€ä¸ªè·¯ç”±å™¨æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…çš„å¤§å°è¶…è¿‡è¿™ä¸ªæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œå®ƒæœ‰è¿™ä¹ˆä¸¤ä¸ªé€‰æ‹©ï¼Œa)åœ¨IPå±‚å¯¹è¿™ä¸ªæ•°æ®åŒ…è¿›è¡Œåˆ†">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2025-12-17T18:31:29.670Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="æ„å»ºæ¸¸æˆç½‘ç»œåè®®ä¸‰ä¹‹æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„">
<meta name="twitter:description" content="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“æœ¬ç¯‡ä¸»è¦è®²äº†æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„é—®é¢˜, åˆ°åº•æ•°æ®åŒ…å¤šå¤§æ‰å¥½å‘¢?æ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½å‘¢?åŒ…å¤ªå¤§äº†æ€ä¹ˆåŠå‘¢?è¯·çœ‹æ€»ç»“, ä¸æ˜ä¹‹å¤„å†çœ‹æ–‡ä¸­å…·ä½“è®²è§£. ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿæ¯å°è®¡ç®—æœº(è·¯ç”±å™¨)ä¼šæ²¿ç€è·¯ç”±å¼ºåˆ¶è¦æ±‚æ•°æ®åŒ…çš„å¤§å°ä¼šæœ‰ä¸€ä¸ªæœ€å¤§çš„ä¸Šé™ï¼Œè¿™ä¸ªä¸Šé™å°±æ˜¯æ‰€è°“çš„æœ€å¤§ä¼ è¾“å•å…ƒMTUã€‚å¦‚æœä»»æ„ä¸€ä¸ªè·¯ç”±å™¨æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…çš„å¤§å°è¶…è¿‡è¿™ä¸ªæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œå®ƒæœ‰è¿™ä¹ˆä¸¤ä¸ªé€‰æ‹©ï¼Œa)åœ¨IPå±‚å¯¹è¿™ä¸ªæ•°æ®åŒ…è¿›è¡Œåˆ†">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":12,"scrollpercent":true,"onmobile":true,"dimmer":true,"body_content_height":0,"display_duration":150},
    local_search: {"enable":true,"trigger":"auto","top_n_per_article":1},
    fancybox: false,
    mediumzoom: true,
    darkmode_js: false,
    tabs: true,
    motion: {"enable":true,"async":false,"duration":188,"transition":{"header":"fadeIn","menu":"fadeIn","logo":"fadeIn","post_block_else":"fadeIn","post_header":"fadeIn","post_body":"fadeIn","coll_header":"fadeIn","footer":"fadeIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>








  <title>æ„å»ºæ¸¸æˆç½‘ç»œåè®®ä¸‰ä¹‹æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ | ğŸš™</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ğŸš™</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ğŸ’¨ ğŸ’¨ ğŸ’¨</p>
      
  </div>

  <div class="menu-item sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div class="menu-item site-search">
    
  
  <div class="site-search-div">
    <button class="search-icon" id="search-button">
      <i class="fa fa-search"></i>
    </button>
    <input type="text" id="local-search-input" class="st-search-input">
    <i id="local-search-close">Ã—</i>
  </div>


<script type="text/javascript" id="local.search.active">
    {/* var inputArea       = document.querySelector("#local-search-input");
    inputArea.onclick   = function(){ getSearchFile(); this.focus(); }
    inputArea.onkeydown = function(){ if(event.keyCode == 13) return false } */}
</script>



  </div>
  <div id="local-search-result-pc" class="local-search-result-cls"></div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

       
    </ul>
  

  
    
  
</nav>



 </div>
    </header>

    <div id="local-search-result-mobile" class="local-search-result-cls"></div>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/packet_fragmentation_and_reassembly/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">æ„å»ºæ¸¸æˆç½‘ç»œåè®®ä¸‰ä¹‹æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-26T03:13:35+00:00">
                02-26-2017
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GS/" itemprop="url" rel="index">
                    <span itemprop="name">GS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            <div class="post-tags">
              
                <a href="/tags/GafferOnGames/" rel="tag"><i class="fa fa-tag"></i> GafferOnGames</a>
              
            </div>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/serialization_strategies/" rel="next" title="æ„å»ºæ¸¸æˆç½‘ç»œåè®®äºŒä¹‹åºåˆ—åŒ–ç­–ç•¥">
                <i class="fa fa-chevron-left"></i> 
                <p class="post-nav-pre-next-title">
                  æ„å»ºæ¸¸æˆç½‘ç»œåè®®äºŒä¹‹åºåˆ—åŒ–ç­–ç•¥
                </p> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/sending_large_blocks_of_data/" rel="prev" title="æ„å»ºæ¸¸æˆç½‘ç»œåè®®å››ä¹‹å‘é€å¤§å—æ•°æ®">
              <p class="post-nav-pre-next-title">
                  æ„å»ºæ¸¸æˆç½‘ç»œåè®®å››ä¹‹å‘é€å¤§å—æ•°æ®
              </p> 
              <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      

      
      

      
        <h1 id="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"><a href="#æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“" class="headerlink" title="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"></a>æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“</h1><p>æœ¬ç¯‡ä¸»è¦è®²äº†æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„é—®é¢˜, åˆ°åº•æ•°æ®åŒ…å¤šå¤§æ‰å¥½å‘¢?æ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½å‘¢?åŒ…å¤ªå¤§äº†æ€ä¹ˆåŠå‘¢?<br>è¯·çœ‹æ€»ç»“, ä¸æ˜ä¹‹å¤„å†çœ‹æ–‡ä¸­å…·ä½“è®²è§£.</p>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿ</h2><p>æ¯å°è®¡ç®—æœº(è·¯ç”±å™¨)ä¼šæ²¿ç€è·¯ç”±å¼ºåˆ¶è¦æ±‚æ•°æ®åŒ…çš„å¤§å°ä¼šæœ‰ä¸€ä¸ªæœ€å¤§çš„ä¸Šé™ï¼Œè¿™ä¸ªä¸Šé™å°±æ˜¯æ‰€è°“çš„æœ€å¤§ä¼ è¾“å•å…ƒMTUã€‚å¦‚æœä»»æ„ä¸€ä¸ªè·¯ç”±å™¨æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…çš„å¤§å°è¶…è¿‡è¿™ä¸ªæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œå®ƒæœ‰è¿™ä¹ˆä¸¤ä¸ªé€‰æ‹©ï¼Œa)åœ¨IPå±‚å¯¹è¿™ä¸ªæ•°æ®åŒ…è¿›è¡Œåˆ†åŒ…ï¼Œå¹¶å°†åˆ†åŒ…åçš„æ•°æ®åŒ…ç»§ç»­ä¼ é€’ï¼Œb)ä¸¢å¼ƒè¿™ä¸ªæ•°æ®åŒ…ç„¶åå‘Šè¯‰ä½ æ•°æ®åŒ…è¢«ä¸¢å¼ƒäº†ï¼Œä½ è‡ªå·±è´Ÿè´£æ‘†å¹³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><strong>å®ä¾‹</strong> : è¿™å„¿æœ‰ä¸€ä¸ªæˆ‘ä¼šç»å¸¸é‡åˆ°çš„æƒ…å†µã€‚äººä»¬åœ¨ç¼–å†™å¤šäººåœ¨çº¿æ¸¸æˆçš„æ—¶å€™ï¼Œæ•°æ®åŒ…çš„å¹³å‡å¤§å°éƒ½ä¼šéå¸¸çš„å°ï¼Œè®©æˆ‘ä»¬å‡è®¾ä¸‹ï¼Œè¿™äº›æ•°æ®åŒ…çš„å¹³å‡å¤§å°å¤§æ¦‚åªæœ‰å‡ ç™¾å­—èŠ‚ï¼Œä½†æ—¶ä¸æ—¶ä¼šåœ¨ä»–ä»¬çš„æ¸¸æˆä¸­åŒæ—¶å‘ç”Ÿå¤§é‡çš„äº‹æƒ…å¹¶ä¸”å‘å‡ºå»çš„æ•°æ®åŒ…ä¼šå‡ºç°ä¸¢å¤±çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™æ•°æ®åŒ…ä¼šæ¯”é€šå¸¸çš„æƒ…å†µä¸‹è¦å¤§ã€‚çªç„¶ä¹‹é—´ï¼Œæ¸¸æˆçš„æ•°æ®åŒ…çš„å¤§å°å°±ä¼šè¶…è¿‡æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œè¿™æ ·å°±åªæœ‰å¾ˆå°‘ä¸€éƒ¨åˆ†ç©å®¶èƒ½å¤Ÿæ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…ï¼Œç„¶åæ•´ä¸ªé€šä¿¡å°±å´©æºƒäº†ã€‚</p>
<h2 id="æœ¬ç¯‡åŸºæœ¬æœ¯è¯­"><a href="#æœ¬ç¯‡åŸºæœ¬æœ¯è¯­" class="headerlink" title="æœ¬ç¯‡åŸºæœ¬æœ¯è¯­"></a>æœ¬ç¯‡åŸºæœ¬æœ¯è¯­</h2><ul>
<li>æ•°æ®åŒ…packets</li>
<li>åˆ†åŒ…fragments</li>
</ul>
<h2 id="åˆ†åŒ…çš„æ•°æ®ç»“æ„"><a href="#åˆ†åŒ…çš„æ•°æ®ç»“æ„" class="headerlink" title="åˆ†åŒ…çš„æ•°æ®ç»“æ„"></a>åˆ†åŒ…çš„æ•°æ®ç»“æ„</h2><p>æˆ‘ä»¬å°†å…è®¸ä¸€ä¸ªæ•°æ®åŒ…æœ€å¤šå¯ä»¥åˆ†æˆ256ä¸ªæ•°æ®åŒ…ï¼Œå¹¶ä¸”æ¯ä¸ªåˆ†åŒ…åçš„æ•°æ®åŒ…çš„å¤§å°ä¸ä¼šè¶…è¿‡1024ä¸ªå­—èŠ‚ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™æ ·ä¸€ä¸ªç³»ç»Ÿæ¥å‘é€å¤§å°æœ€å¤§ä¸º256kçš„æ•°æ®åŒ…</p>
<pre><del>[protocol id] (32 bits)</del>   // not actually sent, but used to calc crc32
[crc32] (32 bits)  
[sequence] (16 bits)  // æ•°æ®åŒ…åºå·
[packet type = 0] (2 bits)
<strong>[fragment id] (8 bits) // åˆ†åŒ…ID
[num fragments] (8 bits)
[pad zero bits to nearest byte index] // ç”¨äºå­—èŠ‚å¯¹é½çš„bits
&lt;fragment data&gt;</strong>
</pre>

<h2 id="å‘é€åˆ†åŒ…åçš„æ•°æ®åŒ…"><a href="#å‘é€åˆ†åŒ…åçš„æ•°æ®åŒ…" class="headerlink" title="å‘é€åˆ†åŒ…åçš„æ•°æ®åŒ…"></a>å‘é€åˆ†åŒ…åçš„æ•°æ®åŒ…</h2><p>å‘é€åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…æ˜¯ä¸€ä»¶éå¸¸å®¹æ˜“çš„äº‹æƒ…ã€‚å¦‚æœæ•°æ®åŒ…çš„å¤§å°å°äºä¿å®ˆä¼°è®¡çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ã€‚é‚£ä¹ˆå°±æŒ‰æ­£å¸¸çš„æ–¹æ³•è¿›è¡Œå‘é€ã€‚å¦åˆ™çš„è¯ï¼Œå°±è®¡ç®—è¿™ä¸ªæ•°æ®åŒ…åˆ°åº•è¯¥åˆ†æˆå¤šå°‘ä¸ª1024å­—èŠ‚çš„æ•°æ®åŒ…åˆ†åŒ…ï¼Œç„¶åæ„å»ºè¿™äº›åˆ†åŒ…å¹¶æŒ‰ç…§ä¹‹å‰å‘é€æ­£å¸¸æ•°æ®åŒ…çš„æ–¹æ³•è¿›è¡Œå‘é€ã€‚</p>
<p>å‘é€å‡ºå»ä»¥åä¹Ÿä¸è®°å½•å‘é€çš„æ•°æ®åŒ…çš„å†…å®¹ï¼Œè¿™ç§å‘é€ä»¥åä¸è®°å½•å‘é€çš„æ•°æ®åŒ…çš„å†…å®¹çš„æ–¹æ³•æœ‰ä¸€ä¸ªåæœï¼Œå°±æ˜¯æ•°æ®åŒ…çš„ä»»æ„ä¸€ä¸ªåˆ†åŒ…å¦‚æœä¸¢å¤±çš„è¯ï¼Œé‚£ä¹ˆæ•´ä¸ªæ•°æ®åŒ…å°±éƒ½è¦ä¸¢å¼ƒã€‚éšç€åˆ†åŒ…æ•°é‡çš„å¢åŠ ï¼Œæ•´ä¸ªæ•°æ®åŒ…è¢«ä¸¢å¼ƒçš„æ¦‚ç‡ä¹Ÿéšä¹‹å¢åŠ .ç”±æ­¤å¯è§ï¼Œå½“ä½ éœ€è¦å‘é€è¦ç»™256Kçš„æ•°æ®åŒ…çš„æ—¶å€™è¦å‘é€256ä¸ªåˆ†åŒ…ï¼Œå¦‚æœæœ‰ä¸€ä¸ªåˆ†åŒ…ä¸¢å¤±çš„è¯ï¼Œä½ å°±è¦é‡æ–°æŠŠè¿™ä¸ª256kçš„æ•°æ®åŒ…å†åˆ†ä¸€æ¬¡åŒ…ç„¶åå†å‘é€å‡ºå»ã€‚</p>
<h2 id="ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿå‘¢"><a href="#ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿå‘¢" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿå‘¢"></a>ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿå‘¢</h2><p>å› ä¸ºå‘é€å‡ºå»ä»¥åä¹Ÿä¸è®°å½•å‘é€çš„æ•°æ®åŒ…, éšç€åˆ†åŒ…æ•°é‡çš„å¢åŠ ï¼Œæ•´ä¸ªæ•°æ®åŒ…è¢«ä¸¢å¼ƒçš„æ¦‚ç‡ä¹Ÿéšä¹‹å¢åŠ , è€Œä¸€ä¸ªç‰‡æ®µçš„ä¸¢å¤±å°±ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®åŒ…éƒ½è¦è¢«ä¸¢å¼ƒæ‰.æ‰€ä»¥æˆ‘å»ºè®®ä½ è¦å°å¿ƒåˆ†åŒ…ä»¥åçš„æ•°é‡ã€‚</p>
<p><strong>è¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿæœ€å¥½æ˜¯åªå¯¹2-4ä¸ªåˆ†åŒ…çš„æƒ…å†µè¿›è¡Œä½¿ç”¨ï¼Œè€Œä¸”æœ€å¥½æ˜¯é’ˆå¯¹é‚£ç§å¯¹æ—¶é—´ä¸æ€ä¹ˆæ•æ„Ÿçš„æ•°æ®ä½¿ç”¨æˆ–è€…æ˜¯å°±ç®—åˆ†åŒ…lostäº†ä¹Ÿæ— æ‰€è°“çš„æƒ…å†µã€‚</strong>ç»å¯¹ä¸è¦åªæ˜¯ä¸ºäº†çœäº‹å°±æŠŠä¸€å¤§å †ä¾èµ–é¡ºåºçš„äº‹ä»¶æ‰“åˆ°ä¸€ä¸ªå¤§æ•°æ®åŒ…é‡Œé¢ç„¶åä¾èµ–æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„æœºåˆ¶è¿›è¡Œå‘é€ã€‚è¿™ä¼šè®©äº‹æƒ…å˜å¾—æ›´åŠ éº»çƒ¦ã€‚</p>
<p>æ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿçš„å…³é”®å¼±ç‚¹æ˜¯ä¸€ä¸ªç‰‡æ®µçš„ä¸¢å¤±å°±ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®åŒ…éƒ½è¦è¢«ä¸¢å¼ƒæ‰, æƒ³è¦è§£å†³è¿™ä¸ªå¼±ç‚¹å¾—ä½¿ç”¨å¤§å—æ•°æ®å‘é€ç­–ç•¥, è§ä¸‹ä¸€ç¯‡æ–‡ç«  <a href="/sending_large_blocks_of_data/" title="æ„å»ºæ¸¸æˆç½‘ç»œåè®®å››ä¹‹å‘é€å¤§å—æ•°æ®">æ„å»ºæ¸¸æˆç½‘ç»œåè®®å››ä¹‹å‘é€å¤§å—æ•°æ®</a>.</p>
<h2 id="æ¥æ”¶åˆ†åŒ…åçš„æ•°æ®åŒ…"><a href="#æ¥æ”¶åˆ†åŒ…åçš„æ•°æ®åŒ…" class="headerlink" title="æ¥æ”¶åˆ†åŒ…åçš„æ•°æ®åŒ…"></a>æ¥æ”¶åˆ†åŒ…åçš„æ•°æ®åŒ…</h2><p>ä¹‹æ‰€ä»¥å¯¹åˆ†åŒ…åçš„æ•°æ®åŒ…è¿›è¡Œæ¥æ”¶å¾ˆå›°éš¾çš„åŸå› æ˜¯æˆ‘ä»¬ä¸ä»…éœ€è¦ç»™ç¼“å†²åŒºå»ºç«‹ä¸€ä¸ªæ•°æ®ç»“æ„è¿˜è¦æŠŠè¿™äº›åˆ†åŒ…é‡ç»„æˆåŸå§‹çš„æ•°æ®åŒ…ï¼Œæˆ‘ä»¬ä¹Ÿè¦ç‰¹åˆ«å°å¿ƒå¦‚æœæœ‰äººè¯•å›¾è®©æˆ‘ä»¬çš„ç¨‹åºäº§ç”Ÿå´©æºƒè€Œç»™æˆ‘ä»¬å‘é€æ¶æ„çš„æ•°æ®åŒ…ã€‚</p>
<p>è¦éå¸¸å°å¿ƒæ£€æŸ¥ä¸€åˆ‡å¯èƒ½çš„æƒ…å†µã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„äº‹æƒ…è¦æ³¨æ„ï¼šè®©åˆ†åŒ…ä¿å­˜åœ¨ä¸€ä¸ªæ•°æ®ç»“æ„é‡Œé¢ï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…çš„æ‰€æœ‰åˆ†åŒ…éƒ½åˆ°è¾¾ä»¥åï¼ˆé€šè¿‡è®¡æ•°æ¥åˆ¤æ–­æ˜¯å¦å…¨éƒ¨åˆ°è¾¾ï¼‰ï¼Œå°†è¿™äº›åˆ†åŒ…é‡ç»„æˆä¸€ä¸ªå¤§çš„æ•°æ®åŒ…ï¼Œå¹¶æŠŠè¿™ä¸ªé‡ç»„åçš„å¤§æ•°æ®åŒ…è¿”å›ç»™æ¥æ”¶æ–¹ã€‚</p>
<p>ä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„åœ¨è¿™é‡Œæ˜¯æœ‰æ„ä¹‰çš„?è¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„æ•°æ®ç»“æ„!æˆ‘ä½¿ç”¨çš„æ˜¯ä¸€ç§æˆ‘å–œæ¬¢ç§°ä¹‹ä¸ºåºåˆ—ç¼“å†²åŒºçš„ä¸œè¥¿ã€‚æˆ‘æƒ³å’Œä½ åˆ†äº«çš„æœ€æ ¸å¿ƒçš„æŠ€å·§æ˜¯å¦‚ä½•è®©è¿™ä¸ªæ•°æ®ç»“æ„å˜å¾—é«˜æ•ˆï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const int MaxEntries = 256;</span><br><span class="line"> </span><br><span class="line">struct SequenceBuffer</span><br><span class="line">&#123;</span><br><span class="line">    bool exists[MaxEntries];</span><br><span class="line">    uint16_t sequence[MaxEntries];</span><br><span class="line">    Entry entries[MaxEntries];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h1 id="åŸæ–‡"><a href="#åŸæ–‡" class="headerlink" title="åŸæ–‡"></a>åŸæ–‡</h1><p><a href="https://gafferongames.com/post/packet_fragmentation_and_reassembly/" target="_blank" rel="noopener">åŸæ–‡å‡ºå¤„</a></p>
<p>åŸæ–‡æ ‡é¢˜ : <strong>Packet Fragmentation and Reassembly</strong> (<em>How to send and receive packets larger than MTU</em>)</p>
<hr>
<p></p><h2 id="introduction">Introduction</h2><p></p>
<p>Hi, Iâ€™m <a href="https://gafferongames.com/about" target="_blank" rel="noopener">Glenn Fiedler</a> and welcome to <strong><a href="https://gafferongames.com/categories/building-a-game-network-protocol/" target="_blank" rel="noopener">Building a Game Network Protocol</a></strong>.</p><br><p>In the <a href="https://gafferongames.com/post/serialization_strategies/" target="_blank" rel="noopener">previous article</a> we discussed how to unify packet read and write into a single serialize function and added a bunch of safety features to packet read.</p><br><p>Now we are ready to start putting interesting things in our packets and sending them over the network, but immediately we run into an interesting question: <em>how big should our packets be?</em></p><br><p>To answer this question properly we need a bit of background about how packets are actually sent over the Internet.</p><br><h2 id="background">Background</h2><br><p>Perhaps the most important thing to understand about the internet is that there&rsquo;s no direct connection between the source and destination IP address. What actually happens is that packets hop from one computer to another to reach their destination.</p><br><p>Each computer along this route enforces a maximum packet size called the maximum transmission unit, or MTU. According to the IP standard, if any computer recieves a packet larger than its MTU, it has the option of a) fragmenting that packet, or b) dropping the packet.</p><br><p>So here&rsquo;s how this usually goes down. People write a multiplayer game where the average packet size is quite small, lets say a few hundred bytes, but every now and then when a lot of stuff is happening in their game and a burst of packet loss occurs, packets get a lot larger than usual, going above MTU for the route, and suddenly all packets start getting dropped!</p><br><p>Just last year (2015) I was talking with Alex Austin at Indiecade about networking in his game <a href="http://subrosagame.com" target="_blank" rel="noopener">Sub Rosa</a>. He had this strange networking bug he couldn&rsquo;t reproduce. For some reason, players would randomly get disconnected from the game, but only when a bunch of stuff was going on. It was extremely rare and he was unable to reproduce it. Alex told me looking at the logs it seemed like <em>packets just stopped getting through</em>.</p><br><p>This sounded <em>exactly</em> like an MTU issue to me, and sure enough, when Alex limited his maximum packet size to a reasonable value the bug went away.</p><br><h2 id="mtu-in-the-real-world">MTU in the real world</h2><br><p>So what&rsquo;s a reasonable maximum packet size?</p><br><p>On the Internet today (2016, IPv4) the real-world MTU is 1500 bytes.</p><br><p>Give or take a few bytes for UDP/IP packet header and you&rsquo;ll find that the typical number before packets start to get dropped or fragmented is somewhere around 1472.</p><br><p>You can try this out for yourself by running this command on MacOS X:</p><br><pre>ping -g 56 -G 1500 -h 10 -D 8.8.4.4</pre><br><p>On my machine it conks out around just below 1500 bytes as expected:</p><br><pre>1404 bytes from 8.8.4.4: icmp_seq=134 ttl=56 time=11.945 ms<br>1414 bytes from 8.8.4.4: icmp_seq=135 ttl=56 time=11.964 ms<br>1424 bytes from 8.8.4.4: icmp_seq=136 ttl=56 time=13.492 ms<br>1434 bytes from 8.8.4.4: icmp_seq=137 ttl=56 time=13.652 ms<br>1444 bytes from 8.8.4.4: icmp_seq=138 ttl=56 time=133.241 ms<br>1454 bytes from 8.8.4.4: icmp_seq=139 ttl=56 time=17.463 ms<br>1464 bytes from 8.8.4.4: icmp_seq=140 ttl=56 time=12.307 ms<br>1474 bytes from 8.8.4.4: icmp_seq=141 ttl=56 time=11.987 ms<br>ping: sendto: Message too long<br>ping: sendto: Message too long<br>Request timeout for icmp_seq 142</pre><br><p>Why 1500? That&rsquo;s the default MTU for MacOS X. It&rsquo;s also the default MTU on Windows. So now we have an upper bound for your packet size assuming you actually care about packets getting through to Windows and Mac boxes without IP level fragmentation or a chance of being dropped: <strong>1472 bytes</strong>.</p><br><p>So what&rsquo;s the lower bound? Unfortunately for the routers in between your computer and the destination the IPv4 standard says <strong>576</strong>. Does this mean we have to limit our packets to 400 bytes or less? In practice, not really.</p><br><p>MacOS X lets me set MTU values in range 1280 to 1500 so considering packet header overhead, my first guess for a conservative lower bound on the IPv4 Internet today would be <strong>1200 bytes</strong>. Moving forward, in IPv6 this is also a good value, as any packet of 1280 bytes or less is guaranteed to get passed on without IP level fragmentation.</p><br><p>This lines up with numbers that I&rsquo;ve seen throughout my career. In my experience games rarely try anything complicated like attempting to discover path MTU, they just assume a reasonably conservative MTU and roll with that, something like 1000 to 1200 bytes of payload data. If a packet larger than this needs to be sent, it&rsquo;s split up into fragments by the game protocol and re-assembled on the other side.</p><br><p>And that&rsquo;s <em>exactly</em> what I&rsquo;m going to show you how to do in this article.</p><br><h2 id="fragment-packet-structure">Fragment Packet Structure</h2><br><p>Let&rsquo;s get started with implementation.</p><br><p>The first thing we need to decide is how we&rsquo;re going to represent fragment packets over the network so they are distinct from non-fragmented packets.</p><br><p>Ideally, we would like fragmented and non-fragmented packets to be compatible with the existing packet structure we&rsquo;ve already built, with as little overhead as possible in the common case when we are sending packets smaller than MTU.</p><br><p>Here&rsquo;s the packet structure from the previous article:</p><br><pre><del>[protocol id] (64 bits)</del> // not actually sent, but used to calc crc32<br>[crc32] (32 bits)<br>[packet type] (2 bits for 3 distinct packet types)<br>(variable length packet data according to packet type)<br>[end of packet serialize check] (32 bits)<br></pre><br><p>In our protocol we have three packet types: A, B and C.</p><br><p>Let&rsquo;s make one of these packet types generate really large packets:</p><br><pre>static const int MaxItems = 4096 * 4;<br><br>struct TestPacketB : public Packet<br>{<br>    int numItems;<br>    int items[MaxItems];<br><br>    TestPacketB() : Packet( TEST_PACKET_B )<br>    {<br>        numItems = random_int( 0, MaxItems );<br>        for ( int i = 0; i &lt; numItems; ++i )<br>            items[i] = random_int( -100, +100 );<br>    }<br><br>    template &lt;typename Stream&gt; bool Serialize( Stream &amp; stream )<br>    {<br>        serialize_int( stream, numItems, 0, MaxItems );<br>        for ( int i = 0; i &lt; numItems; ++i )<br>        {<br>            serialize_int( stream, items[i], -100, +100 );<br>        }<br>        return true;<br>    }<br>};<br></pre><br><p>This may seem somewhat contrived but these situations really do occur. For example, if you have a strategy where you send all un-acked events from server to client and you hit a burst of packet loss, you can easily end up with packets larger than MTU, even though your average packet size is quite small.</p><br><p>Another common case is delta encoded snapshots in a first person shooter. Here packet size is proportional to the amount of state changed between the baseline and current snapshots for each client. If there are a lot of differences between the snapshots the delta packet is large and there&rsquo;s nothing you can do about it except break it up into fragments and re-assemble them on the other side.</p><br><p>Getting back to packet structure. It&rsquo;s fairly common to add a sequence number at the header of each packet. This is just a packet number that increases with each packet sent. I like to use 16 bits for sequence numbers even though they wrap around in about 15 minutes @ 60 packets-per-second, because it&rsquo;s extremely unlikely that a packet will be delivered 15 minutes late.</p><br><p>Sequence numbers are useful for a bunch of things like acks, reliability and detecting and discarding out of order packets. In our case, we&rsquo;re going to use the sequence number to identify which packet a fragment belongs to:</p><br><pre><del>[protocol id] (64 bits)</del>   // not actually sent, but used to calc crc32<br>[crc32] (32 bits)<br><strong>[sequence] (16 bits)</strong><br>[packet type] (2 bits)<br>(variable length packet data according to packet type)<br>[end of packet serialize check] (32 bits)<br></pre><br><p>Here&rsquo;s the interesting part. Sure we could just add a bit <strong>is_fragment</strong> to the header, but then in the common case of non-fragmented packets you&rsquo;re wasting one bit that is always set to zero.</p><br><p>What I do instead is add a special fragment packet type:</p><br><pre>enum TestPacketTypes<br>{<br>    PACKET_FRAGMENT = 0,     // RESERVED<br>    TEST_PACKET_A,<br>    TEST_PACKET_B,<br>    TEST_PACKET_C,<br>    TEST_PACKET_NUM_TYPES<br>};<br></pre><br><p>And it just happens to be <em>free</em> because four packet types fit into 2 bits. Now when a packet is read, if the packet type is zero we know it&rsquo;s a fragment packet, otherwise we run through the ordinary, non-fragmented read packet codepath.</p><br><p>Lets design what this fragment packet looks like. We&rsquo;ll allow a maximum of 256 fragments per-packet and have a fragment size of 1024 bytes. This gives a maximum packet size of 256k that we can send through this system, which should be enough for anybody, but please don&rsquo;t quote me on this.</p><br><p>With a small fixed size header, UDP header and IP header a fragment packet be well under the conservative MTU value of 1200. Plus, with 256 max fragments per-packet we can represent a fragment id in the range [0,255] and the total number of fragments per-packet [1,256] with 8 bits.</p><br><pre><del>[protocol id] (32 bits)</del>   // not actually sent, but used to calc crc32<br>[crc32] (32 bits)<br>[sequence] (16 bits)<br>[packet type = 0] (2 bits)<br><strong>[fragment id] (8 bits)<br>[num fragments] (8 bits)<br>[pad zero bits to nearest byte index]<br>&lt;fragment data&gt;</strong><br></pre><br><p>Notice that we pad bits up to the next byte before writing out the fragment data. Why do this? Two reasons: 1) it&rsquo;s faster to copy fragment data into the packet via memcpy than bitpacking each byte, and 2) we can now save a small amount of bandwidth by inferring the fragment size by subtracting the start of the fragment data from the total size of the packet.</p><br><h2 id="sending-packet-fragments">Sending Packet Fragments</h2><br><p>Sending packet fragments is <em>easy</em>. For any packet larger than conservative MTU, simply calculate how many 1024 byte fragments it needs to be split into, and send those fragment packets over the network. Fire and forget!</p><br><p>One consequence of this is that if <em>any</em> fragment of that packet is lost then the entire packet is lost. It follows that if you have packet loss then sending a 256k packet as 256 fragments is not a very good idea, because the probability of dropping a packet increases significantly as the number of fragments increases. Not quite linearly, but in an interesting way that you can read more about <a href="https://www.fourmilab.ch/rpkp/experiments/statistics.html" target="_blank" rel="noopener">here</a>.</p><br><p>In short, to calculate the probability of losing a packet, you must calculate the probability of all fragments being delivered successfully and subtract that from one, giving you the probability that at least one fragment was dropped.</p><br><pre>1 - probability_of_fragment_being_delivered ^ num_fragments<br></pre><br><p>For example, if we send a non-fragmented packet over the network with 1% packet loss, there is naturally a <sup>1</sup>&frasl;<sub>100</sub> chance the packet will be dropped.</p><br><p>As the number of fragments increase, packet loss is amplified:<br><ul><br><li>Two fragments: 1 - (<sup>99</sup>&frasl;<sub>100</sub>) ^ 2 = <strong>2%</strong></li><br><li>Ten fragments: 1 - (<sup>99</sup>&frasl;<sub>100</sub>) ^ 10 = <strong>9.5%</strong></li><br><li>100 fragments: 1 - (<sup>99</sup>&frasl;<sub>100</sub>) ^ 100 = <strong>63.4%</strong></li><br><li>256 fragments: 1 - (<sup>99</sup>&frasl;<sub>100</sub>) ^ 256 = <strong>92.4%</strong></li><br></ul></p><br><p>So I recommend you take it easy with the number of fragments. It&rsquo;s best to use this strategy only for packets in the 2-4 fragment range, and only for time critical data that doesn&rsquo;t matter too much if it gets dropped. It&rsquo;s <em>definitely not</em> a good idea to fire down a bunch of reliable-ordered events in a huge packet and rely on packet fragmentation and reassembly to save your ass.</p><br><p>Another typical use case for large packets is when a client initially joins a game. Here you usually want to send a large block of data down reliably to that client, for example, representing the initial state of the world for late join. Whatever you do, don&rsquo;t send that block of data down using the fragmentation and re-assembly technique in this article.</p><br><p>Instead, check out the technique in <a href="https://gafferongames.com/post/sending-large-blocks-of-data.html" target="_blank" rel="noopener">next article</a> which handles packet loss by resending fragments until they are all received.</p><br><h2 id="receiving-packet-fragments">Receiving Packet Fragments</h2><br><p>It&rsquo;s time to implement the code that receives and processed packet fragments. This is a bit tricky because we have to be particularly careful of somebody trying to attack us with malicious packets.</p><br><p>Here&rsquo;s a list of all the ways I can think of to attack the protocol:</p><br><ul><br><li><p>Try to send out of bound fragments ids trying to get you to crash memory. eg: send fragments [0,255] in a packet that has just two fragments.</p></li><br><li><p>Send packet n with some maximum fragment count of say 2, and then send more fragment packets belonging to the same packet n but with maximum fragments of 256 hoping that you didn&rsquo;t realize I widened the maximum number of fragments in the packet after the first one you received, and you trash memory.</p></li><br><li><p>Send really large fragment packets with fragment data larger than 1k hoping to get you to trash memory as you try to copy that fragment data into the data structure, or blow memory budget trying to allocate fragments</p></li><br><li><p>Continually send fragments of maximum size (<sup>256</sup>&frasl;<sub>256</sub> fragments) in hope that it I could make you allocate a bunch of memory and crash you out. Lets say you have a sliding window of 256 packets, 256 fragments per-packet max, and each fragment is 1k. That&rsquo;s 64 mb per-client.</p></li><br><li><p>Can I fragment the heap with a bunch of funny sized fragment packets sent over and over? Perhaps the server shares a common allocator across clients and I can make allocations fail for other clients in the game because the heap becomes fragmented.</p></li><br></ul><br><p>Aside from these concerns, implementation is reasonably straightforward: store received fragments somewhere and when all fragments arrive for a packet, reassemble them into the original packet and return that to the user.</p><br><h2 id="data-structure-on-receiver-side">Data Structure on Receiver Side</h2><br><p>The first thing we need is some way to store fragments before they are reassembled. My favorite data structure is something I call a <em>sequence buffer</em>:</p><br><pre>const int MaxEntries = 256;<br><br>struct SequenceBuffer<br>{<br>    uint32_t sequence[MaxEntries];<br>    Entry entries[MaxEntries];<br>};<br></pre><br><p>Indexing into the arrays is performed with modulo arithmetic, giving us a fast O(1) lookup of entries by sequence number:</p><br><pre>const int index = sequence % MaxEntries;<br></pre><br><p>A sentinel value of 0xFFFFFFFF is used to represent empty entries. This value cannot possibly occur with 16 bit sequence numbers, thus providing us with a fast test to see if an entry exists for a given sequence number, without an additional branch to test if that entry exists.</p><br><p>This data structure is used as follows. When the first fragment of a new packet comes in, the sequence number is mapped to an entry in the sequence buffer. If an entry doesn&rsquo;t exist, it&rsquo;s added and the fragment data is stored in there, along with information about the fragment, eg. how many fragments there are, how many fragments have been received so far, and so on.</p><br><p>Each time a new fragment arrives, it looks up the entry by the packet sequence number. When an entry already exists, the fragment data is stored and number of fragments received is incremented. Eventually, once the number of fragments received matches the number of fragments in the packet, the packet is reassembled and delivered to the user.</p><br><p>Since it&rsquo;s possible for old entries to stick around (potentially with allocated blocks), great care must be taken to clean up any stale entries when inserting new entries in the sequence buffer. These stale entries correspond to packets that didn&rsquo;t receive all fragments.</p><br><p>And that&rsquo;s basically it at a high level. For further details on this approach please refer to the example source code for this article. </p><br><p><a href="https://www.patreon.com/gafferongames" target="_blank" rel="noopener">Click here to get the example source code for this article series</a>.</p><br><h2 id="test-driven-development">Test Driven Development</h2><br><p>One thing I&rsquo;d like to close this article out on.</p><br><p>Writing a custom UDP network protocol is <em>hard</em>. It&rsquo;s so hard that even though I&rsquo;ve done this from scratch at least 10 times, each time I still manage to fuck it up in a new and exciting ways. You&rsquo;d think eventually I&rsquo;d learn, but this stuff is complicated. You can&rsquo;t just write low-level netcode and expect it to just work.</p><br><p>You have to test it!</p><br><p>My strategy when testing low-level netcode is as follows:</p><br><ul><br><li><p>Code defensively. Assert everywhere. These asserts will fire and they&rsquo;ll be important clues you need when something goes wrong.</p></li><br><li><p>Add functional tests and make sure stuff is working as you are writing it. Put your code through its paces at a basic level as you write it and make sure it&rsquo;s working as you build it up. Think hard about the essential cases that need to be property handled and add tests that cover them.</p></li><br><li><p>But just adding a bunch of functional tests is not enough. There are of course cases you didn&rsquo;t think of! Now you have to get really mean. I call this soak testing and I&rsquo;ve never, not even once, have coded a network protocol that hasn&rsquo;t subsequently had problems found in it by soak testing.</p></li><br><li><p>When soak testing just loop forever and just do a mix of random stuff that puts your system through its paces, eg. random length packets in this case with a huge amount of packet loss, out of order and duplicates through a packet simulator. Your soak test passes when it runs overnight and doesn&rsquo;t hang or assert.</p></li><br><li><p>If you find anything wrong with soak testing. You may need to go back and add detailed logs to the soak test to work out how you got to the failure case. Once you know what&rsquo;s going on, stop. Don&rsquo;t fix it immediately and just run the soak test again.</p></li><br><li><p>Instead, add a unit test that reproduces that problem you are trying to fix, verify your test reproduces the problem, and that it problem goes away with your fix. Only after this, go back to the soak test and make sure they run overnight. This way the unit tests document the correct behavior of your system and can quickly be run in future to make sure you don&rsquo;t break this thing moving forward when you make other changes.</p></li><br><li><p>Add a bunch of logs. High level errors, info asserts showing an overview of what is going on, but also low-level warnings and debug logs that show what went wrong after the fact. You&rsquo;re going to need these logs to diagnose issues that don&rsquo;t occur on your machine. Make sure the log level can be adjusted dynamically.</p></li><br><li><p>Implement network simulators and make sure code handles the worst possible network conditions imaginable. 99% packet loss, 10 seconds of latency and +/- several seconds of jitter. Again, you&rsquo;ll be surprised how much this uncovers. Testing is the time where you want to uncover and fix issues with bad network conditions, not the night before your open beta.</p></li><br><li><p>Implement fuzz tests where appropriate to make sure your protocol doesn&rsquo;t crash when processing random packets. Leave fuzz tests running overnight to feel confident that your code is reasonably secure against malicious packets and doesn&rsquo;t crash.</p></li><br><li><p>Surprisingly, I&rsquo;ve consistently found issues that only show up when I loop the set of unit tests over and over, perhaps these issues are caused by different random numbers in tests, especially with the network simulator being driven by random numbers. This is a great way to take a rare test that fails once every few days and make it fail every time. So before you congratulate yourself on your tests passing 100%, add a mode where your unit tests can be looped easily, to uncover such errors.</p></li><br><li><p>Test simultaneously on multiple platforms. I&rsquo;ve never written a low-level library that worked first time on MacOS, Windows and Linux. There are always interesting compiler specific issues and crashes. Test on multiple platforms as you develop, otherwise it&rsquo;s pretty painful fixing all these at the end.</p></li><br><li><p>This about how people can attack the protocol. Implement code to defend against these attacks. Add functional tests that mimic these attacks and make sure that your code handles them correctly.</p></li><br></ul><br><p>This is my process and it seems to work pretty well. If you are writing a low-level network protocol, the rest of your game depends on this code working correctly. You need to be absolutely sure it works before you build on it, otherwise it&rsquo;s basically a stack of cards.</p><br><p>In my experience, game neworking is hard enough without having suspicions that that your low-level network protocol has bugs that only show up under extreme network conditions. That&rsquo;s exactly where you need to be able to trust your code works correctly. <strong>So test it!</strong></p>



<h1 id="è¯‘æ–‡">è¯‘æ–‡</h1>


<p><a href="http://gad.qq.com/program/translateview/7164496" target="_blank" rel="noopener">è¯‘æ–‡å‡ºå¤„</a></p>
<div class="WordSection1"><b><span style="font-family:å¾®è½¯é›…é»‘;"><span style="color: rgb(34, 34, 34); font-size: 12pt;">è¯‘è€…ï¼šå´”å˜‰è‰º</span><span style="color: rgb(34, 34, 34); font-size: 12pt;">(milan21) </span><span style="color: rgb(34, 34, 34); font-size: 12pt;">å®¡æ ¡ï¼šå´”å›½å†›ï¼ˆæ˜Ÿé™…è¿·èˆªï¼‰</span></span></b><div><span style="color: rgb(34, 34, 34); font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></div><p class="MsoNormal" align="left"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ ¼ä¼¦Â·è²å¾·å‹’ã€‚æ¬¢è¿å¤§å®¶é˜…è¯»ç³»åˆ—æ•™ç¨‹ã€Šæ„å»ºæ¸¸æˆç½‘ç»œåè®®ã€‹çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ã€‚</span><span style="color: rgb(34, 34, 34); font-size: 12pt;">åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•å°†æ•°æ®åŒ…çš„è¯»å–å’Œå†™å…¥ç”¨ä¸€ä¸ªå•ç‹¬çš„åºåˆ—åŒ–å‡½æ•°æ¥å®ç°ã€‚</span></span></p><p class="MsoNormal" align="left"><span style="color: rgb(34, 34, 34); font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">ç°åœ¨æˆ‘ä»¬è¦å¼€å§‹æŠŠä¸€äº›æœ‰è¶£çš„äº‹æƒ…æ”¾åˆ°è¿™äº›æ•°æ®åŒ…ä¸­ï¼Œ<span>,</span>ä½†æ­£å¦‚ä½ å³å°†å¼€å§‹ç¼–ç çš„ä»¤äººæƒŠå¹çš„å¤šäººåœ¨çº¿åŠ¨ä½œã€ç¬¬ä¸€äººç§°å°„å‡»ã€å¤§å‹å¤šäººåœ¨çº¿è§’è‰²æ‰®æ¼”æ¸¸æˆã€å¤šäººåœ¨çº¿æˆ˜æœ¯ç«æŠ€æ¸¸æˆä¼šå‘ç”Ÿçš„é‚£æ ·ï¼Œå½“ä½ ä»¥æ¯ç§’<span>120</span>æ¬¡çš„é¢‘ç‡å‘é€<span>8k</span>å¤§å°çš„æ•°æ®åŒ…ï¼Œæ¸¸æˆç½‘ç»œä¸­ä¼šä¼ æ¥ä¸€ä¸ªå£°éŸ³å‘¼å–Šç€ä½ <span>:</span></span><span style="font-size: 12pt; color: rgb(34, 34, 34);">â€œ</span><span style="font-size: 12pt; color: rgb(34, 34, 34);">ä¸è¦å‘é€è¶…è¿‡<span>1200</span>å­—èŠ‚å¤§å°çš„æ•°æ®åŒ…<span>!â€</span></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä½†æ˜¯éƒ½å·²ç»<span>2016</span>å¹´äº†ï¼Œä½ çœŸçš„è¦æ³¨æ„æœ€å¤§ä¼ è¾“å•å…ƒè¿™ä¸ªä¸œè¥¿ä¹ˆ<span>?</span></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸å¹¸çš„æ˜¯ï¼Œç­”æ¡ˆæ˜¯æ˜¯çš„ï¼</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><h2 id="æœ€å¤§ä¼ è¾“å•å…ƒMTU"><span style="font-family:å¾®è½¯é›…é»‘;">æœ€å¤§ä¼ è¾“å•å…ƒMTU</span></h2><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä½ å¯èƒ½å·²ç»å¬è¯´è¿‡æœ€å¤§ä¼ è¾“å•å…ƒäº†ã€‚åœ¨ç½‘ç»œç¨‹åºå‘˜ä¸­æµä¼ ç€å¤§é‡æœ‰å…³æœ€å¤§ä¼ è¾“å•å…ƒé—®é¢˜çš„æ•…äº‹ã€‚é‚£ä¹ˆè¿™åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿç©¶ç«Ÿä»€ä¹ˆæ˜¯æœ€å¤§ä¼ è¾“å•å…ƒ<span>?</span>ä¸ºä»€ä¹ˆä½ è¦åœ¨ä¹æœ€å¤§ä¼ è¾“å•å…ƒè¿™ä¸ªäº‹æƒ…ï¼Ÿ</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">å½“ä½ é€šè¿‡äº’è”ç½‘æ¥å‘é€æ•°æ®åŒ…çš„æ—¶å€™åˆ°åº•èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿè¿™äº›æ•°æ®åŒ…è¦ä»ä¸€å°è®¡ç®—æœº<span>(</span>è·¯ç”±å™¨<span>)</span>è·³åˆ°å¦ä¸€ä¸ªè®¡ç®—æœº<span>(</span>è·¯ç”±å™¨<span>)</span>ä¸Šï¼Œå¦‚æ­¤å¾€å¤å¤šæ¬¡æ‰èƒ½åˆ°è¾¾è‡ªå·±çš„ç›®çš„åœ°ã€‚è¿™æ˜¯ä¸€ä¸ªåˆ†ç»„äº¤æ¢ç½‘ç»œå…·ä½“å¦‚ä½•è¿ä½œçš„æ–¹å¼ã€‚åœ¨å¤§éƒ¨åˆ†æ—¶é—´é‡Œï¼Œå®ƒçš„å·¥ä½œæ–¹å¼ä¸åƒæ˜¯åœ¨æºå’Œç›®çš„åœ°ä¹‹é—´å­˜åœ¨ä¸€æ¡ç›´æ¥çš„è¿æ¥ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä½†æ„å¤–çš„æ˜¯ï¼šæ¯å°è®¡ç®—æœº<span>(</span>è·¯ç”±å™¨<span>)</span>ä¼šæ²¿ç€è·¯ç”±å¼ºåˆ¶è¦æ±‚æ•°æ®åŒ…çš„å¤§å°ä¼šæœ‰ä¸€ä¸ªæœ€å¤§çš„ä¸Šé™ï¼Œè¿™ä¸ªä¸Šé™å°±æ˜¯æ‰€è°“çš„æœ€å¤§ä¼ è¾“å•å…ƒã€‚å¦‚æœä»»æ„ä¸€ä¸ªè·¯ç”±å™¨æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…çš„å¤§å°è¶…è¿‡è¿™ä¸ªæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œå®ƒæœ‰è¿™ä¹ˆä¸¤ä¸ªé€‰æ‹©ï¼Œ<span>a)</span>åœ¨<span>IP</span>å±‚å¯¹è¿™ä¸ªæ•°æ®åŒ…è¿›è¡Œåˆ†åŒ…ï¼Œå¹¶å°†åˆ†åŒ…åçš„æ•°æ®åŒ…ç»§ç»­ä¼ é€’ï¼Œ<span>b)</span>ä¸¢å¼ƒè¿™ä¸ªæ•°æ®åŒ…ç„¶åå‘Šè¯‰ä½ æ•°æ®åŒ…è¢«ä¸¢å¼ƒäº†ï¼Œä½ è‡ªå·±è´Ÿè´£æ‘†å¹³è¿™ä¸ªé—®é¢˜ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™å„¿æœ‰ä¸€ä¸ªæˆ‘ä¼šç»å¸¸é‡åˆ°çš„æƒ…å†µã€‚äººä»¬åœ¨ç¼–å†™å¤šäººåœ¨çº¿æ¸¸æˆçš„æ—¶å€™ï¼Œæ•°æ®åŒ…çš„å¹³å‡å¤§å°éƒ½ä¼šéå¸¸çš„å°ï¼Œè®©æˆ‘ä»¬å‡è®¾ä¸‹ï¼Œè¿™äº›æ•°æ®åŒ…çš„å¹³å‡å¤§å°å¤§æ¦‚åªæœ‰å‡ ç™¾å­—èŠ‚ï¼Œä½†æ—¶ä¸æ—¶ä¼šåœ¨ä»–ä»¬çš„æ¸¸æˆä¸­åŒæ—¶å‘ç”Ÿå¤§é‡çš„äº‹æƒ…å¹¶ä¸”å‘å‡ºå»çš„æ•°æ®åŒ…ä¼šå‡ºç°ä¸¢å¤±çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™æ•°æ®åŒ…ä¼šæ¯”é€šå¸¸çš„æƒ…å†µä¸‹è¦å¤§ã€‚çªç„¶ä¹‹é—´ï¼Œæ¸¸æˆçš„æ•°æ®åŒ…çš„å¤§å°å°±ä¼šè¶…è¿‡æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œè¿™æ ·å°±åªæœ‰å¾ˆå°‘ä¸€éƒ¨åˆ†ç©å®¶èƒ½å¤Ÿæ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…ï¼Œç„¶åæ•´ä¸ªé€šä¿¡å°±å´©æºƒäº†ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span><br></span>å°±åœ¨å»å¹´<span>(2015</span>å¹´<span>)</span>ï¼Œæˆ‘ä¸äºšå†å…‹æ–¯<span>Â·</span>å¥¥æ–¯æ±€åœ¨<span>Indiecade</span>è°ˆè®ºä»–çš„æ¸¸æˆ<span>â€ </span></span><span><a rel="noopener" href="http://subrosagame.com/" target="_blank"><span style="font-size: 12pt; color: rgb(34, 34, 34); text-decoration: none;">Sub Rosa</span></a></span><span style="font-size: 12pt; color: rgb(34, 34, 34);"> â€œ</span><span style="font-size: 12pt; color: rgb(34, 34, 34);">ä¸­çš„ç½‘ç»œéƒ¨åˆ†ã€‚ä»–é‡åˆ°äº†ä¸€äº›å¥‡æ€ªçš„æ— æ³•é‡ç°çš„ç½‘ç»œ<span>bug</span>ã€‚å‡ºäºæŸç§åŸå› ï¼Œä¸€äº›å®¢æˆ·ç«¯ï¼ˆåœ¨æ‰€æœ‰ç©å®¶é‡Œé¢æ€»æ˜¯æœ‰é‚£ä¹ˆä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªï¼‰ä¼šéšæœºçš„ä»æ¸¸æˆä¸­æ–­å¼€è¿æ¥å¹¶ä¸”å…¶ä»–äººéƒ½èƒ½å¤Ÿæ­£å¸¸æ¸¸æˆã€‚æŸ¥çœ‹æ—¥å¿—çš„è¯ï¼Œäºšå†å…‹æ–¯åˆè§‰å¾—ä¸€åˆ‡éƒ½æ˜¯æ­£å¸¸çš„ï¼Œåªæ˜¯çœ‹ä¸Šå»å¥½åƒæ•°æ®åŒ…çªç„¶åœæ­¢è¿›è¡Œä¼ é€’äº†ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><span><br></span>å¯¹æˆ‘æ¥è¯´ï¼Œè¿™å¬ä¸Šå»å°±åƒæ˜¯ä¸€ä¸ªæœ€å¤§ä¼ è¾“å•å…ƒæ‰€å¼•èµ·çš„é—®é¢˜ï¼Œå¹¶ä¸”æˆ‘éå¸¸ç¡®ä¿¡ã€‚å½“äºšå†å…‹æ–¯æŠŠä»–æœ€å¤§çš„æ•°æ®åŒ…å¤§å°é™åˆ¶åœ¨ä¸€ä¸ªåˆç†çš„å€¼ä¹‹å†…ï¼Œè¿™ä¸ª<span>bug</span>å°±å†ä¹Ÿæ²¡æœ‰å‡ºç°äº†ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><h2 id="çœŸå®ä¸–ç•Œä¸­çš„æœ€å¤§ä¼ è¾“å•å…ƒMTU"><span style="font-family:å¾®è½¯é›…é»‘;">çœŸå®ä¸–ç•Œä¸­çš„æœ€å¤§ä¼ è¾“å•å…ƒMTU</span></h2><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">æ‰€ä»¥ä»€ä¹ˆæ˜¯â€œä¸€ä¸ªåˆç†çš„æ•°æ®åŒ…çš„å¤§å°â€ï¼Ÿ</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">åœ¨ä»Šå¤©çš„äº’è”ç½‘ä¸Š<span>(2016</span>å¹´ï¼Œè¿˜æ˜¯åŸºäº<span>IPv4)</span>ï¼Œå…¸å‹çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°æ˜¯<span>1500</span>å­—èŠ‚ã€‚åœ¨<span>UDP/IP</span>æ•°æ®åŒ…çš„åŒ…å¤´æ·»åŠ æˆ–è€…å»æ‰å‡ ä¸ªå­—èŠ‚ï¼Œä½ ä¼šå‘ç°åœ¨æ•°æ®åŒ…å¼€å§‹å‡ºç°è¢«ä¸¢å¼ƒæˆ–è€…è¢«åˆ†åŒ…æƒ…å†µçš„ä¸€ä¸ªå…¸å‹çš„è¾¹ç•Œå€¼æ˜¯<span>1472</span>ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä½ å¯ä»¥è‡ªå·±åœ¨<span>MacOS X</span>å°è¯•è¿è¡Œä¸‹ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼š</span></span></p><div style="border:solid #F0F0F0 1.0pt;border-left:solid #E0E0E0 2.25pt;padding:0cm 0cm 0cm 0cm;background:whitesmoke"><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ping-g 56 -G 1500 -h 10 -D 8.8.4.4</span></span></p></div><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œè¿™ä¸ªç»“æœåœ¨ç•¥å¾®ä½äº<span>1500</span>å­—èŠ‚çš„å¤§å°ä¸Šä¸‹æµ®åŠ¨ï¼Œç¬¦åˆé¢„æœŸï¼š</span></span></p><div style="border:solid #F0F0F0 1.0pt;border-left:solid #E0E0E0 2.25pt;padding:0cm 0cm 0cm 0cm;background:whitesmoke"><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1404bytes from 8.8.4.4: icmp_seq=134 ttl=56 time=11.945 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1414bytes from 8.8.4.4: icmp_seq=135 ttl=56 time=11.964 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1424bytes from 8.8.4.4: icmp_seq=136 ttl=56 time=13.492 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1434bytes from 8.8.4.4: icmp_seq=137 ttl=56 time=13.652 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1444bytes from 8.8.4.4: icmp_seq=138 ttl=56 time=133.241 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1454bytes from 8.8.4.4: icmp_seq=139 ttl=56 time=17.463 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1464bytes from 8.8.4.4: icmp_seq=140 ttl=56 time=12.307 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1474bytes from 8.8.4.4: icmp_seq=141 ttl=56 time=11.987 ms</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ping:sendto: Message too long</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ping:sendto: Message too long</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">Requesttimeout for icmp_seq 142</span></span></p></div><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸ºä»€ä¹ˆæ˜¯<span>1500</span>å­—èŠ‚ï¼Ÿè¿™æ˜¯<span>MacOS X</span>ä¸Šé»˜è®¤çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ã€‚è¿™ä¹Ÿæ˜¯<span>Windows</span>å¹³å°ä¸Šé»˜è®¤çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ã€‚æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å¯¹æ•°æ®åŒ…çš„å¤§å°æœ‰äº†ä¸€ä¸ªä¸Šé™ï¼ˆä¹Ÿå°±æ˜¯ä¸èƒ½è¶…è¿‡è¿™ä¸ªé»˜è®¤çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼‰ï¼Œå‡å¦‚ä½ çœŸçš„å…³å¿ƒæ•°æ®åŒ…é€šè¿‡<span>Windows</span>å¹³å°æˆ–è€…<span>Mac</span>å¹³å°è¿›è¡Œä¼ æ’­è€Œä¸å¸Œæœ›æ•°æ®åŒ…åœ¨<span>IP</span>å±‚è¿›è¡Œåˆ†åŒ…æˆ–è€…æœ‰è¢«ä¸¢å¼ƒçš„å¯èƒ½çš„è¯ï¼Œé‚£ä¹ˆå°±è¦ä¿è¯æ•°æ®åŒ…çš„å¤§å°ä¸èƒ½è¶…è¿‡è¿™ä¸ªä¸Šé™ï¼š<span>1472</span>ä¸ªå­—èŠ‚ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">é‚£ä¹ˆè¿™ä¸ªæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°çš„ä¸‹é™æ˜¯å¤šå°‘å‘¢ï¼Ÿ<span>MacOS X</span>å…è®¸è®¾ç½®çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°çš„å€¼æ˜¯åœ¨<span>1280</span>åˆ°<span>1500</span>ï¼Œæ‰€ä»¥æˆ‘å¯¹ç°åœ¨äº’è”ç½‘ä¸Šé€šè¿‡<span>IPv4</span>è¿›è¡Œä¼ æ’­çš„æ•°æ®åŒ…çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°çš„ä¸‹é™æœ‰ä¸€ä¸ªæ¯”è¾ƒä¿å®ˆçš„ä¼°è®¡ï¼Œå°±æ˜¯<span>1200</span>å­—èŠ‚ã€‚å¦‚æœæ˜¯åœ¨é€šè¿‡<span>IPv4</span>è¿›è¡Œä¼ æ’­çš„æƒ…å†µä¸‹è¿™ä¸ªæ¯”è¾ƒä¿å®ˆçš„å¤§ä¼ è¾“å•å…ƒçš„å¤§å°çš„ä¸‹é™ä¹Ÿä¼šæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¼°è®¡å€¼ï¼Œä»»æ„æ•°æ®åŒ…åªè¦å¤§å°å°äº<span>1280</span>å­—èŠ‚éƒ½èƒ½ä¿è¯åœ¨æ²¡æœ‰<span>IP</span>å±‚åˆ†åŒ…çš„æƒ…å†µä¸‹é¡ºåˆ©çš„ä¼ æ’­ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™ä¸ªä¼°è®¡ä¸æˆ‘åœ¨èŒä¸šç”Ÿæ¶¯ä¸­æ„Ÿå—åˆ°çš„æƒ…å†µæ˜¯æ¯”è¾ƒä¸€è‡´çš„ã€‚ä»¥æˆ‘çš„ç»éªŒæ¥çœ‹ï¼Œå¾ˆå°‘æœ‰æ¸¸æˆä¼šè¯•å›¾åšè¿™äº›å¤æ‚çš„äº‹æƒ…ï¼Œè¯¸å¦‚å°è¯•å‘ç°è·¯å¾„ä¸Šçš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ä¹‹ç±»çš„ï¼Œå®ƒä»¬ä¸€èˆ¬éƒ½æ˜¯å‡å®šä¸€ä¸ªåˆç†åˆä¿å®ˆçš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ç„¶åä¸€ç›´éµå¾ªè¿™ä¸ªå€¼ã€‚å¦‚æœå‡ºç°ä¸€ä¸ªè¦å‘é€çš„æ•°æ®åŒ…æ¯”è¿™ä¸ªä¿å®ˆçš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°è¦å¤§çš„æƒ…å†µï¼Œæ¸¸æˆåè®®ä¼šå°†è¿™ä¸ªæ•°æ®åŒ…åˆ†æˆå‡ ä¸ªåŒ…ç„¶ååœ¨ç½‘ç»œçš„å¦å¤–ä¸€ä¾§è¿›è¡Œé‡ç»„ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è€Œè¿™æ­£æ˜¯æˆ‘è¦åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢è¦å‘ä½ ä¼ æˆçš„å†…å®¹ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="åˆ†åŒ…åçš„æ•°æ®åŒ…çš„ç»“æ„"><span style="color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;font-size:x-large;">åˆ†åŒ…åçš„æ•°æ®åŒ…çš„ç»“æ„</span></span></h2><p></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è®©æˆ‘ä»¬ä»å†³å®šè¯¥å¯¹ç½‘ç»œä¸Šä¼ è¾“çš„æ•°æ®åˆ†åŒ…åé‡‡ç”¨ä»€ä¹ˆçš„ç»“æ„è¿›è¡Œè¡¨ç¤ºæ¥å¼€å§‹æ„å»ºæˆ‘ä»¬çš„æ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„æœºåˆ¶ã€‚åœ¨ç†æƒ³çŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…å’Œæœªåˆ†åŒ…çš„æ•°æ®åŒ…å…¼å®¹æˆ‘ä»¬ç°åœ¨å·²ç»å»ºç«‹å¥½çš„æ•°æ®åŒ…ç»“æ„ï¼Œè¿™æ ·å½“æˆ‘ä»¬å‘é€å°äºæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°çš„æ•°æ®åŒ…çš„æ—¶å€™ï¼Œç½‘ç»œåè®®æ²¡æœ‰ä»»ä½•å¤šä½™çš„è´Ÿè½½ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸‹é¢æ˜¯åœ¨å‰ä¸€ç¯‡æ–‡ç« ç»“æŸçš„æ—¶å€™å¾—åˆ°çš„æ•°æ®åŒ…çš„ç»“æ„ï¼š</span></span></p><br><br><pre><del>[protocol id] (64 bits)</del> // not actually sent, but used to calc crc32<br>[crc32] (32 bits)<br>[packet type] (2 bits for 3 distinct packet types)<br>(variable length packet data according to packet type)<br>[end of packet serialize check] (32 bits)<br></pre><br><br><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¹‹ä¸­ï¼Œæˆ‘ä»¬ä¸€å…±æœ‰ä¸‰ä¸ªæ•°æ®åŒ…çš„ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ï¼¡ã€ï¼¢å’Œï¼£ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è®©æˆ‘ä»¬ç”¨è¿™ä¸‰ä¸ªæ•°æ®åŒ…ç±»å‹ä¸­çš„ä¸€ä¸ªåˆ¶é€ ä¸€ä¸ªæ¯”æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°è¿˜è¦å¤§ä¸€äº›çš„æ•°æ®åŒ…ï¼š</span></span></p><div><div id="highlighter_44479" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">1</span></div><div class="line number2 index1 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">2</span></div><div class="line number3 index2 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">3</span></div><div class="line number4 index3 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">4</span></div><div class="line number5 index4 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">5</span></div><div class="line number6 index5 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">6</span></div><div class="line number7 index6 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">7</span></div><div class="line number8 index7 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">8</span></div><div class="line number9 index8 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">9</span></div><div class="line number10 index9 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">10</span></div><div class="line number11 index10 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">11</span></div><div class="line number12 index11 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">12</span></div><div class="line number13 index12 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">13</span></div><div class="line number14 index13 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">14</span></div><div class="line number15 index14 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">15</span></div><div class="line number16 index15 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">16</span></div><div class="line number17 index16 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">17</span></div><div class="line number18 index17 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">18</span></div><div class="line number19 index18 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">19</span></div><div class="line number20 index19 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">20</span></div><div class="line number21 index20 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">21</span></div><div class="line number22 index21 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">22</span></div><div class="line number23 index22 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">23</span></div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp keyword bold">static</code> <code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">MaxItems = 4096 * 4;</code></span></div><div class="line number2 index1 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></div><div class="line number3 index2 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp keyword bold">struct</code> <code class="cpp plain">TestPacketB : </code><code class="cpp keyword bold">public</code> <code class="cpp plain">protocol2::Packet</code></span></div><div class="line number4 index3 alt1"><code class="cpp plain"><span style="font-family:å¾®è½¯é›…é»‘;">{</span></code></div><div class="line number5 index4 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">numItems;</code></span></div><div class="line number6 index5 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp color1 bold">int</code> <code class="cpp plain">items[MaxItems];</code></span></div><div class="line number7 index6 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></div><div class="line number8 index7 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">TestPacketB() : Packet( TEST_PACKET_B )</code></span></div><div class="line number9 index8 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">{</code></span></div><div class="line number10 index9 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">        </code><code class="cpp plain">numItems = random_int( 0, MaxItems );</code></span></div><div class="line number11 index10 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">        </code><code class="cpp keyword bold">for</code> <code class="cpp plain">( </code><code class="cpp color1 bold">int</code> <code class="cpp plain">i = 0; i &lt; numItems; ++i )</code></span></div><div class="line number12 index11 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">            </code><code class="cpp plain">items[i] = random_int( -100, +100 );</code></span></div><div class="line number13 index12 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">}</code></span></div><div class="line number14 index13 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></div><div class="line number15 index14 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp keyword bold">template</code> <code class="cpp plain">&lt;</code><code class="cpp keyword bold">typename</code> <code class="cpp plain">stream</code><code class="cpp string"></code><code class="cpp plain">&gt; </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">Serialize( Stream &amp; stream )</code></span></div><div class="line number16 index15 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">{</code></span></div><div class="line number17 index16 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">        </code><code class="cpp plain">serialize_int( stream, numItems, 0, MaxItems );</code></span></div><div class="line number18 index17 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">        </code><code class="cpp keyword bold">for</code> <code class="cpp plain">( </code><code class="cpp color1 bold">int</code> <code class="cpp plain">i = 0; i &lt; numItems; ++i )</code></span></div><div class="line number19 index18 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">            </code><code class="cpp plain">serialize_int( stream, items[i], -100, +100 );</code></span></div><div class="line number20 index19 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></div><div class="line number21 index20 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp keyword bold">true</code><code class="cpp plain">;</code></span></div><div class="line number22 index21 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">}</code></span></div><div class="line number23 index22 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp plain">};</code><code class="cpp keyword bold"></code><code class="cpp plain"></code></span></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™å¯èƒ½çœ‹èµ·æ¥ä¸æ€ä¹ˆè‡ªç„¶ï¼Œä½†åœ¨ç°å®ä¸–ç•Œä¸­è¿™äº›æƒ…å†µçœŸçš„ä¼šå‘ç”Ÿã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥æ˜¯ä»æœåŠ¡å™¨å¾€å®¢æˆ·ç«¯å‘é€æ‰€æœ‰çš„æœªç¡®è®¤çš„äº‹ä»¶ï¼Œä½ ä¼šå¾—åˆ°ä¸€ç»„å¯ä¿¡èµ–ä¹Ÿæœ‰åºçš„äº‹ä»¶ï¼Œä½†æ˜¯ä¹Ÿä¼šé‡åˆ°å¤§é‡æ•°æ®åŒ…çš„ä¸¢å¤±çš„æƒ…å†µï¼Œä½ ä¼šè½»æ˜“çš„é‡åˆ°æ•°æ®åŒ…æ¯”æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°è¿˜è¦å¤§çš„æƒ…å†µï¼Œå³ä½¿ä½ çš„æ•°æ®åŒ…çš„å¹³å‡å¤§å°éå¸¸å°ã€‚ï¼ˆè¯‘æ³¨ï¼šè¿™æ˜¯ç”±äºä¸¢åŒ…é‡ä¼ å¯¼è‡´çš„ä¸åœé‡å‘ï¼Œè€Œé‡å‘çš„æ•°æ®åŒ…åœ¨<span>UDP</span>æˆ–è€…<span>TCP</span>ä¸Šä¼šè¿›è¡Œåˆå¹¶ã€‚æ‰€ä»¥å³ä½¿æ•°æ®åŒ…çš„å¹³å‡å¤§å°è¿œå°äºæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œä½†æ˜¯ç”±äºå¤§é‡è¿™æ ·çš„æ•°æ®åŒ…çš„åˆå¹¶ï¼Œè¿˜æ˜¯å¾ˆå®¹æ˜“å‡ºç°è¶…è¿‡æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°çš„æƒ…å†µï¼‰ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">åœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å®ç°è¿™ä¹ˆä¸€ä¸ªç­–ç•¥ï¼šåœ¨ä¸€ä¸ªæ•°æ®åŒ…é‡Œé¢åªåŒ…å«å¾ˆå°‘ä¸€ç»„äº‹ä»¶æˆ–è€…çŠ¶æ€æ›´æ–°æ¥é¿å…æ•°æ®åŒ…çš„å¤§å°è¶…è¿‡æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œé‡‡ç”¨è¿™ç§ç­–ç•¥ä»¥åå¯ä»¥æœ‰æ•ˆçš„è§„é¿ä¸Šé¢çš„é‚£ç§æƒ…å†µã€‚è¿™ç§è§„åˆ’åœ¨å¾ˆå¤šæƒ…å†µä¸‹éƒ½å·¥ä½œçš„å¾ˆæ£’ã€‚ã€‚ã€‚ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µä¸‹è¿™ç§ç­–ç•¥ä¹Ÿæ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œè¿™ç§æƒ…å†µå°±æ˜¯å¢é‡ç¼–ç ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ç”±ä¸€ä¸ªå¢é‡ç¼–ç å™¨åˆ›å»ºçš„æ•°æ®åŒ…çš„å¤§å°æ˜¯ä¸å½“å‰çŠ¶æ€ä¸ä¹‹å‰çŠ¶æ€ä¹‹é—´æ‰€å‘ç”Ÿçš„çŠ¶æ€å˜åŒ–çš„æ•°é‡æˆæ­£æ¯”çš„ã€‚å¦‚æœè¿™ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´æœ‰å¤§é‡çš„ä¸åŒçš„è¯ï¼Œé‚£ä¹ˆå¢é‡ä¹Ÿå°†å¾ˆå¤§å¹¶ä¸”ä½ å¯¹è¿™ç§æƒ…å†µå…¶å®æ˜¯æ²¡æœ‰ä»€ä¹ˆåŠæ³•çš„ã€‚å¦‚æœå‡ºç°ä¸€ä¸ªå¢é‡æ°å¥½æ¯”æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°è¦å¤§çš„æƒ…å†µï¼Œå½“ç„¶è¿™æ˜¯ä¸€ä¸ªåè¿æ°”ä¸‹æ‰ä¼šå‡ºç°çš„æƒ…å†µï¼Œä½†æ˜¯ä½ ä»ç„¶è¦å‘é€è¿™ä¸ªè¶…è¿‡æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°çš„æ•°æ®åŒ…ï¼æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¢é‡ç¼–ç çš„æƒ…å†µä¸‹ï¼Œä½ çœŸçš„ä¸èƒ½é™åˆ¶æ•°æ®åŒ…çš„æœ€å¤§å¤§å°ä¸€å®šå°äºæœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„ç­–ç•¥å°±æœ‰äº†ç”¨æ­¦ä¹‹åœ°ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è®©æˆ‘ä»¬å›åˆ°æ•°æ®åŒ…çš„ç»“æ„ä¸Šé¢æ¥ã€‚åœ¨æ¯ä¸ªæ•°æ®åŒ…çš„åŒ…å¤´çš„åœ°æ–¹æ·»åŠ ä¸€ä¸ªåºå·æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„åšæ³•ã€‚è¿™å¹¶æ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„ã€‚è¿™åªæ˜¯ä¸€ä¸ªæ•°æ®åŒ…çš„åºå·ï¼Œä¼šåœ¨æ¯ä¸ªæ•°æ®åŒ…è¿›è¡Œå‘é€çš„æ—¶å€™ä¾æ¬¡åŠ ä¸€ã€‚ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œå°±æ˜¯<span>0</span>ã€<span>1</span>ã€<span>2</span>ã€<span>3</span>è¿™ä¹ˆç®€å•ã€‚æˆ‘å–œæ¬¢ç”¨<span>16</span>æ¯”ç‰¹æ¥è¡¨ç¤ºè¿™ä¸ªåºå·ï¼Œå³ä½¿åœ¨æ¯ç§’å‘é€<span>60</span>ä¸ªæ•°æ®åŒ…çš„æƒ…å†µä¸‹ï¼Œåªè¦<span>15</span>åˆ†é’Ÿåºå·å°±ä¼šè¢«ç”¨å®Œä¸€éï¼Œéœ€è¦å†æ¬¡ä»å¤´å¼€å§‹é‡ç”¨ï¼Œä½†æ˜¯è¿™ä¹ˆåšä¹Ÿæ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œä¸»è¦æ˜¯å› ä¸ºä½ åœ¨ç½‘ç»œä¸Šæ”¶åˆ°ä¸€ä¸ª<span>15</span>åˆ†é’Ÿä¹‹å‰å‘é€å‡ºå»çš„æ•°æ®åŒ…æ˜¯ä¸€ä¸ªéå¸¸ç½•è§çš„äº‹æƒ…ï¼Œæ‰€ä»¥ä½ å¾ˆå°‘ä¼šæœ‰æœºä¼šå›°æƒ‘è¿™åˆ°åº•æ˜¯ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…è¿˜æ˜¯ä¸€ä¸ªæ—§çš„æ•°æ®åŒ…ï¼ˆå› ä¸º<span>IP</span>å±‚åœ¨åŒ…å¤´çš„åœ°æ–¹æœ‰ä¸ªè·³è½¬è®¡æ•°ï¼Œè¶…å‡ºä¸€å®šè·³è½¬æ¬¡æ•°çš„æ•°æ®åŒ…ä¼šè¢«ä¸¢å¼ƒæ‰ï¼Œæ‰€ä»¥åŸºæœ¬ä¸ç”¨æ‹…å¿ƒè¿™ç§æƒ…å†µï¼‰ã€‚å¦‚æœä½ ç¡®å®å…³å¿ƒè¿™ä¸ªé—®é¢˜çš„è¯ï¼Œè¯·ä½¿ç”¨<span>32</span>æ¯”ç‰¹çš„åºå·è¿›è¡Œä»£æ›¿ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">æ— è®ºä½ é€‰æ‹©ç”¨å¤šå°‘æ¯”ç‰¹æ¥è¡¨ç¤ºè¿™ä¸ªåºå·ï¼Œå®ƒä»¬å¯¹äºå¾ˆå¤šäº‹æƒ…éƒ½æ˜¯æœ‰ç”¨çš„ï¼Œæ¯”å¦‚è¯´å¯ä¾èµ–æ€§ã€æ£€æµ‹å’Œä¸¢å¼ƒä¹±åºçš„æ•°æ®åŒ…ç­‰ç­‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°æ®åŒ…åºå·çš„åŸå› æ˜¯åœ¨å¯¹æ•°æ®åŒ…è¿›è¡Œåˆ†åŒ…çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æŸä¸ªæ–¹æ³•æ¥ç¡®å®šè¿™ä¸ªæ•°æ®åŒ…çš„åˆ†åŒ…åˆ°åº•æ˜¯å±äºå“ªä¸ªæ•°æ®åŒ…çš„ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„æ•°æ®åŒ…çš„ç»“æ„é‡Œé¢åŠ ä¸Šåºå·è¿™ä¸ªä¸œè¥¿ï¼š</span></span></p><br><br><pre><del>[protocol id] (64 bits)</del>   // not actually sent, but used to calc crc32<br>[crc32] (32 bits)<br><strong>[sequence] (16 bits)</strong><br>[packet type] (2 bits)<br>(variable length packet data according to packet type)<br>[end of packet serialize check] (32 bits)<br></pre><br><br><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™æ˜¯æœ€æœ‰è¶£çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®åŒ…çš„å¤´éƒ¨åªæ·»åŠ ä¸€ä¸ªæ¯”ç‰¹çš„æ ‡è¯†<span> is_fragment</span>ï¼Œä½†æ˜¯å¯¹äºé€šå¸¸æƒ…å†µä¸‹æ ¹æœ¬ä¸éœ€è¦åˆ†åŒ…çš„æ•°æ®åŒ…æ¥è¯´ï¼Œä½ å°±æµªè´¹äº†ä¸€ä¸ªæ¯”ç‰¹ï¼Œå› ä¸ºå®ƒæ€»æ˜¯è¦è¢«ç½®ä¸º<span>0</span>ã€‚è¿™ä¸æ˜¯å¾ˆå¥½ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ç›¸åï¼Œæˆ‘çš„é€‰æ‹©æ˜¯åœ¨æ•°æ®åŒ…çš„ç»“æ„é‡Œé¢æ·»åŠ äº†ä¸€ä¸ªç‰¹æ®Šçš„<span>â€</span>åˆ†åŒ…åçš„æ•°æ®åŒ…<span>â€œ</span>çš„ç±»å‹ï¼š</span></span></p><div><div id="highlighter_815496" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">1</span></div><div class="line number2 index1 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">2</span></div><div class="line number3 index2 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">3</span></div><div class="line number4 index3 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">4</span></div><div class="line number5 index4 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">5</span></div><div class="line number6 index5 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">6</span></div><div class="line number7 index6 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">7</span></div><div class="line number8 index7 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">8</span></div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp keyword bold">enum</code> <code class="cpp plain">TestPacketTypes</code></span></div><div class="line number2 index1 alt1"><code class="cpp plain"><span style="font-family:å¾®è½¯é›…é»‘;">{</span></code></div><div class="line number3 index2 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">PACKET_FRAGMENT = 0,     </code><code class="cpp comments">// RESERVED</code></span></div><div class="line number4 index3 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">TEST_PACKET_A,</code></span></div><div class="line number5 index4 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">TEST_PACKET_B,</code></span></div><div class="line number6 index5 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">TEST_PACKET_C,</code></span></div><div class="line number7 index6 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">TEST_PACKET_NUM_TYPES</code></span></div><div class="line number8 index7 alt1"><code class="cpp plain"><span style="font-family:å¾®è½¯é›…é»‘;">};</span></code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="margin-bottom: 12pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="color: rgb(34, 34, 34); font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™æ°å¥½ä¸éœ€è¦å æ®ä»»ä½•çš„ç©ºé—´ï¼Œæ˜¯å› ä¸ºå››ä¸ªæ•°æ®åŒ…ç±»å‹æ­£å¥½å¯ä»¥ç”¨ä¸¤ä¸ªæ¯”ç‰¹æ¥è¡¨ç¤ºï¼Œè€Œè¿™ä¸¤ä¸ªæ¯”ç‰¹çš„ç©ºé—´å·²ç»ç”¨äºè¡¨ç¤ºæ•°æ®åŒ…ç±»å‹äº†ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨åŸæ¥çš„æšä¸¾ä¸Šæ–°åŠ äº†ä¸€ä¸ªç±»å‹ã€‚è¿™ä¹ˆå¤„ç†ä»¥åï¼Œæ¯æ¬¡å½“æˆ‘ä»¬è¯»å–ä¸€ä¸ªæ•°æ®åŒ…çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®åŒ…çš„ç±»å‹æ˜¯<span>0</span>çš„è¯ï¼Œæˆ‘ä»¬å°±çŸ¥é“è¿™ä¸ªæ•°æ®åŒ…æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…ï¼Œå®ƒçš„å†…å­˜å¸ƒå±€å¯ä»¥é€šè¿‡æ•°æ®åŒ…çš„ç±»å‹å¾—çŸ¥ï¼Œå¦åˆ™çš„è¯ï¼Œæˆ‘ä»¬å°±èµ°å›åŸæ¥çš„é€šç”¨çš„å¯¹éåˆ†åŒ…çš„æ•°æ®åŒ…è¿›è¡Œè¯»å–å’Œå¤„ç†çš„æ–¹æ³•ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è®©æˆ‘ä»¬è®¾è®¡ä¸‹è¿™ä¸ªåˆ†åŒ…åçš„æ•°æ®åŒ…çœ‹èµ·æ¥åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚æˆ‘ä»¬å°†å…è®¸ä¸€ä¸ªæ•°æ®åŒ…æœ€å¤šå¯ä»¥åˆ†æˆ<span>256</span>ä¸ªæ•°æ®åŒ…ï¼Œå¹¶ä¸”æ¯ä¸ªåˆ†åŒ…åçš„æ•°æ®åŒ…çš„å¤§å°ä¸ä¼šè¶…è¿‡<span>1024</span>ä¸ªå­—èŠ‚ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™æ ·ä¸€ä¸ªç³»ç»Ÿæ¥å‘é€å¤§å°æœ€å¤§ä¸º<span>256k</span>çš„æ•°æ®åŒ…ï¼Œè¿™å¯¹äºä»»æ„ç³»ç»Ÿä»»æ„æƒ…å†µæ¥è¯´éƒ½åº”è¯¥æ˜¯è¶³å¤Ÿçš„ï¼Œä½†æ˜¯è¿™åªæ˜¯æˆ‘ä¸ªäººçš„ä¸€ä¸ªçœ‹æ³•ï¼Œå¦‚æœæœ‰ç‰¹æ®Šçš„æƒ…å†µï¼Œè¿˜è¯·ç»“åˆå®é™…æƒ…å†µè¿›è¡Œå…·ä½“åˆ†æã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">æœ‰äº†è¿™ä¹ˆä¸€ä¸ªä¸å¤§çš„å›ºå®šå¤§å°çš„æ•°æ®åŒ…åŒ…å¤´ç»“æ„ï¼Œå†åŠ ä¸Š<span>UDP</span>çš„åŒ…å¤´ç»“æ„ä»¥åŠ<span>IP</span>çš„åŒ…å¤´ç»“æ„ï¼Œä¸€ä¸ªåˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…ä¼šå°äºä¹‹å‰æˆ‘ä»¬ä¿å®ˆä¼°è®¡çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ï¼š<span>1200</span>å­—èŠ‚ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå› ä¸ºä¸€ä¸ªæ•°æ®åŒ…æœ€å¤šå¯ä»¥åˆ†åŒ…æˆ<span>256</span>ä¸ªæ•°æ®åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ã€<span>0</span>ï¼Œ<span>255</span>ã€‘è¿™ä¸ªèŒƒå›´æ¥è¡¨ç¤ºåˆ†åŒ…çš„<span>id</span>å’Œåºå·ï¼Œè¿™æ ·æ¯ä¸ªåˆ†åŒ…é‡Œé¢è¿˜éœ€è¦æœ‰<span>8</span>æ¯”ç‰¹æ¥è¡¨ç¤ºè¿™ä¸ªåºå·ã€‚</span></span></p><br><br><pre><del>[protocol id] (32 bits)</del>   // not actually sent, but used to calc crc32<br>[crc32] (32 bits)<br>[sequence] (16 bits)<br>[packet type = 0] (2 bits)<br><strong>[fragment id] (8 bits)<br>[num fragments] (8 bits)<br>[pad zero bits to nearest byte index]<br>&lt;fragment data&gt;</strong><br></pre><br><br><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æŠŠè¿™å‡ ä¸ªæ¯”ç‰¹å¯¹é½åˆ°äº†ä¸‹ä¸€ä¸ªå­—èŠ‚ï¼Œç„¶åæ‰æŠŠå¯¹é½ä»¥åçš„æ•°æ®å†™å…¥åˆ°æ•°æ®åŒ…é‡Œé¢ã€‚æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿè¿™ä¹ˆåšå…¶å®æ˜¯æœ‰ä¸¤ä¸ªåŸå› çš„<span>: 1) </span>è¿™ä¹ˆå¤„ç†ä»¥åå¯ä»¥é€šè¿‡<span>memcpy</span>å‡½æ•°æ›´å¿«çš„æŠŠåˆ†åŒ…çš„æ•°æ®æ‹·è´åˆ°æ•°æ®åŒ…é‡Œé¢è€Œä¸éœ€è¦ä½¿ç”¨ä½æ‰“åŒ…å™¨æ¥å¯¹æ¯ä¸ªå­—èŠ‚è¿›è¡Œå¤„ç†ã€‚<span>2) </span>æˆ‘ä»¬é€šè¿‡ä¸å‘é€åˆ†åŒ…æ•°æ®çš„å¤§å°èŠ‚çœäº†ä¸€å°éƒ¨åˆ†å¸¦å®½ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»æ•°æ®åŒ…çš„æ•´ä½“å¤§å°å‡å»åˆ†åŒ…æ•°æ®èµ·å§‹ä½ç½®çš„å­—èŠ‚åºå·æ¥æ¨æ–­å‡ºè¿™ä¸ªåˆ†åŒ…çš„å¤§å°ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="å‘é€åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…"><span style="color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;font-size:x-large;">å‘é€åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…</span></span></h2><p></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">å‘é€åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…æ˜¯ä¸€ä»¶éå¸¸å®¹æ˜“çš„äº‹æƒ…ã€‚å¦‚æœæ•°æ®åŒ…çš„å¤§å°å°äºä¿å®ˆä¼°è®¡çš„æœ€å¤§ä¼ è¾“å•å…ƒçš„å¤§å°ã€‚é‚£ä¹ˆå°±æŒ‰æ­£å¸¸çš„æ–¹æ³•è¿›è¡Œå‘é€ã€‚å¦åˆ™çš„è¯ï¼Œå°±è®¡ç®—è¿™ä¸ªæ•°æ®åŒ…åˆ°åº•è¯¥åˆ†æˆå¤šå°‘ä¸ª<span>1024</span>å­—èŠ‚çš„æ•°æ®åŒ…åˆ†åŒ…ï¼Œç„¶åæ„å»ºè¿™äº›åˆ†åŒ…å¹¶æŒ‰ç…§ä¹‹å‰å‘é€æ­£å¸¸æ•°æ®åŒ…çš„æ–¹æ³•è¿›è¡Œå‘é€ã€‚å‘é€å‡ºå»ä»¥åä¹Ÿä¸è®°å½•å‘é€çš„æ•°æ®åŒ…çš„å†…å®¹ï¼Œè¿™æ²¡ä»€ä¹ˆå›°éš¾çš„ï¼</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™ç§å‘é€ä»¥åä¸è®°å½•å‘é€çš„æ•°æ®åŒ…çš„å†…å®¹çš„æ–¹æ³•æœ‰ä¸€ä¸ªåæœï¼Œå°±æ˜¯æ•°æ®åŒ…çš„ä»»æ„ä¸€ä¸ªåˆ†åŒ…å¦‚æœä¸¢å¤±çš„è¯ï¼Œé‚£ä¹ˆæ•´ä¸ªæ•°æ®åŒ…å°±éƒ½è¦ä¸¢å¼ƒã€‚ç”±æ­¤å¯è§ï¼Œå½“ä½ éœ€è¦å‘é€è¦ç»™<span>256K</span>çš„æ•°æ®åŒ…çš„æ—¶å€™è¦å‘é€<span>256</span>ä¸ªåˆ†åŒ…ï¼Œå¦‚æœæœ‰ä¸€ä¸ªåˆ†åŒ…ä¸¢å¤±çš„è¯ï¼Œä½ å°±è¦é‡æ–°æŠŠè¿™ä¸ª<span>256k</span>çš„æ•°æ®åŒ…å†åˆ†ä¸€æ¬¡åŒ…ç„¶åå†å‘é€å‡ºå»ã€‚è¿™ç»å¯¹ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-family:å¾®è½¯é›…é»‘;"><span style="font-size: 12pt; color: rgb(34, 34, 34);">è¿™æ˜¾ç„¶æ˜¯ä¸€ä¸ªå¾ˆç³Ÿç³•çš„åŠæ³•ï¼Œå› ä¸ºéšç€åˆ†åŒ…æ•°ç›®çš„å¢å¤šï¼Œå‘ç”Ÿä¸¢å¤±çš„æ¦‚ç‡è‚¯å®šæ˜¯æ˜¾è‘—çš„å¢å¤§ã€‚è¿™ç§å¢é•¿å…³ç³»ä¸æ˜¯çº¿æ€§çš„ï¼Œè€Œæ˜¯ä¸€ç§ç›¸å½“å¤æ‚çš„å…³ç³»ï¼Œå¦‚æœä½ å¯¹è¿™ä¸ªè®¡ç®—æ„Ÿå…´è¶£çš„è¯ï¼Œä½ å¯ä»¥è¯»ä¸‹<a rel="noopener" href="http://www.fourmilab.ch/rpkp/experiments/statistics.html" target="_blank">è¿™ç¯‡æ–‡ç« </a></span><span style="font-size: 12pt; color: rgb(34, 34, 34);">ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ç®€è€Œè¨€ä¹‹ï¼Œå¦‚æœä½ è¦è®¡ç®—ä¸€ä¸ªæ•°æ®åŒ…ä¼šè¢«ä¸¢å¼ƒçš„æ¦‚ç‡ï¼Œä½ å¿…é¡»è¦è®¡ç®—æ‰€æœ‰åˆ†åŒ…è¢«æˆåŠŸå‘é€åˆ°ç›®çš„åœ°çš„æ¦‚ç‡ï¼Œç„¶åä»<span>1</span>ä¸­å‡å»è¿™ä¸ªæ¦‚ç‡ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯è‡³å°‘æœ‰ä¸€ä¸ªåˆ†åŒ…ä¸¢å¤±çš„æ¦‚ç‡ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸‹é¢è¿™ä¸ªå…¬å¼å¯ä»¥ç”¨æ¥è®¡ç®—å› ä¸ºåˆ†åŒ…ä¸¢å¤±å¯¼è‡´æ•´ä¸ªæ•°æ®åŒ…è¢«ä¸¢å¼ƒçš„æ¦‚ç‡ï¼š</span></span></p><p class="MsoNormal" align="left" style="margin-bottom: 12pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="font-size: 10pt; color: rgb(40, 40, 40);"><span style="font-family:å¾®è½¯é›…é»‘;">ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼</span></span></p><div style="border:solid #F0F0F0 1.0pt;border-left:solid #E0E0E0 2.25pt;padding:0cm 0cm 0cm 0cm;background:whitesmoke"><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">1- ( probability of fragment being delivered ) ^ num_fragments</span></span></p></div><p class="MsoNormal" align="left" style="margin-bottom: 12pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="font-size: 10pt; color: rgb(40, 40, 40);"><span style="font-family:å¾®è½¯é›…é»‘;">ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼ï¼¼</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è®©æˆ‘ä»¬ä¸¾ä¸ªç®€å•çš„ä¾‹å­å¯¹ä¸Šé¢è¿™ä¸ªå…¬å¼è¿›è¡Œè¯´æ˜ï¼Œå¦‚æœæˆ‘ä»¬å‘é€çš„ä¸€ä¸ªä¸éœ€è¦åˆ†åŒ…çš„æ•°æ®åŒ…ï¼Œå¦‚æœå®ƒåœ¨ç½‘ç»œä¸Šä¼ è¯´çš„æ—¶å€™ä¸¢å¤±çš„æ¦‚ç‡æ˜¯<span>1%</span>ï¼Œé‚£ä¹ˆåªæœ‰ç™¾åˆ†ä¹‹ä¸€çš„æ¦‚ç‡ä¼šå‡ºç°è¿™ä¸ªæ•°æ®åŒ…è¢«ä¸¢å¼ƒçš„æƒ…å†µï¼Œæˆ–è€…æˆ‘ä»¬ä¸è¦å«Œéº»çƒ¦ï¼ŒæŠŠè¿™äº›æ•°æ®ä»£å…¥åˆ°ä¸Šé¢è¿™ä¸ªå…¬å¼é‡Œé¢<span>: 1 â€“ (99/100) ^ 1 = 1/100 = 1%</span>ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">éšç€åˆ†åŒ…æ•°é‡çš„å¢åŠ ï¼Œæ•´ä¸ªæ•°æ®åŒ…è¢«ä¸¢å¼ƒçš„æ¦‚ç‡ä¹Ÿéšä¹‹å¢åŠ ï¼š</span></span></p><ul type="disc"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸¤ä¸ªåˆ†åŒ…çš„æƒ…å†µï¼š<span> 1 â€“ (99/100) ^ 2 = <b><span style="border:none windowtext 1.0pt;     padding:0cm">2%</span></b></span><b><span style="border:none windowtext 1.0pt;     padding:0cm">ã€‚</span></b></span></span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">åä¸ªåˆ†åŒ…çš„æƒ…å†µï¼š<span> 1 â€“ (99/100) ^ 10 = <b><span style="border:none windowtext 1.0pt;     padding:0cm">9.5%</span></b></span><b><span style="border:none windowtext 1.0pt;     padding:0cm">ã€‚</span></b></span></span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸€ç™¾ä¸ªåˆ†åŒ…çš„æƒ…å†µï¼š<span> 1 â€“ (99/100) ^ 100 = <b><span style="border:none windowtext 1.0pt;     padding:0cm">63.4%</span></b></span><b><span style="border:none windowtext 1.0pt;     padding:0cm">ã€‚</span></b></span></span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">äºŒç™¾äº”åå…­ä¸ªåˆ†åŒ…çš„æƒ…å†µï¼š<span> 1 â€“ (99/100) ^ 256 = <b><span style="border:none windowtext 1.0pt;     padding:0cm">92.4%</span></b></span><b><span style="border:none windowtext 1.0pt;     padding:0cm">ã€‚</span></b></span></span></li></ul><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">æ‰€ä»¥æˆ‘å»ºè®®ä½ è¦å°å¿ƒåˆ†åŒ…ä»¥åçš„æ•°é‡ã€‚è¿™ä¸ªç­–ç•¥æœ€å¥½æ˜¯åªå¯¹<span>2-4</span>ä¸ªåˆ†åŒ…çš„æƒ…å†µè¿›è¡Œä½¿ç”¨ï¼Œè€Œä¸”æœ€å¥½æ˜¯é’ˆå¯¹é‚£ç§å¯¹æ—¶é—´ä¸æ€ä¹ˆæ•æ„Ÿçš„æ•°æ®ä½¿ç”¨æˆ–è€…æ˜¯å°±ç®—åˆ†åŒ…lostäº†ä¹Ÿæ— æ‰€è°“çš„æƒ…å†µã€‚ç»å¯¹ä¸è¦åªæ˜¯ä¸ºäº†çœäº‹å°±æŠŠä¸€å¤§å †ä¾èµ–é¡ºåºçš„äº‹ä»¶æ‰“åˆ°ä¸€ä¸ªå¤§æ•°æ®åŒ…é‡Œé¢ç„¶åä¾èµ–æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„æœºåˆ¶è¿›è¡Œå‘é€ã€‚è¿™ä¼šè®©äº‹æƒ…å˜å¾—æ›´åŠ éº»çƒ¦ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">å¤§æ•°æ®åŒ…çš„å¦å¤–ä¸€ç§å…¸å‹çš„ç”¨é€”æ˜¯å½“å®¢æˆ·ç«¯æ–°è¿å…¥ä¸€ä¸ªæ¸¸æˆæœåŠ¡å™¨çš„æ—¶å€™ã€‚æ¸¸æˆæœåŠ¡å™¨é€šå¸¸ä¼šæŠŠå¤§å—çš„æ•°æ®ä»¥ä¸€ç§å¯é çš„æ–¹å¼ä¸‹å‘ç»™å®¢æˆ·ç«¯ã€‚å¯¹äºåæœŸæ‰åŠ å…¥çš„å®¢æˆ·ç«¯è€Œè¨€ï¼Œè¿™äº›å¤§å—çš„æ•°æ®ä¹Ÿè®¸ä»£è¡¨äº†ä¸–ç•Œçš„åˆå§‹çŠ¶æ€ã€‚æ— è®ºè¿™äº›æ•°æ®åŒ…å«äº†æ€ä¹ˆæ ·çš„ä¿¡æ¯ï¼Œè¯·ä¸è¦ä½¿ç”¨æœ¬ç¯‡æ–‡ç« çš„åˆ†åŒ…æŠ€å·§æ¥ç»™å®¢æˆ·ç«¯ä¸‹å‘å¤§å—çš„æ•°æ®ã€‚ç›¸åï¼Œè¯·æŸ¥é˜…è¿™ä¸ªç³»åˆ—æ•™ç¨‹çš„ä¸‹ç¯‡æ–‡ç« ï¼Œåœ¨é‚£ç¯‡æ–‡ç« é‡Œé¢å°†è®²è§£å¦‚ä½•åœ¨æœ‰æ•°æ®åŒ…å¯èƒ½å‘ç”Ÿä¸¢å¤±çš„æƒ…å†µä¸‹ï¼Œå¿«é€Ÿå¯é çš„å‘é€å¤§å—çš„æ•°æ®ç›´åˆ°è¿™äº›å¤§å—çš„æ•°æ®å®Œå…¨è¢«ç¡®è®¤æ¥æ”¶ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="å¯¹åˆ†åŒ…åçš„æ•°æ®åŒ…çš„æ¥æ”¶"><span style="color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;font-size:x-large;">å¯¹åˆ†åŒ…åçš„æ•°æ®åŒ…çš„æ¥æ”¶</span></span></h2><p></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">å°½ç®¡å‘é€åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…æ˜¯ä¸€ä»¶ç›¸åŒç®€å•çš„äº‹æƒ…ï¼Œä½†æ˜¯å¯¹åˆ†åŒ…åçš„æ•°æ®åŒ…è¿›è¡Œæ¥æ”¶å°±ç›¸å¯¹éœ€è¦æŠ€å·§äº†ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä¹‹æ‰€ä»¥å¯¹åˆ†åŒ…åçš„æ•°æ®åŒ…è¿›è¡Œæ¥æ”¶å¾ˆå›°éš¾çš„åŸå› æ˜¯æˆ‘ä»¬ä¸ä»…éœ€è¦ç»™ç¼“å†²åŒºå»ºç«‹ä¸€ä¸ªæ•°æ®ç»“æ„è¿˜è¦æŠŠè¿™äº›åˆ†åŒ…é‡ç»„æˆåŸå§‹çš„æ•°æ®åŒ…ï¼Œæˆ‘ä»¬ä¹Ÿè¦ç‰¹åˆ«å°å¿ƒå¦‚æœæœ‰äººè¯•å›¾è®©æˆ‘ä»¬çš„ç¨‹åºäº§ç”Ÿå´©æºƒè€Œç»™æˆ‘ä»¬å‘é€æ¶æ„çš„æ•°æ®åŒ…ã€‚</span></span></p><br><br><pre><del>[protocol id] (32 bits)</del>   // not actually sent, but used to calc crc32<br>[crc32] (32 bits)<br>[sequence] (16 bits)<br>[packet type = 0] (2 bits)<br><strong>[fragment id] (8 bits)<br>[num fragments] (8 bits)<br>[pad zero bits to nearest byte index]<br>&lt;fragment data&gt;</strong><br></pre><br><br><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸‹é¢åˆ—å‡ºçš„æ˜¯æˆ‘èƒ½æƒ³åˆ°çš„å¦‚ä½•æ”»å‡»ä½ çš„åè®®ä»¥ä¾¿è®©ä½ çš„æœåŠ¡å™¨å´©æºƒçš„æ‰€æœ‰æ–¹æ³•ï¼š</span></span></p><ul type="disc"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">å°è¯•å‘é€åˆ†åŒ…<span>ID</span>åœ¨ä¸€ä¸ªé™åˆ¶èŒƒå›´å†…çš„åˆ†åŒ…ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½è®©ä½ çš„ç¨‹åºå´©æºƒã€‚ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œä¹Ÿè®¸è¿™ä¸ªæ•°æ®åŒ…åªæœ‰ä¸¤ä¸ªåˆ†åŒ…ï¼Œä½†æ˜¯æˆ‘ä¼šå‘é€å¤šä¸ªåˆ†åŒ…<span>ID</span>åœ¨ã€ï¼ï¼Œï¼’ï¼•ï¼•ã€‘ä¹‹å†…çš„åˆ†åŒ…ã€‚</span></span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">å‘é€ä¸€ä¸ªæ•°æ®åŒ…ï¼Œè®©æˆ‘ä»¬å‡è®¾è¿™ä¸ªä¹¦åŒ…çš„æœ€å¤§åˆ†åŒ…æ•°é‡æ˜¯<span>2</span>ï¼Œç„¶åå‘é€å¤šä¸ªå±äºè¿™ä¸ªæ•°æ®åŒ…çš„åˆ†åŒ…ï¼Œä½†æ˜¯åœ¨åˆ†åŒ…çš„æ•°æ®åŒ…æŠ¥å¤´é‡Œé¢æŠŠæœ€å¤§åˆ†åŒ…çš„æ•°é‡æ”¹ä¸º<span>256</span>ï¼Œæ¥å¸Œæœ›ä½ åœ¨æ¥æ”¶å®Œç¬¬ä¸€ä¸ªåˆ†åŒ…ä»¥åï¼Œä¸ä¼šå‘ç°åˆ†åŒ…çš„æœ€å¤§æ•°é‡ä¿¡æ¯è¢«æ”¹å˜äº†ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½é€ æˆä½ çš„å†…å­˜å´©æºƒã€‚</span></span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">å‘é€éå¸¸å¤§çš„åˆ†åŒ…ï¼Œè®©åˆ†åŒ…é‡Œé¢çš„æ•°æ®è¶…è¿‡<span>1k</span>ï¼Œæµ‹è¯•ä¸‹ä½ åœ¨è¯•å›¾æŠŠåˆ†åŒ…æ•°æ®æ‹·è´åˆ°æ•°æ®ç»“æ„çš„æ—¶å€™æ˜¯å¦æœ‰è‰¯å¥½çš„åˆ¤æ–­ï¼Œå¦‚æœæ²¡æœ‰è‰¯å¥½çš„åˆ¤æ–­çš„è¯ï¼Œè¿™ä¹Ÿè®¸ä¼šè®©ä½ çš„å†…å­˜å´©æºƒï¼Œæˆ–è€…å ç”¨å¤§é‡çš„å†…å®¹è®©ä½ åœ¨åˆ†é…æ–°çš„åˆ†åŒ…çš„æ—¶å€™æ²¡æœ‰ç©ºé—´ã€‚ </span></span></li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;">æŒç»­çš„ç»™ä½ çš„ç¨‹åºå‘é€æœ€å¤§åˆ†åŒ…æ•°ç›®çš„åˆ†åŒ…ï¼ˆä¹Ÿå°±æ˜¯å¦‚æœæœ€å¤§åˆ†åŒ…æ•°ç›®æ˜¯<span>256</span>çš„è¯ï¼Œå°±æŒç»­ä¸æ–­çš„å‘é€åˆ†åŒ…<span>ID</span>æ˜¯<span>256</span>çš„æ•°æ®åŒ…ï¼‰ï¼Œå¸Œæœ›ä½ ä¼šåˆ†é…å¤§é‡çš„å†…å®¹æ¥å®¹çº³è¿™äº›åˆ†åŒ…ç„¶åè®©ä½ çš„å†…å­˜å´©æºƒã€‚è®©æˆ‘ä»¬å‡è®¾ä½ çš„ç¨‹åºä¸­æœ‰ä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼Œè¿™ä¸ªæ»‘åŠ¨çª—å£æœ‰<span>256</span>ä¸ªæ•°æ®åŒ…ï¼Œæ¯ä¸ªæ•°æ®åŒ…æœ€å¤šå¯ä»¥æœ‰<span>256</span>ä¸ªåˆ†åŒ…ï¼Œæ¯ä¸ªåˆ†åŒ…é¢„ç•™çš„ç©ºé—´æ˜¯<span>1k</span>ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯ä¼šç»™æ¯ä¸ªå®¢æˆ·ç«¯é¢„ç•™<span>67,108,864</span>å­—èŠ‚æˆ–è€…<span>64mb</span>çš„ç©ºé—´ã€‚æˆ‘å¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•è®©æœåŠ¡å™¨å´©æºƒä¹ˆï¼Ÿæˆ‘èƒ½ç”¨ä¸€å †å¤§å°æœ‰è¶£çš„åˆ†åŒ…æ¥è€—å°½çš„ä½ åœ°å€ç©ºé—´çš„<span>heap</span>ç©ºé—´ä¹ˆï¼Ÿå› ä¸ºæœåŠ¡å™¨çš„ç¨‹åºæ˜¯ä½ æ¥è®¾è®¡å®ç°çš„ï¼Œæ‰€ä»¥åªæœ‰ä½ æ‰çŸ¥é“è¿™ä¸ªé—®é¢˜çš„ç¡®åˆ‡ç­”æ¡ˆã€‚å®ƒå–å†³äºä½ çš„å†…å­˜é¢„ç®—ä»¥åŠå¦‚ä½•åˆ†é…å†…å­˜æ¥å­˜å‚¨åˆ†åŒ…ã€‚å¦‚æœä½ è€ƒè™‘è¿‡äº†è§‰å¾—è¿™ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆå°±é™åˆ¶ä¸‹ç¼“å†²åŒºä¸­åˆ†åŒ…çš„æ•°ç›®æˆ–è€ƒè™‘å‡å°‘æ¯ä¸ªæ•°æ®åŒ…çš„åˆ†åŒ…çš„æœ€å¤§æ•°ç›®ã€‚è€ƒè™‘ç»™æ¯ä¸ªåˆ†åŒ…é™æ€åˆ†é…æ•°æ®ç»“æœæˆ–è€…ä½¿ç”¨ä¸€ä¸ªå†…å­˜æ± æ¥å‡å°‘å†…å­˜ç¢ç‰‡ã€‚</span></span></li></ul><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ¥æ”¶ç«¯ä»£ç æ˜¯éå¸¸è„†å¼±çš„ï¼Œè¦éå¸¸å°å¿ƒæ£€æŸ¥ä¸€åˆ‡å¯èƒ½çš„æƒ…å†µã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„äº‹æƒ…è¦æ³¨æ„ï¼šè®©åˆ†åŒ…ä¿å­˜åœ¨ä¸€ä¸ªæ•°æ®ç»“æ„é‡Œé¢ï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…çš„æ‰€æœ‰åˆ†åŒ…éƒ½åˆ°è¾¾ä»¥åï¼ˆé€šè¿‡è®¡æ•°æ¥åˆ¤æ–­æ˜¯å¦å…¨éƒ¨åˆ°è¾¾ï¼‰ï¼Œå°†è¿™äº›åˆ†åŒ…é‡ç»„æˆä¸€ä¸ªå¤§çš„æ•°æ®åŒ…ï¼Œå¹¶æŠŠè¿™ä¸ªé‡ç»„åçš„å¤§æ•°æ®åŒ…è¿”å›ç»™æ¥æ”¶æ–¹ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„åœ¨è¿™é‡Œæ˜¯æœ‰æ„ä¹‰çš„<span>?</span>è¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„æ•°æ®ç»“æ„<span>!</span>æˆ‘ä½¿ç”¨çš„æ˜¯ä¸€ç§æˆ‘å–œæ¬¢ç§°ä¹‹ä¸ºåºåˆ—ç¼“å†²åŒºçš„ä¸œè¥¿ã€‚æˆ‘æƒ³å’Œä½ åˆ†äº«çš„æœ€æ ¸å¿ƒçš„æŠ€å·§æ˜¯å¦‚ä½•è®©è¿™ä¸ªæ•°æ®ç»“æ„å˜å¾—é«˜æ•ˆï¼š</span></span></p><div><div id="highlighter_81070" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">1</span></div><div class="line number2 index1 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">2</span></div><div class="line number3 index2 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">3</span></div><div class="line number4 index3 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">4</span></div><div class="line number5 index4 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">5</span></div><div class="line number6 index5 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">6</span></div><div class="line number7 index6 alt2"><span style="font-family:å¾®è½¯é›…é»‘;">7</span></div><div class="line number8 index7 alt1"><span style="font-family:å¾®è½¯é›…é»‘;">8</span></div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">MaxEntries = 256;</code></span></div><div class="line number2 index1 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></div><div class="line number3 index2 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp keyword bold">struct</code> <code class="cpp plain">SequenceBuffer</code></span></div><div class="line number4 index3 alt1"><code class="cpp plain"><span style="font-family:å¾®è½¯é›…é»‘;">{</span></code></div><div class="line number5 index4 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">exists[MaxEntries];</code></span></div><div class="line number6 index5 alt1"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">uint16_t sequence[MaxEntries];</code></span></div><div class="line number7 index6 alt2"><span style="font-family:å¾®è½¯é›…é»‘;"><code class="cpp spaces">    </code><code class="cpp plain">Entry entries[MaxEntries];</code></span></div><div class="line number8 index7 alt1"><code class="cpp plain"><span style="font-family:å¾®è½¯é›…é»‘;">};</span></code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="margin-bottom: 12pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™é‡Œé¢æœ‰å‡ ä»¶äº‹æƒ…å€¼å¾—æ³¨æ„ã€‚é¦–å…ˆï¼Œä½¿ç”¨ç±»ä¼¼æ•°ç»„çš„ç»“æ„å¯ä»¥å…è®¸å¯¹ç»™å®šæ¡ç›®æ˜¯å¦å­˜åœ¨äºä¸€ä¸ªåºåˆ—ç¼“å†²åŒºçš„å­˜åœ¨æ€§è¿›è¡Œå¿«é€Ÿæµ‹è¯•å¹¶ä¸”å°†æµ‹è¯•ç»“æœè¿›è¡Œç¼“å­˜ï¼Œå³ä½¿æ¯ä¸ªæ•°æ®åŒ…çš„æ¡ç›®ç»“æ„æ˜¯éå¸¸å¤§çš„ï¼ˆè€Œä¸”è¿™ç§ç»“æ„å¯¹äºæ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„æ¥è¯´æ˜¯éå¸¸æ£’çš„ï¼‰ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ•°æ®ç»“æ„ï¼Ÿå½“ä½ æ¥æ”¶åˆ°ä¸€ä¸ªåˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…ä»¥åï¼Œè¿™ä¸ªæ•°æ®åŒ…ä¼šæºå¸¦ä¸€ä¸ªåºå·æŒ‡å®šå®ƒæ˜¯å±äºå“ªä¸ªæ•°æ®åŒ…çš„åˆ†åŒ…ã€‚è¿™ä¸ªåºå·ä¼šéšç€å‘é€è€Œä¸åœçš„å¢å¤§<span>(</span>æ‰€æœ‰åºå·å…¨éƒ¨ç”¨å®Œå¯¼è‡´å‘ç”Ÿç¯ç»•é™¤å¤–<span>)</span>ï¼Œ æ‰€ä»¥æœ€å…³é”®çš„æŠ€å·§æ˜¯ä½ è¦å¯¹åºå·è¿›è¡Œæ•£åˆ—è®©æ•£åˆ—åçš„åºå·è¿›å…¥ä¸€ä¸ªæ•°ç»„ä¸­æŸä¸ªç»™å®šçš„ä½ç½®ï¼Œå…·ä½“å¤„ç†è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</span></span></p><div style="border:solid #F0F0F0 1.0pt;border-left:solid #E0E0E0 2.25pt;padding:0cm 0cm 0cm 0cm;background:whitesmoke"><p class="MsoNormal" align="left" style="line-height: 16.8pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; vertical-align: baseline; border: none; padding: 0cm;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">int index = sequence % MaxEntries;</span></span></p></div><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ç°åœ¨ä½ å¯ä»¥ç”¨<span>O(1)</span>çš„æ—¶é—´å¤æ‚åº¦è¿›è¡Œä¸€ä¸ªå¿«é€Ÿæµ‹è¯•ï¼Œæ¥é€šè¿‡åºå·çœ‹ä¸‹ä¸€ä¸ªç»™å®šçš„æ¡ç›®æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”åˆ¤æ–­ä¸‹è¿™ä¸ªæ¡ç›®æ˜¯å¦å’Œä½ æƒ³è¦è¯»å–æˆ–è€…å†™å…¥çš„æ•°æ®åŒ…åºå·ç›¸åŒ¹é…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ æ—¢éœ€è¦æµ‹è¯•å­˜åœ¨æ€§åˆéœ€è¦æµ‹è¯•åºå·æ˜¯å¦æ˜¯é¢„æœŸçš„åºå·ï¼Œè¿™æ˜¯å› ä¸ºæ‰€æœ‰çš„åºå·éƒ½æ˜¯æœ‰æ•ˆçš„æ•°å­—<span>(</span>æ¯”å¦‚è¯´æ˜¯<span>0)</span>ï¼Œè¿˜æœ‰å°±æ˜¯å› ä¸ºæ ¹æ®ä¸€ä¸ªç‰¹å®šçš„æ•°æ®åŒ…åºå·æŸ¥æ‰¾åˆ°çš„æ¡ç›®å¯èƒ½æ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯å®ƒå±äºè¿‡å»çš„ä¸€ä¸ªåºå·ï¼ˆæ¯”å¦‚è¯´ï¼Œè¿™æ˜¯æŸä¸ªå…¶ä»–çš„åºå·ï¼Œä½†æ˜¯æ°å·§é€šè¿‡å–æ¨¡çš„è®¡ç®—å¾—åˆ°ç›¸åŒçš„åºå·ï¼‰ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">æ‰€ä»¥å½“ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…çš„ç¬¬ä¸€ä¸ªåˆ†åŒ…åˆ°è¾¾çš„æ—¶å€™ï¼Œä½ éœ€è¦æŠŠæ•°æ®åŒ…çš„åºå·æ•£åˆ—æˆä¸€ä¸ªç´¢å¼•ï¼Œå¦‚æœå‘ç°è¿™ä¸ªç´¢å¼•å¯¹åº”çš„å†…å®¹è¿˜ä¸å­˜åœ¨çš„è¯ï¼Œä½ éœ€è¦è®¾ç½®<span>exists[index] = 1</span>ï¼Œå¹¶è®¾ç½®<span>sequence[index]</span>æ¥åŒ¹é…ä½ æ­£åœ¨å¤„ç†çš„æ•°æ®åŒ…ï¼Œå¹¶æŠŠè¿™ä¸ªåˆ†åŒ…å‚¨å­˜åœ¨åºå·ç¼“å†²åŒºå¯¹åº”çš„æ¡ç›®é‡Œé¢ã€‚è¿™æ ·å½“ä¸‹ä¸€æ¬¡æœ‰åˆ†åŒ…å®é™…åˆ°è¾¾çš„æ—¶å€™ï¼Œä½ ä¼šå¾—åˆ°ç›¸åŒçš„åºå·ï¼Œç„¶åå¾—åˆ°ä¸€ä¸ªç›¸å½“çš„ç´¢å¼•ï¼Œåœ¨æŸ¥æ‰¾çš„æ—¶å€™ä¼šå‘ç°å¯¹åº”è¿™ä¸ªç´¢å¼•çš„å†…å®¹å·²ç»å­˜åœ¨äº†ï¼Œå¹¶ä¸”è¿™ä¸ªæ¡ç›®çš„åºå·æ­£å¥½èƒ½å’Œåˆšåˆšæ¥æ”¶åˆ°çš„æ•°æ®åŒ…çš„åºå·åŒ¹é…ï¼Œæ‰€ä»¥ä½ å°±å¯ä»¥æŠŠè¿™ä¸ªåˆ†åŒ…ç´¯åŠ åˆ°è¿™ä¸ªæ¡ç›®ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´é‡å¤ç›´åˆ°è¿™ä¸ªæ•°æ®åŒ…çš„æ‰€æœ‰åˆ†åŒ…éƒ½è¢«æ¥æ”¶åˆ°ä¸ºæ­¢ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">å¦‚æœä»æ¯”è¾ƒæŠ½è±¡çš„å±‚æ¬¡æ¥è§£é‡Šè¿™ä¸ªäº‹æƒ…çš„è¯ï¼ŒåŸºæœ¬åŸç†å¤§æ¦‚å°±æ˜¯è¿™æ ·çš„ã€‚è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªæ›´å®Œæ•´çš„è§£é‡Šè¯·å‚é˜…æœ¬æ–‡çš„ç¤ºä¾‹æºä»£ç ã€‚åœ¨åœ°å€<span><a href="https://www.patreon.com/gafferongames" target="_blank" rel="noopener">https://www.patreon.com/gafferongames</a></span>å¯ä»¥è·å–æœ¬ç³»åˆ—æ–‡ç« ç¤ºä¾‹çš„æºä»£ç ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="ç½‘ç»œåè®®çš„æµ‹è¯•é©±åŠ¨å¼€å‘"><span style="color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;font-size:x-large;">ç½‘ç»œåè®®çš„æµ‹è¯•é©±åŠ¨å¼€å‘</span></span></h2><p></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿˜æœ‰ä¸€ä»¶äº‹æƒ…æˆ‘æƒ³åœ¨æ–‡ç« çš„æœ«å°¾è¿›è¡Œè¡¥å……è¯´æ˜ã€‚æˆ‘æ„Ÿè§‰å¦‚æœæˆ‘ä¸å‘æˆ‘çš„è¯»è€…æåŠè¿™ä¸ªæ–¹æ³•çš„è¯ï¼Œå°±æ˜¯å¯¹ä»–ä»¬çš„ä¸€ä¸ªä¼¤å®³ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ç¼–å†™ä¸€ä¸ªå®šåˆ¶çš„ç½‘ç»œåè®®æ˜¯éå¸¸å›°éš¾çš„ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å¦‚æ­¤çš„è‹¦éš¾ä»¥è‡³äºæˆ‘ä»å¤´å¼€å§‹è‡³å°‘ç¼–å†™äº†<span>10</span>æ¬¡ç½‘ç»œåè®®ï¼Œä½†æ˜¯æ¯æ¬¡æˆ‘éƒ½è§‰å¾—æˆ‘åœ¨ç”¨ä¸€ç§å…¨æ–°çš„æœ‰è¶£çš„æ–¹æ³•åœ¨åšè¿™ä¸ªäº‹æƒ…ã€‚ä¹Ÿè®¸ä½ ä¼šè®¤ä¸ºæ˜¯æˆ‘åœ¨æŒ‘æˆ˜è‡ªå·±ï¼Œç”¨ä¸€äº›æ–°å¥‡çš„æ–¹æ³•æ¥å®ç°è¿™ä¸ªè¿‡ç¨‹ï¼Œä½†å…¶å®æ˜¯è¿™ä¸ªè¿‡ç¨‹å¤ªå¤æ‚äº†ï¼Œå®Œå…¨æ²¡æœ‰åŠæ³•æŒ‰ç…§é¢„æœŸçš„é‚£æ ·å†™å®Œä»£ç å°±æœŸå¾…å®ƒä»¬èƒ½å¤Ÿæ­£ç¡®çš„å·¥ä½œã€‚ä½ éœ€è¦å¯¹å†™å‡ºæ¥çš„ä»£ç è¿›è¡Œæµ‹è¯•ï¼</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">å½“ç¼–å†™åº•å±‚ç½‘ç»œåè®®å±‚çš„ä»£ç çš„æ—¶å€™ï¼Œæˆ‘çš„ç­–ç•¥æ˜¯<span>:</span></span></span></p><p style=" margin: 6pt 0cm 6pt 21pt ; ; ; ; "><span style="font-family:å¾®è½¯é›…é»‘;font-size:medium;"><span style="color: rgb(34, 34, 34);">1ã€</span><span style="color: rgb(34, 34, 34);">é˜²å¾¡æ€§ç¼–ç¨‹ã€‚åœ¨ä¸€åˆ‡å¯èƒ½çš„åœ°æ–¹è¿›è¡Œæ–­è¨€ã€‚å½“æŸäº›åœ°æ–¹å‡ºç°é”™è¯¯çš„æ—¶å€™è¿™äº›æ–­è¨€ä¼šèµ·ä½œç”¨ï¼Œå¹¶ä¸”å°†æˆä¸ºæŸ¥æ‰¾é—®é¢˜çš„é‡è¦çº¿ç´¢ã€‚</span></span></p><p style=" margin: 6pt 0cm 6pt 21pt ; ; ; ; "><span style="font-family:å¾®è½¯é›…é»‘;font-size:medium;"><span style="color: rgb(34, 34, 34);">2ã€</span><span style="color: rgb(34, 34, 34);">æ·»åŠ å‡½æ•°çš„åŠŸèƒ½æµ‹è¯•ï¼Œç¡®ä¿å®ƒä»¬æ˜¯å¦‚ä½ çš„é¢„æœŸé‚£æ ·å·¥ä½œçš„ã€‚æŠŠä½ çš„ä»£ç æ”¾åˆ°ä¸€ä¸ªå¯ä»¥è¿è¡Œå’Œæµ‹è¯•çš„ç¯å¢ƒä¸‹ï¼Œè¿™æ ·å¯ä»¥ä¸æ—¶åœ°å¯¹å®ƒä»¬è¿›è¡Œæµ‹è¯•ä»¥ä¾¿å¯ä»¥ç¡®ä¿å®ƒä¸€ç›´ä¼šåƒä½ èµ·åˆåˆ›å»ºå®ƒä»¬æ—¶å€™é‚£æ ·è‰¯å¥½çš„å·¥ä½œã€‚ä»”ç»†è€ƒè™‘æœ‰å“ªäº›æƒ…å†µéœ€è¦æ­£ç¡®çš„å¤„ç†å¹¶ç»™è¿™äº›æƒ…å†µæ·»åŠ æµ‹è¯•ã€‚</span></span></p><p style=" margin: 6pt 0cm 6pt 21pt ; ; ; ; "><span style="font-family:å¾®è½¯é›…é»‘;font-size:medium;"><span style="color: rgb(34, 34, 34);">3ã€</span><span style="color: rgb(34, 34, 34);">è™½ç„¶å‡½æ•°æµ‹è¯•éå¸¸æœ‰å¿…è¦ï¼Œä½†æ˜¯åªæ˜¯æ·»åŠ ä¸€äº›å‡½æ•°æµ‹è¯•æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚æ— è®ºå¦‚ä½•éƒ½æœ‰é‡åˆ°ä½ æ²¡æœ‰é¢„æ–™åˆ°çš„æƒ…å†µ<span>! </span>ç°åœ¨ä½ å¿…é¡»æŠŠå®ƒä»¬æ”¾åˆ°ä¸€ä¸ªçœŸå®çš„ç¯å¢ƒä¸‹çœ‹çœ‹åˆ°åº•ä¼šå‘ç”Ÿä»€ä¹ˆã€‚æˆ‘æŠŠè¿™ä¸ªç§°ä¹‹ä¸ºæµ¸æ³¡æµ‹è¯•ï¼Œå¹¶ä¸”åœ¨æˆ‘ä¹‹å‰ç¼–å†™ç½‘ç»œåè®®çš„è¿‡ç¨‹ä¸­è¿˜ä»æ¥æ²¡æœ‰è¿‡åœ¨æµ¸æ³¡æµ‹è¯•çš„è¿‡ç¨‹ä¸­æ²¡æœ‰å‘ç°é—®é¢˜çš„æƒ…å†µã€‚æµ¸æ³¡æµ‹è¯•åªæ˜¯åœ¨ä¸åœçš„å¾ªç¯ï¼Œå¹¶ä¼šéšæœºçš„åšä¸€äº›äº‹æƒ…è®©ä½ çš„ç³»ç»Ÿåœ¨å®ƒçš„ç©ºé—´ä¸­å¤„ç†ä¸€äº›æƒ…å†µï¼Œè®©æˆ‘ä»¬ä¸¾äº›ç®€å•çš„ä¾‹å­å¯¹å®ƒè¿›è¡Œä¸€äº›ç®€å•çš„è¯´æ˜ï¼Œæ¯”å¦‚è¯´æ„é€ å‡ºéšæœºé•¿åº¦çš„æ•°æ®åŒ…ï¼Œè€Œä¸”è¿™äº›æ•°æ®åŒ…æœ‰ä¸€ä¸ªéå¸¸é«˜çš„ä¸¢å¤±ç‡ï¼Œé€šè¿‡æ•°æ®åŒ…æ¨¡æ‹Ÿå™¨å‘å‡ºçš„å¤§é‡ä¹±åºå¹¶ä¸”é‡å¤çš„æ•°æ®åŒ…ç­‰ç­‰ã€‚å¦‚æœä½ çš„ç¨‹åºèƒ½å¤Ÿåœ¨ä¸€æ™šä¸Šçš„æ—¶é—´é‡Œé¢ä¸æŒ‚èµ·æˆ–è€…é‡åˆ°æ–­è¨€ï¼Œé‚£ä¹ˆå°±ç®—ä½ çš„ç¨‹åºé€šè¿‡äº†æµ¸æ³¡æµ‹è¯•ã€‚</span></span></p><p style=" margin: 6pt 0cm 6pt 21pt ; ; ; ; "><span style="font-family:å¾®è½¯é›…é»‘;font-size:medium;"><span style="color: rgb(34, 34, 34);">4ã€</span><span style="color: rgb(34, 34, 34);">å¦‚æœä½ çš„ç¨‹åºåœ¨æµ¸æ³¡æµ‹è¯•çš„è¿‡ç¨‹ä¸­å‘ç°äº†æŸäº›é—®é¢˜ã€‚ä½ å¯èƒ½éœ€è¦åœ¨ä»£ç é‡Œé¢æ·»åŠ ä¸€äº›è¯¦ç»†çš„æ—¥å¿—ä»¥ä¾¿ä¸‹æ¬¡åœ¨æµ¸æ³¡æµ‹è¯•çš„æ—¶å€™å¦‚æœé‡åˆ°äº†åŒæ ·çš„é—®é¢˜ä½ å¯ä»¥æ‰¾åˆ°å‡ºç°é—®é¢˜çš„åŸå› ã€‚ä¸€æ—¦ä½ çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œå°±å¯ä»¥åœæ­¢äº†ã€‚ä¸è¦ç«‹å³çš„ä¿®å¤è¿™ä¸ªé—®é¢˜å¹¶ä¸”å†æ¬¡è¿è¡Œæµ¸æ³¡æµ‹è¯•ã€‚è¿™ç§åšæ³•éå¸¸çš„æ„šè ¢ã€‚ç›¸åï¼Œåˆ©ç”¨å•å…ƒæµ‹è¯•æ¥ä¸åœçš„é‡ç°ä½ éœ€è¦ä¿®å¤çš„é—®é¢˜ï¼Œç¡®ä¿å•å…ƒæµ‹è¯•èƒ½å¤Ÿé‡ç°é—®é¢˜ï¼Œè€Œä¸”è¿™ä¸ªé—®é¢˜å› ä¸ºä½ çš„ä¿®å¤å·²ç»å½»åº•ä¿®å¥½äº†ã€‚åªæœ‰åœ¨è¿™æ ·çš„å¤„ç†æµç¨‹ä¹‹åï¼Œæ‰èƒ½å›åˆ°æµ¸æ³¡æµ‹è¯•å¹¶ç¡®ä¿ç¨‹åºåœ¨æµ¸æ³¡æµ‹è¯•èƒ½æ­£å¸¸è¿è½¬ä¸€æ•´å¤œã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå•å…ƒæµ‹è¯•èƒ½å¤Ÿè®°å½•ä½ çš„ç³»ç»Ÿçš„æ­£ç¡®çš„è¡Œä¸ºå¹¶ä¸”åœ¨ä»¥åéœ€è¦çš„æ—¶å€™å¯ä»¥å¿«é€Ÿçš„è¿è¡Œèµ·æ¥ï¼Œç¡®ä¿å½“ä½ åšå…¶ä»–æ”¹å˜çš„æ—¶å€™ä¸ä¼šå¯¼è‡´ä¸€äº›åŸæ¥ä¿®è¿‡çš„é—®é¢˜é‡å¤çš„å‡ºç°ã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¿™å°±æ˜¯æˆ‘çš„æ•°æ®åŒ…åˆ†åŒ…å’Œé‡ç»„çš„å¤„ç†æµç¨‹äº†ï¼Œå®ƒä¼¼ä¹å·¥ä½œçš„ä¸é”™ã€‚å¦‚æœä½ åœ¨è¿›è¡Œä¸€äº›åº•å±‚çš„ç½‘ç»œåè®®çš„è®¾è®¡ï¼Œä½ çš„æ¸¸æˆçš„å…¶ä»–çš„éƒ¨åˆ†å°†ä¾èµ–äºåº•å±‚çš„ç½‘ç»œåè®®çš„è®¾è®¡ã€‚åœ¨ä½ ç»§ç»­æ„å»ºå…¶ä»–çš„åŠŸèƒ½ä¹‹å‰ï¼Œä½ éœ€è¦ç»å¯¹çš„ç¡®è®¤åº•å±‚çš„ç½‘ç»œåè®®æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸çš„å·¥ä½œï¼Œå¦åˆ™å°±åƒä¸€å †èƒ¡ä¹±å †ç§¯çš„å¡ç‰‡ï¼Œå¾ˆå®¹æ˜“å°±æ•£æ¶äº†ã€‚å¤šäººåœ¨çº¿æ¸¸æˆçš„ç½‘ç»œéƒ¨åˆ†æ˜¯éå¸¸å›°éš¾çš„ï¼Œå¦‚æœä¸å°å¿ƒè®¾è®¡çš„è¯ï¼Œå¾ˆå®¹æ˜“å°±ä¼šå‡ºç°åº•å±‚ç½‘ç»œåè®®å¯èƒ½æ— æ³•æ­£å¸¸çš„å·¥ä½œæˆ–è€…å­˜åœ¨ç¼ºé™·ã€‚æ‰€ä»¥è¯·ç¡®ä¿ä½ æ˜¯çŸ¥é“ä½ çš„åº•å±‚ç½‘ç»œåè®®æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼</span></span></p><b><span style="font-size: 12pt; line-height: 156%; font-weight: normal;"><span style="font-family:å¾®è½¯é›…é»‘;">å³å°†åˆ°æ¥çš„æ–‡ç« çš„é¢„å‘Š</span></span></b><div><span style="font-size: 12pt; line-height: 156%; font-weight: normal;"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ä¸‹ä¸€ç¯‡æ–‡ç« æ˜¯<span>: </span>ã€Šå‘é€å¤§å—çš„æ•°æ®ã€‹</span></span></p><p class="MsoNormal" align="left" style="line-height: 18pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">è¯·ç»§ç»­é˜…è¯»æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œåœ¨å“ªç¯‡æ–‡ç« é‡Œé¢æˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•é€šè¿‡æ•°æ®åŒ…å¿«é€Ÿå¯ä¿¡èµ–çš„å‘é€å¤§å—çš„æ•°æ®ï¼Œå¦‚æœå…¶ä¸­ä¸€å—æ•°æ®ä¸¢å¤±äº†ä¹Ÿä¸éœ€è¦ä¸¢å¼ƒæ•´ä¸ªæ•°æ®åŒ…ï¼</span></span></p><p class="MsoNormal" align="left" style="line-height: 18pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ä»·å€¼çš„è¯ï¼Œè¯·åœ¨<span>patreon</span>ä¸Šæ”¯æŒæˆ‘çš„å†™ä½œï¼Œè¿™æ ·æˆ‘ä¼šå†™çš„æ›´å¿«ã€‚ä½ å¯ä»¥åœ¨<span>BSD 3.0</span>è®¸å¯ä¸‹è®¿é—®åˆ°è¿™ç¯‡æ–‡ç« é‡Œé¢çš„ä»£ç ã€‚éå¸¸æ„Ÿè°¢ä½ çš„æ”¯æŒï¼</span></span></p><p class="MsoNormal" align="left" style="line-height: 18pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"><br></span></span></p><p class="MsoNormal" align="left" style="line-height: 18pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">ã€ç‰ˆæƒå£°æ˜ã€‘</span></span></p><p class="MsoNormal"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;">åŸæ–‡ä½œè€…æœªåšæƒåˆ©å£°æ˜ï¼Œè§†ä¸ºå…±äº«çŸ¥è¯†äº§æƒè¿›å…¥å…¬å…±é¢†åŸŸï¼Œè‡ªåŠ¨è·å¾—æˆæƒã€‚</span></span></p><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(34, 34, 34);"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span></p><p class="MsoNormal"><span style="font-size: 12pt;"><span style="font-family:å¾®è½¯é›…é»‘;"> </span></span></p></div>                    <br>                

      


      

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/GafferOnGames/" rel="tag"><i class="fa fa-tag"></i> GafferOnGames</a>
            
          </div>
        

        
        
        

        
          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/serialization_strategies/" rel="next" title="æ„å»ºæ¸¸æˆç½‘ç»œåè®®äºŒä¹‹åºåˆ—åŒ–ç­–ç•¥">
                  <i class="fa fa-chevron-left"></i> 
                  <p class="post-nav-pre-next-title">
                    æ„å»ºæ¸¸æˆç½‘ç»œåè®®äºŒä¹‹åºåˆ—åŒ–ç­–ç•¥
                  </p> 
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/sending_large_blocks_of_data/" rel="prev" title="æ„å»ºæ¸¸æˆç½‘ç»œåè®®å››ä¹‹å‘é€å¤§å—æ•°æ®">
                <p class="post-nav-pre-next-title">
                    æ„å»ºæ¸¸æˆç½‘ç»œåè®®å››ä¹‹å‘é€å¤§å—æ•°æ®
                </p> 
                <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        

        
        
      </footer>
      
    </div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  

  <aside id="sidebar" class="sidebar">

    
      
        <div id="sidebar-dimmer"></div>
      
    

    <div class="sidebar-inner">
    
      <div class="sidebar-toggle-inside motion-element">
        <div class="sidebar-toggle-line-wrap">
          <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
          <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
          <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
        </div>
      </div>

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a href="/" class="site-author-image" rel="start" style="border:none">
            <img class="site-author-image" itemprop="image" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/uploads/avatar.png" alt="Mike">
          </a>
          <p class="site-author-name" itemprop="name">Mike</p>
           
              <p class="site-description motion-element" itemprop="description">ğŸš™ ğŸš— ğŸ’¨ ğŸ’¨ If you want to create a blog like this, just follow my open-source project, "hexo-theme-neo", click the GitHub button below and check it out ^_^ . It is recommended to use Chrome, Safari, or Edge to read this blog since this blog was developed on Edge (Chromium kernel version) and tested on Safari.</p>
          
        </div>

        <nav class="site-state motion-element">

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">298</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">111</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

          <div class="site-state-item site-state-about">
            <a href="/about/">
              <span class="site-state-item-about fa fa-fw fa-user"></span>
              <span class="site-state-item-name">about</span>
            </a>
          </div>
          
        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/no5ix" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://open.spotify.com/user/313duq77ekebrfyak3xijqewzss4?si=e7653b829a9747bf" target="_blank" title="Spotify">
                  
                    <i class="fa fa-fw fa-spotify"></i>
                  
                    
                      Spotify
                    
                </a>
              </span>
            
          
          
          <!-- ç½‘æ˜“äº‘éŸ³ä¹ -->
            <!-- <div class="netease-cloud-music"> -->
              <!-- <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=280 height=110 src="//music.163.com/outchain/player?type=0&id=992743594&auto=0&height=90"></iframe> -->
            <!-- </div> -->
          <!-- ç½‘æ˜“äº‘éŸ³ä¹ -->

        </div>

        
        

        
        

        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"><span class="nav-text">æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿ"><span class="nav-text">ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ¬ç¯‡åŸºæœ¬æœ¯è¯­"><span class="nav-text">æœ¬ç¯‡åŸºæœ¬æœ¯è¯­</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆ†åŒ…çš„æ•°æ®ç»“æ„"><span class="nav-text">åˆ†åŒ…çš„æ•°æ®ç»“æ„</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‘é€åˆ†åŒ…åçš„æ•°æ®åŒ…"><span class="nav-text">å‘é€åˆ†åŒ…åçš„æ•°æ®åŒ…</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿå‘¢"><span class="nav-text">ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªåˆ†åŒ…å’Œé‡ç»„ç³»ç»Ÿå‘¢</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ¥æ”¶åˆ†åŒ…åçš„æ•°æ®åŒ…"><span class="nav-text">æ¥æ”¶åˆ†åŒ…åçš„æ•°æ®åŒ…</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#åŸæ–‡"><span class="nav-text">åŸæ–‡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#introduction"><span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#background"><span class="nav-text">Background</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mtu-in-the-real-world"><span class="nav-text">MTU in the real world</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fragment-packet-structure"><span class="nav-text">Fragment Packet Structure</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sending-packet-fragments"><span class="nav-text">Sending Packet Fragments</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#receiving-packet-fragments"><span class="nav-text">Receiving Packet Fragments</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#data-structure-on-receiver-side"><span class="nav-text">Data Structure on Receiver Side</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#test-driven-development"><span class="nav-text">Test Driven Development</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#è¯‘æ–‡"><span class="nav-text">è¯‘æ–‡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ€å¤§ä¼ è¾“å•å…ƒMTU"><span class="nav-text">æœ€å¤§ä¼ è¾“å•å…ƒMTU</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#çœŸå®ä¸–ç•Œä¸­çš„æœ€å¤§ä¼ è¾“å•å…ƒMTU"><span class="nav-text">çœŸå®ä¸–ç•Œä¸­çš„æœ€å¤§ä¼ è¾“å•å…ƒMTU</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆ†åŒ…åçš„æ•°æ®åŒ…çš„ç»“æ„"><span class="nav-text">åˆ†åŒ…åçš„æ•°æ®åŒ…çš„ç»“æ„</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‘é€åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…"><span class="nav-text">å‘é€åˆ†åŒ…ä»¥åçš„æ•°æ®åŒ…</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¯¹åˆ†åŒ…åçš„æ•°æ®åŒ…çš„æ¥æ”¶"><span class="nav-text">å¯¹åˆ†åŒ…åçš„æ•°æ®åŒ…çš„æ¥æ”¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç½‘ç»œåè®®çš„æµ‹è¯•é©±åŠ¨å¼€å‘"><span class="nav-text">ç½‘ç»œåè®®çš„æµ‹è¯•é©±åŠ¨å¼€å‘</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mike</span>
</div>



        

        
      </div>
    </footer>

    <!--
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      
        <span id="scrollpercent"><span>0</span>%</span>
      
    </div>
    -->

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>










  















  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/mediumzoom/medium-zoom.js?v=1.1.0"></script>





  




  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>


  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

    <script src="/js/src/local-search.js"></script>





  

  

  

  

  

  


  <script type="text/javascript" src="/lib/wobble_window/wobblewindow.js"> </script>
<script type="text/javascript" src="/js/src/custom.js"></script>
</body>
</html>






<script type="text/javascript" src="/js/src/headroom.js"></script>

<!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½ -->
<script type="text/javascript" src="/js/src/code-highlight-modification.js"></script>

<!-- Flashcards Script -->
<script type="text/javascript" src="/js/src/flashcards.js"></script>
