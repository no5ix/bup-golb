<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


  <meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">

<script>
    (function(){
        if('mmp'){
            let localStoragePasswdKey = 'Twitter Clone backend notes' + '_last_passwd';
            let tryCnt = 0;
            function checkPassword(password) {
                password = password == null ? null : password.trim();
                if (password !== 'mmp') {
                    if (password != null) {
                        // å¦‚æœç”¨æˆ·ç‚¹å‡»äº†ç¡®è®¤è€Œä¸”å¯†ç é”™è¯¯çš„æ—¶å€™, å› ä¸ºå½“password == nullçš„æ—¶å€™è¯´æ˜ç”¨æˆ·ç‚¹äº†å–æ¶ˆ
                        alert('Error!');
                        if (++tryCnt < 3) {
                            password = prompt('Open Sesame');
                            checkPassword(password);
                            return;
                        }
                    }

                    // if (history.length > 1) {
                    //     alert('back!');
                    //     history.back();
                    // } else {
                        // alert('blankkkk!');
                    //     window.location.href = "about:blank";
                    // }
                    if (document.referrer) {
                        window.location.href = document.referrer;
                    } else {
                        window.location.href = "about:blank";; // fallback if no referrer
                    }

                } else {
                    localStorage.setItem(localStoragePasswdKey, password);
                }
            }

            var password_verify_on_local = false;
            const hostname = window.location.hostname;
            if (password_verify_on_local || (!(hostname === "localhost" || hostname === "127.0.0.1" || hostname === "::1" || hostname.startsWith("192")))) {
                const lspk = localStorage.getItem(localStoragePasswdKey) || "";
                if (lspk !== 'mmp') {
                    var password = prompt('Open Sesame');
                    checkPassword(password);
                }
            }
        }
    })();
</script>








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">





















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="GitHub,noodle,Java,NA,">








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2">






<meta name="description" content="Twitter Clone frontend notes Project URLhttps://github.com/merikbest/twitter-spring-reactjs æ­£ç¡®çš„å®‰è£…å’Œå¯åŠ¨æ–¹æ³•åŸä½œè€…å¾ˆæ‡’, æ²¡å†™æ¸…æ¥š, æ‰€ä»¥æˆ‘æ¥å†™ Installation Install maven: link Install Java: link Install Postgresql: link In">
<meta name="keywords" content="GitHub,noodle,Java,NA">
<meta property="og:type" content="article">
<meta property="og:title" content="Twitter Clone backend notes">
<meta property="og:url" content="https://hulinhong.com/twitter_clone_backend_notes/index.html">
<meta property="og:site_name" content="ğŸš™">
<meta property="og:description" content="Twitter Clone frontend notes Project URLhttps://github.com/merikbest/twitter-spring-reactjs æ­£ç¡®çš„å®‰è£…å’Œå¯åŠ¨æ–¹æ³•åŸä½œè€…å¾ˆæ‡’, æ²¡å†™æ¸…æ¥š, æ‰€ä»¥æˆ‘æ¥å†™ Installation Install maven: link Install Java: link Install Postgresql: link In">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2025-12-17T18:31:29.679Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Twitter Clone backend notes">
<meta name="twitter:description" content="Twitter Clone frontend notes Project URLhttps://github.com/merikbest/twitter-spring-reactjs æ­£ç¡®çš„å®‰è£…å’Œå¯åŠ¨æ–¹æ³•åŸä½œè€…å¾ˆæ‡’, æ²¡å†™æ¸…æ¥š, æ‰€ä»¥æˆ‘æ¥å†™ Installation Install maven: link Install Java: link Install Postgresql: link In">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":12,"scrollpercent":true,"onmobile":true,"dimmer":true,"body_content_height":0,"display_duration":150},
    local_search: {"enable":true,"trigger":"auto","top_n_per_article":1},
    fancybox: false,
    mediumzoom: true,
    darkmode_js: false,
    tabs: true,
    motion: {"enable":true,"async":false,"duration":188,"transition":{"header":"fadeIn","menu":"fadeIn","logo":"fadeIn","post_block_else":"fadeIn","post_header":"fadeIn","post_body":"fadeIn","coll_header":"fadeIn","footer":"fadeIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>








  <title>Twitter Clone backend notes | ğŸš™</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ğŸš™</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ğŸ’¨ ğŸ’¨ ğŸ’¨</p>
      
  </div>

  <div class="menu-item sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div class="menu-item site-search">
    
  
  <div class="site-search-div">
    <button class="search-icon" id="search-button">
      <i class="fa fa-search"></i>
    </button>
    <input type="text" id="local-search-input" class="st-search-input">
    <i id="local-search-close">Ã—</i>
  </div>


<script type="text/javascript" id="local.search.active">
    {/* var inputArea       = document.querySelector("#local-search-input");
    inputArea.onclick   = function(){ getSearchFile(); this.focus(); }
    inputArea.onkeydown = function(){ if(event.keyCode == 13) return false } */}
</script>



  </div>
  <div id="local-search-result-pc" class="local-search-result-cls"></div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

       
    </ul>
  

  
    
  
</nav>



 </div>
    </header>

    <div id="local-search-result-mobile" class="local-search-result-cls"></div>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/twitter_clone_backend_notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Twitter Clone backend notes</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2025-04-15T03:05:08+00:00">
                04-15-2025
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Noodle/" itemprop="url" rel="index">
                    <span itemprop="name">Noodle</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            <div class="post-tags">
              
                <a href="/tags/GitHub/" rel="tag"><i class="fa fa-tag"></i> GitHub</a>
              
                <a href="/tags/noodle/" rel="tag"><i class="fa fa-tag"></i> noodle</a>
              
                <a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a>
              
                <a href="/tags/NA/" rel="tag"><i class="fa fa-tag"></i> NA</a>
              
            </div>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/na_c2g/" rel="next" title="C2G">
                <i class="fa fa-chevron-left"></i> 
                <p class="post-nav-pre-next-title">
                  C2G
                </p> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/twitter_clone_frontend_notes/" rel="prev" title="Twitter Clone frontend notes">
              <p class="post-nav-pre-next-title">
                  Twitter Clone frontend notes
              </p> 
              <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      

      
      

      
        <a href="/twitter_clone_frontend_notes/" title="Twitter Clone frontend notes">Twitter Clone frontend notes</a>
<h1 id="Project-URL"><a href="#Project-URL" class="headerlink" title="Project URL"></a>Project URL</h1><p><a href="https://github.com/merikbest/twitter-spring-reactjs" target="_blank" rel="noopener">https://github.com/merikbest/twitter-spring-reactjs</a></p>
<h1 id="æ­£ç¡®çš„å®‰è£…å’Œå¯åŠ¨æ–¹æ³•"><a href="#æ­£ç¡®çš„å®‰è£…å’Œå¯åŠ¨æ–¹æ³•" class="headerlink" title="æ­£ç¡®çš„å®‰è£…å’Œå¯åŠ¨æ–¹æ³•"></a>æ­£ç¡®çš„å®‰è£…å’Œå¯åŠ¨æ–¹æ³•</h1><p>åŸä½œè€…å¾ˆæ‡’, æ²¡å†™æ¸…æ¥š, æ‰€ä»¥æˆ‘æ¥å†™</p>
<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><ol>
<li>Install maven: <a href="https://www.baeldung.com/install-maven-on-windows-linux-mac" target="_blank" rel="noopener">link</a></li>
<li>Install Java: <a href="https://www.oracle.com/java/technologies/javase/jdk15-archive-downloads.html" target="_blank" rel="noopener">link</a></li>
<li>Install Postgresql: <a href="https://www.postgresql.org/download/" target="_blank" rel="noopener">link</a></li>
<li>Install Intellij IDEA Ultimate: <a href="https://www.jetbrains.com/idea/" target="_blank" rel="noopener">link</a></li>
<li>Install Docker and Docker Desktop</li>
<li>Add Lombok plugin to the Intellij IDEA: <a href="https://i.ibb.co/Gtwcw0t/6-lombok.jpg" target="_blank" rel="noopener">link</a></li>
<li>Make sure Java 17 is selected: <a href="https://i.ibb.co/8PVGDdm/7-Java-17.png" target="_blank" rel="noopener">link</a></li>
<li>Build the project with Maven: <a href="https://i.ibb.co/qr4w7F4/8-Maven-build.pngg" target="_blank" rel="noopener">link</a></li>
<li>Sign up for a new AWS account: <a href="https://portal.aws.amazon.com/billing/signup#/start" target="_blank" rel="noopener">link</a></li>
<li>Create a new AWS S3 bucket: <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-overview.html" target="_blank" rel="noopener">link</a></li>
<li>Change access from private to public in the AWS S3 bucket</li>
<li>Add a public access policy to the AWS S3 bucket (!!!important!!! see:<br><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-policy-language-overview.html" target="_blank" rel="noopener">doc</a>,<br><a href="https://stackoverflow.com/questions/58580042/how-to-set-public-read-only-access-on-amazon-s3-bucket#:~:text=To%20make%20objects%20publicly%20accessible%2C%20use%20a%20policy%20like%20this%3A" target="_blank" rel="noopener">github examle</a> or<br><a href="https://i.ibb.co/mSpHmyL/12-bucket.jpg" target="_blank" rel="noopener">my example</a>)</li>
<li>Get AWS keys: <a href="https://supsystic.com/documentation/id-secret-access-key-amazon-s3/" target="_blank" rel="noopener">link</a> and add to the application.properties file: <a href="https://i.ibb.co/zHw537K/13-key.jpg" target="_blank" rel="noopener">link</a></li>
<li>In the <a href="https://github.com/merikbest/twitter-spring-reactjs/blob/391ddc666a79057615322898ea2715f1178fdb03/config-server/src/main/resources/config/image-service.yml#L13" target="_blank" rel="noopener">image-service.yml config file</a> add bucket, access-key, secret-key properties</li>
<li>Sign up for gmail</li>
<li>Create google API keys: <a href="https://developers.google.com/youtube/v3/getting-started#before-you-start" target="_blank" rel="noopener">link</a></li>
<li>Add google API key to the <a href="https://github.com/merikbest/twitter-spring-reactjs/blob/391ddc666a79057615322898ea2715f1178fdb03/config-server/src/main/resources/config/tweet-service.yml#L27" target="_blank" rel="noopener">tweet-service.yml config file</a></li>
<li>Add gmail account and password to the <a href="https://github.com/merikbest/twitter-spring-reactjs/blob/391ddc666a79057615322898ea2715f1178fdb03/config-server/src/main/resources/config/email-service.yml#L11" target="_blank" rel="noopener">email-service.yml config file</a></li>
<li>Go to <a href="https://myaccount.google.com/u/2/lesssecureapps" target="_blank" rel="noopener">link</a> (important) and change to: â€œAllow less secure apps: ONâ€</li>
</ol>
<h2 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h2><ol>
<li>(<strong>only for the first time</strong>) run <code>docker compose up --build</code></li>
<li>run these services on your Docker Desktop: <code>postgres</code>, <code>pgadmin</code>, <code>zipkin</code>, <code>rabbitmq</code>, <code>zookeeper</code>, <code>broker</code>(kafka) <a href="https://i.ibb.co/tCCXJLk/9-Docker-Desktop.png" target="_blank" rel="noopener">link</a></li>
<li>(<strong>only for the first time</strong>) Open <a href="http://localhost:5050/browser/" target="_blank" rel="noopener">http://localhost:5050/browser/</a> and create DBs: <code>user</code>, <code>tweet</code>, <code>chat</code>, <code>lists</code>, <code>notification</code>, <code>tag</code>, <code>topic</code>, <code>scheduler</code>, <code>localization</code></li>
<li>Run services in this order:<ul>
<li>eureka-server</li>
<li>config-server</li>
<li>api-gateway</li>
<li>user-service</li>
<li>and then all other services in any order <a href="https://i.ibb.co/jRhYMd9/24-microservices-run.png" target="_blank" rel="noopener">link</a></li>
</ul>
</li>
<li>Open terminal in frontend directory and run these commands step by step:<ol>
<li><code>cd ./frontend/</code></li>
<li><code>nvm install v16.16.0</code></li>
<li><code>nvm alias default 16.16.0</code></li>
<li><code>nvm use 16.16.0</code></li>
<li><code>npm install -g npm@8.17.0</code></li>
<li><code>node -v</code></li>
<li><code>npm -v</code></li>
<li><code>npm config set legacy-peer-deps true</code></li>
<li><code>npm uninstall node-sass</code></li>
<li><code>npm install sass</code></li>
<li><code>rm -rf node_modules package-lock.json</code></li>
<li><code>npm install --legacy-peer-deps</code></li>
<li><code>npm list ajv</code></li>
<li><code>npm install ajv@^8 ajv-keywords</code></li>
<li><code>npm list ajv</code></li>
</ol>
</li>
<li>Open terminal in frontend directory and type: <code>npm start</code>, then â€œ<strong>Wait</strong> almost <strong>a</strong> minute <strong>for</strong> its <strong>boot-up</strong>.â€ ç­‰å·®ä¸å¤šä¸€åˆ†é’Ÿè®©å®ƒå¯åŠ¨ã€‚</li>
<li>Navigate to <a href="http://localhost:3000/home" target="_blank" rel="noopener">http://localhost:3000/home</a></li>
</ol>
<h2 id="To-enter-the-application-you-can-register-or-login"><a href="#To-enter-the-application-you-can-register-or-login" class="headerlink" title="To enter the application you can register or login:"></a>To enter the application you can register or login:</h2><ul>
<li>Login: <code>user2016@gmail.com</code>  </li>
<li>Password: <code>qwerty123</code></li>
</ul>
<h1 id="é¡¹ç›®é‡Œä½¿ç”¨äº†å“ªäº›SpringCloudçš„ä¸œè¥¿"><a href="#é¡¹ç›®é‡Œä½¿ç”¨äº†å“ªäº›SpringCloudçš„ä¸œè¥¿" class="headerlink" title="é¡¹ç›®é‡Œä½¿ç”¨äº†å“ªäº›SpringCloudçš„ä¸œè¥¿"></a>é¡¹ç›®é‡Œä½¿ç”¨äº†å“ªäº›SpringCloudçš„ä¸œè¥¿</h1><p>ä½ çœ‹<code>pom.xml</code>é‡Œå¦‚æœæœ‰ç±»ä¼¼äºå¼•å…¥<code>spring-cloud</code>å¼€å¤´çš„ä¾èµ–å°±æ˜¯ç”¨åˆ°äº†SpringCloudçš„ä¸œè¥¿<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="1-Spring-Cloud-OpenFeign"><a href="#1-Spring-Cloud-OpenFeign" class="headerlink" title="1. Spring Cloud OpenFeign"></a>1. Spring Cloud OpenFeign</h2><p>åœ¨è¿™ä¸ª Twitter å…‹éš†é¡¹ç›®é‡Œï¼ŒSpring Cloud æä¾›äº†ä¸€ç³»åˆ—ç»„ä»¶ï¼Œä¸ºæ„å»ºå¾®æœåŠ¡æ¶æ„æä¾›äº†å¼ºå¤§çš„æ”¯æŒã€‚ç»“åˆä»£ç ç‰‡æ®µå’Œ <code>README.md</code> æ–‡ä»¶ï¼Œé¡¹ç›®ä¸­æ¶‰åŠçš„ Spring Cloud ç›¸å…³ç»„ä»¶å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šSpring Cloud OpenFeign æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„ HTTP å®¢æˆ·ç«¯ï¼Œå®ƒä½¿å¾—ç¼–å†™ Web æœåŠ¡å®¢æˆ·ç«¯å˜å¾—æ›´åŠ ç®€å•ã€‚é€šè¿‡å®šä¹‰æ¥å£å’Œä½¿ç”¨æ³¨è§£ï¼Œå°±å¯ä»¥è½»æ¾åœ°è°ƒç”¨å…¶ä»–å¾®æœåŠ¡çš„ RESTful APIã€‚</li>
<li><strong>ä»£ç ä½“ç°</strong>ï¼šå¤šä¸ªæœåŠ¡çš„ä¸»ç±»ä¸Šéƒ½æ·»åŠ äº† <code>@EnableFeignClients</code> æ³¨è§£ï¼Œå¯ç”¨äº† Feign å®¢æˆ·ç«¯åŠŸèƒ½ã€‚<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// twitter-spring-reactjs/user-service/src/main/java/com/gmail/merikbest2015/UserServiceApplication.java</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(UserServiceApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="2-Spring-Cloud-Circuit-Breaker-Resilience4j"><a href="#2-Spring-Cloud-Circuit-Breaker-Resilience4j" class="headerlink" title="2. Spring Cloud Circuit Breaker (Resilience4j)"></a>2. Spring Cloud Circuit Breaker (Resilience4j)</h2><ul>
<li><strong>åŠŸèƒ½</strong>ï¼šSpring Cloud Circuit Breaker æ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œç”¨äºåœ¨å¾®æœåŠ¡ä¹‹é—´å®ç°ç†”æ–­ã€é™æµç­‰å®¹é”™æœºåˆ¶ã€‚Resilience4j æ˜¯å…¶ä¸­ä¸€ç§å…·ä½“çš„å®ç°ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¾®æœåŠ¡åœ¨å‡ºç°æ•…éšœæ—¶å¿«é€Ÿå¤±è´¥ï¼Œé¿å…çº§è”æ•…éšœã€‚</li>
<li><strong>ä»£ç ä½“ç°</strong>ï¼šåœ¨å¤šä¸ªæœåŠ¡çš„ <code>pom.xml</code> æ–‡ä»¶ä¸­å¼•å…¥äº† <code>spring-cloud-starter-circuitbreaker-resilience4j</code> ä¾èµ–ã€‚<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- twitter-spring-reactjs/tag-service/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-circuitbreaker-resilience4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>åŒæ—¶ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†ç†”æ–­å®ä¾‹çš„å‚æ•°ï¼Œä¾‹å¦‚ <code>resilience4j.circuitbreaker.instances</code>ã€‚<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># twitter-spring-reactjs/config-server/src/main/resources/config/topic-service.yml</span></span><br><span class="line"><span class="attr">resilience4j:</span></span><br><span class="line"><span class="attr">    circuitbreaker:</span></span><br><span class="line"><span class="attr">        instances:</span></span><br><span class="line"><span class="attr">            user-service:</span></span><br><span class="line"><span class="attr">                minimum-number-of-calls:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<h2 id="3-Spring-Cloud-Config"><a href="#3-Spring-Cloud-Config" class="headerlink" title="3. Spring Cloud Config"></a>3. Spring Cloud Config</h2><ul>
<li><strong>åŠŸèƒ½</strong>ï¼šSpring Cloud Config ä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„åº”ç”¨æä¾›äº†é›†ä¸­åŒ–çš„å¤–éƒ¨é…ç½®æ”¯æŒã€‚å®ƒå…è®¸å¼€å‘è€…å°†é…ç½®æ–‡ä»¶å­˜å‚¨åœ¨è¿œç¨‹ä»“åº“ï¼ˆå¦‚ Gitï¼‰ä¸­ï¼Œå„ä¸ªå¾®æœåŠ¡å¯ä»¥ä»é…ç½®æœåŠ¡å™¨è·å–é…ç½®ä¿¡æ¯ï¼Œå®ç°é…ç½®çš„ç»Ÿä¸€ç®¡ç†å’ŒåŠ¨æ€æ›´æ–°ã€‚</li>
<li><strong>ä»£ç ä½“ç°</strong>ï¼šå„ä¸ªæœåŠ¡çš„ <code>bootstrap.yml</code> æ–‡ä»¶ä¸­éƒ½é…ç½®äº†é…ç½®æœåŠ¡å™¨çš„åœ°å€ã€‚<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># twitter-spring-reactjs/tweet-service/src/main/resources/bootstrap.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">    application:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">tweet-service</span></span><br><span class="line"><span class="attr">    cloud:</span></span><br><span class="line"><span class="attr">        config:</span></span><br><span class="line"><span class="attr">            uri:</span> <span class="attr">http://$&#123;CONFIG_SERVER_HOST:localhost&#125;:8888/</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>é…ç½®æœåŠ¡å™¨çš„ä¸»ç±»æ·»åŠ äº† <code>@EnableConfigServer</code> æ³¨è§£ï¼Œå¯ç”¨äº†é…ç½®æœåŠ¡å™¨åŠŸèƒ½ã€‚<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// twitter-spring-reactjs/config-server/src/main/java/com/gmail/merikbest2015/ConfigServerApplication.java</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigServerApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ConfigServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="4-Spring-Cloud-Netflix-Eureka"><a href="#4-Spring-Cloud-Netflix-Eureka" class="headerlink" title="4. Spring Cloud Netflix Eureka"></a>4. Spring Cloud Netflix Eureka</h2><ul>
<li><strong>åŠŸèƒ½</strong>ï¼šSpring Cloud Netflix Eureka æ˜¯ä¸€ä¸ªæœåŠ¡å‘ç°ç»„ä»¶ï¼Œå®ƒæä¾›äº†æœåŠ¡æ³¨å†Œå’Œå‘ç°çš„åŠŸèƒ½ã€‚å¾®æœåŠ¡å¯ä»¥å°†è‡ªå·±æ³¨å†Œåˆ° Eureka æœåŠ¡å™¨ï¼Œå…¶ä»–å¾®æœåŠ¡å¯ä»¥ä» Eureka æœåŠ¡å™¨è·å–æœåŠ¡åˆ—è¡¨ï¼Œå®ç°æœåŠ¡ä¹‹é—´çš„è°ƒç”¨ã€‚</li>
<li><strong>ä»£ç ä½“ç°</strong>ï¼šEureka æœåŠ¡å™¨çš„ä¸»ç±»æ·»åŠ äº† <code>@EnableEurekaServer</code> æ³¨è§£ï¼Œå¯ç”¨äº† Eureka æœåŠ¡å™¨åŠŸèƒ½ã€‚<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// twitter-spring-reactjs/eureka-server/src/main/java/com/gmail/merikbest2015/EurekaServerApplication.java</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaServerApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EurekaServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>å„ä¸ªæœåŠ¡çš„é…ç½®æ–‡ä»¶ä¸­éƒ½é…ç½®äº† Eureka æœåŠ¡å™¨çš„åœ°å€ï¼Œå¹¶è®¾ç½®äº†æ˜¯å¦æ³¨å†Œå’Œè·å–æœåŠ¡åˆ—è¡¨çš„å‚æ•°ã€‚<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># twitter-spring-reactjs/config-server/src/main/resources/config/topic-service.yml</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">    client:</span></span><br><span class="line"><span class="attr">        service-url:</span></span><br><span class="line"><span class="attr">            defaultZone:</span> <span class="attr">http://$&#123;EUREKA_HOST:localhost&#125;:8761/eureka</span></span><br><span class="line"><span class="attr">        fetch-registry:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">        register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    instance:</span></span><br><span class="line"><span class="attr">        hostname:</span> <span class="string">$&#123;EUREKA_HOST:localhost&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="5-Spring-Cloud-Gateway"><a href="#5-Spring-Cloud-Gateway" class="headerlink" title="5. Spring Cloud Gateway"></a>5. Spring Cloud Gateway</h2><ul>
<li><strong>åŠŸèƒ½</strong>ï¼šSpring Cloud Gateway æ˜¯ä¸€ä¸ªåŸºäº Spring WebFlux çš„ API ç½‘å…³ï¼Œå®ƒæä¾›äº†è·¯ç”±ã€è¿‡æ»¤ç­‰åŠŸèƒ½ã€‚å¯ä»¥å°†å®¢æˆ·ç«¯çš„è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„å¾®æœåŠ¡ï¼Œå¹¶å¯¹è¯·æ±‚è¿›è¡Œé¢„å¤„ç†å’Œåå¤„ç†ã€‚</li>
<li><strong>ä»£ç ä½“ç°</strong>ï¼šAPI ç½‘å…³æœåŠ¡çš„ä¸»ç±»æ’é™¤äº†æ•°æ®æºè‡ªåŠ¨é…ç½®ï¼Œå¹¶å¯ç”¨äº† Feign å®¢æˆ·ç«¯ã€‚<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// twitter-spring-reactjs/api-gateway/src/main/java/com/gmail/merikbest2015/ApiGatewayApplication.java</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span>(exclude = &#123;DataSourceAutoConfiguration.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiGatewayApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ApiGatewayApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>åŒæ—¶ï¼Œè¿˜é…ç½®äº† WebSocket ç›¸å…³çš„ Beanï¼Œä»¥æ”¯æŒ WebSocket é€šä¿¡ã€‚<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// twitter-spring-reactjs/api-gateway/src/main/java/com/gmail/merikbest2015/configuration/WebSocketConfig.java</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RequestUpgradeStrategy <span class="title">requestUpgradeStrategy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TomcatRequestUpgradeStrategy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function">WebSocketClient <span class="title">tomcatWebSocketClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TomcatWebSocketClient();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨çš„ Spring Cloud ç»„ä»¶åŒ…æ‹¬ OpenFeignã€Circuit Breakerã€Configã€Eureka å’Œ Gatewayï¼Œå®ƒä»¬å…±åŒæ„æˆäº†ä¸€ä¸ªå®Œæ•´çš„å¾®æœåŠ¡æ¶æ„ï¼Œæä¾›äº†æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†ã€å®¹é”™ã€API ç½‘å…³ç­‰åŠŸèƒ½ã€‚ </p>
<h1 id="Prometheuså’ŒGrafanaå’ŒActuatorå’ŒZipkin"><a href="#Prometheuså’ŒGrafanaå’ŒActuatorå’ŒZipkin" class="headerlink" title="Prometheuså’ŒGrafanaå’ŒActuatorå’ŒZipkin"></a>Prometheuså’ŒGrafanaå’ŒActuatorå’ŒZipkin</h1><h2 id="zipkinå¦‚ä½•æ˜¯å•¥-zipkinæ˜¯springbootè‡ªå¸¦çš„å—"><a href="#zipkinå¦‚ä½•æ˜¯å•¥-zipkinæ˜¯springbootè‡ªå¸¦çš„å—" class="headerlink" title="zipkinå¦‚ä½•æ˜¯å•¥?zipkinæ˜¯springbootè‡ªå¸¦çš„å—?"></a>zipkinå¦‚ä½•æ˜¯å•¥?zipkinæ˜¯springbootè‡ªå¸¦çš„å—?</h2><p><strong>æ³¨</strong>: æœ¬é¡¹ç›®twitter cloneä¸­ä¼¼ä¹æ²¡æœ‰å¼•å…¥è¿™ä¿©ä¾èµ–, æ‰€ä»¥å¹¶æ²¡æœ‰å®Œå…¨æ¥å…¥zipkinçš„åŠŸèƒ½</p>
<p>åœ¨ Spring Boot é¡¹ç›®ä¸­æ¥å…¥å’Œä½¿ç”¨ Zipkin å¯ä»¥å¸®åŠ©ä½ å®ç°åˆ†å¸ƒå¼ç³»ç»Ÿçš„é“¾è·¯è¿½è¸ªï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ¥å…¥å’Œä½¿ç”¨æ­¥éª¤ï¼Œç»“åˆä»£ç åº“ä¸­çš„ä¿¡æ¯æ¥è¿›è¡Œè¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>æ˜¯å¦ Spring Boot è‡ªå¸¦</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Zipkin</td>
<td>å¦</td>
<td>ç‹¬ç«‹ç³»ç»Ÿï¼Œç”¨äºæ”¶é›†å’ŒæŸ¥è¯¢é“¾è·¯è¿½è¸ªæ•°æ®ï¼ˆå¦‚è¯·æ±‚è°ƒç”¨é“¾ï¼‰</td>
</tr>
<tr>
<td>Spring Cloud Sleuth</td>
<td>å¦ï¼ˆéœ€å¼•å…¥ï¼‰</td>
<td>Spring å®˜æ–¹æä¾›çš„é“¾è·¯è¿½è¸ªåº“ï¼Œç”¨äºç”Ÿæˆ trace/span æ•°æ®ï¼Œå¹¶å¯å‘é€ç»™ Zipkin</td>
</tr>
<tr>
<td>Spring Boot Actuator</td>
<td>æ˜¯ï¼ˆéƒ¨åˆ†æ¨¡å—ï¼‰</td>
<td>ç”¨äºç›‘æ§ã€æŒ‡æ ‡æ”¶é›†ï¼Œä¸åŒ…å« Zipkin æˆ– Sleuth</td>
</tr>
</tbody>
</table>
<h3 id="1-æ·»åŠ ä¾èµ–"><a href="#1-æ·»åŠ ä¾èµ–" class="headerlink" title="1. æ·»åŠ ä¾èµ–"></a>1. æ·»åŠ ä¾èµ–</h3><p>åœ¨ <code>pom.xml</code> æ–‡ä»¶ä¸­æ·»åŠ  Spring Cloud Sleuth å’Œ Zipkin ç›¸å…³çš„ä¾èµ–ï¼Œä¸è¿‡ä»£ç åº“ä¸­æœªå±•ç¤ºå„æœåŠ¡å…·ä½“ä¾èµ–æ·»åŠ æƒ…å†µï¼Œä½†ä¸€èˆ¬éœ€æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-sleuth<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2-é…ç½®-Zipkin-æœåŠ¡åœ°å€"><a href="#2-é…ç½®-Zipkin-æœåŠ¡åœ°å€" class="headerlink" title="2. é…ç½® Zipkin æœåŠ¡åœ°å€"></a>2. é…ç½® Zipkin æœåŠ¡åœ°å€</h3><p>åœ¨æ¯ä¸ª Spring Boot æœåŠ¡çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œéœ€è¦é…ç½® Zipkin çš„æœåŠ¡åœ°å€ã€‚ä»¥ <code>config-server/src/main/resources/config/lists-service.yml</code> ä¸ºä¾‹ï¼š<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">    zipkin:</span></span><br><span class="line"><span class="attr">        base-url:</span> <span class="attr">http://$&#123;ZIPKIN_HOST:localhost&#125;:9411</span></span><br></pre></td></tr></table></figure></p>
<p>ä¸Šè¿°é…ç½®æŒ‡å®šäº† Zipkin æœåŠ¡çš„åŸºç¡€ URLï¼Œè¿™é‡Œä½¿ç”¨äº†ç¯å¢ƒå˜é‡ <code>${ZIPKIN_HOST}</code>ï¼Œé»˜è®¤å€¼ä¸º <code>localhost</code>ï¼Œç«¯å£ä¸º <code>9411</code>ã€‚</p>
<h3 id="3-å¯åŠ¨-Zipkin-æœåŠ¡"><a href="#3-å¯åŠ¨-Zipkin-æœåŠ¡" class="headerlink" title="3. å¯åŠ¨ Zipkin æœåŠ¡"></a>3. å¯åŠ¨ Zipkin æœåŠ¡</h3><p>åœ¨ <code>docker-compose.yml</code> æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ° Zipkin æœåŠ¡çš„é…ç½®ï¼š<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">zipkin:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">openzipkin/zipkin</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">zipkin</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">"9411:9411"</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">spring</span></span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨ Docker Compose å¯åŠ¨è¯¥é…ç½®ï¼Œå³å¯å¯åŠ¨ Zipkin æœåŠ¡ï¼Œå®ƒä¼šç›‘å¬ <code>9411</code> ç«¯å£ã€‚</p>
<h3 id="4-æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆå¯é€‰ï¼‰"><a href="#4-æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="4. æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆå¯é€‰ï¼‰"></a>4. æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆå¯é€‰ï¼‰</h3><p>å¦‚æœé¡¹ç›®ä½¿ç”¨äº†æœåŠ¡æ³¨å†Œä¸å‘ç°æœºåˆ¶ï¼ˆå¦‚ Eurekaï¼‰ï¼Œå„æœåŠ¡éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½® Eureka ç›¸å…³ä¿¡æ¯ï¼Œä»¥ç¡®ä¿ Zipkin èƒ½æ­£ç¡®è¯†åˆ«å’Œè¿½è¸ªæœåŠ¡ã€‚ä»¥ <code>config-server/src/main/resources/config/lists-service.yml</code> ä¸ºä¾‹ï¼š<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">    client:</span></span><br><span class="line"><span class="attr">        service-url:</span></span><br><span class="line"><span class="attr">            defaultZone:</span> <span class="attr">http://$&#123;EUREKA_HOST:localhost&#125;:8761/eureka</span></span><br><span class="line"><span class="attr">        fetch-registry:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">        register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    instance:</span></span><br><span class="line">   </span><br><span class="line"><span class="attr">   hostname:</span> <span class="string">$&#123;EUREKA_HOST:localhost&#125;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="5-éªŒè¯æ¥å…¥"><a href="#5-éªŒè¯æ¥å…¥" class="headerlink" title="5. éªŒè¯æ¥å…¥"></a>5. éªŒè¯æ¥å…¥</h3><p>å¯åŠ¨æ‰€æœ‰ Spring Boot æœåŠ¡å’Œ Zipkin æœåŠ¡åï¼Œå½“æœåŠ¡ä¹‹é—´è¿›è¡Œè°ƒç”¨æ—¶ï¼ŒSleuth ä¼šè‡ªåŠ¨æ”¶é›†é“¾è·¯è¿½è¸ªä¿¡æ¯ï¼Œå¹¶å°†å…¶å‘é€åˆ° Zipkin æœåŠ¡ã€‚ä½ å¯ä»¥é€šè¿‡è®¿é—® <code>http://localhost:9411</code> æ‰“å¼€ Zipkin çš„ Web ç•Œé¢ï¼Œåœ¨è¯¥ç•Œé¢ä¸­å¯ä»¥æŸ¥çœ‹å’Œåˆ†æé“¾è·¯è¿½è¸ªæ•°æ®ã€‚</p>
<h3 id="6-ç¤ºä¾‹ä»£ç åˆ†æ"><a href="#6-ç¤ºä¾‹ä»£ç åˆ†æ" class="headerlink" title="6. ç¤ºä¾‹ä»£ç åˆ†æ"></a>6. ç¤ºä¾‹ä»£ç åˆ†æ</h3><p>åœ¨ä»£ç åº“çš„å¤šä¸ªæœåŠ¡é…ç½®æ–‡ä»¶ä¸­éƒ½æœ‰ Zipkin ç›¸å…³é…ç½®ï¼Œå¦‚ <code>chat-service</code>ã€<code>user-service</code> ç­‰ï¼Œè¿™è¡¨æ˜è¿™äº›æœåŠ¡éƒ½æ¥å…¥äº† Zipkin è¿›è¡Œé“¾è·¯è¿½è¸ªã€‚ä»¥ä¸‹æ˜¯ <code>chat-service</code> çš„é…ç½®ç¤ºä¾‹ï¼š<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">    zipkin:</span></span><br><span class="line"><span class="attr">        base-url:</span> <span class="attr">http://$&#123;ZIPKIN_HOST:localhost&#125;:9411</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™è¯´æ˜ <code>chat-service</code> ä¼šå°†é“¾è·¯è¿½è¸ªæ•°æ®å‘é€åˆ°æŒ‡å®šçš„ Zipkin æœåŠ¡åœ°å€ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ å¯ä»¥åœ¨ Spring Boot é¡¹ç›®ä¸­æˆåŠŸæ¥å…¥å’Œä½¿ç”¨ Zipkin è¿›è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„é“¾è·¯è¿½è¸ªã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå„æœåŠ¡ä¼šæ ¹æ®é…ç½®è‡ªåŠ¨æ”¶é›†å’Œå‘é€é“¾è·¯è¿½è¸ªæ•°æ®ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ Zipkin çš„ Web ç•Œé¢æŸ¥çœ‹å’Œåˆ†æè¿™äº›æ•°æ®ï¼Œä»è€Œæ›´å¥½åœ°ç†è§£ç³»ç»Ÿçš„è°ƒç”¨å…³ç³»å’Œæ€§èƒ½ç“¶é¢ˆã€‚ </p>
<h2 id="ç”¨è¡¨æ ¼è¯´æ˜-prometheuså’Œgrafanaå’ŒactuatoråŒºåˆ«"><a href="#ç”¨è¡¨æ ¼è¯´æ˜-prometheuså’Œgrafanaå’ŒactuatoråŒºåˆ«" class="headerlink" title="ç”¨è¡¨æ ¼è¯´æ˜: prometheuså’Œgrafanaå’ŒactuatoråŒºåˆ«"></a>ç”¨è¡¨æ ¼è¯´æ˜: prometheuså’Œgrafanaå’ŒactuatoråŒºåˆ«</h2><table>
<thead>
<tr>
<th>æ¯”è¾ƒé¡¹</th>
<th>Prometheus</th>
<th>Grafana</th>
<th>Actuator</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å®šä½</strong></td>
<td>å¼€æºçš„ç³»ç»Ÿç›‘æ§å’Œè­¦æŠ¥å·¥å…·åŒ…ï¼Œä¸“æ³¨äº<strong>æ”¶é›†å’Œå­˜å‚¨</strong>æ—¶é—´åºåˆ—æ•°æ®ã€‚</td>
<td>å¼€æºçš„<strong>å¯è§†åŒ–</strong>åˆ†æå¹³å°ï¼Œç”¨äºå°†æ”¶é›†åˆ°çš„æ•°æ®ä»¥ç›´è§‚çš„å›¾è¡¨ã€ä»ªè¡¨ç›˜ç­‰å½¢å¼å±•ç¤ºå‡ºæ¥ã€‚</td>
<td>Spring Boot æä¾›çš„æ¯”è¾ƒ<strong>ç®€å•åŸå§‹</strong>çš„ç›‘æ§å’Œç®¡ç†å·¥å…·ï¼Œç”¨äºç›‘æ§å’Œç®¡ç† Spring Boot åº”ç”¨ç¨‹åºå†…éƒ¨çš„è¿è¡ŒçŠ¶æ€ã€‚</td>
</tr>
<tr>
<td><strong>åŠŸèƒ½</strong></td>
<td>1. <strong>æ•°æ®æ”¶é›†</strong>ï¼šä»å„ç§æ•°æ®æºï¼ˆå¦‚ Actuator æš´éœ²çš„ç«¯ç‚¹ï¼‰æ”¶é›†æŒ‡æ ‡æ•°æ®ã€‚<br>2. <strong>æ•°æ®å­˜å‚¨</strong>ï¼šå°†æ”¶é›†åˆ°çš„æ•°æ®ä»¥æ—¶é—´åºåˆ—çš„å½¢å¼å­˜å‚¨åœ¨æœ¬åœ°ç£ç›˜ã€‚<br>3. <strong>æŸ¥è¯¢è¯­è¨€</strong>ï¼šæä¾› PromQL æŸ¥è¯¢è¯­è¨€ï¼Œç”¨äºå¯¹å­˜å‚¨çš„æ•°æ®è¿›è¡ŒæŸ¥è¯¢å’Œåˆ†æã€‚<br>4. <strong>è­¦æŠ¥åŠŸèƒ½</strong>ï¼šæ”¯æŒè®¾ç½®è­¦æŠ¥è§„åˆ™ï¼Œå½“æŒ‡æ ‡æ•°æ®æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶è§¦å‘è­¦æŠ¥ã€‚</td>
<td>1. <strong>æ•°æ®å¯è§†åŒ–</strong>ï¼šæ”¯æŒå¤šç§æ•°æ®æºï¼ˆå¦‚ Prometheusã€InfluxDB ç­‰ï¼‰ï¼Œå¯ä»¥å°†æ•°æ®ä»¥å›¾è¡¨ã€è¡¨æ ¼ã€ä»ªè¡¨ç›˜ç­‰å½¢å¼è¿›è¡Œå¯è§†åŒ–å±•ç¤ºã€‚<br>2. <strong>å¤šæ•°æ®æºæ”¯æŒ</strong>ï¼šå¯ä»¥åŒæ—¶è¿æ¥å¤šä¸ªä¸åŒç±»å‹çš„æ•°æ®æºï¼Œå¹¶åœ¨åŒä¸€ä¸ªä»ªè¡¨ç›˜ä¸Šå±•ç¤ºä¸åŒæ•°æ®æºçš„æ•°æ®ã€‚<br>3. <strong>äº¤äº’å¼ä»ªè¡¨ç›˜</strong>ï¼šæä¾›ä¸°å¯Œçš„äº¤äº’åŠŸèƒ½ï¼Œå¦‚ç¼©æ”¾ã€è¿‡æ»¤ã€é’»å–ç­‰ï¼Œæ–¹ä¾¿ç”¨æˆ·æ·±å…¥åˆ†ææ•°æ®ã€‚<br>4. <strong>è­¦æŠ¥é€šçŸ¥</strong>ï¼šæ”¯æŒè®¾ç½®è­¦æŠ¥è§„åˆ™ï¼Œå¹¶é€šè¿‡å¤šç§æ–¹å¼ï¼ˆå¦‚é‚®ä»¶ã€Slack ç­‰ï¼‰å‘é€è­¦æŠ¥é€šçŸ¥ã€‚</td>
<td>1. <strong>ç«¯ç‚¹æš´éœ²</strong>ï¼šæä¾›ä¸€ç³»åˆ—çš„ç«¯ç‚¹ï¼ˆEndpointsï¼‰ï¼Œé€šè¿‡ HTTP æˆ–è€… JMX æ¥è®¿é—®åº”ç”¨çš„è¿è¡ŒçŠ¶æ€ä¿¡æ¯ï¼Œå¦‚å¥åº·çŠ¶å†µã€å†…å­˜ä½¿ç”¨æƒ…å†µã€çº¿ç¨‹æ± çŠ¶æ€ç­‰ã€‚<br>2. <strong>è‡ªå®šä¹‰æ‰©å±•</strong>ï¼šå¼€å‘è€…å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è‡ªå®šä¹‰ Actuator ç«¯ç‚¹ï¼Œä»¥æ»¡è¶³ç‰¹å®šçš„ç›‘æ§å’Œç®¡ç†éœ€æ±‚ã€‚</td>
</tr>
<tr>
<td><strong>ä½¿ç”¨åœºæ™¯</strong></td>
<td>1. ç›‘æ§å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¦‚ CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ã€ç½‘ç»œå¸¦å®½ç­‰ã€‚<br>2. å¯¹ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€è¿›è¡Œå®æ—¶ç›‘æ§å’Œåˆ†æï¼ŒåŠæ—¶å‘ç°æ½œåœ¨çš„é—®é¢˜ã€‚<br>3. è®¾ç½®è­¦æŠ¥è§„åˆ™ï¼Œå½“ç³»ç»Ÿå‡ºç°å¼‚å¸¸æ—¶åŠæ—¶é€šçŸ¥ç›¸å…³äººå‘˜ã€‚</td>
<td>1. å°† Prometheus æ”¶é›†åˆ°çš„æ•°æ®è¿›è¡Œå¯è§†åŒ–å±•ç¤ºï¼Œæ–¹ä¾¿ç”¨æˆ·ç›´è§‚åœ°äº†è§£ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ã€‚<br>2. åˆ›å»ºäº¤äº’å¼ä»ªè¡¨ç›˜ï¼Œç”¨äºå±•ç¤ºä¸åŒç»´åº¦çš„æ•°æ®ï¼Œå¸®åŠ©ç”¨æˆ·è¿›è¡Œæ•°æ®åˆ†æå’Œå†³ç­–ã€‚<br>3. å¯¹å¤šä¸ªæ•°æ®æºçš„æ•°æ®è¿›è¡Œæ•´åˆå’Œå±•ç¤ºï¼Œæä¾›ç»Ÿä¸€çš„ç›‘æ§è§†å›¾ã€‚</td>
<td>1. ç›‘æ§ Spring Boot åº”ç”¨ç¨‹åºçš„å†…éƒ¨çŠ¶æ€ï¼Œå¦‚å¥åº·æ£€æŸ¥ã€æŒ‡æ ‡ç›‘æ§ç­‰ã€‚<br>2. å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œç®¡ç†å’Œé…ç½®ï¼Œå¦‚å…³é—­åº”ç”¨ã€åˆ·æ–°é…ç½®ç­‰ã€‚<br>3. è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡ï¼Œæ»¡è¶³ç‰¹å®šçš„ä¸šåŠ¡éœ€æ±‚ã€‚</td>
</tr>
<tr>
<td><strong>åœ¨ä»£ç åº“ä¸­çš„ä½“ç°</strong></td>
<td>åœ¨ <code>twitter-spring-reactjs/dashboard/prometheus.yml</code> æ–‡ä»¶ä¸­ï¼Œå®šä¹‰äº†å¤šä¸ªæœåŠ¡çš„æŠ“å–é…ç½®ï¼ŒæŒ‡å®šäº†æŠ“å–é—´éš”ã€æŒ‡æ ‡è·¯å¾„å’Œç›®æ ‡åœ°å€ï¼Œç”¨äºä»å„ä¸ªæœåŠ¡çš„ <code>/actuator/prometheus</code> ç«¯ç‚¹æ”¶é›†æŒ‡æ ‡æ•°æ®ã€‚</td>
<td>åœ¨ <code>twitter-spring-reactjs/docker-compose.yml</code> æ–‡ä»¶ä¸­ï¼Œå®šä¹‰äº† Grafana æœåŠ¡çš„é…ç½®ï¼ŒåŒ…æ‹¬ç«¯å£æ˜ å°„ã€ç¯å¢ƒå˜é‡ç­‰ã€‚åŒæ—¶ï¼Œåœ¨ <code>twitter-spring-reactjs/dashboard/grafana/provisioning/micrometer-spring-throughput_rev2.json</code> æ–‡ä»¶ä¸­ï¼Œå®šä¹‰äº† Grafana çš„ä»ªè¡¨ç›˜é…ç½®ï¼Œç”¨äºå±•ç¤ºä» Prometheus æ”¶é›†åˆ°çš„æ•°æ®ã€‚</td>
<td>åœ¨ <code>twitter-spring-reactjs/dashboard/prometheus.yml</code> æ–‡ä»¶ä¸­ï¼Œå¤šä¸ªæœåŠ¡çš„ <code>metrics_path</code> éƒ½è®¾ç½®ä¸º <code>/actuator/prometheus</code>ï¼Œè¡¨æ˜è¿™äº›æœåŠ¡ä½¿ç”¨äº† Spring Boot Actuator æ¥æš´éœ²æŒ‡æ ‡æ•°æ®ï¼Œä¾› Prometheus è¿›è¡Œé‡‡é›†ã€‚</td>
</tr>
</tbody>
</table>
<h2 id="Actuatorå·²ç»å¾ˆå¥½-ä¸ºå•¥è¿˜éœ€è¦-Prometheus"><a href="#Actuatorå·²ç»å¾ˆå¥½-ä¸ºå•¥è¿˜éœ€è¦-Prometheus" class="headerlink" title="Actuatorå·²ç»å¾ˆå¥½, ä¸ºå•¥è¿˜éœ€è¦ Prometheus?"></a>Actuatorå·²ç»å¾ˆå¥½, ä¸ºå•¥è¿˜éœ€è¦ Prometheus?</h2><p>ä½ å¯ä»¥ç›´æ¥ç”¨ Actuator æŸ¥çœ‹æŒ‡æ ‡ï¼Œä½†å®ƒåªæ˜¯â€œåŸå§‹æ•°æ®æºâ€ï¼Œä¸æ˜¯å®Œæ•´ç›‘æ§æ–¹æ¡ˆã€‚</p>
<p>ç”¨ Actuator ç›´æ¥è®¿é—®çš„ç¼ºç‚¹ï¼š</p>
<table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>Actuator</th>
<th>Prometheus + Grafana</th>
</tr>
</thead>
<tbody>
<tr>
<td>å®æ—¶æŸ¥çœ‹æ•°æ®</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>æ•°æ®æŒä¹…åŒ–</td>
<td>âŒï¼ˆä»…è¿”å›å½“å‰å¿«ç…§ï¼‰</td>
<td>âœ…ï¼ˆè‡ªåŠ¨å­˜å†å²ï¼‰</td>
</tr>
<tr>
<td>å›¾è¡¨å±•ç¤º</td>
<td>âŒï¼ˆçº¯æ–‡æœ¬ï¼‰</td>
<td>âœ…ï¼ˆçµæ´»å›¾å½¢åŒ–ï¼‰</td>
</tr>
<tr>
<td>å‘Šè­¦è®¾ç½®</td>
<td>âŒ</td>
<td>âœ…ï¼ˆå¦‚ CPU è¶…é™å‘é€šçŸ¥ï¼‰</td>
</tr>
<tr>
<td>å¤šæœåŠ¡ç»Ÿä¸€ç®¡ç†</td>
<td>âŒï¼ˆæ¯ä¸ªæœåŠ¡è¦å•ç‹¬è®¿é—®ï¼‰</td>
<td>âœ…ï¼ˆé›†ä¸­å¼å¹³å°ï¼‰</td>
</tr>
<tr>
<td>æ•°æ®æŸ¥è¯¢/èšåˆ</td>
<td>âŒï¼ˆä¸æ”¯æŒæŸ¥è¯¢ï¼‰</td>
<td>âœ…ï¼ˆæ”¯æŒ PromQL æŸ¥è¯¢ï¼‰</td>
</tr>
</tbody>
</table>
<p>â¸»</p>
<p>ç»“è®ºï¼š</p>
<p>å¦‚æœä½ åªæƒ³è°ƒè¯•ä¸€ä¸ªæœåŠ¡ã€ä¸´æ—¶çœ‹çœ‹è¿è¡ŒçŠ¶æ€ï¼ŒActuator æ˜¯å¤Ÿç”¨çš„ã€‚<br>ä½†å¦‚æœä½ è¦ï¼š<br>    â€¢    æŒç»­è§‚å¯Ÿè¶‹åŠ¿<br>    â€¢    å¤šæœåŠ¡ç»Ÿä¸€ç›‘æ§<br>    â€¢    è®¾ç½®å‘Šè­¦<br>    â€¢    åšæ€§èƒ½ä¼˜åŒ–</p>
<p>é‚£å°±å¿…é¡»ç”¨ Prometheus + Grafanaã€‚Actuator æ˜¯æ•°æ®æºï¼Œä¸æ˜¯ä»ªè¡¨ç›˜æˆ–ç›‘æ§ç³»ç»Ÿã€‚</p>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<p>Actuator æ˜¯å–‡å­ï¼ŒPrometheus + Grafana æ‰æ˜¯è€³æœµ + çœ¼ç› + è„‘å­ã€‚</p>
<h2 id="Prometheus-ä¸ºå•¥ä¾èµ–-Actuator"><a href="#Prometheus-ä¸ºå•¥ä¾èµ–-Actuator" class="headerlink" title="Prometheus ä¸ºå•¥ä¾èµ– Actuator?"></a>Prometheus ä¸ºå•¥ä¾èµ– Actuator?</h2><p>å› ä¸º Spring Boot Actuator æ˜¯å®˜æ–¹æä¾›çš„ç›‘æ§å’Œç®¡ç†æ¨¡å—ï¼Œè´Ÿè´£æš´éœ²å„ç§è¿è¡Œæ—¶æŒ‡æ ‡ã€å¥åº·æ£€æŸ¥ã€ç¯å¢ƒå˜é‡ã€çº¿ç¨‹ä¿¡æ¯ç­‰ã€‚ä½ è¦é€šè¿‡ Grafana + Prometheus ç›‘æ§ Spring Boot åº”ç”¨ï¼Œæ ¸å¿ƒå°±æ˜¯è¿™äº›è¿è¡Œæ—¶æŒ‡æ ‡ï¼Œè€Œè¿™äº›æŒ‡æ ‡å°±æ˜¯ç”± Actuator æä¾›å¹¶æš´éœ²å‡ºæ¥çš„ã€‚</p>
<p>ä¸ºä»€ä¹ˆ Prometheus è¦ä¾èµ– Actuatorï¼Ÿ</p>
<p>Prometheus æŠ“å–çš„ /actuator/prometheus æ¥å£å°±æ˜¯ Actuator æä¾›çš„ï¼Œé‡Œé¢åŒ…å«äº† Micrometer é‡‡é›†åˆ°çš„å„ç§ç³»ç»Ÿã€JVMã€Spring åº”ç”¨è¿è¡Œæ•°æ®ï¼Œæ¯”å¦‚ï¼š<br>    â€¢    JVM å†…å­˜ã€GCã€çº¿ç¨‹æ•°<br>    â€¢    HTTP è¯·æ±‚æ¬¡æ•°ã€è€—æ—¶<br>    â€¢    æ•°æ®åº“è¿æ¥æ± çŠ¶æ€<br>    â€¢    è‡ªå®šä¹‰ä¸šåŠ¡æŒ‡æ ‡ï¼ˆå¦‚æœä½ æ·»åŠ äº†ï¼‰</p>
<p>å¦‚æœä½ ä¸åŠ  spring-boot-starter-actuatorï¼ŒSpring Boot å°±ä¸ä¼šæš´éœ²è¿™äº›ä¿¡æ¯ï¼ŒPrometheus æ ¹æœ¬æ— ä»æŠ“å–ã€‚</p>
<p>â¸»</p>
<p>æ ¸å¿ƒä¾èµ–å…³ç³»å¦‚ä¸‹ï¼š</p>
<p>Spring Boot åº”ç”¨<br>   â””â”€â”€ Actuator æš´éœ²åº”ç”¨è¿è¡ŒæŒ‡æ ‡<br>         â””â”€â”€ Micrometer æä¾›ç»Ÿä¸€æŒ‡æ ‡é‡‡é›†æ¥å£<br>               â””â”€â”€ micrometer-registry-prometheus æŠŠæŒ‡æ ‡è½¬æˆ Prometheus èƒ½è¯»æ‡‚çš„æ ¼å¼<br>                     â””â”€â”€ Prometheus æŠ“å–æ•°æ®<br>                           â””â”€â”€ Grafana å±•ç¤ºæ•°æ®</p>
<p>â¸»</p>
<p>ç»“è®ºï¼š</p>
<p>è¦æƒ³ Prometheus èƒ½ç›‘æ§ Spring Bootï¼Œå¿…é¡»ä¾èµ– Actuator æä¾› /actuator/prometheus ç«¯ç‚¹ï¼Œè¿™æ˜¯æ•°æ®çš„æ¥æºï¼Œæ²¡æœ‰ Actuator å°±æ²¡æœ‰ç›‘æ§æ•°æ®ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºç›‘æ§ç³»ç»Ÿçš„â€œæ•°æ®å‡ºå£â€ã€‚</p>
<h2 id="Actuactoræ•´ä½“å¦‚ä½•é…ç½®é‡Œå¼€å¯ä»¥åŠä»£ç é‡Œå¦‚ä½•æ¥å…¥"><a href="#Actuactoræ•´ä½“å¦‚ä½•é…ç½®é‡Œå¼€å¯ä»¥åŠä»£ç é‡Œå¦‚ä½•æ¥å…¥" class="headerlink" title="Actuactoræ•´ä½“å¦‚ä½•é…ç½®é‡Œå¼€å¯ä»¥åŠä»£ç é‡Œå¦‚ä½•æ¥å…¥?"></a>Actuactoræ•´ä½“å¦‚ä½•é…ç½®é‡Œå¼€å¯ä»¥åŠä»£ç é‡Œå¦‚ä½•æ¥å…¥?</h2><p>Spring Boot Actuator æ˜¯ä¸€ä¸ªå†…å»ºæ¨¡å—ï¼Œç”¨æ¥æš´éœ²è¿è¡Œæ—¶çš„ç³»ç»Ÿä¿¡æ¯ï¼ˆå¥åº·æ£€æŸ¥ã€Beanã€çº¿ç¨‹ã€å†…å­˜ã€æŒ‡æ ‡ç­‰ï¼‰ï¼Œç”¨äºç›‘æ§ã€æŠ¥è­¦ã€åˆ†æç³»ç»ŸçŠ¶æ€ã€‚è¦å®Œæ•´å¯ç”¨å¹¶æ¥å…¥ï¼Œåˆ†ä¸ºä¸¤æ­¥ï¼š</p>
<p>â¸»</p>
<p>âœ… ä¸€ã€é…ç½®æ–‡ä»¶é‡Œå¼€å¯ Actuator åŠŸèƒ½</p>
<ol>
<li>å¼•å…¥ä¾èµ–</li>
</ol>
<p>pom.xml ä¸­æ·»åŠ ï¼ˆSpring Boot 2.2+ æ¨èä½¿ç”¨ spring-boot-starter-actuatorï¼‰ï¼š<br><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>â¸»</p>
<ol>
<li>application.yml ä¸­å¼€å¯ç«¯ç‚¹<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line"><span class="attr">  endpoints:</span></span><br><span class="line"><span class="attr">    web:</span></span><br><span class="line"><span class="attr">      exposure:</span></span><br><span class="line"><span class="attr">        include:</span> <span class="string">"*"</span>   <span class="comment">## æš´éœ²æ‰€æœ‰ç«¯ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯ ["health", "info", "metrics"]</span></span><br><span class="line"><span class="attr">  endpoint:</span></span><br><span class="line"><span class="attr">    health:</span></span><br><span class="line"><span class="attr">      show-details:</span> <span class="string">always</span>  <span class="comment">## æ˜¾ç¤ºè¯¦ç»†å¥åº·ä¿¡æ¯</span></span><br><span class="line"><span class="attr">  metrics:</span></span><br><span class="line"><span class="attr">    export:</span></span><br><span class="line"><span class="attr">      prometheus:</span></span><br><span class="line"><span class="attr">        enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  server:</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">8081</span>  <span class="comment">## å¯é€‰ï¼Œç‹¬ç«‹èµ·ä¸€ä¸ª actuator ç®¡ç†ç«¯å£</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>â¸»</p>
<p>âœ… äºŒã€ä»£ç ä¸­æ¥å…¥å¹¶ä½¿ç”¨</p>
<p>ä½ ä¸éœ€è¦æ˜¾å¼å†™ä»»ä½•ä»£ç æ¥è·å– actuator åŠŸèƒ½ã€‚Spring Boot è‡ªåŠ¨è£…é…è¿™äº›ç«¯ç‚¹ï¼š</p>
<p>åŠŸèƒ½    è®¿é—®è·¯å¾„    æè¿°</p>
<ul>
<li>Health Check    /actuator/health    æŸ¥çœ‹æœåŠ¡æ˜¯å¦æ­£å¸¸</li>
<li>Info    /actuator/info    å±•ç¤ºé¡¹ç›®ä¿¡æ¯ï¼ˆéœ€é…ç½®ï¼‰</li>
<li>Beans    /actuator/beans    æ‰€æœ‰ Spring Bean åˆ—è¡¨</li>
<li>Metrics    /actuator/metrics    æ‰€æœ‰å¯ç”¨çš„ç³»ç»ŸæŒ‡æ ‡</li>
<li>Prometheus    /actuator/prometheus    Prometheus æ ¼å¼çš„ç›‘æ§æ•°æ®</li>
<li>Env    /actuator/env    å½“å‰ç³»ç»Ÿç¯å¢ƒå˜é‡</li>
<li>Loggers    /actuator/loggers    åŠ¨æ€è°ƒæ•´æ—¥å¿—çº§åˆ«</li>
<li>Mappings    /actuator/mappings    æ‰€æœ‰è¯·æ±‚è·¯å¾„å’Œæ§åˆ¶å™¨æ˜ å°„</li>
</ul>
<p>ğŸ” å¦‚æœä½ ç”¨äº† Spring Securityï¼Œè¿˜è¦é¢å¤–å¼€æ”¾ Actuator çš„è®¿é—®æƒé™ï¼ˆæˆ‘å¯ä»¥ç»™ä½ é…ç½®æ¨¡æ¿ï¼‰ã€‚</p>
<p>â¸»</p>
<p>âœ… å››ã€å¯é€‰ï¼šä¸ Prometheus + Grafana è”åŠ¨</p>
<pre><code>1.    ä¿è¯ Prometheus èƒ½è®¿é—® /actuator/prometheus
2.    Prometheus é…ç½®ä¸­åŠ  targetï¼š
</code></pre><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">- job_name:</span> <span class="string">'user-service'</span></span><br><span class="line"><span class="attr">  static_configs:</span></span><br><span class="line"><span class="attr">    - targets:</span> <span class="string">['localhost:8080']</span></span><br></pre></td></tr></table></figure>
<pre><code>3.    Grafana æ·»åŠ  Prometheus æ•°æ®æºå³å¯ã€‚
</code></pre><p>â¸»</p>
<h2 id="Grafanaæœ¬èº«ä¸éœ€è¦æ¥å…¥åˆ°springbootå¯¹å—-ä»–åªéœ€è¦åˆ°ç½‘é¡µç«¯é…ç½®æ•°æ®æºå°±è¡Œäº†"><a href="#Grafanaæœ¬èº«ä¸éœ€è¦æ¥å…¥åˆ°springbootå¯¹å—-ä»–åªéœ€è¦åˆ°ç½‘é¡µç«¯é…ç½®æ•°æ®æºå°±è¡Œäº†" class="headerlink" title="Grafanaæœ¬èº«ä¸éœ€è¦æ¥å…¥åˆ°springbootå¯¹å—? ä»–åªéœ€è¦åˆ°ç½‘é¡µç«¯é…ç½®æ•°æ®æºå°±è¡Œäº†"></a>Grafanaæœ¬èº«ä¸éœ€è¦æ¥å…¥åˆ°springbootå¯¹å—? ä»–åªéœ€è¦åˆ°ç½‘é¡µç«¯é…ç½®æ•°æ®æºå°±è¡Œäº†</h2><p>æ˜¯çš„ï¼Œå®Œå…¨æ­£ç¡®ã€‚Grafana æœ¬èº«ä¸éœ€è¦æ¥å…¥ Spring Boot åº”ç”¨ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªå¯è§†åŒ–å¹³å°ï¼Œé€šè¿‡é…ç½®<strong>æ•°æ®æºï¼ˆå¦‚ Prometheusã€InfluxDBã€Loki ç­‰ï¼‰</strong>æ‹‰å–æ•°æ®å¹¶å±•ç¤ºå›¾è¡¨ã€‚</p>
<p>â¸»</p>
<p>âœ… ä½ åªéœ€åšä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>Spring Boot åº”ç”¨è´Ÿè´£æš´éœ²ç›‘æ§æ•°æ®</li>
</ol>
<p>ä¾‹å¦‚é€šè¿‡ Actuator æš´éœ²ï¼š</p>
<p><a href="http://localhost:8080/actuator/prometheus" target="_blank" rel="noopener">http://localhost:8080/actuator/prometheus</a></p>
<ol>
<li>Grafana é…ç½®æ•°æ®æºï¼ˆPrometheusï¼‰<br> â€¢    åœ¨æµè§ˆå™¨è®¿é—® Grafanaï¼ˆé€šå¸¸æ˜¯ <a href="http://localhost:3000ï¼‰" target="_blank" rel="noopener">http://localhost:3000ï¼‰</a><br> â€¢    å·¦ä¾§èœå• â†’ âš™ï¸ Configuration â†’ Data Sources<br> â€¢    é€‰æ‹© Prometheus â†’ å¡«å†™ URLï¼ˆå¦‚ <a href="http://localhost:9090ï¼‰" target="_blank" rel="noopener">http://localhost:9090ï¼‰</a><br> â€¢    ç‚¹å‡» Save &amp; Test</li>
</ol>
<p>â¸»</p>
<p>ğŸ” ä¹‹åçš„é“¾è·¯å¦‚ä¸‹ï¼š</p>
<p>Spring Boot (Actuator) â€“&gt; Prometheus â€“&gt; Grafana Dashboard</p>
<p>Spring Boot ä¸éœ€è¦æ„ŸçŸ¥ Grafana çš„å­˜åœ¨ï¼Œå®Œå…¨è§£è€¦ã€‚åªè¦ä½ çš„ Prometheus èƒ½æŠ“åˆ°æ•°æ®ï¼ŒGrafanaå°±èƒ½å±•ç¤ºã€‚ä½ ä¹Ÿå¯ä»¥æŠŠå¤šä¸ªå¾®æœåŠ¡æ¥å…¥åŒä¸€ä¸ª Prometheusï¼Œç„¶ååœ¨ Grafana ä¸­ç»Ÿä¸€å±•ç¤ºã€‚</p>
<h1 id="é¡¹ç›®é‡ŒKafkaå’‹ç”¨çš„"><a href="#é¡¹ç›®é‡ŒKafkaå’‹ç”¨çš„" class="headerlink" title="é¡¹ç›®é‡ŒKafkaå’‹ç”¨çš„"></a>é¡¹ç›®é‡ŒKafkaå’‹ç”¨çš„</h1><p>åœ¨è¿™ä¸ª Twitter å…‹éš†é¡¹ç›®ä¸­ï¼Œ</p>
<ul>
<li><strong>Kafka</strong> ä½œä¸ºæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œç”¨äºåœ¨å„ä¸ªå¾®æœåŠ¡ä¹‹é—´å®ç°<strong>å¼‚æ­¥</strong>é€šä¿¡å’Œè§£è€¦, </li>
<li><strong>Feign</strong>ç”¨ä½œå¾®æœåŠ¡ä¹‹é—´çš„<strong>åŒæ­¥</strong>é€šä¿¡ã€‚</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ Kafka åœ¨é¡¹ç›®ä¸­çš„å…·ä½“ä½¿ç”¨æ–¹å¼ï¼š</p>
<h2 id="1-é…ç½®-Kafka"><a href="#1-é…ç½®-Kafka" class="headerlink" title="1. é…ç½® Kafka"></a>1. é…ç½® Kafka</h2><h3 id="1-1-ç”Ÿäº§è€…é…ç½®"><a href="#1-1-ç”Ÿäº§è€…é…ç½®" class="headerlink" title="1.1 ç”Ÿäº§è€…é…ç½®"></a>1.1 ç”Ÿäº§è€…é…ç½®</h3><p>å¤šä¸ªæœåŠ¡ä¸­éƒ½æœ‰ Kafka ç”Ÿäº§è€…çš„é…ç½®ï¼Œä»¥ <code>user-service</code> ä¸ºä¾‹ï¼Œåœ¨ <code>KafkaProducerConfiguration</code> ç±»ä¸­ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableKafka</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaProducerConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.kafka.bootstrap-servers&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String bootstrapServers;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">producerConfigs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; props = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);</span><br><span class="line">        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);</span><br><span class="line">        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class);</span><br><span class="line">        <span class="keyword">return</span> props;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> KafkaTemplate&lt;String, UpdateUserEvent&gt; <span class="title">kafkaUpdateUserTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> KafkaTemplate&lt;&gt;(<span class="keyword">new</span> DefaultKafkaProducerFactory&lt;&gt;(producerConfigs()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…¶ä»– KafkaTemplate Bean å®šä¹‰...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œé…ç½®äº† Kafka ç”Ÿäº§è€…çš„åŸºæœ¬å±æ€§ï¼Œå¦‚ <code>bootstrap.servers</code>ã€é”®å’Œå€¼çš„åºåˆ—åŒ–å™¨ã€‚é€šè¿‡åˆ›å»ºä¸åŒçš„ <code>KafkaTemplate</code> Beanï¼Œå¯ä»¥å‘ä¸åŒçš„ä¸»é¢˜å‘é€ä¸åŒç±»å‹çš„æ¶ˆæ¯ã€‚</p>
<p>åœ¨æä¾›çš„ä»£ç ä¸­ï¼Œæ¶‰åŠåˆ°äº† Apache Kafka ç›¸å…³çš„é…ç½®ï¼Œå…¶ä¸­ <code>bootstrap.servers</code>ã€é”®å’Œå€¼çš„åºåˆ—åŒ–å™¨ä»¥åŠ <code>KafkaTemplate</code> Bean éƒ½æ˜¯ Kafka é…ç½®å’Œä½¿ç”¨è¿‡ç¨‹ä¸­çš„é‡è¦æ¦‚å¿µï¼Œä¸‹é¢ä¸ºä½ è¯¦ç»†è§£é‡Šï¼š</p>
<h4 id="1-bootstrap-servers"><a href="#1-bootstrap-servers" class="headerlink" title="1. bootstrap.servers"></a>1. <code>bootstrap.servers</code></h4><p><code>bootstrap.servers</code> æ˜¯ Kafka å®¢æˆ·ç«¯ï¼ˆç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ï¼‰ç”¨äºè¿æ¥ Kafka é›†ç¾¤çš„åˆå§‹æœåŠ¡å™¨åˆ—è¡¨ã€‚å®¢æˆ·ç«¯ä½¿ç”¨è¿™äº›æœåŠ¡å™¨æ¥å‘ç°æ•´ä¸ª Kafka é›†ç¾¤çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„ broker èŠ‚ç‚¹ã€ä¸»é¢˜åˆ†åŒºç­‰ã€‚åœ¨ä»£ç é‡Œï¼Œè¿™ä¸ªé…ç½®é€šå¸¸ä» Spring çš„é…ç½®æ–‡ä»¶ä¸­è¯»å–ï¼Œç„¶åç”¨äºåˆ›å»º Kafka ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…çš„é…ç½®ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;spring.kafka.bootstrap-servers&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String bootstrapServers;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">producerConfigs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; props = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);</span><br><span class="line">    <span class="comment">// å…¶ä»–é…ç½®...</span></span><br><span class="line">    <span class="keyword">return</span> props;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>bootstrapServers</code> ä» <code>spring.kafka.bootstrap-servers</code> é…ç½®é¡¹ä¸­è·å–ï¼Œç„¶åæ·»åŠ åˆ°ç”Ÿäº§è€…é…ç½® <code>props</code> ä¸­ã€‚</p>
<h4 id="2-é”®å’Œå€¼çš„åºåˆ—åŒ–å™¨"><a href="#2-é”®å’Œå€¼çš„åºåˆ—åŒ–å™¨" class="headerlink" title="2. é”®å’Œå€¼çš„åºåˆ—åŒ–å™¨"></a>2. é”®å’Œå€¼çš„åºåˆ—åŒ–å™¨</h4><p>åœ¨ Kafka ä¸­ï¼Œæ¶ˆæ¯æ˜¯ä»¥å­—èŠ‚å½¢å¼å­˜å‚¨å’Œä¼ è¾“çš„ã€‚å› æ­¤ï¼Œåœ¨ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ° Kafka ä¹‹å‰ï¼Œéœ€è¦å°†æ¶ˆæ¯çš„é”®å’Œå€¼åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼›è€Œåœ¨æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œéœ€è¦å°†å­—èŠ‚æ•°ç»„ååºåˆ—åŒ–ä¸ºå¯¹è±¡ã€‚è¿™å°±éœ€è¦ä½¿ç”¨åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨ã€‚</p>
<h5 id="åºåˆ—åŒ–å™¨"><a href="#åºåˆ—åŒ–å™¨" class="headerlink" title="åºåˆ—åŒ–å™¨"></a>åºåˆ—åŒ–å™¨</h5><ul>
<li><strong>é”®åºåˆ—åŒ–å™¨ï¼ˆ<code>KEY_SERIALIZER_CLASS_CONFIG</code>ï¼‰</strong>ï¼šç”¨äºå°†æ¶ˆæ¯çš„é”®åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ã€‚</li>
<li><strong>å€¼åºåˆ—åŒ–å™¨ï¼ˆ<code>VALUE_SERIALIZER_CLASS_CONFIG</code>ï¼‰</strong>ï¼šç”¨äºå°†æ¶ˆæ¯çš„å€¼åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ã€‚</li>
</ul>
<p>ç¤ºä¾‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">producerConfigs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; props = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);</span><br><span class="line">    props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class);</span><br><span class="line">    <span class="keyword">return</span> props;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œé”®ä½¿ç”¨ <code>StringSerializer</code> è¿›è¡Œåºåˆ—åŒ–ï¼Œå€¼ä½¿ç”¨ <code>JsonSerializer</code> è¿›è¡Œåºåˆ—åŒ–ã€‚</p>
<h5 id="ååºåˆ—åŒ–å™¨"><a href="#ååºåˆ—åŒ–å™¨" class="headerlink" title="ååºåˆ—åŒ–å™¨"></a>ååºåˆ—åŒ–å™¨</h5><p>åœ¨æ¶ˆè´¹è€…ç«¯ï¼Œéœ€è¦ä½¿ç”¨ç›¸åº”çš„ååºåˆ—åŒ–å™¨å°†å­—èŠ‚æ•°ç»„ååºåˆ—åŒ–ä¸ºå¯¹è±¡ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">consumerConfigs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; props = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);</span><br><span class="line">    props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, JsonDeserializer.class);</span><br><span class="line">    <span class="keyword">return</span> props;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œé”®ä½¿ç”¨ <code>StringDeserializer</code> è¿›è¡Œååºåˆ—åŒ–ï¼Œå€¼ä½¿ç”¨ <code>JsonDeserializer</code> è¿›è¡Œååºåˆ—åŒ–ã€‚</p>
<h4 id="3-KafkaTemplate-Bean"><a href="#3-KafkaTemplate-Bean" class="headerlink" title="3. KafkaTemplate Bean"></a>3. <code>KafkaTemplate</code> Bean</h4><p><code>KafkaTemplate</code> æ˜¯ Spring Kafka æä¾›çš„ä¸€ä¸ªé«˜çº§æŠ½è±¡ï¼Œç”¨äºç®€åŒ– Kafka ç”Ÿäº§è€…çš„ä½¿ç”¨ã€‚é€šè¿‡åˆ›å»º <code>KafkaTemplate</code> Beanï¼Œå¯ä»¥æ–¹ä¾¿åœ°å‘ Kafka ä¸»é¢˜å‘é€æ¶ˆæ¯ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š<br><figure class="highlight java"><figcaption><span>KafkaProducerConfiguration.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> KafkaTemplate&lt;String, UpdateTweetCountEvent&gt; <span class="title">kafkaUpdateTweetCountTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> KafkaTemplate&lt;&gt;(<span class="keyword">new</span> DefaultKafkaProducerFactory&lt;&gt;(producerConfigs()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ª <code>KafkaTemplate</code> Beanï¼Œç”¨äºå‘é€é”®ä¸º <code>String</code> ç±»å‹ï¼Œå€¼ä¸º <code>ListsNotificationEvent</code> ç±»å‹çš„æ¶ˆæ¯ã€‚å¯ä»¥é€šè¿‡æ³¨å…¥è¿™ä¸ª <code>KafkaTemplate</code> Beanï¼Œåœ¨ä»£ç ä¸­ä½¿ç”¨å®ƒæ¥å‘é€æ¶ˆæ¯ï¼š<br><figure class="highlight java"><figcaption><span>UpdateTweetCountProducer.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> KafkaTemplate&lt;String, UpdateTweetCountEvent&gt; kafkaTemplate;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendUpdateTweetCountEvent</span><span class="params">(Long authUserId, <span class="keyword">boolean</span> hasRetweeted)</span> </span>&#123;</span><br><span class="line">    kafkaTemplate.send(getUpdateTweetCountEvent(KafkaTopicConstants.UPDATE_USER_TWEETS_COUNT_TOPIC, authUserId, hasRetweeted));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œ<code>bootstrap.servers</code> ç”¨äºè¿æ¥ Kafka é›†ç¾¤ï¼Œé”®å’Œå€¼çš„åºåˆ—åŒ–å™¨ç”¨äºæ¶ˆæ¯çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œ<code>KafkaTemplate</code> Bean ç”¨äºç®€åŒ– Kafka ç”Ÿäº§è€…çš„ä½¿ç”¨ã€‚è¿™äº›é…ç½®å’Œç»„ä»¶å…±åŒæ„æˆäº†é¡¹ç›®ä¸­ Kafka æ¶ˆæ¯ä¼ é€’çš„åŸºç¡€ã€‚ </p>
<h3 id="1-2-æ¶ˆè´¹è€…é…ç½®"><a href="#1-2-æ¶ˆè´¹è€…é…ç½®" class="headerlink" title="1.2 æ¶ˆè´¹è€…é…ç½®"></a>1.2 æ¶ˆè´¹è€…é…ç½®</h3><p>ä»¥ <code>tweet-service</code> ä¸ºä¾‹ï¼Œåœ¨ <code>KafkaConsumerConfiguration</code> ç±»ä¸­ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableKafka</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaConsumerConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.kafka.bootstrap-servers&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String bootstrapServers;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.kafka.consumer.group-id&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String groupId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">consumerConfigs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; props = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);</span><br><span class="line">        props.put(ConsumerConfig.GROUP_ID_CONFIG, groupId);</span><br><span class="line">        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);</span><br><span class="line">        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, JsonDeserializer.class);</span><br><span class="line">        <span class="keyword">return</span> props;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConsumerFactory&lt;String, UpdateUserEvent&gt; <span class="title">userConsumerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultKafkaConsumerFactory&lt;&gt;(</span><br><span class="line">                consumerConfigs(),</span><br><span class="line">                <span class="keyword">new</span> StringDeserializer(),</span><br><span class="line">                <span class="keyword">new</span> JsonDeserializer&lt;&gt;(UpdateUserEvent.class)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…¶ä»– ConsumerFactory Bean å®šä¹‰...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œé…ç½®äº† Kafka æ¶ˆè´¹è€…çš„åŸºæœ¬å±æ€§ï¼Œå¦‚ <code>bootstrap.servers</code>ã€æ¶ˆè´¹è€…ç»„ IDã€é”®å’Œå€¼çš„ååºåˆ—åŒ–å™¨ã€‚é€šè¿‡åˆ›å»ºä¸åŒçš„ <code>ConsumerFactory</code> Beanï¼Œå¯ä»¥ä»ä¸åŒçš„ä¸»é¢˜æ¶ˆè´¹ä¸åŒç±»å‹çš„æ¶ˆæ¯ã€‚</p>
<h2 id="2-å‘é€æ¶ˆæ¯ï¼ˆç”Ÿäº§è€…ï¼‰"><a href="#2-å‘é€æ¶ˆæ¯ï¼ˆç”Ÿäº§è€…ï¼‰" class="headerlink" title="2. å‘é€æ¶ˆæ¯ï¼ˆç”Ÿäº§è€…ï¼‰"></a>2. å‘é€æ¶ˆæ¯ï¼ˆç”Ÿäº§è€…ï¼‰</h2><p>é¡¹ç›®ä¸­æœ‰å¤šä¸ªç”Ÿäº§è€…ç±»ï¼Œç”¨äºå‘ Kafka ä¸»é¢˜å‘é€ä¸åŒç±»å‹çš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œ<code>PinTweetProducer</code> ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PinTweetProducer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> KafkaTemplate&lt;String, PinTweetEvent&gt; kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendPinTweetEvent</span><span class="params">(Long tweetId, Long authUserId)</span> </span>&#123;</span><br><span class="line">        PinTweetEvent pinTweetEvent = PinTweetEvent.builder()</span><br><span class="line">                .tweetId(tweetId)</span><br><span class="line">                .build();</span><br><span class="line">        kafkaTemplate.send(ProducerUtil.authHeaderWrapper(KafkaTopicConstants.PIN_TWEET_USER_TOPIC, pinTweetEvent, authUserId));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¯¥ç±»ä½¿ç”¨ <code>KafkaTemplate</code> å‘ <code>PIN_TWEET_USER_TOPIC</code> ä¸»é¢˜å‘é€ <code>PinTweetEvent</code> ç±»å‹çš„æ¶ˆæ¯ã€‚</p>
<h2 id="3-æ¥æ”¶æ¶ˆæ¯ï¼ˆæ¶ˆè´¹è€…ï¼‰"><a href="#3-æ¥æ”¶æ¶ˆæ¯ï¼ˆæ¶ˆè´¹è€…ï¼‰" class="headerlink" title="3. æ¥æ”¶æ¶ˆæ¯ï¼ˆæ¶ˆè´¹è€…ï¼‰"></a>3. æ¥æ”¶æ¶ˆæ¯ï¼ˆæ¶ˆè´¹è€…ï¼‰</h2><p>è™½ç„¶ä»£ç ç‰‡æ®µä¸­æ²¡æœ‰å±•ç¤ºå®Œæ•´çš„æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼Œä½†ä»é…ç½®æ–‡ä»¶å¯ä»¥æ¨æµ‹ï¼Œæ¯ä¸ªæœåŠ¡ä¼šæ ¹æ®éœ€è¦åˆ›å»ºç›¸åº”çš„æ¶ˆè´¹è€…ç›‘å¬å™¨æ¥å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œåœ¨ <code>tweet-service</code> ä¸­é…ç½®äº†å¤šä¸ª <code>ConsumerFactory</code>ï¼Œå¯ä»¥ç”¨äºåˆ›å»ºæ¶ˆè´¹è€…ç›‘å¬å™¨æ¥å¤„ç†ä¸åŒç±»å‹çš„äº‹ä»¶ã€‚</p>
<h2 id="4-ä¸»é¢˜å’Œäº‹ä»¶ç±»å‹"><a href="#4-ä¸»é¢˜å’Œäº‹ä»¶ç±»å‹" class="headerlink" title="4. ä¸»é¢˜å’Œäº‹ä»¶ç±»å‹"></a>4. ä¸»é¢˜å’Œäº‹ä»¶ç±»å‹</h2><p>é¡¹ç›®ä¸­å®šä¹‰äº†å¤šä¸ª Kafka ä¸»é¢˜å’Œå¯¹åº”çš„äº‹ä»¶ç±»å‹ï¼Œç”¨äºä¸åŒçš„ä¸šåŠ¡åœºæ™¯ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>KafkaTopicConstants.PIN_TWEET_USER_TOPIC</code>ï¼šç”¨äºå¤„ç†å›ºå®šæ¨æ–‡çš„äº‹ä»¶ã€‚</li>
<li><code>KafkaTopicConstants.UPDATE_USER_TOPIC</code>ï¼šç”¨äºå¤„ç†ç”¨æˆ·ä¿¡æ¯æ›´æ–°çš„äº‹ä»¶ã€‚</li>
</ul>
<p>ä¸åŒçš„æœåŠ¡æ ¹æ®ä¸šåŠ¡éœ€æ±‚å‘ä¸åŒçš„ä¸»é¢˜å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œå®ç°äº†å¾®æœåŠ¡ä¹‹é—´çš„è§£è€¦å’Œå¼‚æ­¥é€šä¿¡ã€‚</p>
<h2 id="5-å®¹å™¨åŒ–éƒ¨ç½²"><a href="#5-å®¹å™¨åŒ–éƒ¨ç½²" class="headerlink" title="5. å®¹å™¨åŒ–éƒ¨ç½²"></a>5. å®¹å™¨åŒ–éƒ¨ç½²</h2><p>åœ¨ <code>docker-compose.yml</code> æ–‡ä»¶ä¸­ï¼Œé…ç½®äº† Kafka å®¹å™¨ï¼š<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">broker:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">confluentinc/cp-kafka:7.0.1</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">broker</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">"9092:9092"</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">zookeeper</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">        KAFKA_BROKER_ID:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">        KAFKA_ZOOKEEPER_CONNECT:</span> <span class="string">'zookeeper:2181'</span></span><br><span class="line"><span class="attr">        KAFKA_LISTENER_SECURITY_PROTOCOL_MAP:</span> <span class="attr">PLAINTEXT:PLAINTEXT,PLAINTEXT_INTERNAL:PLAINTEXT</span></span><br><span class="line"><span class="attr">        KAFKA_ADVERTISED_LISTENERS:</span> <span class="attr">PLAINTEXT://localhost:9092,PLAINTEXT_INTERNAL://broker:29092</span></span><br><span class="line"><span class="attr">        KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">        KAFKA_TRANSACTION_STATE_LOG_MIN_ISR:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">        KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">spring</span></span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡ Docker å®¹å™¨åŒ–éƒ¨ç½² Kafkaï¼Œæ–¹ä¾¿åœ¨å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼ŒKafka åœ¨é¡¹ç›®ä¸­ç”¨äºå¾®æœåŠ¡ä¹‹é—´çš„å¼‚æ­¥é€šä¿¡ï¼Œé€šè¿‡é…ç½®ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œä¸åŒçš„æœåŠ¡å¯ä»¥å‘ä¸åŒçš„ä¸»é¢˜å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œå®ç°äº†ç³»ç»Ÿçš„è§£è€¦å’Œæ‰©å±•æ€§ã€‚ </p>
<h1 id="RabbitMQ-å’Œ-KafkaåŒºåˆ«"><a href="#RabbitMQ-å’Œ-KafkaåŒºåˆ«" class="headerlink" title="RabbitMQ å’Œ KafkaåŒºåˆ«"></a>RabbitMQ å’Œ KafkaåŒºåˆ«</h1><p><strong>æ³¨</strong>: é¡¹ç›®ä¸­å¹¶æ²¡æœ‰å®é™…ç”¨åˆ°rabbitmq, æ²¡æœ‰ç›¸å…³ä»£ç , åªæ˜¯docker-compose.ymlé‡Œæœ‰è€Œå·²</p>
<p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­é€‰æ‹©æ¶ˆæ¯ä¸­é—´ä»¶ï¼ŒRabbitMQ å’Œ Kafka å„æœ‰ä¼˜åŠ£ã€‚ä»¥ä¸‹æ˜¯ RabbitMQ ç›¸å¯¹äº Kafka çš„å‡ ä¸ªæ ¸å¿ƒä¼˜åŠ¿ï¼Œé€‚ç”¨äºä¸€äº›ç‰¹å®šçš„å¾®æœåŠ¡åœºæ™¯ï¼š</p>
<p>âœ… RabbitMQ çš„ä¼˜åŠ¿ï¼ˆå¯¹æ¯” Kafkaï¼‰</p>
<p><strong>æœ€é‡è¦çš„ä¼˜åŠ¿</strong>: ä½å»¶è¿Ÿï¼Œé€‚åˆå®æ—¶è¯·æ±‚å¤„ç†</p>
<ul>
<li>â€¢    RabbitMQ å»¶è¿Ÿä½ï¼Œé€‚åˆè¯·æ±‚-å“åº”æ¨¡å‹æˆ–å¯¹æ¶ˆæ¯å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ã€‚</li>
<li>â€¢    Kafka æ›´é€‚åˆååä¼˜å…ˆçš„æ‰¹é‡å¤„ç†æˆ–æ•°æ®ç®¡é“åœºæ™¯ã€‚<br>ğŸ¯ åŸå› åˆ†æ:<ul>
<li>â€¢    RabbitMQ æ˜¯æ¨æ¨¡å‹ï¼šç”Ÿäº§è€…æŠ•é€’åï¼Œbroker ç«‹å³æ¨é€ç»™æ¶ˆè´¹è€…ï¼Œå‡ ä¹æ²¡æœ‰æ¶ˆè´¹å»¶è¿Ÿã€‚</li>
<li>â€¢    Kafka æ˜¯æ‹‰æ¨¡å‹ï¼šæ¶ˆè´¹è€…è½®è¯¢ poll()ï¼ŒåŠ ä¸Šæ‰¹å¤„ç†æœºåˆ¶ï¼Œä¼šå¸¦æ¥ä¸€å®šå»¶è¿Ÿã€‚</li>
<li>â€¢    Kafka å¼ºä¸€è‡´æ€§ + æŒä¹…åŒ–æœºåˆ¶å¼€é”€æ›´å¤§ï¼šKafka çš„å†™å…¥ä¸€èˆ¬éœ€è¦åˆ·ç›˜ï¼ˆacks=allï¼‰ï¼Œè€Œ RabbitMQ å¯é…ç½®ä¸ºå†…å­˜ä¼˜å…ˆã€‚<br>ğŸ“Œ å®é™…ç»éªŒå»ºè®®:</li>
<li>â€¢    å¯¹ä½å»¶è¿Ÿæœ‰æè‡´è¦æ±‚ï¼ˆ&lt;10msï¼‰ â†’ RabbitMQ æ›´åˆé€‚ã€‚</li>
<li>â€¢    å¯¹å»¶è¿Ÿä¸æ•æ„Ÿä½†ååè¦æ±‚é«˜ï¼ˆå¦‚æ—¥å¿—å¤„ç†ã€å¤§è§„æ¨¡æµå¼å¤„ç†ï¼‰â†’ Kafka æ˜æ˜¾æ›´å¼ºã€‚</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>RabbitMQ</th>
<th>Kafka</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç«¯åˆ°ç«¯å»¶è¿Ÿï¼ˆä½è´Ÿè½½ï¼‰</td>
<td>1â€“5 æ¯«ç§’</td>
<td>10â€“100 æ¯«ç§’</td>
</tr>
<tr>
<td>ç«¯åˆ°ç«¯å»¶è¿Ÿï¼ˆä¸­é«˜è´Ÿè½½ï¼‰</td>
<td>5â€“20 æ¯«ç§’</td>
<td>50â€“200 æ¯«ç§’</td>
</tr>
<tr>
<td>å†™å…¥å»¶è¿Ÿ</td>
<td>1â€“2 æ¯«ç§’</td>
<td>5â€“50 æ¯«ç§’ï¼ˆå–å†³äº acks ç­–ç•¥ã€flush ç­‰ï¼‰</td>
</tr>
<tr>
<td>æ¶ˆè´¹å»¶è¿Ÿ</td>
<td>å®æ—¶æ¨é€ï¼ˆåŸºæœ¬æ— å»¶è¿Ÿï¼‰</td>
<td>æ‹‰å–æ¨¡å¼ï¼ˆå–å†³äº poll å‘¨æœŸï¼‰</td>
</tr>
</tbody>
</table>
<ol>
<li><p>æ›´å¼ºçš„æ¶ˆæ¯è·¯ç”±èƒ½åŠ›ï¼ˆAMQPï¼‰<br> â€¢    RabbitMQ æ”¯æŒå¤šç§ Exchange ç±»å‹ï¼ˆDirectã€Topicã€Fanoutã€Headersï¼‰ï¼Œå¯ä»¥çµæ´»è·¯ç”±æ¶ˆæ¯ã€‚<br> â€¢    Kafka çš„æ¶ˆæ¯è·¯ç”±ä¸»è¦ä¾èµ–äº topic å’Œ keyï¼Œçµæ´»æ€§è¾ƒä½ã€‚</p>
</li>
<li><p>æˆç†Ÿçš„æ¶ˆæ¯ç¡®è®¤ä¸é‡è¯•æœºåˆ¶<br> â€¢    RabbitMQ æ”¯æŒ per-message ackã€dead-letter queueï¼ˆDLQï¼‰ã€retryã€å»¶è¿Ÿé˜Ÿåˆ—ç­‰ï¼Œé€‚åˆå¾®æœåŠ¡é—´å¤æ‚çš„æ¶ˆæ¯æŠ•é€’ä¿éšœã€‚<br> â€¢    Kafka è™½ç„¶æ”¯æŒ consumer offset å’Œæ‰‹åŠ¨æäº¤ï¼Œä½†é‡è¯•å’Œæ­»ä¿¡å¤„ç†éœ€é¢å¤–å®ç°ã€‚</p>
</li>
<li><p>èµ„æºå¼€é”€æ›´ä½ï¼Œéƒ¨ç½²ç®€å•<br> â€¢    RabbitMQ æ¯” Kafka æ›´è½»é‡ï¼Œéƒ¨ç½²ç®€å•ï¼Œé€‚åˆä¸­å°å‹æœåŠ¡ã€‚<br> â€¢    Kafka å¯¹ ZooKeeperã€ç£ç›˜ IOã€ç½‘ç»œååè¦æ±‚æ›´é«˜ï¼Œå¤æ‚åº¦æ›´é«˜ã€‚</p>
</li>
<li><p>æ”¯æŒå¤šç§åè®®ï¼ˆAMQPã€MQTTã€STOMPã€HTTPï¼‰<br> â€¢    RabbitMQ åè®®å±‚çµæ´»ï¼Œå¯ä»¥é€‚é…å„ç§å®¢æˆ·ç«¯ï¼Œåˆ©äºå¼‚æ„ç³»ç»Ÿé›†æˆã€‚</p>
</li>
<li><p>é€‚åˆå‘½ä»¤ã€äº‹ä»¶æ··åˆå‹ç³»ç»Ÿ<br> â€¢    å¾®æœåŠ¡ä¹‹é—´ä¸ä»…ä»…ä¼ é€’æ—¥å¿—/äº‹ä»¶ï¼Œè¿˜åŒ…æ‹¬ä»»åŠ¡æŒ‡ä»¤ï¼ˆCommandï¼‰ï¼›RabbitMQ æ›´é€‚åˆè¿™ç§åœºæ™¯ã€‚</p>
</li>
</ol>
<p>ğŸŸ¨ ä½¿ç”¨ RabbitMQ çš„å…¸å‹åœºæ™¯<br>    â€¢    RPCï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰<br>    â€¢    å®æ—¶ä»»åŠ¡åˆ†å‘ï¼ˆå¦‚è®¢å•å¤„ç†ï¼‰<br>    â€¢    å¼‚æ­¥äº‹åŠ¡è¡¥å¿ï¼ˆSaga æ¨¡å¼ï¼‰<br>    â€¢    é«˜å¯é æ€§æ¶ˆæ¯ä¼ é€’ï¼ˆç¡®ä¿æ¯æ¡æ¶ˆæ¯éƒ½å¤„ç†ï¼‰</p>
<p>âš ï¸ ä»€ä¹ˆæ—¶å€™ä¸è¦ç”¨ RabbitMQï¼Ÿ<br>    â€¢    éœ€è¦æé«˜ååé‡ï¼ˆå¦‚ç™¾ä¸‡çº§ TPSï¼‰ â†’ ç”¨ Kafkaã€‚<br>    â€¢    ç”¨ä½œäº‹ä»¶æº¯æºï¼ˆEvent Sourcingï¼‰ã€æ—¥å¿—èšåˆã€å¤§æ•°æ®é‡‡é›† â†’ Kafka æ›´åˆé€‚ã€‚<br>    â€¢    å¤§é‡æ¶ˆè´¹è€…å¹¶è¡Œå¤„ç†å†å²æ¶ˆæ¯ â†’ Kafka ä¼˜åŠ¿æ˜æ˜¾ã€‚</p>
<p>æ€»ç»“ä¸€å¥è¯ï¼š<br>RabbitMQ é€‚åˆæœåŠ¡é—´é«˜å¯é ã€ä½å»¶è¿Ÿã€çµæ´»è·¯ç”±çš„æ¶ˆæ¯ä¼ é€’ï¼›Kafka é€‚åˆé«˜ååã€å¯æŒä¹…åŒ–ã€å¤§æ•°æ®é©±åŠ¨çš„äº‹ä»¶æµæ¶æ„ã€‚</p>
<h1 id="Resilience4j-Feign-æ˜¯å•¥-é»˜è®¤åŒæ­¥è°ƒç”¨çš„è¯-ä¸ä¼šå¡æ­»å—"><a href="#Resilience4j-Feign-æ˜¯å•¥-é»˜è®¤åŒæ­¥è°ƒç”¨çš„è¯-ä¸ä¼šå¡æ­»å—" class="headerlink" title="Resilience4j? Feign æ˜¯å•¥? é»˜è®¤åŒæ­¥è°ƒç”¨çš„è¯, ä¸ä¼šå¡æ­»å—?"></a>Resilience4j? Feign æ˜¯å•¥? é»˜è®¤åŒæ­¥è°ƒç”¨çš„è¯, ä¸ä¼šå¡æ­»å—?</h1><h2 id="1-Resilience4j-æ˜¯ä»€ä¹ˆ"><a href="#1-Resilience4j-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1. Resilience4j æ˜¯ä»€ä¹ˆ"></a>1. Resilience4j æ˜¯ä»€ä¹ˆ</h2><p>Resilience4j æ˜¯ä¸€ä¸ªè½»é‡çº§ã€æ˜“äºä½¿ç”¨çš„å®¹é”™åº“ï¼Œä¸“ä¸º Java 8 åŠä»¥ä¸Šç‰ˆæœ¬è®¾è®¡ï¼Œä¸»è¦ç”¨äºå¢å¼ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœåŠ¡è°ƒç”¨çš„ç¨³å®šæ€§å’Œå¼¹æ€§ã€‚å®ƒæä¾›äº†å¤šç§å®¹é”™æ¨¡å¼ï¼Œä¾‹å¦‚æ–­è·¯å™¨ï¼ˆCircuit Breakerï¼‰ã€é™æµï¼ˆRate Limiterï¼‰ã€é‡è¯•ï¼ˆRetryï¼‰ã€é™æ—¶å™¨ï¼ˆTime Limiterï¼‰ç­‰ã€‚</p>
<h3 id="åœ¨ä»£ç åº“ä¸­çš„ä½“ç°"><a href="#åœ¨ä»£ç åº“ä¸­çš„ä½“ç°" class="headerlink" title="åœ¨ä»£ç åº“ä¸­çš„ä½“ç°"></a>åœ¨ä»£ç åº“ä¸­çš„ä½“ç°</h3><p>åœ¨ <code>twitter - spring - reactjs</code> é¡¹ç›®é‡Œï¼Œå¤šä¸ªæœåŠ¡çš„ <code>pom.xml</code> æ–‡ä»¶éƒ½å¼•å…¥äº† <code>spring - cloud - starter - circuitbreaker - resilience4j</code> ä¾èµ–ï¼Œåƒ <code>notification - service/pom.xml</code>ã€<code>lists - service/pom.xml</code> ç­‰ï¼Œè¡¨æ˜é¡¹ç›®ä½¿ç”¨ Resilience4j æ¥å®ç°æœåŠ¡è°ƒç”¨çš„å®¹é”™åŠŸèƒ½ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-circuitbreaker-resilience4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åŒæ—¶ï¼Œåœ¨å¤šä¸ªæœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚ <code>topic - service.yml</code>ã€<code>tag - service.yml</code> ç­‰ï¼‰ä¸­é…ç½®äº†æ–­è·¯å™¨çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">resilience4j:</span></span><br><span class="line"><span class="attr">    circuitbreaker:</span></span><br><span class="line"><span class="attr">        instances:</span></span><br><span class="line">            <span class="string">user</span> <span class="bullet">-</span> <span class="attr">service:</span></span><br><span class="line">                <span class="string">minimum</span> <span class="bullet">-</span> <span class="string">number</span> <span class="bullet">-</span> <span class="string">of</span> <span class="bullet">-</span> <span class="attr">calls:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<h2 id="2-Feign-æ˜¯ä»€ä¹ˆ"><a href="#2-Feign-æ˜¯ä»€ä¹ˆ" class="headerlink" title="2. Feign æ˜¯ä»€ä¹ˆ"></a>2. Feign æ˜¯ä»€ä¹ˆ</h2><p>Feign æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„ Web æœåŠ¡å®¢æˆ·ç«¯ï¼Œç”± Netflix å¼€å‘å¹¶å¼€æºã€‚å®ƒä½¿å¾—ç¼–å†™ Web æœåŠ¡å®¢æˆ·ç«¯å˜å¾—æ›´åŠ ç®€å•ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶åœ¨æ¥å£ä¸Šæ·»åŠ æ³¨è§£ï¼ŒFeign å°±ä¼šè‡ªåŠ¨åˆ›å»ºè¯¥æ¥å£çš„å®ç°ç±»å¹¶å®Œæˆ HTTP è¯·æ±‚çš„å‘é€ã€‚</p>
<h3 id="åœ¨ä»£ç åº“ä¸­çš„ä½“ç°-1"><a href="#åœ¨ä»£ç åº“ä¸­çš„ä½“ç°-1" class="headerlink" title="åœ¨ä»£ç åº“ä¸­çš„ä½“ç°"></a>åœ¨ä»£ç åº“ä¸­çš„ä½“ç°</h3><p>åœ¨ <code>twitter - spring - reactjs</code> é¡¹ç›®ä¸­ï¼Œæœ‰å¤§é‡ä½¿ç”¨ Feign çš„ç¤ºä¾‹ã€‚ä¾‹å¦‚ <code>scheduler - service/src/main/java/com/gmail/merikbest2015/client/TweetClient.java</code> æ–‡ä»¶ä¸­ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(name = FeignConstants.TWEET_SERVICE, path = PathConstants.API_V1_TWEETS, configuration = FeignConfiguration.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TweetClient</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PostMapping</span>(PathConstants.USER_BATCH_JOB)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">runImportUsersBatchJob</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª Feign å®¢æˆ·ç«¯æ¥å£ <code>TweetClient</code>ï¼Œç”¨äºè°ƒç”¨ <code>tweet - service</code> çš„ç›¸å…³æ¥å£ã€‚</p>
<h2 id="3-é»˜è®¤åŒæ­¥è°ƒç”¨æ˜¯å¦ä¼šå¡æ­»"><a href="#3-é»˜è®¤åŒæ­¥è°ƒç”¨æ˜¯å¦ä¼šå¡æ­»" class="headerlink" title="3. é»˜è®¤åŒæ­¥è°ƒç”¨æ˜¯å¦ä¼šå¡æ­»"></a>3. é»˜è®¤åŒæ­¥è°ƒç”¨æ˜¯å¦ä¼šå¡æ­»</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒFeign æ˜¯åŒæ­¥è°ƒç”¨çš„ï¼Œå³å®¢æˆ·ç«¯åœ¨å‘é€è¯·æ±‚åä¼šé˜»å¡ï¼Œç›´åˆ°æ”¶åˆ°æœåŠ¡ç«¯çš„å“åº”ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒåŒæ­¥è°ƒç”¨å¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œç”šè‡³å‡ºç°å¡æ­»çš„æƒ…å†µï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><strong>æœåŠ¡ç«¯å“åº”æ…¢</strong>ï¼šå¦‚æœæœåŠ¡ç«¯å¤„ç†è¯·æ±‚çš„æ—¶é—´è¿‡é•¿ï¼Œå®¢æˆ·ç«¯çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œå¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹èµ„æºè€—å°½ï¼Œå½±å“ç³»ç»Ÿçš„æ€§èƒ½ã€‚</li>
<li><strong>æœåŠ¡ç«¯æ•…éšœ</strong>ï¼šå¦‚æœæœåŠ¡ç«¯å‡ºç°æ•…éšœï¼Œæ— æ³•æ­£å¸¸å“åº”è¯·æ±‚ï¼Œå®¢æˆ·ç«¯çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°è¶…æ—¶ã€‚</li>
</ul>
<h3 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h3><p>ä¸ºäº†é¿å…åŒæ­¥è°ƒç”¨å¸¦æ¥çš„é—®é¢˜ï¼Œå¯ä»¥ç»“åˆä½¿ç”¨ Resilience4j æä¾›çš„å®¹é”™æœºåˆ¶ï¼š</p>
<ul>
<li><p><strong>æ–­è·¯å™¨ï¼ˆCircuit Breakerï¼‰</strong>ï¼šå½“æœåŠ¡è°ƒç”¨å¤±è´¥çš„æ¬¡æ•°è¾¾åˆ°ä¸€å®šé˜ˆå€¼æ—¶ï¼Œæ–­è·¯å™¨ä¼šæ‰“å¼€ï¼Œåç»­çš„è¯·æ±‚å°†ç›´æ¥è¿”å›é”™è¯¯ï¼Œè€Œä¸æ˜¯ç»§ç»­ç­‰å¾…æœåŠ¡ç«¯çš„å“åº”ï¼Œé¿å…çº¿ç¨‹é•¿æ—¶é—´é˜»å¡ã€‚ä¾‹å¦‚åœ¨ <code>tag - service/src/main/java/com/gmail/merikbest2015/client/TweetClient.java</code> ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CircuitBreaker</span>(name = FeignConstants.TWEET_SERVICE, fallbackMethod = <span class="string">"defaultEmptyTweetList"</span>)</span><br><span class="line"><span class="meta">@FeignClient</span>(value = FeignConstants.TWEET_SERVICE, path = PathConstants.API_V1_TWEETS, configuration = FeignConfiguration.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TweetClient</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PostMapping</span>(PathConstants.IDS)</span><br><span class="line">    <span class="function">List&lt;TweetResponse&gt; <span class="title">getTweetsByIds</span><span class="params">(@RequestBody IdsRequest request)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> ArrayList&lt;TweetResponse&gt; <span class="title">defaultEmptyTweetList</span><span class="params">(Throwable throwable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>é™æ—¶å™¨ï¼ˆTime Limiterï¼‰</strong>ï¼šå¯ä»¥ä¸ºæ¯ä¸ªæœåŠ¡è°ƒç”¨è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå½“è°ƒç”¨æ—¶é—´è¶…è¿‡è¯¥æ—¶é—´æ—¶ï¼Œä¼šæŠ›å‡ºè¶…æ—¶å¼‚å¸¸ï¼Œé¿å…çº¿ç¨‹æ— é™æœŸé˜»å¡ã€‚</p>
</li>
</ul>
<p>é€šè¿‡è¿™äº›å®¹é”™æœºåˆ¶ï¼Œå¯ä»¥æœ‰æ•ˆæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œé¿å…åŒæ­¥è°ƒç”¨å¯èƒ½å¸¦æ¥çš„å¡æ­»é—®é¢˜ã€‚ </p>
<h1 id="Lombok-æ˜¯-Entity-çš„æ›¿ä»£å“å—-ä¼˜åŠ¿å¦‚ä½•"><a href="#Lombok-æ˜¯-Entity-çš„æ›¿ä»£å“å—-ä¼˜åŠ¿å¦‚ä½•" class="headerlink" title="Lombok æ˜¯ @Entity çš„æ›¿ä»£å“å—? ä¼˜åŠ¿å¦‚ä½•?"></a>Lombok æ˜¯ @Entity çš„æ›¿ä»£å“å—? ä¼˜åŠ¿å¦‚ä½•?</h1><p>Lombok å¹¶ä¸æ˜¯ <code>@Entity</code> çš„æ›¿ä»£å“ï¼Œå®ƒä»¬åœ¨ Java å¼€å‘ä¸­æ‰¿æ‹…ç€ä¸åŒçš„è§’è‰²ï¼Œä¸‹é¢ä»å®ƒä»¬å„è‡ªçš„åŠŸèƒ½ã€åŒºåˆ«ä»¥åŠ Lombok çš„ä¼˜åŠ¿ç­‰æ–¹é¢è¿›è¡Œè¯¦ç»†åˆ†æã€‚</p>
<h2 id="1-Entity-å’Œ-Lombok-çš„åŠŸèƒ½"><a href="#1-Entity-å’Œ-Lombok-çš„åŠŸèƒ½" class="headerlink" title="1. @Entity å’Œ Lombok çš„åŠŸèƒ½"></a>1. <code>@Entity</code> å’Œ Lombok çš„åŠŸèƒ½</h2><ul>
<li><p><strong><code>@Entity</code></strong>ï¼š<code>@Entity</code> æ˜¯ JPAï¼ˆJava Persistence APIï¼‰ä¸­çš„ä¸€ä¸ªæ³¨è§£ï¼Œç”¨äºå°†ä¸€ä¸ª Java ç±»æ˜ å°„åˆ°æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ã€‚å®ƒä¸»è¦ç”¨äºå®šä¹‰å®ä½“ç±»ï¼Œä½¿å¾—è¯¥ç±»å¯ä»¥ä¸æ•°æ®åº“ä¸­çš„è¡¨è¿›è¡Œäº¤äº’ï¼Œå®ç°æ•°æ®çš„æŒä¹…åŒ–æ“ä½œã€‚åœ¨ä»£ç åº“ä¸­ï¼Œåƒ <code>twitter-spring-reactjs/tweet-service/src/main/java/com/gmail/merikbest2015/model/User.java</code> æ–‡ä»¶é‡Œçš„ <code>User</code> ç±»å°±ä½¿ç”¨äº† <code>@Entity</code> æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span>(of = <span class="string">"id"</span>)</span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç±»çš„å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Lombok</strong>ï¼šLombok æ˜¯ä¸€ä¸ª Java åº“ï¼Œå®ƒé€šè¿‡æ³¨è§£çš„æ–¹å¼ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µè‡ªåŠ¨ç”Ÿæˆ Java ç±»çš„ getterã€setterã€æ„é€ å‡½æ•°ã€toString ç­‰æ–¹æ³•ï¼Œä»è€Œå‡å°‘æ ·æ¿ä»£ç çš„ç¼–å†™ã€‚ä¾‹å¦‚ï¼Œä¸Šè¿° <code>User</code> ç±»ä¸­ä½¿ç”¨çš„ <code>@Getter</code>ã€<code>@Setter</code>ã€<code>@NoArgsConstructor</code> ç­‰æ³¨è§£éƒ½æ˜¯ Lombok æä¾›çš„ã€‚</p>
</li>
</ul>
<h2 id="2-ä¸ºä»€ä¹ˆ-Lombok-ä¸æ˜¯-Entity-çš„æ›¿ä»£å“"><a href="#2-ä¸ºä»€ä¹ˆ-Lombok-ä¸æ˜¯-Entity-çš„æ›¿ä»£å“" class="headerlink" title="2. ä¸ºä»€ä¹ˆ Lombok ä¸æ˜¯ @Entity çš„æ›¿ä»£å“"></a>2. ä¸ºä»€ä¹ˆ Lombok ä¸æ˜¯ <code>@Entity</code> çš„æ›¿ä»£å“</h2><ul>
<li><strong>åŠŸèƒ½ä¾§é‡ç‚¹ä¸åŒ</strong>ï¼š<code>@Entity</code> çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å»ºç«‹ Java ç±»ä¸æ•°æ®åº“è¡¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œä¾§é‡äºæ•°æ®æŒä¹…åŒ–æ–¹é¢çš„æ“ä½œï¼›è€Œ Lombok ä¸»è¦æ˜¯ä¸ºäº†ç®€åŒ– Java ç±»çš„ç¼–å†™ï¼Œå‡å°‘é‡å¤ä»£ç ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</li>
<li><strong>ç›¸äº’é…åˆä½¿ç”¨</strong>ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œ<code>@Entity</code> å’Œ Lombok é€šå¸¸æ˜¯ç›¸äº’é…åˆä½¿ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨å®šä¹‰å®ä½“ç±»æ—¶ï¼Œæ—¢éœ€è¦ä½¿ç”¨ <code>@Entity</code> æ³¨è§£å°†ç±»æ˜ å°„åˆ°æ•°æ®åº“è¡¨ï¼Œåˆå¯ä»¥ä½¿ç”¨ Lombok æ³¨è§£æ¥è‡ªåŠ¨ç”Ÿæˆä¸€äº›å¿…è¦çš„æ–¹æ³•ã€‚</li>
</ul>
<h2 id="3-Lombok-çš„ä¼˜åŠ¿"><a href="#3-Lombok-çš„ä¼˜åŠ¿" class="headerlink" title="3. Lombok çš„ä¼˜åŠ¿"></a>3. Lombok çš„ä¼˜åŠ¿</h2><ul>
<li><strong>å‡å°‘æ ·æ¿ä»£ç </strong>ï¼šä½¿ç”¨ Lombok å¯ä»¥æ˜¾è‘—å‡å°‘ Java ç±»ä¸­çš„æ ·æ¿ä»£ç ã€‚ä¾‹å¦‚ï¼Œåœ¨æ²¡æœ‰ä½¿ç”¨ Lombok çš„æƒ…å†µä¸‹ï¼Œéœ€è¦æ‰‹åŠ¨ç¼–å†™ getterã€setterã€æ„é€ å‡½æ•°ç­‰æ–¹æ³•ï¼š<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String fullName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFullName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fullName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFullName</span><span class="params">(String fullName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fullName = fullName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>è€Œä½¿ç”¨ Lombok åï¼Œåªéœ€è¦æ·»åŠ ç›¸åº”çš„æ³¨è§£å³å¯ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String fullName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§</strong>ï¼šå‡å°‘äº†å¤§é‡çš„æ ·æ¿ä»£ç åï¼Œä»£ç å˜å¾—æ›´åŠ ç®€æ´ï¼Œå¼€å‘è€…å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
<li><strong>é™ä½å‡ºé”™æ¦‚ç‡</strong>ï¼šæ‰‹åŠ¨ç¼–å†™ getterã€setter ç­‰æ–¹æ³•æ—¶ï¼Œå®¹æ˜“å‡ºç°æ‹¼å†™é”™è¯¯æˆ–é€»è¾‘é”™è¯¯ã€‚ä½¿ç”¨ Lombok è‡ªåŠ¨ç”Ÿæˆè¿™äº›æ–¹æ³•å¯ä»¥é¿å…è¿™äº›é—®é¢˜ï¼Œé™ä½å‡ºé”™æ¦‚ç‡ã€‚</li>
</ul>
<p>ç»¼ä¸Šæ‰€è¿°ï¼ŒLombok å’Œ <code>@Entity</code> åœ¨ Java å¼€å‘ä¸­èµ·ç€ä¸åŒçš„ä½œç”¨ï¼Œå®ƒä»¬ç›¸äº’é…åˆå¯ä»¥æé«˜å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚Lombok çš„ä¸»è¦ä¼˜åŠ¿åœ¨äºå‡å°‘æ ·æ¿ä»£ç ã€æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ä»¥åŠé™ä½å‡ºé”™æ¦‚ç‡ã€‚ </p>
<h1 id="Eurekaæ˜¯ç±»ä¼¼äºetcdé‚£ç§çš„ç¬¬ä¸‰æ–¹è¿›ç¨‹å—-å¦‚ä½•æ¥å…¥-å¦‚ä½•æ³¨å†Œ-æ¥å…¥äº†k8sè¿˜éœ€è¦eurekaå—"><a href="#Eurekaæ˜¯ç±»ä¼¼äºetcdé‚£ç§çš„ç¬¬ä¸‰æ–¹è¿›ç¨‹å—-å¦‚ä½•æ¥å…¥-å¦‚ä½•æ³¨å†Œ-æ¥å…¥äº†k8sè¿˜éœ€è¦eurekaå—" class="headerlink" title="Eurekaæ˜¯ç±»ä¼¼äºetcdé‚£ç§çš„ç¬¬ä¸‰æ–¹è¿›ç¨‹å—? å¦‚ä½•æ¥å…¥, å¦‚ä½•æ³¨å†Œ?æ¥å…¥äº†k8sè¿˜éœ€è¦eurekaå—"></a>Eurekaæ˜¯ç±»ä¼¼äºetcdé‚£ç§çš„ç¬¬ä¸‰æ–¹è¿›ç¨‹å—? å¦‚ä½•æ¥å…¥, å¦‚ä½•æ³¨å†Œ?æ¥å…¥äº†k8sè¿˜éœ€è¦eurekaå—</h1><ul>
<li>Eureka æ˜¯ Netflix å¼€æºçš„æœåŠ¡å‘ç°ç»„ä»¶ï¼Œåœ¨ Spring Cloud ä½“ç³»ä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œç”¨äºå®ç°æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚å®ƒå’Œ etcd ä¸åŒ, ä»–å¯ä»¥åŠ ä¸ªæ³¨è§£ <code>@EnableEurekaServer</code>å°±æŠŠä¸€ä¸ªspringbootè¿›ç¨‹å˜æˆä¸€ä¸ª eurekaæ³¨å†Œä¸­å¿ƒ</li>
<li>etcd æ˜¯ä¸€ä¸ªgoè¯­è¨€çš„åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿï¼Œå¸¸ç”¨äºæœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†ç­‰åœºæ™¯ï¼›è€Œ Eureka ä¸“é—¨ç”¨äºæœåŠ¡æ³¨å†Œä¸å‘ç°ã€‚</li>
</ul>
<h2 id="Eureka-ä½œä¸ºç¬¬ä¸‰æ–¹è¿›ç¨‹çš„ä½¿ç”¨æ–¹å¼"><a href="#Eureka-ä½œä¸ºç¬¬ä¸‰æ–¹è¿›ç¨‹çš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="Eureka ä½œä¸ºç¬¬ä¸‰æ–¹è¿›ç¨‹çš„ä½¿ç”¨æ–¹å¼"></a>Eureka ä½œä¸ºç¬¬ä¸‰æ–¹è¿›ç¨‹çš„ä½¿ç”¨æ–¹å¼</h2><p>åœ¨ Spring Cloud é¡¹ç›®é‡Œï¼ŒEureka é€šå¸¸ä»¥ç‹¬ç«‹æœåŠ¡ï¼ˆEureka Serverï¼‰çš„å½¢å¼è¿è¡Œï¼Œå°±åƒä¸€ä¸ªå•ç‹¬çš„ç¬¬ä¸‰æ–¹è¿›ç¨‹ã€‚ä» <code>twitter-spring-reactjs</code> é¡¹ç›®çš„é…ç½®æ¥çœ‹ï¼ŒEureka Server æ˜¯é€šè¿‡ Docker å®¹å™¨æ¥å¯åŠ¨çš„ï¼Œç›¸å…³é…ç½®å¦‚ä¸‹ï¼š<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">eureka-server:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">merikbest/twitter-spring-reactjs:eureka-server</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">eureka-server</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">eureka-server</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">        EUREKA_HOST:</span> <span class="string">eureka-server</span></span><br><span class="line"><span class="attr">        ZIPKIN_HOST:</span> <span class="string">zipkin</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">"8761:8761"</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">spring</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">zipkin</span></span><br></pre></td></tr></table></figure></p>
<p>ä»è¿™ä¸ªé…ç½®èƒ½å¤Ÿçœ‹å‡ºï¼ŒEureka Server è¿è¡Œåœ¨ç«¯å£ 8761 ä¸Šã€‚</p>
<h2 id="æ¥å…¥-Eureka-Server"><a href="#æ¥å…¥-Eureka-Server" class="headerlink" title="æ¥å…¥ Eureka Server"></a>æ¥å…¥ Eureka Server</h2><p>è¦è®©æœåŠ¡æ¥å…¥ Eureka Serverï¼Œéœ€è¦åœ¨æœåŠ¡çš„é…ç½®æ–‡ä»¶é‡ŒæŒ‡å®š Eureka Server çš„åœ°å€ã€‚ä»¥ <code>tweet-service</code> ä¸ºä¾‹ï¼Œå…¶é…ç½®æ–‡ä»¶ <code>config-server/src/main/resources/config/tweet-service.yml</code> ä¸­æœ‰å¦‚ä¸‹é…ç½®ï¼š<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">    client:</span></span><br><span class="line"><span class="attr">        service-url:</span></span><br><span class="line"><span class="attr">            defaultZone:</span> <span class="attr">http://$&#123;EUREKA_HOST:localhost&#125;:8761/eureka</span></span><br><span class="line"><span class="attr">        fetch-registry:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">        register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    instance:</span></span><br><span class="line"><span class="attr">        hostname:</span> <span class="string">$&#123;EUREKA_HOST:localhost&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œçš„ <code>defaultZone</code> æŒ‡å®šäº† Eureka Server çš„åœ°å€ï¼Œ<code>fetch-registry</code> è¡¨ç¤ºæ˜¯å¦ä» Eureka Server è·å–æœåŠ¡æ³¨å†Œä¿¡æ¯ï¼Œ<code>register-with-eureka</code> è¡¨ç¤ºæ˜¯å¦å°†å½“å‰æœåŠ¡æ³¨å†Œåˆ° Eureka Serverã€‚</p>
<h2 id="æ³¨å†ŒæœåŠ¡åˆ°-Eureka-Server"><a href="#æ³¨å†ŒæœåŠ¡åˆ°-Eureka-Server" class="headerlink" title="æ³¨å†ŒæœåŠ¡åˆ° Eureka Server"></a>æ³¨å†ŒæœåŠ¡åˆ° Eureka Server</h2><p>è¦æŠŠæœåŠ¡æ³¨å†Œåˆ° Eureka Serverï¼Œé™¤äº†åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š Eureka Server çš„åœ°å€ä¹‹å¤–ï¼Œè¿˜éœ€è¦åœ¨æœåŠ¡çš„å¯åŠ¨ç±»ä¸Šæ·»åŠ ç›¸åº”çš„æ³¨è§£ã€‚ä»¥ä¸‹æ˜¯ Eureka Server çš„å¯åŠ¨ç±»ç¤ºä¾‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gmail.merikbest2015;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaServerApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EurekaServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯¹äºéœ€è¦æ³¨å†Œçš„æœåŠ¡ï¼Œåœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ  <code>@EnableEurekaClient</code> æ³¨è§£ï¼ˆSpring Cloud Edgware åŠæ›´é«˜ç‰ˆæœ¬ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>@EnableDiscoveryClient</code>ï¼‰ï¼ŒåŒæ—¶ç¡®ä¿é…ç½®æ–‡ä»¶ä¸­ <code>register-with-eureka</code> ä¸º <code>true</code>ã€‚ä¾‹å¦‚ï¼Œåœ¨ <code>tweet-service</code> é‡Œæ·»åŠ ç›¸åº”æ³¨è§£åï¼ŒæœåŠ¡å¯åŠ¨æ—¶å°±ä¼šè‡ªåŠ¨æ³¨å†Œåˆ° Eureka Serverã€‚</p>
<h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><strong>Eureka Server</strong>ï¼šä»¥ç‹¬ç«‹æœåŠ¡çš„å½¢å¼è¿è¡Œï¼Œé€šè¿‡ Docker å®¹å™¨å¯åŠ¨ã€‚</li>
<li><strong>æ¥å…¥ Eureka Server</strong>ï¼šåœ¨æœåŠ¡çš„é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š Eureka Server çš„åœ°å€ã€‚</li>
<li><strong>æ³¨å†ŒæœåŠ¡</strong>ï¼šåœ¨æœåŠ¡çš„å¯åŠ¨ç±»ä¸Šæ·»åŠ  <code>@EnableEurekaClient</code> æ³¨è§£ï¼ŒåŒæ—¶ç¡®ä¿é…ç½®æ–‡ä»¶ä¸­ <code>register-with-eureka</code> ä¸º <code>true</code>ã€‚ </li>
</ul>
<p>æ¥å…¥Kubernetesï¼ˆk8sï¼‰åï¼Œæ˜¯å¦è¿˜éœ€è¦Eurekaå–å†³äºå…·ä½“çš„ä¸šåŠ¡åœºæ™¯å’Œéœ€æ±‚ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§ä¸åŒæƒ…å†µçš„åˆ†æï¼š</p>
<h2 id="æœ‰k8sä¸éœ€è¦Eurekaçš„æƒ…å†µ"><a href="#æœ‰k8sä¸éœ€è¦Eurekaçš„æƒ…å†µ" class="headerlink" title="æœ‰k8sä¸éœ€è¦Eurekaçš„æƒ…å†µ"></a>æœ‰k8sä¸éœ€è¦Eurekaçš„æƒ…å†µ</h2><ul>
<li><strong>æœåŠ¡å‘ç°åŠŸèƒ½å¯ç”±k8sæ›¿ä»£</strong>ï¼šKubernetesæœ¬èº«æä¾›äº†å¼ºå¤§çš„æœåŠ¡å‘ç°æœºåˆ¶ã€‚é€šè¿‡ä½¿ç”¨Kubernetesçš„Serviceèµ„æºï¼ŒæœåŠ¡ä¹‹é—´å¯ä»¥é€šè¿‡æœåŠ¡åè¿›è¡Œé€šä¿¡ï¼ŒKubernetesä¼šè‡ªåŠ¨å¤„ç†æœåŠ¡çš„è´Ÿè½½å‡è¡¡å’Œç«¯ç‚¹ç®¡ç†ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªä½¿ç”¨k8séƒ¨ç½²çš„å¾®æœåŠ¡åº”ç”¨ä¸­ï¼Œå„ä¸ªæœåŠ¡å¯ä»¥é€šè¿‡å®šä¹‰çš„Serviceåç§°æ¥ç›¸äº’è®¿é—®ï¼Œæ— éœ€é¢å¤–çš„æœåŠ¡å‘ç°ç»„ä»¶ã€‚<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">my-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">MyApp</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">9376</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>åœ¨ä¸Šè¿°é…ç½®ä¸­ï¼Œå…¶ä»–æœåŠ¡å¯ä»¥é€šè¿‡<code>my-service</code>è¿™ä¸ªåç§°æ¥è®¿é—®å¯¹åº”çš„åº”ç”¨å®ä¾‹ã€‚</p>
<ul>
<li><strong>ç®€åŒ–æ¶æ„å’Œç»´æŠ¤æˆæœ¬</strong>ï¼šå¼•å…¥é¢å¤–çš„ç»„ä»¶ï¼ˆå¦‚Eurekaï¼‰ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§å’Œç»´æŠ¤æˆæœ¬ã€‚ä½¿ç”¨k8sçš„åŸç”ŸåŠŸèƒ½å¯ä»¥å‡å°‘å¯¹ç¬¬ä¸‰æ–¹æœåŠ¡å‘ç°ç»„ä»¶çš„ä¾èµ–ï¼Œé™ä½ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚ä¾‹å¦‚ï¼Œå‡å°‘äº†å¯¹EurekaæœåŠ¡å™¨çš„éƒ¨ç½²ã€é…ç½®å’Œç›‘æ§å·¥ä½œã€‚</li>
</ul>
<h2 id="éœ€è¦Eurekaçš„æƒ…å†µ"><a href="#éœ€è¦Eurekaçš„æƒ…å†µ" class="headerlink" title="éœ€è¦Eurekaçš„æƒ…å†µ"></a>éœ€è¦Eurekaçš„æƒ…å†µ</h2><ul>
<li><strong>å·²æœ‰åŸºäºEurekaçš„æ¶æ„</strong>ï¼šå¦‚æœé¡¹ç›®å·²ç»åŸºäºSpring Cloudå’ŒEurekaæ„å»ºäº†æˆç†Ÿçš„å¾®æœåŠ¡æ¶æ„ï¼Œå¹¶ä¸”æœ‰å¤§é‡çš„ä¸šåŠ¡é€»è¾‘å’Œé…ç½®ä¾èµ–äºEurekaï¼Œè¿ç§»åˆ°Kubernetesçš„åŸç”ŸæœåŠ¡å‘ç°æœºåˆ¶å¯èƒ½éœ€è¦ä»˜å‡ºè¾ƒå¤§çš„æˆæœ¬ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘åœ¨Kubernetesç¯å¢ƒä¸­ç»§ç»­ä½¿ç”¨Eurekaã€‚</li>
<li><strong>è·¨é›†ç¾¤æˆ–æ··åˆäº‘åœºæ™¯</strong>ï¼šåœ¨è·¨å¤šä¸ªKubernetesé›†ç¾¤æˆ–æ··åˆäº‘ç¯å¢ƒä¸­ï¼ŒKubernetesçš„åŸç”ŸæœåŠ¡å‘ç°æœºåˆ¶å¯èƒ½æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚Eurekaå¯ä»¥æä¾›è·¨é›†ç¾¤å’Œè·¨äº‘ç¯å¢ƒçš„æœåŠ¡å‘ç°åŠŸèƒ½ï¼Œç¡®ä¿ä¸åŒç¯å¢ƒä¸­çš„æœåŠ¡å¯ä»¥ç›¸äº’å‘ç°å’Œé€šä¿¡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªä¼ä¸šåœ¨å…¬æœ‰äº‘å’Œç§æœ‰äº‘éƒ½æœ‰éƒ¨ç½²æœåŠ¡ï¼Œä½¿ç”¨Eurekaå¯ä»¥æ–¹ä¾¿åœ°å®ç°æœåŠ¡çš„ç»Ÿä¸€ç®¡ç†å’Œå‘ç°ã€‚</li>
<li><strong>ç‰¹å®šçš„ä¸šåŠ¡éœ€æ±‚</strong>ï¼šEurekaæä¾›äº†ä¸€äº›KubernetesåŸç”ŸæœåŠ¡å‘ç°æœºåˆ¶æ²¡æœ‰çš„åŠŸèƒ½ï¼Œå¦‚æœåŠ¡çš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ã€æœåŠ¡çš„å¥åº·æ£€æŸ¥å’Œç›‘æ§ç­‰ã€‚å¦‚æœé¡¹ç›®å¯¹è¿™äº›åŠŸèƒ½æœ‰ç‰¹å®šçš„éœ€æ±‚ï¼Œé‚£ä¹ˆå¯ä»¥ç»§ç»­ä½¿ç”¨Eurekaã€‚</li>
</ul>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œæ¥å…¥Kubernetesåæ˜¯å¦è¿˜éœ€è¦Eurekaéœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯ã€æŠ€æœ¯æ¶æ„å’Œéœ€æ±‚æ¥å†³å®šã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œä½¿ç”¨Kubernetesçš„åŸç”ŸæœåŠ¡å‘ç°æœºåˆ¶å¯ä»¥ç®€åŒ–æ¶æ„å’Œç»´æŠ¤æˆæœ¬ï¼›ä½†åœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ä¸‹ï¼ŒEurekaä»ç„¶å¯ä»¥å‘æŒ¥é‡è¦ä½œç”¨ã€‚ </p>
<h1 id="é¡¹ç›®é‡Œçš„api-gatewayå¹²å•¥çš„"><a href="#é¡¹ç›®é‡Œçš„api-gatewayå¹²å•¥çš„" class="headerlink" title="é¡¹ç›®é‡Œçš„api-gatewayå¹²å•¥çš„"></a>é¡¹ç›®é‡Œçš„api-gatewayå¹²å•¥çš„</h1><p>åœ¨è¿™ä¸ª Twitter å…‹éš†é¡¹ç›®ä¸­ï¼ŒAPI Gatewayï¼ˆAPI ç½‘å…³ï¼‰èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œå®ƒæ˜¯ç³»ç»Ÿå¯¹å¤–çš„ç»Ÿä¸€å…¥å£ï¼Œè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶å°†è¿™äº›è¯·æ±‚è·¯ç”±åˆ°å¯¹åº”çš„å¾®æœåŠ¡ã€‚ä»¥ä¸‹ç»“åˆä»£ç å’Œæ–‡æ¡£è¯¦ç»†ä»‹ç»å…¶åŠŸèƒ½ï¼š</p>
<h2 id="1-è·¯ç”±è¯·æ±‚"><a href="#1-è·¯ç”±è¯·æ±‚" class="headerlink" title="1. è·¯ç”±è¯·æ±‚"></a>1. è·¯ç”±è¯·æ±‚</h2><p>API ç½‘å…³çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€æ˜¯æ ¹æ®è¯·æ±‚çš„è·¯å¾„å°†å…¶è·¯ç”±åˆ°ç›¸åº”çš„å¾®æœåŠ¡ã€‚åœ¨ <code>config-server/src/main/resources/config/api-gateway.yml</code> æ–‡ä»¶ä¸­ï¼Œå®šä¹‰äº†å¤šä¸ªè·¯ç”±è§„åˆ™ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight yaml"><figcaption><span>api-gateway.yml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    gateway:</span></span><br><span class="line"><span class="attr">      routes:</span></span><br><span class="line"><span class="attr">        - id:</span> <span class="string">topic-service</span></span><br><span class="line"><span class="attr">          uri:</span> <span class="attr">lb://topic-service</span></span><br><span class="line"><span class="attr">          predicates:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">Path=/ui/v1/topics/**</span></span><br><span class="line"><span class="attr">          filters:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">AuthFilter</span></span><br><span class="line"></span><br><span class="line"><span class="attr">        - id:</span> <span class="string">tweet-service</span></span><br><span class="line"><span class="attr">          uri:</span> <span class="attr">lb://tweet-service</span></span><br><span class="line"><span class="attr">          predicates:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">Path=/ui/v1/tweets/**,</span> <span class="string">/api/v1/tweets/**</span></span><br><span class="line"><span class="attr">          filters:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">AuthFilter</span></span><br></pre></td></tr></table></figure></p>
<p>ä¸Šè¿°é…ç½®è¡¨æ˜ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚è·¯å¾„åŒ¹é… <code>/ui/v1/topics/**</code> æ—¶ï¼ŒAPI ç½‘å…³ä¼šå°†è¯·æ±‚è·¯ç”±åˆ° <code>topic-service</code> å¾®æœåŠ¡ï¼›å½“è¯·æ±‚è·¯å¾„åŒ¹é… <code>/ui/v1/tweets/**</code> æˆ– <code>/api/v1/tweets/**</code> æ—¶ï¼Œä¼šå°†è¯·æ±‚è·¯ç”±åˆ° <code>tweet-service</code> å¾®æœåŠ¡ã€‚</p>
<h2 id="2-æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡"><a href="#2-æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡" class="headerlink" title="2. æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡"></a>2. æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡</h2><p>API ç½‘å…³é›†æˆäº†æœåŠ¡å‘ç°æœºåˆ¶ï¼Œé…ç½®æ–‡ä»¶æœ«å°¾è¿˜é…ç½®äº†å€ŸåŠ© Eureka æ¥æŸ¥æ‰¾å¯ç”¨çš„å¾®æœåŠ¡å®ä¾‹ã€‚é…ç½®æ–‡ä»¶ä¸­å…³äº Eureka çš„éƒ¨åˆ†å¦‚ä¸‹ï¼š<br><figure class="highlight yaml"><figcaption><span>api-gateway.yml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://$&#123;EUREKA_HOST:localhost&#125;:8761/eureka</span></span><br><span class="line"><span class="attr">    fetch-registry:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">$&#123;EUREKA_HOST:localhost&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œçš„ <code>defaultZone</code> æŒ‡å®šäº† Eureka Server çš„åœ°å€ï¼ŒAPI ç½‘å…³ä¼šä» Eureka ä¸­è·å–æœåŠ¡æ³¨å†Œä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨ <code>lb://</code> å‰ç¼€å®ç°è´Ÿè½½å‡è¡¡ã€‚ä¾‹å¦‚ <code>uri: lb://topic-service</code> è¡¨ç¤ºå°†è¯·æ±‚è´Ÿè½½å‡è¡¡åˆ° <code>topic-service</code> çš„å¤šä¸ªå®ä¾‹ä¸Šã€‚</p>
<h2 id="3-è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰é…ç½®"><a href="#3-è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰é…ç½®" class="headerlink" title="3. è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰é…ç½®"></a>3. è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰é…ç½®</h2><p>API ç½‘å…³è¿˜è´Ÿè´£å¤„ç†è·¨åŸŸè¯·æ±‚ï¼Œé€šè¿‡å…¨å±€ CORS é…ç½®å…è®¸ç‰¹å®šæ¥æºçš„è¯·æ±‚è®¿é—® APIã€‚é…ç½®å¦‚ä¸‹ï¼š<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    gateway:</span></span><br><span class="line"><span class="attr">      globalcors:</span></span><br><span class="line"><span class="attr">        corsConfigurations:</span></span><br><span class="line">          <span class="string">'[/ui/v1/**]'</span><span class="string">:</span></span><br><span class="line"><span class="attr">            allowedOrigins:</span> <span class="string">"http://localhost:3000"</span></span><br><span class="line"><span class="attr">            exposedHeaders:</span> <span class="string">"page-total-count"</span></span><br><span class="line"><span class="attr">            allowedHeaders:</span> <span class="string">"*"</span></span><br><span class="line"><span class="attr">            allowedMethods:</span></span><br><span class="line"><span class="bullet">              -</span> <span class="string">GET</span></span><br><span class="line"><span class="bullet">              -</span> <span class="string">POST</span></span><br><span class="line"><span class="bullet">              -</span> <span class="string">PUT</span></span><br><span class="line"><span class="bullet">              -</span> <span class="string">DELETE</span></span><br><span class="line"><span class="bullet">              -</span> <span class="string">PATCH</span></span><br><span class="line"><span class="bullet">              -</span> <span class="string">OPTIONS</span></span><br><span class="line"><span class="bullet">              -</span> <span class="string">HEAD</span></span><br></pre></td></tr></table></figure></p>
<p>ä¸Šè¿°é…ç½®å…è®¸æ¥è‡ª <code>http://localhost:3000</code> çš„è¯·æ±‚è®¿é—®ä»¥ <code>/ui/v1/</code> å¼€å¤´çš„ APIï¼Œå¹¶ä¸”æŒ‡å®šäº†å…è®¸çš„è¯·æ±‚æ–¹æ³•å’Œæš´éœ²çš„å“åº”å¤´ã€‚</p>
<h2 id="4-è¿‡æ»¤å™¨åŠŸèƒ½"><a href="#4-è¿‡æ»¤å™¨åŠŸèƒ½" class="headerlink" title="4. è¿‡æ»¤å™¨åŠŸèƒ½"></a>4. è¿‡æ»¤å™¨åŠŸèƒ½</h2><p>API ç½‘å…³ä½¿ç”¨è¿‡æ»¤å™¨å¯¹è¯·æ±‚è¿›è¡Œé¢„å¤„ç†å’Œåå¤„ç†ï¼Œä¾‹å¦‚èº«ä»½éªŒè¯ã€æ—¥å¿—è®°å½•ç­‰ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¤šä¸ªè·¯ç”±è§„åˆ™éƒ½ä½¿ç”¨äº† <code>AuthFilter</code> è¿›è¡Œèº«ä»½éªŒè¯ï¼š<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">- id:</span> <span class="string">topic-service</span></span><br><span class="line"><span class="attr">  uri:</span> <span class="attr">lb://topic-service</span></span><br><span class="line"><span class="attr">  predicates:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">Path=/ui/v1/topics/**</span></span><br><span class="line"><span class="attr">  filters:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">AuthFilter</span></span><br></pre></td></tr></table></figure></p>
<p><code>AuthFilter</code> å¯ä»¥éªŒè¯è¯·æ±‚çš„åˆæ³•æ€§ï¼Œç¡®ä¿åªæœ‰ç»è¿‡æˆæƒçš„ç”¨æˆ·æ‰èƒ½è®¿é—®å—ä¿æŠ¤çš„ APIã€‚</p>
<h2 id="5-é›†æˆåˆ†å¸ƒå¼è¿½è¸ª"><a href="#5-é›†æˆåˆ†å¸ƒå¼è¿½è¸ª" class="headerlink" title="5. é›†æˆåˆ†å¸ƒå¼è¿½è¸ª"></a>5. é›†æˆåˆ†å¸ƒå¼è¿½è¸ª</h2><p>é¡¹ç›®ä¸­é›†æˆäº† Zipkin è¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ªï¼ŒAPI ç½‘å…³ä¼šå°†è¯·æ±‚ä¿¡æ¯å‘é€åˆ° Zipkin è¿›è¡Œåˆ†æå’Œç›‘æ§ã€‚é…ç½®æ–‡ä»¶ä¸­çš„ç›¸å…³éƒ¨åˆ†å¦‚ä¸‹ï¼š<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">zipkin:</span></span><br><span class="line"><span class="attr">  base-url:</span> <span class="attr">http://$&#123;ZIPKIN_HOST:localhost&#125;:9411</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œçš„ <code>base-url</code> æŒ‡å®šäº† Zipkin Server çš„åœ°å€ï¼ŒAPI ç½‘å…³ä¼šå°†è¯·æ±‚çš„è¿½è¸ªä¿¡æ¯å‘é€åˆ°è¯¥åœ°å€ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼ŒAPI ç½‘å…³åœ¨é¡¹ç›®ä¸­æ‰¿æ‹…ç€è·¯ç”±è¯·æ±‚ã€æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡ã€è·¨åŸŸå¤„ç†ã€è¿‡æ»¤å™¨åŠŸèƒ½ä»¥åŠåˆ†å¸ƒå¼è¿½è¸ªé›†æˆç­‰é‡è¦èŒè´£ï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿçš„å…³é”®ç»„ä»¶ã€‚ </p>
<h1 id="WebSocketå’ŒHTTPé•¿é“¾æ¥å’ŒTCP"><a href="#WebSocketå’ŒHTTPé•¿é“¾æ¥å’ŒTCP" class="headerlink" title="WebSocketå’ŒHTTPé•¿é“¾æ¥å’ŒTCP"></a>WebSocketå’ŒHTTPé•¿é“¾æ¥å’ŒTCP</h1><p>WebSocket èƒ½å¤Ÿå®ç°å®æ—¶é€šä¿¡ï¼Œè¿™å’Œå®ƒçš„åŸç†ä»¥åŠä¸ TCP é•¿è¿æ¥çš„å…³ç³»å¯†åˆ‡ç›¸å…³ï¼Œä¸‹é¢ä¸ºä½ è¯¦ç»†è§£é‡Šï¼š</p>
<h2 id="WebSocket-å®ç°å®æ—¶é€šä¿¡çš„åŸç†"><a href="#WebSocket-å®ç°å®æ—¶é€šä¿¡çš„åŸç†" class="headerlink" title="WebSocket å®ç°å®æ—¶é€šä¿¡çš„åŸç†"></a>WebSocket å®ç°å®æ—¶é€šä¿¡çš„åŸç†</h2><h3 id="1-æ¡æ‰‹é˜¶æ®µ"><a href="#1-æ¡æ‰‹é˜¶æ®µ" class="headerlink" title="1. æ¡æ‰‹é˜¶æ®µ"></a>1. æ¡æ‰‹é˜¶æ®µ</h3><ul>
<li><p><strong>HTTP å‡çº§è¯·æ±‚</strong>ï¼šWebSocket é€šä¿¡å§‹äºä¸€ä¸ª HTTP è¯·æ±‚ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªç‰¹æ®Šçš„ HTTP è¯·æ±‚ï¼Œè¯·æ±‚ä¸­åŒ…å« <code>Upgrade: websocket</code> å’Œ <code>Connection: Upgrade</code> å¤´éƒ¨å­—æ®µï¼Œè¡¨æ˜å®¢æˆ·ç«¯å¸Œæœ›å°†å½“å‰çš„ HTTP è¿æ¥å‡çº§ä¸º WebSocket è¿æ¥ã€‚</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/chat</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: example.com</span><br><span class="line"><span class="attribute">Upgrade</span>: websocket</span><br><span class="line"><span class="attribute">Connection</span>: Upgrade</span><br><span class="line"><span class="attribute">Sec-WebSocket-Key</span>: dGhlIHNhbXBsZSBub25jZQ==</span><br><span class="line"><span class="attribute">Sec-WebSocket-Version</span>: 13</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æœåŠ¡å™¨å“åº”</strong>ï¼šå¦‚æœæœåŠ¡å™¨æ”¯æŒ WebSocketï¼Œä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€ç ä¸º 101 Switching Protocols çš„å“åº”ï¼Œè¡¨ç¤ºåŒæ„å‡çº§è¿æ¥ã€‚</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">101</span> Switching Protocols</span><br><span class="line"><span class="attribute">Upgrade</span>: websocket</span><br><span class="line"><span class="attribute">Connection</span>: Upgrade</span><br><span class="line"><span class="attribute">Sec-WebSocket-Accept</span>: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è¿æ¥å»ºç«‹</strong>ï¼šç»è¿‡è¿™ä¸ªæ¡æ‰‹è¿‡ç¨‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ HTTP è¿æ¥å°±å‡çº§ä¸ºäº† WebSocket è¿æ¥ï¼Œåç»­çš„æ•°æ®ä¼ è¾“å°†åœ¨è¿™ä¸ªæ–°çš„è¿æ¥ä¸Šè¿›è¡Œã€‚</p>
</li>
</ul>
<h3 id="2-æ•°æ®ä¼ è¾“é˜¶æ®µ"><a href="#2-æ•°æ®ä¼ è¾“é˜¶æ®µ" class="headerlink" title="2. æ•°æ®ä¼ è¾“é˜¶æ®µ"></a>2. æ•°æ®ä¼ è¾“é˜¶æ®µ</h3><ul>
<li><p><strong>å…¨åŒå·¥é€šä¿¡</strong>ï¼šWebSocket è¿æ¥å»ºç«‹åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥åŒæ—¶ç‹¬ç«‹åœ°å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œè¿™ç§å…¨åŒå·¥é€šä¿¡æ¨¡å¼ä½¿å¾—åŒæ–¹èƒ½å¤Ÿå®æ—¶åœ°äº¤æ¢ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œåœ¨ Twitter å…‹éš†é¡¹ç›®ä¸­ï¼Œå½“æœ‰æ–°çš„æ¨æ–‡å‘å¸ƒã€ç”¨æˆ·ç‚¹èµæˆ–å›å¤æ¨æ–‡æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥ç«‹å³å°†ç›¸å…³ä¿¡æ¯æ¨é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥éšæ—¶å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯ï¼Œå¦‚å‘é€æ–°çš„æ¨æ–‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// tweet-service ä¸­å‘é€æ¨æ–‡æ›´æ–°æ¶ˆæ¯</span></span><br><span class="line">webSocketClient.send(WebsocketConstants.TOPIC_FEED_ADD, tweet);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å¸§åè®®</strong>ï¼šWebSocket ä½¿ç”¨å¸§åè®®æ¥ä¼ è¾“æ•°æ®ï¼Œæ•°æ®è¢«åˆ†å‰²æˆå¤šä¸ªå¸§è¿›è¡Œä¼ è¾“ã€‚æ¯ä¸ªå¸§åŒ…å«ä¸€ä¸ªå¤´éƒ¨å’Œä¸€ä¸ªæ•°æ®è´Ÿè½½ï¼Œå¤´éƒ¨åŒ…å«äº†å¸§çš„ç±»å‹ã€é•¿åº¦ç­‰ä¿¡æ¯ã€‚è¿™ç§æœºåˆ¶ä½¿å¾—æ•°æ®å¯ä»¥ä»¥è¾ƒå°çš„å•å…ƒè¿›è¡Œä¼ è¾“ï¼Œæé«˜äº†ä¼ è¾“æ•ˆç‡ã€‚</p>
</li>
</ul>
<h3 id="3-è¿æ¥å…³é—­é˜¶æ®µ"><a href="#3-è¿æ¥å…³é—­é˜¶æ®µ" class="headerlink" title="3. è¿æ¥å…³é—­é˜¶æ®µ"></a>3. è¿æ¥å…³é—­é˜¶æ®µ</h3><ul>
<li><strong>æ˜¾å¼å…³é—­</strong>ï¼šå½“é€šä¿¡ç»“æŸæ—¶ï¼Œå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å¯ä»¥å‘é€ä¸€ä¸ªå…³é—­å¸§æ¥å…³é—­è¿æ¥ã€‚å…³é—­å¸§åŒ…å«ä¸€ä¸ªçŠ¶æ€ç å’Œå¯é€‰çš„å…³é—­åŸå› ã€‚å¯¹æ–¹æ”¶åˆ°å…³é—­å¸§åï¼Œä¼šå‘é€ä¸€ä¸ªç¡®è®¤å…³é—­å¸§ï¼Œç„¶ååŒæ–¹å…³é—­è¿æ¥ã€‚</li>
</ul>
<h2 id="WebSocket-ä¸-TCP-é•¿è¿æ¥çš„å…³ç³»"><a href="#WebSocket-ä¸-TCP-é•¿è¿æ¥çš„å…³ç³»" class="headerlink" title="WebSocket ä¸ TCP é•¿è¿æ¥çš„å…³ç³»"></a>WebSocket ä¸ TCP é•¿è¿æ¥çš„å…³ç³»</h2><h3 id="ç›¸åŒç‚¹"><a href="#ç›¸åŒç‚¹" class="headerlink" title="ç›¸åŒç‚¹"></a>ç›¸åŒç‚¹</h3><ul>
<li><strong>é•¿è¿æ¥ç‰¹æ€§</strong>ï¼šWebSocket å’Œ TCP é•¿è¿æ¥éƒ½ä¿æŒä¸€ä¸ªæŒä¹…çš„è¿æ¥ï¼Œé¿å…äº†é¢‘ç¹å»ºç«‹å’Œæ–­å¼€è¿æ¥çš„å¼€é”€ã€‚åœ¨é•¿è¿æ¥ä¸Šï¼ŒåŒæ–¹å¯ä»¥åœ¨ä¸€æ®µæ—¶é—´å†…æŒç»­åœ°äº¤æ¢æ•°æ®ï¼Œæé«˜äº†é€šä¿¡æ•ˆç‡ã€‚</li>
<li><strong>å®æ—¶é€šä¿¡èƒ½åŠ›</strong>ï¼šç”±äºè¿æ¥ä¸€ç›´ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œä¸¤è€…éƒ½èƒ½å¤Ÿå®ç°å®æ—¶é€šä¿¡ã€‚æœåŠ¡å™¨å¯ä»¥åœ¨æœ‰æ–°æ•°æ®æ—¶ç«‹å³å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥åŠæ—¶å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚</li>
</ul>
<h3 id="ä¸åŒç‚¹"><a href="#ä¸åŒç‚¹" class="headerlink" title="ä¸åŒç‚¹"></a>ä¸åŒç‚¹</h3><ul>
<li><strong>åè®®å±‚æ¬¡</strong>ï¼šTCP æ˜¯ä¼ è¾“å±‚åè®®ï¼Œå®ƒæä¾›äº†å¯é çš„ã€é¢å‘è¿æ¥çš„å­—èŠ‚æµæœåŠ¡ï¼Œä½†ä¸å¤„ç†åº”ç”¨å±‚çš„æ•°æ®ã€‚WebSocket æ˜¯åº”ç”¨å±‚åè®®ï¼Œå®ƒå»ºç«‹åœ¨ TCP ä¹‹ä¸Šï¼Œå®šä¹‰äº†ä¸€å¥—å®Œæ•´çš„é€šä¿¡è§„èŒƒï¼ŒåŒ…æ‹¬æ¡æ‰‹ã€æ•°æ®ä¼ è¾“å’Œå…³é—­è¿æ¥ç­‰è¿‡ç¨‹ã€‚</li>
<li><strong>å…¼å®¹æ€§</strong>ï¼šWebSocket æ˜¯åŸºäº HTTP åè®®çš„ï¼Œå®ƒå¯ä»¥é€šè¿‡ HTTP ç«¯å£ï¼ˆå¦‚ 80 å’Œ 443ï¼‰è¿›è¡Œé€šä¿¡ï¼Œå› æ­¤æ›´å®¹æ˜“ç©¿è¶Šé˜²ç«å¢™å’Œä»£ç†æœåŠ¡å™¨ã€‚è€Œ TCP é•¿è¿æ¥å¯èƒ½éœ€è¦ä¸“é—¨é…ç½®é˜²ç«å¢™å’Œä»£ç†æœåŠ¡å™¨æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚</li>
<li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šTCP é•¿è¿æ¥é€šå¸¸ç”¨äºéœ€è¦é«˜æ€§èƒ½å’Œä½å»¶è¿Ÿçš„åœºæ™¯ï¼Œå¦‚æ¸¸æˆã€é‡‘èäº¤æ˜“ç­‰ã€‚WebSocket æ›´é€‚åˆäº Web åº”ç”¨ï¼Œå®ƒå¯ä»¥åœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´å®ç°å®æ—¶é€šä¿¡ï¼Œå¦‚åœ¨çº¿èŠå¤©ã€å®æ—¶é€šçŸ¥ç­‰ã€‚åœ¨ Twitter å…‹éš†é¡¹ç›®ä¸­ï¼ŒWebSocket ç”¨äºå®ç°å®æ—¶é€šçŸ¥ã€åœ¨çº¿èŠå¤©å’Œæ¨æ–‡å®æ—¶æ›´æ–°ç­‰åŠŸèƒ½ï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤ŸåŠæ—¶è·å–æœ€æ–°çš„ä¿¡æ¯ã€‚</li>
</ul>
<p>ç»¼ä¸Šæ‰€è¿°ï¼ŒWebSocket é€šè¿‡æ¡æ‰‹å‡çº§ã€å…¨åŒå·¥é€šä¿¡å’Œå¸§åè®®ç­‰æœºåˆ¶å®ç°äº†å®æ—¶é€šä¿¡ï¼Œå®ƒå’Œ TCP é•¿è¿æ¥æœ‰ç›¸ä¼¼çš„é•¿è¿æ¥ç‰¹æ€§ï¼Œä½†åœ¨åè®®å±‚æ¬¡ã€å…¼å®¹æ€§å’Œåº”ç”¨åœºæ™¯ç­‰æ–¹é¢å­˜åœ¨å·®å¼‚ã€‚ </p>
<h2 id="HTTPé•¿é“¾æ¥ä¸-WebSocket-çš„å¯¹æ¯”"><a href="#HTTPé•¿é“¾æ¥ä¸-WebSocket-çš„å¯¹æ¯”" class="headerlink" title="HTTPé•¿é“¾æ¥ä¸ WebSocket çš„å¯¹æ¯”"></a>HTTPé•¿é“¾æ¥ä¸ WebSocket çš„å¯¹æ¯”</h2><p>æ˜¯çš„ï¼ŒHTTP ä¹Ÿæœ‰ä¿æŒé•¿è¿æ¥çš„ç±»å‹ï¼Œä¸‹é¢ä¸ºä½ è¯¦ç»†ä»‹ç»ã€‚</p>
<h3 id="HTTP-é•¿è¿æ¥çš„æ¦‚å¿µ"><a href="#HTTP-é•¿è¿æ¥çš„æ¦‚å¿µ" class="headerlink" title="HTTP é•¿è¿æ¥çš„æ¦‚å¿µ"></a>HTTP é•¿è¿æ¥çš„æ¦‚å¿µ</h3><p>åœ¨æ—©æœŸçš„ HTTP 1.0 åè®®ä¸­ï¼Œæ¯æ¬¡è¯·æ±‚ - å“åº”å®Œæˆåï¼Œè¿æ¥å°±ä¼šå…³é—­ã€‚å¦‚æœéœ€è¦è¿›è¡Œå¤šæ¬¡è¯·æ±‚ï¼Œå°±éœ€è¦é‡æ–°å»ºç«‹è¿æ¥ï¼Œè¿™ä¼šå¸¦æ¥ä¸€å®šçš„å¼€é”€ï¼Œæ¯”å¦‚ TCP æ¡æ‰‹å’ŒæŒ¥æ‰‹çš„æ—¶é—´ã€‚ä¸ºäº†å‡å°‘è¿™ç§å¼€é”€ï¼ŒHTTP å¼•å…¥äº†é•¿è¿æ¥æœºåˆ¶ã€‚</p>
<h3 id="HTTP-1-1-é•¿è¿æ¥"><a href="#HTTP-1-1-é•¿è¿æ¥" class="headerlink" title="HTTP 1.1 é•¿è¿æ¥"></a>HTTP 1.1 é•¿è¿æ¥</h3><ul>
<li><strong>æœºåˆ¶åŸç†</strong>ï¼šHTTP 1.1 é»˜è®¤é‡‡ç”¨æŒä¹…è¿æ¥ï¼ˆé•¿è¿æ¥ï¼‰ã€‚é€šè¿‡åœ¨è¯·æ±‚å¤´å’Œå“åº”å¤´ä¸­æ·»åŠ  <code>Connection: keep - alive</code> å­—æ®µï¼ˆåœ¨ HTTP 1.1 ä¸­ï¼Œå³ä½¿ä¸æ˜ç¡®æŒ‡å®šè¯¥å­—æ®µï¼Œä¹Ÿé»˜è®¤ä½¿ç”¨é•¿è¿æ¥ï¼‰ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å¯ä»¥åœ¨ä¸€æ¬¡ TCP è¿æ¥ä¸Šè¿›è¡Œå¤šæ¬¡è¯·æ±‚ - å“åº”äº¤äº’ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½é‡æ–°å»ºç«‹è¿æ¥ã€‚<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/example</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: example.com</span><br><span class="line"><span class="attribute">Connection</span>: keep - alive</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>æœåŠ¡å™¨å“åº”ç¤ºä¾‹ï¼š<br><figure class="highlight"><table><tr><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line">Content - Type: text/html</span><br><span class="line"><span class="attribute">Connection</span>: keep - alive</span><br><span class="line">Content - Length: 1234</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>åº”ç”¨åœºæ™¯åŠå±€é™æ€§</strong>ï¼šè¿™ç§é•¿è¿æ¥é€‚ç”¨äºéœ€è¦é¢‘ç¹è¿›è¡Œå°æ•°æ®é‡è¯·æ±‚çš„åœºæ™¯ï¼Œæ¯”å¦‚ç½‘é¡µä¸­å¤šä¸ªèµ„æºçš„åŠ è½½ã€‚ç„¶è€Œï¼ŒHTTP 1.1 çš„é•¿è¿æ¥æ˜¯åŠåŒå·¥çš„ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€æ–¹å‘é€æ•°æ®ï¼Œå¹¶ä¸”å­˜åœ¨é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œå³å¦‚æœä¸€ä¸ªè¯·æ±‚çš„å“åº”æ²¡æœ‰åŠæ—¶è¿”å›ï¼Œåç»­çš„è¯·æ±‚éƒ½éœ€è¦ç­‰å¾…ã€‚</li>
</ul>
<h3 id="HTTP-2-é•¿è¿æ¥"><a href="#HTTP-2-é•¿è¿æ¥" class="headerlink" title="HTTP 2 é•¿è¿æ¥"></a>HTTP 2 é•¿è¿æ¥</h3><ul>
<li><strong>æœºåˆ¶åŸç†</strong>ï¼šHTTP 2 åœ¨ HTTP 1.1 çš„åŸºç¡€ä¸Šè¿›è¡Œäº†æ”¹è¿›ï¼Œå®ƒé‡‡ç”¨äºŒè¿›åˆ¶åˆ†å¸§å±‚ï¼Œå°†è¯·æ±‚å’Œå“åº”æ•°æ®åˆ†å‰²æˆæ›´å°çš„å¸§ï¼Œå¹¶åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸Šä»¥å¤šè·¯å¤ç”¨çš„æ–¹å¼å¹¶è¡Œä¼ è¾“ã€‚è¿™æ„å‘³ç€å¤šä¸ªè¯·æ±‚å’Œå“åº”å¯ä»¥åŒæ—¶åœ¨ä¸€ä¸ªè¿æ¥ä¸Šè¿›è¡Œï¼Œé¿å…äº†é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚</li>
<li><strong>åº”ç”¨åœºæ™¯åŠä¼˜åŠ¿</strong>ï¼šåœ¨é«˜å¹¶å‘çš„ Web åº”ç”¨ä¸­ï¼ŒHTTP 2 çš„é•¿è¿æ¥èƒ½æ˜¾è‘—æé«˜æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œåœ¨åŠ è½½ä¸€ä¸ªåŒ…å«å¤§é‡å›¾ç‰‡å’Œè„šæœ¬çš„ç½‘é¡µæ—¶ï¼ŒHTTP 2 å¯ä»¥æ›´é«˜æ•ˆåœ°å¹¶è¡ŒåŠ è½½è¿™äº›èµ„æºï¼Œå‡å°‘ç”¨æˆ·ç­‰å¾…æ—¶é—´ã€‚</li>
</ul>
<h3 id="HTTP-3-é•¿è¿æ¥"><a href="#HTTP-3-é•¿è¿æ¥" class="headerlink" title="HTTP 3 é•¿è¿æ¥"></a>HTTP 3 é•¿è¿æ¥</h3><ul>
<li><strong>æœºåˆ¶åŸç†</strong>ï¼šHTTP 3 åŸºäº QUIC åè®®ï¼ŒQUIC æ˜¯ä¸€ç§åœ¨ UDP ä¹‹ä¸Šæ„å»ºçš„æ–°ä¼ è¾“åè®®ã€‚å®ƒè§£å†³äº† TCP åè®®ä¸­å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼Œå¦‚ TCP æ¡æ‰‹å»¶è¿Ÿã€é˜Ÿå¤´é˜»å¡ç­‰ã€‚HTTP 3 çš„é•¿è¿æ¥åœ¨å»ºç«‹è¿æ¥æ—¶æ›´å¿«ï¼Œå¹¶ä¸”å¯ä»¥æä¾›æ›´å¥½çš„ç½‘ç»œé€‚åº”æ€§ã€‚</li>
<li><strong>åº”ç”¨åœºæ™¯åŠä¼˜åŠ¿</strong>ï¼šå¯¹äºå¯¹å»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨ï¼Œå¦‚å®æ—¶è§†é¢‘æµã€åœ¨çº¿æ¸¸æˆç­‰ï¼ŒHTTP 3 çš„é•¿è¿æ¥èƒ½æä¾›æ›´æµç•…çš„ä½“éªŒã€‚</li>
</ul>
<h3 id="ä¸-WebSocket-çš„å¯¹æ¯”"><a href="#ä¸-WebSocket-çš„å¯¹æ¯”" class="headerlink" title="ä¸ WebSocket çš„å¯¹æ¯”"></a>ä¸ WebSocket çš„å¯¹æ¯”</h3><p>è™½ç„¶ HTTP é•¿è¿æ¥å¯ä»¥å‡å°‘è¿æ¥å»ºç«‹çš„å¼€é”€ï¼Œä½†å®ƒä»ç„¶æ˜¯åŸºäº<strong>è¯·æ±‚ - å“åº”</strong>æ¨¡å‹çš„ã€‚è€Œ WebSocket æ˜¯<strong>å…¨åŒå·¥</strong>çš„ï¼ŒæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ï¼Œæ›´é€‚åˆå®æ—¶é€šä¿¡åœºæ™¯ï¼Œå¦‚åœ¨çº¿èŠå¤©ã€å®æ—¶é€šçŸ¥ç­‰ã€‚åœ¨ Twitter å…‹éš†é¡¹ç›®ä¸­ï¼Œé€‰æ‹© WebSocket è€Œé HTTP é•¿è¿æ¥ï¼Œæ­£æ˜¯å› ä¸ºéœ€è¦å®ç°æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ–°çš„æ¨æ–‡ã€é€šçŸ¥ç­‰å®æ—¶ä¿¡æ¯ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼ŒHTTP æœ‰ä¸åŒç‰ˆæœ¬çš„é•¿è¿æ¥æœºåˆ¶ï¼Œå®ƒä»¬åœ¨ä¸åŒçš„åœºæ™¯ä¸­å‘æŒ¥ç€é‡è¦ä½œç”¨ï¼Œä½†åœ¨å®æ—¶é€šä¿¡æ–¹é¢ï¼ŒWebSocket å…·æœ‰æ›´æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚ </p>
<h1 id="é¡¹ç›®é‡ŒWebSocketæœ‰å•¥ç”¨"><a href="#é¡¹ç›®é‡ŒWebSocketæœ‰å•¥ç”¨" class="headerlink" title="é¡¹ç›®é‡ŒWebSocketæœ‰å•¥ç”¨?"></a>é¡¹ç›®é‡ŒWebSocketæœ‰å•¥ç”¨?</h1><h2 id="1-å®æ—¶é€šçŸ¥"><a href="#1-å®æ—¶é€šçŸ¥" class="headerlink" title="1. å®æ—¶é€šçŸ¥"></a>1. å®æ—¶é€šçŸ¥</h2><p>é¡¹ç›®æ”¯æŒç”¨æˆ·åœ¨ä»–äººè®¢é˜…ã€è½¬æ¨æˆ–ç‚¹èµæ¨æ–‡æ—¶æ”¶åˆ°é€šçŸ¥ã€‚é€šè¿‡WebSocketï¼Œè¿™äº›é€šçŸ¥å¯ä»¥å®æ—¶æ¨é€ç»™ç”¨æˆ·ï¼Œè€Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°é¡µé¢ã€‚<br>åœ¨<code>notification-service</code>æ¨¡å—çš„<code>NotificationHandlerServiceImpl</code>ç±»ä¸­ï¼Œå½“å¤„ç†å„ç§é€šçŸ¥äº‹ä»¶ï¼ˆå¦‚<code>ListsNotificationEvent</code>ã€<code>FollowUserNotificationEvent</code>ç­‰ï¼‰æ—¶ï¼Œä¼šè°ƒç”¨<code>WebSocketClient</code>çš„<code>send</code>æ–¹æ³•å°†é€šçŸ¥æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„WebSocketä¸»é¢˜ã€‚<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// notification-service/src/main/java/com/gmail/merikbest2015/service/impl/NotificationHandlerServiceImpl.java</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleListsNotification</span><span class="params">(ListsNotificationEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    NotificationResponse response = notificationHandlerMapper.convertToNotificationListResponse(</span><br><span class="line">            notification, event.isNotificationCondition());</span><br><span class="line">    webSocketClient.send(WebsocketConstants.TOPIC_NOTIFICATIONS + response.getNotifiedUser().getId(), response);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="2-åœ¨çº¿èŠå¤©åŠŸèƒ½"><a href="#2-åœ¨çº¿èŠå¤©åŠŸèƒ½" class="headerlink" title="2. åœ¨çº¿èŠå¤©åŠŸèƒ½"></a>2. åœ¨çº¿èŠå¤©åŠŸèƒ½</h2><p>é¡¹ç›®å®ç°äº†åŸºäºWebSocketçš„åœ¨çº¿èŠå¤©åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥å®æ—¶æ”¶å‘æ¶ˆæ¯ã€‚åœ¨<code>chat-service</code>æ¨¡å—çš„<code>ChatMessageController</code>ç±»ä¸­ï¼Œå½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šå°†æ¶ˆæ¯é€šè¿‡<code>WebSocketClient</code>å‘é€åˆ°å¯¹åº”çš„èŠå¤©ä¸»é¢˜ã€‚<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// chat-service/src/main/java/com/gmail/merikbest2015/controller/ChatMessageController.java</span></span><br><span class="line"><span class="meta">@PostMapping</span>(PathConstants.ADD_MESSAGE)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">addMessage</span><span class="params">(@RequestBody ChatMessageRequest request)</span> </span>&#123;</span><br><span class="line">    chatMessageMapper.addMessage(request)</span><br><span class="line">            .forEach((userId, message) -&gt; webSocketClient.send(WebsocketConstants.TOPIC_CHAT + userId, message));</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok().build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼ŒWebSocketåœ¨é¡¹ç›®ä¸­ç”¨äºå®ç°å®æ—¶é€šçŸ¥ã€åœ¨çº¿èŠå¤©ã€æ¨æ–‡å®æ—¶æ›´æ–°å’Œå®šæ—¶æ¨æ–‡å‘å¸ƒé€šçŸ¥ç­‰åŠŸèƒ½ï¼Œæå‡äº†ç”¨æˆ·ä½“éªŒå’Œåº”ç”¨çš„å®æ—¶æ€§ã€‚</p>
<h1 id="PostgresSQLå’ŒMySQLä¼˜åŠ£åŠ¿"><a href="#PostgresSQLå’ŒMySQLä¼˜åŠ£åŠ¿" class="headerlink" title="PostgresSQLå’ŒMySQLä¼˜åŠ£åŠ¿"></a>PostgresSQLå’ŒMySQLä¼˜åŠ£åŠ¿</h1><p>åœ¨å½“å‰é¡¹ç›®ä¸­ï¼Œä½¿ç”¨äº†PostgreSQLä½œä¸ºæ•°æ®åº“ã€‚ä¸‹é¢ä»¥è¡¨æ ¼å½¢å¼è¯¦ç»†å¯¹æ¯”PostgreSQLå’ŒMySQLçš„ä¼˜åŠ£åŠ¿ï¼š</p>
<table>
<thead>
<tr>
<th>å¯¹æ¯”é¡¹</th>
<th>PostgreSQL</th>
<th>MySQL</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ä¼˜åŠ¿</strong></td>
<td>1. <strong>å¤æ‚æŸ¥è¯¢å¤„ç†èƒ½åŠ›å¼º</strong>ï¼šæ”¯æŒå¤æ‚çš„SQLæŸ¥è¯¢ï¼ŒåŒ…æ‹¬é€’å½’æŸ¥è¯¢ã€çª—å£å‡½æ•°ç­‰ï¼Œé€‚åˆå¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€‚ä¾‹å¦‚åœ¨å¤„ç†ç”¨æˆ·å…³ç³»ï¼ˆå¦‚å…³æ³¨ã€è®¢é˜…ç­‰ï¼‰å’Œæ¨æ–‡æ•°æ®å…³è”æŸ¥è¯¢æ—¶ï¼ŒPostgreSQLèƒ½æ›´å¥½åœ°å®Œæˆå¤æ‚æŸ¥è¯¢éœ€æ±‚ã€‚<br>2. <strong>æ•°æ®ç±»å‹ä¸°å¯Œ</strong>ï¼šæä¾›äº†æ›´å¤šçš„æ•°æ®ç±»å‹ï¼Œå¦‚æ•°ç»„ã€JSONã€XMLç­‰ï¼Œæ–¹ä¾¿å­˜å‚¨å’Œå¤„ç†å¤æ‚çš„æ•°æ®ç»“æ„ã€‚åœ¨é¡¹ç›®ä¸­å¯ä»¥æ›´æ–¹ä¾¿åœ°å­˜å‚¨ç”¨æˆ·çš„ä¸ªæ€§åŒ–è®¾ç½®ç­‰æ•°æ®ã€‚<br>3. <strong>å¼€æºä¸”ç¤¾åŒºæ´»è·ƒ</strong>ï¼šå¼€æºå…è´¹ï¼Œæ‹¥æœ‰åºå¤§çš„ç¤¾åŒºæ”¯æŒï¼Œèƒ½åŠæ—¶è·å–ç›¸å…³çš„æ–‡æ¡£ã€æ•™ç¨‹å’Œè§£å†³æ–¹æ¡ˆã€‚<br>4. <strong>æ”¯æŒäº‹åŠ¡å’Œå¹¶å‘æ§åˆ¶</strong>ï¼šå…·å¤‡å¼ºå¤§çš„äº‹åŠ¡å¤„ç†èƒ½åŠ›å’Œå¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ï¼Œé€‚åˆé«˜å¹¶å‘çš„ä¸šåŠ¡åœºæ™¯ã€‚<br>5. <strong>æ•°æ®å®Œæ•´æ€§å’Œçº¦æŸ</strong>ï¼šæä¾›äº†ä¸°å¯Œçš„æ•°æ®å®Œæ•´æ€§çº¦æŸï¼Œå¦‚å”¯ä¸€çº¦æŸã€å¤–é”®çº¦æŸç­‰ï¼Œæœ‰åŠ©äºä¿è¯æ•°æ®çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚</td>
<td>1. <strong>æ€§èƒ½é«˜æ•ˆ</strong>ï¼šåœ¨å¤„ç†ç®€å•æŸ¥è¯¢å’Œé«˜å¹¶å‘è¯»å†™æ“ä½œæ—¶ï¼ŒMySQLçš„æ€§èƒ½è¡¨ç°è¾ƒä¸ºå‡ºè‰²ï¼Œèƒ½å¿«é€Ÿå“åº”è¯·æ±‚ã€‚<br>2. <strong>æ˜“äºå®‰è£…å’Œé…ç½®</strong>ï¼šå®‰è£…è¿‡ç¨‹ç›¸å¯¹ç®€å•ï¼Œé…ç½®é€‰é¡¹ä¹Ÿè¾ƒä¸ºç›´è§‚ï¼Œé€‚åˆåˆå­¦è€…å¿«é€Ÿä¸Šæ‰‹ã€‚<br>3. <strong>å¹¿æ³›åº”ç”¨å’Œç”Ÿæ€ç³»ç»Ÿ</strong>ï¼šåœ¨Webå¼€å‘é¢†åŸŸæœ‰å¹¿æ³›çš„åº”ç”¨ï¼Œæ‹¥æœ‰ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹å·¥å…·å’Œæ’ä»¶ï¼Œç”Ÿæ€ç³»ç»Ÿæˆç†Ÿã€‚<br>4. <strong>å•†ä¸šæ”¯æŒ</strong>ï¼šæœ‰å®˜æ–¹çš„å•†ä¸šæ”¯æŒï¼Œé€‚åˆå¯¹æŠ€æœ¯æ”¯æŒæœ‰è¾ƒé«˜è¦æ±‚çš„ä¼ä¸šçº§åº”ç”¨ã€‚</td>
</tr>
<tr>
<td><strong>åŠ£åŠ¿</strong></td>
<td>1. <strong>æ€§èƒ½å¼€é”€</strong>ï¼šç”±äºåŠŸèƒ½ä¸°å¯Œï¼Œåœ¨å¤„ç†ç®€å•æŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä¼šå­˜åœ¨ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚<br>2. <strong>å­¦ä¹ æˆæœ¬è¾ƒé«˜</strong>ï¼šå¤æ‚çš„åŠŸèƒ½å’Œä¸°å¯Œçš„æ•°æ®ç±»å‹å¯¼è‡´å­¦ä¹ æ›²çº¿è¾ƒé™¡ï¼Œå¯¹äºåˆå­¦è€…æ¥è¯´ï¼ŒæŒæ¡å’Œä½¿ç”¨çš„éš¾åº¦è¾ƒå¤§ã€‚<br>3. <strong>é…ç½®å¤æ‚</strong>ï¼šåœ¨å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒPostgreSQLçš„é…ç½®å¯èƒ½ä¼šå˜å¾—å¤æ‚ï¼Œéœ€è¦è€ƒè™‘å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´çš„é›†ç¾¤é…ç½®ã€æ•°æ®åŒæ­¥ç­‰é—®é¢˜ã€‚</td>
<td>1. <strong>æ•°æ®ç±»å‹ç›¸å¯¹è¾ƒå°‘</strong>ï¼šç›¸æ¯”äºPostgreSQLï¼ŒMySQLçš„æ•°æ®ç±»å‹ç›¸å¯¹è¾ƒå°‘ï¼Œåœ¨å¤„ç†ä¸€äº›å¤æ‚çš„æ•°æ®ç»“æ„æ—¶å¯èƒ½ä¸å¤Ÿçµæ´»ã€‚<br>2. <strong>å¤æ‚æŸ¥è¯¢å¤„ç†èƒ½åŠ›å¼±</strong>ï¼šåœ¨å¤„ç†å¤æ‚çš„SQLæŸ¥è¯¢æ—¶ï¼ŒMySQLçš„è¡¨ç°ä¸å¦‚PostgreSQLï¼Œå¯èƒ½éœ€è¦æ›´å¤šçš„ä¼˜åŒ–å’Œè°ƒæ•´ã€‚<br>3. <strong>äº‹åŠ¡å¤„ç†èƒ½åŠ›æœ‰é™</strong>ï¼šåœ¨æŸäº›ç‰ˆæœ¬ä¸­ï¼ŒMySQLçš„äº‹åŠ¡å¤„ç†èƒ½åŠ›ç›¸å¯¹è¾ƒå¼±ï¼Œå¯¹äºä¸€äº›å¯¹äº‹åŠ¡è¦æ±‚è¾ƒé«˜çš„ä¸šåŠ¡åœºæ™¯ï¼Œå¯èƒ½æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚</td>
</tr>
</tbody>
</table>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œé€‰æ‹©PostgreSQLè¿˜æ˜¯MySQLå–å†³äºé¡¹ç›®çš„å…·ä½“éœ€æ±‚ã€‚å¦‚æœé¡¹ç›®éœ€è¦å¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€å­˜å‚¨å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”å¯¹æ•°æ®å®Œæ•´æ€§å’Œäº‹åŠ¡å¤„ç†æœ‰è¾ƒé«˜è¦æ±‚ï¼Œé‚£ä¹ˆPostgreSQLæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼›å¦‚æœé¡¹ç›®æ›´æ³¨é‡ç®€å•æŸ¥è¯¢çš„æ€§èƒ½å’Œæ˜“äºå®‰è£…é…ç½®ï¼ŒMySQLå¯èƒ½æ›´é€‚åˆã€‚åœ¨å½“å‰çš„Twitterå…‹éš†é¡¹ç›®ä¸­ï¼Œç”±äºä¸šåŠ¡é€»è¾‘ç›¸å¯¹å¤æ‚ï¼Œä½¿ç”¨PostgreSQLå¯ä»¥æ›´å¥½åœ°æ»¡è¶³é¡¹ç›®çš„éœ€æ±‚ã€‚ </p>

      


      

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/GitHub/" rel="tag"><i class="fa fa-tag"></i> GitHub</a>
            
              <a href="/tags/noodle/" rel="tag"><i class="fa fa-tag"></i> noodle</a>
            
              <a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a>
            
              <a href="/tags/NA/" rel="tag"><i class="fa fa-tag"></i> NA</a>
            
          </div>
        

        
        
        

        
          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/na_c2g/" rel="next" title="C2G">
                  <i class="fa fa-chevron-left"></i> 
                  <p class="post-nav-pre-next-title">
                    C2G
                  </p> 
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/twitter_clone_frontend_notes/" rel="prev" title="Twitter Clone frontend notes">
                <p class="post-nav-pre-next-title">
                    Twitter Clone frontend notes
                </p> 
                <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        

        
        
      </footer>
      
    </div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  

  <aside id="sidebar" class="sidebar">

    
      
        <div id="sidebar-dimmer"></div>
      
    

    <div class="sidebar-inner">
    
      <div class="sidebar-toggle-inside motion-element">
        <div class="sidebar-toggle-line-wrap">
          <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
          <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
          <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
        </div>
      </div>

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a href="/" class="site-author-image" rel="start" style="border:none">
            <img class="site-author-image" itemprop="image" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/uploads/avatar.png" alt="Mike">
          </a>
          <p class="site-author-name" itemprop="name">Mike</p>
           
              <p class="site-description motion-element" itemprop="description">ğŸš™ ğŸš— ğŸ’¨ ğŸ’¨ If you want to create a blog like this, just follow my open-source project, "hexo-theme-neo", click the GitHub button below and check it out ^_^ . It is recommended to use Chrome, Safari, or Edge to read this blog since this blog was developed on Edge (Chromium kernel version) and tested on Safari.</p>
          
        </div>

        <nav class="site-state motion-element">

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">298</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">111</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

          <div class="site-state-item site-state-about">
            <a href="/about/">
              <span class="site-state-item-about fa fa-fw fa-user"></span>
              <span class="site-state-item-name">about</span>
            </a>
          </div>
          
        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/no5ix" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://open.spotify.com/user/313duq77ekebrfyak3xijqewzss4?si=e7653b829a9747bf" target="_blank" title="Spotify">
                  
                    <i class="fa fa-fw fa-spotify"></i>
                  
                    
                      Spotify
                    
                </a>
              </span>
            
          
          
          <!-- ç½‘æ˜“äº‘éŸ³ä¹ -->
            <!-- <div class="netease-cloud-music"> -->
              <!-- <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=280 height=110 src="//music.163.com/outchain/player?type=0&id=992743594&auto=0&height=90"></iframe> -->
            <!-- </div> -->
          <!-- ç½‘æ˜“äº‘éŸ³ä¹ -->

        </div>

        
        

        
        

        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Project-URL"><span class="nav-text">Project URL</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æ­£ç¡®çš„å®‰è£…å’Œå¯åŠ¨æ–¹æ³•"><span class="nav-text">æ­£ç¡®çš„å®‰è£…å’Œå¯åŠ¨æ–¹æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Installation"><span class="nav-text">Installation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Run"><span class="nav-text">Run</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#To-enter-the-application-you-can-register-or-login"><span class="nav-text">To enter the application you can register or login:</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#é¡¹ç›®é‡Œä½¿ç”¨äº†å“ªäº›SpringCloudçš„ä¸œè¥¿"><span class="nav-text">é¡¹ç›®é‡Œä½¿ç”¨äº†å“ªäº›SpringCloudçš„ä¸œè¥¿</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Spring-Cloud-OpenFeign"><span class="nav-text">1. Spring Cloud OpenFeign</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Spring-Cloud-Circuit-Breaker-Resilience4j"><span class="nav-text">2. Spring Cloud Circuit Breaker (Resilience4j)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Spring-Cloud-Config"><span class="nav-text">3. Spring Cloud Config</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Spring-Cloud-Netflix-Eureka"><span class="nav-text">4. Spring Cloud Netflix Eureka</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Spring-Cloud-Gateway"><span class="nav-text">5. Spring Cloud Gateway</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Prometheuså’ŒGrafanaå’ŒActuatorå’ŒZipkin"><span class="nav-text">Prometheuså’ŒGrafanaå’ŒActuatorå’ŒZipkin</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#zipkinå¦‚ä½•æ˜¯å•¥-zipkinæ˜¯springbootè‡ªå¸¦çš„å—"><span class="nav-text">zipkinå¦‚ä½•æ˜¯å•¥?zipkinæ˜¯springbootè‡ªå¸¦çš„å—?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-æ·»åŠ ä¾èµ–"><span class="nav-text">1. æ·»åŠ ä¾èµ–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-é…ç½®-Zipkin-æœåŠ¡åœ°å€"><span class="nav-text">2. é…ç½® Zipkin æœåŠ¡åœ°å€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-å¯åŠ¨-Zipkin-æœåŠ¡"><span class="nav-text">3. å¯åŠ¨ Zipkin æœåŠ¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆå¯é€‰ï¼‰"><span class="nav-text">4. æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆå¯é€‰ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-éªŒè¯æ¥å…¥"><span class="nav-text">5. éªŒè¯æ¥å…¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-ç¤ºä¾‹ä»£ç åˆ†æ"><span class="nav-text">6. ç¤ºä¾‹ä»£ç åˆ†æ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ€»ç»“"><span class="nav-text">æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç”¨è¡¨æ ¼è¯´æ˜-prometheuså’Œgrafanaå’ŒactuatoråŒºåˆ«"><span class="nav-text">ç”¨è¡¨æ ¼è¯´æ˜: prometheuså’Œgrafanaå’ŒactuatoråŒºåˆ«</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Actuatorå·²ç»å¾ˆå¥½-ä¸ºå•¥è¿˜éœ€è¦-Prometheus"><span class="nav-text">Actuatorå·²ç»å¾ˆå¥½, ä¸ºå•¥è¿˜éœ€è¦ Prometheus?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Prometheus-ä¸ºå•¥ä¾èµ–-Actuator"><span class="nav-text">Prometheus ä¸ºå•¥ä¾èµ– Actuator?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Actuactoræ•´ä½“å¦‚ä½•é…ç½®é‡Œå¼€å¯ä»¥åŠä»£ç é‡Œå¦‚ä½•æ¥å…¥"><span class="nav-text">Actuactoræ•´ä½“å¦‚ä½•é…ç½®é‡Œå¼€å¯ä»¥åŠä»£ç é‡Œå¦‚ä½•æ¥å…¥?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Grafanaæœ¬èº«ä¸éœ€è¦æ¥å…¥åˆ°springbootå¯¹å—-ä»–åªéœ€è¦åˆ°ç½‘é¡µç«¯é…ç½®æ•°æ®æºå°±è¡Œäº†"><span class="nav-text">Grafanaæœ¬èº«ä¸éœ€è¦æ¥å…¥åˆ°springbootå¯¹å—? ä»–åªéœ€è¦åˆ°ç½‘é¡µç«¯é…ç½®æ•°æ®æºå°±è¡Œäº†</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#é¡¹ç›®é‡ŒKafkaå’‹ç”¨çš„"><span class="nav-text">é¡¹ç›®é‡ŒKafkaå’‹ç”¨çš„</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-é…ç½®-Kafka"><span class="nav-text">1. é…ç½® Kafka</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-ç”Ÿäº§è€…é…ç½®"><span class="nav-text">1.1 ç”Ÿäº§è€…é…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-bootstrap-servers"><span class="nav-text">1. bootstrap.servers</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-é”®å’Œå€¼çš„åºåˆ—åŒ–å™¨"><span class="nav-text">2. é”®å’Œå€¼çš„åºåˆ—åŒ–å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#åºåˆ—åŒ–å™¨"><span class="nav-text">åºåˆ—åŒ–å™¨</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ååºåˆ—åŒ–å™¨"><span class="nav-text">ååºåˆ—åŒ–å™¨</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-KafkaTemplate-Bean"><span class="nav-text">3. KafkaTemplate Bean</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-æ¶ˆè´¹è€…é…ç½®"><span class="nav-text">1.2 æ¶ˆè´¹è€…é…ç½®</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-å‘é€æ¶ˆæ¯ï¼ˆç”Ÿäº§è€…ï¼‰"><span class="nav-text">2. å‘é€æ¶ˆæ¯ï¼ˆç”Ÿäº§è€…ï¼‰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-æ¥æ”¶æ¶ˆæ¯ï¼ˆæ¶ˆè´¹è€…ï¼‰"><span class="nav-text">3. æ¥æ”¶æ¶ˆæ¯ï¼ˆæ¶ˆè´¹è€…ï¼‰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-ä¸»é¢˜å’Œäº‹ä»¶ç±»å‹"><span class="nav-text">4. ä¸»é¢˜å’Œäº‹ä»¶ç±»å‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-å®¹å™¨åŒ–éƒ¨ç½²"><span class="nav-text">5. å®¹å™¨åŒ–éƒ¨ç½²</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RabbitMQ-å’Œ-KafkaåŒºåˆ«"><span class="nav-text">RabbitMQ å’Œ KafkaåŒºåˆ«</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Resilience4j-Feign-æ˜¯å•¥-é»˜è®¤åŒæ­¥è°ƒç”¨çš„è¯-ä¸ä¼šå¡æ­»å—"><span class="nav-text">Resilience4j? Feign æ˜¯å•¥? é»˜è®¤åŒæ­¥è°ƒç”¨çš„è¯, ä¸ä¼šå¡æ­»å—?</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Resilience4j-æ˜¯ä»€ä¹ˆ"><span class="nav-text">1. Resilience4j æ˜¯ä»€ä¹ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åœ¨ä»£ç åº“ä¸­çš„ä½“ç°"><span class="nav-text">åœ¨ä»£ç åº“ä¸­çš„ä½“ç°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Feign-æ˜¯ä»€ä¹ˆ"><span class="nav-text">2. Feign æ˜¯ä»€ä¹ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åœ¨ä»£ç åº“ä¸­çš„ä½“ç°-1"><span class="nav-text">åœ¨ä»£ç åº“ä¸­çš„ä½“ç°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-é»˜è®¤åŒæ­¥è°ƒç”¨æ˜¯å¦ä¼šå¡æ­»"><span class="nav-text">3. é»˜è®¤åŒæ­¥è°ƒç”¨æ˜¯å¦ä¼šå¡æ­»</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#è§£å†³æ–¹æ³•"><span class="nav-text">è§£å†³æ–¹æ³•</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lombok-æ˜¯-Entity-çš„æ›¿ä»£å“å—-ä¼˜åŠ¿å¦‚ä½•"><span class="nav-text">Lombok æ˜¯ @Entity çš„æ›¿ä»£å“å—? ä¼˜åŠ¿å¦‚ä½•?</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Entity-å’Œ-Lombok-çš„åŠŸèƒ½"><span class="nav-text">1. @Entity å’Œ Lombok çš„åŠŸèƒ½</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-ä¸ºä»€ä¹ˆ-Lombok-ä¸æ˜¯-Entity-çš„æ›¿ä»£å“"><span class="nav-text">2. ä¸ºä»€ä¹ˆ Lombok ä¸æ˜¯ @Entity çš„æ›¿ä»£å“</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Lombok-çš„ä¼˜åŠ¿"><span class="nav-text">3. Lombok çš„ä¼˜åŠ¿</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Eurekaæ˜¯ç±»ä¼¼äºetcdé‚£ç§çš„ç¬¬ä¸‰æ–¹è¿›ç¨‹å—-å¦‚ä½•æ¥å…¥-å¦‚ä½•æ³¨å†Œ-æ¥å…¥äº†k8sè¿˜éœ€è¦eurekaå—"><span class="nav-text">Eurekaæ˜¯ç±»ä¼¼äºetcdé‚£ç§çš„ç¬¬ä¸‰æ–¹è¿›ç¨‹å—? å¦‚ä½•æ¥å…¥, å¦‚ä½•æ³¨å†Œ?æ¥å…¥äº†k8sè¿˜éœ€è¦eurekaå—</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Eureka-ä½œä¸ºç¬¬ä¸‰æ–¹è¿›ç¨‹çš„ä½¿ç”¨æ–¹å¼"><span class="nav-text">Eureka ä½œä¸ºç¬¬ä¸‰æ–¹è¿›ç¨‹çš„ä½¿ç”¨æ–¹å¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ¥å…¥-Eureka-Server"><span class="nav-text">æ¥å…¥ Eureka Server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ³¨å†ŒæœåŠ¡åˆ°-Eureka-Server"><span class="nav-text">æ³¨å†ŒæœåŠ¡åˆ° Eureka Server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€»ç»“-1"><span class="nav-text">æ€»ç»“</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ‰k8sä¸éœ€è¦Eurekaçš„æƒ…å†µ"><span class="nav-text">æœ‰k8sä¸éœ€è¦Eurekaçš„æƒ…å†µ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#éœ€è¦Eurekaçš„æƒ…å†µ"><span class="nav-text">éœ€è¦Eurekaçš„æƒ…å†µ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#é¡¹ç›®é‡Œçš„api-gatewayå¹²å•¥çš„"><span class="nav-text">é¡¹ç›®é‡Œçš„api-gatewayå¹²å•¥çš„</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-è·¯ç”±è¯·æ±‚"><span class="nav-text">1. è·¯ç”±è¯·æ±‚</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡"><span class="nav-text">2. æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰é…ç½®"><span class="nav-text">3. è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰é…ç½®</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-è¿‡æ»¤å™¨åŠŸèƒ½"><span class="nav-text">4. è¿‡æ»¤å™¨åŠŸèƒ½</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-é›†æˆåˆ†å¸ƒå¼è¿½è¸ª"><span class="nav-text">5. é›†æˆåˆ†å¸ƒå¼è¿½è¸ª</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WebSocketå’ŒHTTPé•¿é“¾æ¥å’ŒTCP"><span class="nav-text">WebSocketå’ŒHTTPé•¿é“¾æ¥å’ŒTCP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#WebSocket-å®ç°å®æ—¶é€šä¿¡çš„åŸç†"><span class="nav-text">WebSocket å®ç°å®æ—¶é€šä¿¡çš„åŸç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-æ¡æ‰‹é˜¶æ®µ"><span class="nav-text">1. æ¡æ‰‹é˜¶æ®µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-æ•°æ®ä¼ è¾“é˜¶æ®µ"><span class="nav-text">2. æ•°æ®ä¼ è¾“é˜¶æ®µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-è¿æ¥å…³é—­é˜¶æ®µ"><span class="nav-text">3. è¿æ¥å…³é—­é˜¶æ®µ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebSocket-ä¸-TCP-é•¿è¿æ¥çš„å…³ç³»"><span class="nav-text">WebSocket ä¸ TCP é•¿è¿æ¥çš„å…³ç³»</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ç›¸åŒç‚¹"><span class="nav-text">ç›¸åŒç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸åŒç‚¹"><span class="nav-text">ä¸åŒç‚¹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTPé•¿é“¾æ¥ä¸-WebSocket-çš„å¯¹æ¯”"><span class="nav-text">HTTPé•¿é“¾æ¥ä¸ WebSocket çš„å¯¹æ¯”</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-é•¿è¿æ¥çš„æ¦‚å¿µ"><span class="nav-text">HTTP é•¿è¿æ¥çš„æ¦‚å¿µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-1-1-é•¿è¿æ¥"><span class="nav-text">HTTP 1.1 é•¿è¿æ¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-2-é•¿è¿æ¥"><span class="nav-text">HTTP 2 é•¿è¿æ¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-3-é•¿è¿æ¥"><span class="nav-text">HTTP 3 é•¿è¿æ¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸-WebSocket-çš„å¯¹æ¯”"><span class="nav-text">ä¸ WebSocket çš„å¯¹æ¯”</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#é¡¹ç›®é‡ŒWebSocketæœ‰å•¥ç”¨"><span class="nav-text">é¡¹ç›®é‡ŒWebSocketæœ‰å•¥ç”¨?</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-å®æ—¶é€šçŸ¥"><span class="nav-text">1. å®æ—¶é€šçŸ¥</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-åœ¨çº¿èŠå¤©åŠŸèƒ½"><span class="nav-text">2. åœ¨çº¿èŠå¤©åŠŸèƒ½</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PostgresSQLå’ŒMySQLä¼˜åŠ£åŠ¿"><span class="nav-text">PostgresSQLå’ŒMySQLä¼˜åŠ£åŠ¿</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mike</span>
</div>



        

        
      </div>
    </footer>

    <!--
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      
        <span id="scrollpercent"><span>0</span>%</span>
      
    </div>
    -->

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>










  















  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/mediumzoom/medium-zoom.js?v=1.1.0"></script>





  




  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>


  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

    <script src="/js/src/local-search.js"></script>





  

  

  

  

  

  


  <script type="text/javascript" src="/lib/wobble_window/wobblewindow.js"> </script>
<script type="text/javascript" src="/js/src/custom.js"></script>
</body>
</html>






<script type="text/javascript" src="/js/src/headroom.js"></script>

<!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½ -->
<script type="text/javascript" src="/js/src/code-highlight-modification.js"></script>

<!-- Flashcards Script -->
<script type="text/javascript" src="/js/src/flashcards.js"></script>
