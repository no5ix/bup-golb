<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


  <meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">

<script>
    (function(){
        if(''){
            let localStoragePasswdKey = 'æ„å»ºæ¸¸æˆç½‘ç»œåè®®äº”ä¹‹å¯é çš„æœ‰åºæ¶ˆæ¯' + '_last_passwd';
            let tryCnt = 0;
            function checkPassword(password) {
                password = password == null ? null : password.trim();
                if (password !== '') {
                    if (password != null) {
                        // å¦‚æœç”¨æˆ·ç‚¹å‡»äº†ç¡®è®¤è€Œä¸”å¯†ç é”™è¯¯çš„æ—¶å€™, å› ä¸ºå½“password == nullçš„æ—¶å€™è¯´æ˜ç”¨æˆ·ç‚¹äº†å–æ¶ˆ
                        alert('Error!');
                        if (++tryCnt < 3) {
                            password = prompt('Open Sesame');
                            checkPassword(password);
                            return;
                        }
                    }

                    // if (history.length > 1) {
                    //     alert('back!');
                    //     history.back();
                    // } else {
                        // alert('blankkkk!');
                    //     window.location.href = "about:blank";
                    // }
                    if (document.referrer) {
                        window.location.href = document.referrer;
                    } else {
                        window.location.href = "about:blank";; // fallback if no referrer
                    }

                } else {
                    localStorage.setItem(localStoragePasswdKey, password);
                }
            }

            var password_verify_on_local = false;
            const hostname = window.location.hostname;
            if (password_verify_on_local || (!(hostname === "localhost" || hostname === "127.0.0.1" || hostname === "::1" || hostname.startsWith("192")))) {
                const lspk = localStorage.getItem(localStoragePasswdKey) || "";
                if (lspk !== '') {
                    var password = prompt('Open Sesame');
                    checkPassword(password);
                }
            }
        }
    })();
</script>








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">





















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="GafferOnGames,">








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2">






<meta name="description" content="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“æœ¬ç¯‡ä¸»è¦è®²äº†æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„é—®é¢˜, åˆ°åº•æ•°æ®åŒ…å¤šå¤§æ‰å¥½å‘¢?æ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½å‘¢?åŒ…å¤ªå¤§äº†æ€ä¹ˆåŠå‘¢?è¯·çœ‹æ€»ç»“, ä¸æ˜ä¹‹å¤„å†çœ‹æ–‡ä¸­å…·ä½“è®²è§£. ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå¯é UDPåè®®ç½‘ç»œåè®®åœ¨åŠ¨ä½œæ¸¸æˆç±»å‹ï¼ˆFPSï¼‰ä¸­çš„å…¸å‹ç‰¹å¾å°±æ˜¯ä¸€ä¸ªæŒç»­å‘é€çš„æ•°æ®åŒ…ï¼Œåœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šä»¥ç¨³å®šçš„é€Ÿåº¦å¦‚20æˆ–30åŒ…æ¯ç§’å‘é€ã€‚è¿™äº›æ•°æ®åŒ…éƒ½åŒ…å«æœ‰ä¸å¯é çš„æ— åºæ•°æ®ä¾‹å¦‚tæ—¶é—´å†…çš„ä¸–ç•ŒçŠ¶æ€ï¼›æ‰€ä»¥ï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼Œé‡æ–°å‘é€å®ƒå¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰">
<meta name="keywords" content="GafferOnGames">
<meta property="og:type" content="article">
<meta property="og:title" content="æ„å»ºæ¸¸æˆç½‘ç»œåè®®äº”ä¹‹å¯é çš„æœ‰åºæ¶ˆæ¯">
<meta property="og:url" content="https://hulinhong.com/reliable_ordered_messages/index.html">
<meta property="og:site_name" content="ğŸš™">
<meta property="og:description" content="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“æœ¬ç¯‡ä¸»è¦è®²äº†æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„é—®é¢˜, åˆ°åº•æ•°æ®åŒ…å¤šå¤§æ‰å¥½å‘¢?æ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½å‘¢?åŒ…å¤ªå¤§äº†æ€ä¹ˆåŠå‘¢?è¯·çœ‹æ€»ç»“, ä¸æ˜ä¹‹å¤„å†çœ‹æ–‡ä¸­å…·ä½“è®²è§£. ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå¯é UDPåè®®ç½‘ç»œåè®®åœ¨åŠ¨ä½œæ¸¸æˆç±»å‹ï¼ˆFPSï¼‰ä¸­çš„å…¸å‹ç‰¹å¾å°±æ˜¯ä¸€ä¸ªæŒç»­å‘é€çš„æ•°æ®åŒ…ï¼Œåœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šä»¥ç¨³å®šçš„é€Ÿåº¦å¦‚20æˆ–30åŒ…æ¯ç§’å‘é€ã€‚è¿™äº›æ•°æ®åŒ…éƒ½åŒ…å«æœ‰ä¸å¯é çš„æ— åºæ•°æ®ä¾‹å¦‚tæ—¶é—´å†…çš„ä¸–ç•ŒçŠ¶æ€ï¼›æ‰€ä»¥ï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼Œé‡æ–°å‘é€å®ƒå¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2025-12-17T18:31:29.672Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="æ„å»ºæ¸¸æˆç½‘ç»œåè®®äº”ä¹‹å¯é çš„æœ‰åºæ¶ˆæ¯">
<meta name="twitter:description" content="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“æœ¬ç¯‡ä¸»è¦è®²äº†æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„é—®é¢˜, åˆ°åº•æ•°æ®åŒ…å¤šå¤§æ‰å¥½å‘¢?æ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½å‘¢?åŒ…å¤ªå¤§äº†æ€ä¹ˆåŠå‘¢?è¯·çœ‹æ€»ç»“, ä¸æ˜ä¹‹å¤„å†çœ‹æ–‡ä¸­å…·ä½“è®²è§£. ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå¯é UDPåè®®ç½‘ç»œåè®®åœ¨åŠ¨ä½œæ¸¸æˆç±»å‹ï¼ˆFPSï¼‰ä¸­çš„å…¸å‹ç‰¹å¾å°±æ˜¯ä¸€ä¸ªæŒç»­å‘é€çš„æ•°æ®åŒ…ï¼Œåœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šä»¥ç¨³å®šçš„é€Ÿåº¦å¦‚20æˆ–30åŒ…æ¯ç§’å‘é€ã€‚è¿™äº›æ•°æ®åŒ…éƒ½åŒ…å«æœ‰ä¸å¯é çš„æ— åºæ•°æ®ä¾‹å¦‚tæ—¶é—´å†…çš„ä¸–ç•ŒçŠ¶æ€ï¼›æ‰€ä»¥ï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼Œé‡æ–°å‘é€å®ƒå¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":12,"scrollpercent":true,"onmobile":true,"dimmer":true,"body_content_height":0,"display_duration":150},
    local_search: {"enable":true,"trigger":"auto","top_n_per_article":1},
    fancybox: false,
    mediumzoom: true,
    darkmode_js: false,
    tabs: true,
    motion: {"enable":true,"async":false,"duration":188,"transition":{"header":"fadeIn","menu":"fadeIn","logo":"fadeIn","post_block_else":"fadeIn","post_header":"fadeIn","post_body":"fadeIn","coll_header":"fadeIn","footer":"fadeIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>








  <title>æ„å»ºæ¸¸æˆç½‘ç»œåè®®äº”ä¹‹å¯é çš„æœ‰åºæ¶ˆæ¯ | ğŸš™</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ğŸš™</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ğŸ’¨ ğŸ’¨ ğŸ’¨</p>
      
  </div>

  <div class="menu-item sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div class="menu-item site-search">
    
  
  <div class="site-search-div">
    <button class="search-icon" id="search-button">
      <i class="fa fa-search"></i>
    </button>
    <input type="text" id="local-search-input" class="st-search-input">
    <i id="local-search-close">Ã—</i>
  </div>


<script type="text/javascript" id="local.search.active">
    {/* var inputArea       = document.querySelector("#local-search-input");
    inputArea.onclick   = function(){ getSearchFile(); this.focus(); }
    inputArea.onkeydown = function(){ if(event.keyCode == 13) return false } */}
</script>



  </div>
  <div id="local-search-result-pc" class="local-search-result-cls"></div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

       
    </ul>
  

  
    
  
</nav>



 </div>
    </header>

    <div id="local-search-result-mobile" class="local-search-result-cls"></div>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/reliable_ordered_messages/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">æ„å»ºæ¸¸æˆç½‘ç»œåè®®äº”ä¹‹å¯é çš„æœ‰åºæ¶ˆæ¯</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-29T13:13:35+00:00">
                03-29-2017
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GS/" itemprop="url" rel="index">
                    <span itemprop="name">GS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            <div class="post-tags">
              
                <a href="/tags/GafferOnGames/" rel="tag"><i class="fa fa-tag"></i> GafferOnGames</a>
              
            </div>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/ssl_tls_illustrated/" rel="next" title="SSL/TLSè¯¦è§£">
                <i class="fa fa-chevron-left"></i> 
                <p class="post-nav-pre-next-title">
                  SSL/TLSè¯¦è§£
                </p> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/kbe_note_one/" rel="prev" title="kbeæœåŠ¡ç«¯ç¬”è®°(ä¸€)">
              <p class="post-nav-pre-next-title">
                  kbeæœåŠ¡ç«¯ç¬”è®°(ä¸€)
              </p> 
              <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      

      
      

      
        <h1 id="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"><a href="#æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“" class="headerlink" title="æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"></a>æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“</h1><p>æœ¬ç¯‡ä¸»è¦è®²äº†æ•°æ®åŒ…çš„åˆ†åŒ…å’Œé‡ç»„é—®é¢˜, åˆ°åº•æ•°æ®åŒ…å¤šå¤§æ‰å¥½å‘¢?æ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½å‘¢?åŒ…å¤ªå¤§äº†æ€ä¹ˆåŠå‘¢?<br>è¯·çœ‹æ€»ç»“, ä¸æ˜ä¹‹å¤„å†çœ‹æ–‡ä¸­å…·ä½“è®²è§£.</p>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå¯é UDPåè®®"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå¯é UDPåè®®" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå¯é UDPåè®®"></a>ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå¯é UDPåè®®</h2><p>ç½‘ç»œåè®®åœ¨åŠ¨ä½œæ¸¸æˆç±»å‹ï¼ˆFPSï¼‰ä¸­çš„å…¸å‹ç‰¹å¾å°±æ˜¯ä¸€ä¸ªæŒç»­å‘é€çš„æ•°æ®åŒ…ï¼Œåœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šä»¥ç¨³å®šçš„é€Ÿåº¦å¦‚20æˆ–30åŒ…æ¯ç§’å‘é€ã€‚è¿™äº›æ•°æ®åŒ…éƒ½åŒ…å«æœ‰ä¸å¯é çš„æ— åºæ•°æ®ä¾‹å¦‚tæ—¶é—´å†…çš„ä¸–ç•ŒçŠ¶æ€ï¼›æ‰€ä»¥ï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼Œé‡æ–°å‘é€å®ƒå¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚å½“é‡æ–°å‘é€çš„æ•°æ®åŒ…åˆ°è¾¾æ—¶ï¼Œæ—¶é—´tå·²ç»è¿‡å»äº†ã€‚</p>
<p>æ‰€ä»¥è¿™å°±æ˜¯æˆ‘ä»¬å°†è¦å®ç°å¯é æ€§çš„ç°çŠ¶ã€‚å¯¹äºæˆ‘ä»¬90%çš„æ•°æ®åŒ…ï¼Œä»…ä¸¢å¼ƒå¹¶ä¸å†é‡æ–°å‘é€å®ƒä¼šæ›´å¥½ã€‚å¯¹äº10%æˆ–æ›´å°‘ï¼ˆè¯¯å·®å…è®¸èŒƒå›´å†…ï¼‰çš„æƒ…å†µï¼Œæˆ‘ä»¬ç¡®å®éœ€è¦å¯é æ€§ï¼Œä½†è¿™æ ·çš„æ•°æ®æ˜¯éå¸¸ç½•è§çš„ï¼Œå¾ˆå°‘è¢«å‘é€è€Œä¸”æ¯”ä¸å¯é çš„æ•°æ®çš„å¹³å‡å¤§å°è¦å°å¾—å¤šã€‚è¿™ä¸ªä½¿ç”¨æ¡ˆä¾‹é€‚ç”¨äºæ‰€æœ‰è¿‡å»åäº”å¹´æ¥å‘å¸ƒçš„AAAçº§çš„FPSæ¸¸æˆã€‚</p>
<h2 id="åº”ç­”ç³»ç»Ÿæ˜¯å®ç°å¯é UDPçš„æœ€é‡è¦çš„éƒ¨åˆ†"><a href="#åº”ç­”ç³»ç»Ÿæ˜¯å®ç°å¯é UDPçš„æœ€é‡è¦çš„éƒ¨åˆ†" class="headerlink" title="åº”ç­”ç³»ç»Ÿæ˜¯å®ç°å¯é UDPçš„æœ€é‡è¦çš„éƒ¨åˆ†"></a>åº”ç­”ç³»ç»Ÿæ˜¯å®ç°å¯é UDPçš„æœ€é‡è¦çš„éƒ¨åˆ†</h2><p>ä¸ºå®ç°æ•°æ®åŒ…å±‚çº§çš„åº”ç­”ï¼Œåœ¨æ¯ä¸ªåŒ…çš„å‰é¢æ·»åŠ å¦‚ä¸‹çš„æŠ¥å¤´ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Header</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">uint16_t</span> sequence;</span><br><span class="line">    <span class="keyword">uint16_t</span> ack;</span><br><span class="line">    <span class="keyword">uint32_t</span> ack_bits;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¿™äº›æŠ¥å¤´å…ƒç´ ç»„åˆèµ·æ¥ä»¥åˆ›å»ºåº”ç­”ç³»ç»Ÿï¼š</p>
<ul>
<li>sequence æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œéšæ¯ä¸ªæ•°æ®åŒ…å‘é€è€Œå¢é•¿ï¼ˆå¹¶ä¸”åœ¨è¾¾åˆ°65535åå›å¾€å¤ï¼‰ã€‚</li>
<li>ack æ˜¯ä»å¦ä¸€æ–¹æ¥æ”¶åˆ°çš„æœ€æ–°çš„æ•°æ®åŒ…åºåˆ—å·ã€‚</li>
<li>ack_bits æ˜¯ä¸€ä¸ªä½å­—æ®µï¼Œå®ƒç¼–ç ä¸ackç›¸å…³çš„æ”¶åˆ°çš„æ•°æ®åŒ…ç»„åˆï¼šå¦‚æœä½nå·²ç»è®¾ç½®ï¼Œå³ ackâ€“ n æ•°æ®åŒ…è¢«æ¥æ”¶äº†ã€‚</li>
</ul>
<p>ack_bits ä¸ä»…æ˜¯ä¸€ä¸ªèŠ‚çœå¸¦å®½çš„å·§å¦™çš„ç¼–ç ï¼Œå®ƒåŒæ ·ä¹Ÿå¢åŠ äº†ä¿¡æ¯å†—ä½™æ¥æŠµå¾¡åŒ…çš„ä¸¢å¤±ã€‚æ¯ä¸ªåº”ç­”ç è¦è¢«å‘é€32æ¬¡ã€‚å¦‚æœæœ‰ä¸€ä¸ªåŒ…ä¸¢å¤±äº†ï¼Œä»ç„¶æœ‰å…¶ä»–31ä¸ªåŒ…æœ‰ç€ç›¸åŒçš„åº”ç­”ç ã€‚ä»ç»Ÿè®¡ä¸Šæ¥è¯´ï¼Œåº”ç­”ç è¿˜æ˜¯éå¸¸æœ‰å¯èƒ½é€è¾¾çš„ã€‚</p>
<p>ä½†çªå‘çš„ä¼ é€æ•°æ®åŒ…çš„ä¸¢å¤±è¿˜æ˜¯æœ‰å¯èƒ½å‘ç”Ÿçš„ï¼Œæ‰€ä»¥é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼š</p>
<ul>
<li>å¦‚æœä½ æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…nçš„åº”ç­”ç ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…è‚¯å®šå·²ç»æ”¶åˆ°äº†ã€‚</li>
<li>å¦‚æœä½ æ²¡æœ‰æ”¶åˆ°åº”ç­”ç ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…å°±å¾ˆæœ‰å¯èƒ½ æ²¡æœ‰è¢«æ”¶åˆ°ã€‚ä½†æ˜¯â€¦å®ƒä¹Ÿè®¸ä¼šæ˜¯ï¼Œä»…æ˜¯åº”ç­”ç æ²¡æœ‰é€è¾¾ã€‚è¿™ç§æƒ…å†µæ˜¯æå…¶ç½•è§çš„ã€‚</li>
</ul>
<p>ä»¥æˆ‘çš„ç»éªŒï¼Œæ²¡æœ‰å¿…è¦è®¾è®¡å®Œå–„çš„åº”ç­”æœºåˆ¶ã€‚åœ¨ä¸€ä¸ªæå°‘ä¸¢åº”ç­”ç çš„ç³»ç»Ÿä¸Šæ„å»ºä¸€ä¸ªå¯é æ€§ç³»ç»Ÿå¹¶ä¸ä¼šå¢åŠ ä»€ä¹ˆå¤§é—®é¢˜ã€‚</p>
<h2 id="å‘é€æ–¹å¦‚ä½•è¿½è¸ªæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«åº”ç­”"><a href="#å‘é€æ–¹å¦‚ä½•è¿½è¸ªæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«åº”ç­”" class="headerlink" title="å‘é€æ–¹å¦‚ä½•è¿½è¸ªæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«åº”ç­”"></a>å‘é€æ–¹å¦‚ä½•è¿½è¸ªæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«åº”ç­”</h2><p>ä¸ºå®ç°è¿™ä¸ªåº”ç­”ç³»ç»Ÿï¼Œæˆ‘ä»¬åœ¨å‘é€æ–¹è¿˜éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥è¿½è¸ªä¸€ä¸ªæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«åº”ç­”ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¿½ç•¥å†—ä½™çš„åº”ç­”ï¼ˆæ¯ä¸ªåŒ…ä¼šé€šè¿‡ <code>ack_bits</code>å¤šæ¬¡åº”ç­”)ã€‚æˆ‘ä»¬åŒæ ·åœ¨æ¥æ”¶æ–¹ä¹Ÿè¿˜éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥è¿½è¸ªé‚£äº›å·²ç»æ”¶åˆ°çš„åŒ…ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨æ•°æ®åŒ…çš„æŠ¥å¤´å¡«å†™<code>ack_bits</code>çš„å€¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> BufferSize = <span class="number">1024</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">uint32_t</span> sequence_buffer[BufferSize];</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PacketData</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">bool</span> acked;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">PacketData packet_data[BufferSize];</span><br><span class="line"> </span><br><span class="line"><span class="function">PacketData * <span class="title">GetPacketData</span><span class="params">( <span class="keyword">uint16_t</span> sequence )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> index = sequence % BufferSize;</span><br><span class="line">    <span class="keyword">if</span> ( sequence_buffer[index] == sequence )</span><br><span class="line">        <span class="keyword">return</span> &amp;packet_data[index];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ åœ¨è¿™å¯ä»¥çœ‹åˆ°çš„çªé—¨æ˜¯è¿™ä¸ªæ»šåŠ¨çš„ç¼“å†²åŒºæ˜¯ä»¥åºåˆ—å·æ¥ä½œä¸ºç´¢å¼•çš„ï¼š</p>
<p><code>const int index =sequence % BufferSize;</code></p>
<p>å½“æ¡ç›®è¢«é¡ºåºæ·»åŠ ï¼Œå°±åƒä¸€ä¸ªè¢«å‘é€çš„é˜Ÿåˆ—ï¼Œå¯¹æ’å…¥æ‰€éœ€è¦åšçš„å°±æ˜¯æŠŠè¿™ä¸ªåºåˆ—ç¼“å†²åŒºçš„å€¼æ›´æ–°ä¸ºæ–°çš„åºåˆ—å·å¹¶ä¸”åœ¨è¯¥ç´¢å¼•å¤„é‡å†™è¿™ä¸ªæ•°æ®ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">PacketData &amp; <span class="title">InsertPacketData</span><span class="params">( <span class="keyword">uint16_t</span> sequence )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> index = sequence % BufferSize;</span><br><span class="line">    sequence_buffer[index] = sequence;</span><br><span class="line">    <span class="keyword">return</span> packet_data[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="åŸæ–‡"><a href="#åŸæ–‡" class="headerlink" title="åŸæ–‡"></a>åŸæ–‡</h1><p><a href="https://gafferongames.com/post/reliable_ordered_messages/" target="_blank" rel="noopener">åŸæ–‡å‡ºå¤„</a></p>
<p>åŸæ–‡æ ‡é¢˜ : <strong>Reliable Ordered Messages</strong> (<em>How to implement reliable-ordered messages on top of UDP</em>)</p>
<hr>
<p></p><h2 id="introduction">Introduction</h2><p></p>
<p>Hi, Iâ€™m <a href="https://gafferongames.com/about" target="_blank" rel="noopener">Glenn Fiedler</a> and welcome to <strong><a href="https://gafferongames.com/categories/building-a-game-network-protocol/" target="_blank" rel="noopener">Building a Game Network Protocol</a></strong>.</p><br><p>Many people will tell you that implementing your own reliable message system on top of UDP is foolish. After all, why reimplement TCP?</p><br><p>But why limit ourselves to how TCP works? But there are so many different ways to implement reliable-messages and most of them work <em>nothing</em> like TCP!</p><br><p>So let&rsquo;s get creative and work out how we can implement a reliable message system that&rsquo;s <em>better</em> and <em>more flexible</em> than TCP for real-time games.</p><br><h2 id="different-approaches">Different Approaches</h2><br><p>A common approach to reliability in games is to have two packet types: reliable-ordered and unreliable. You&rsquo;ll see this approach in many network libraries.</p><br><p>The basic idea is that the library resends reliable packets until they are received by the other side. This is the option that usually ends up looking a bit like TCP-lite for the reliable-packets. It&rsquo;s not that bad, but you can do much better.</p><br><p>The way I prefer to think of it is that messages are smaller bitpacked elements that know how to serialize themselves. This makes the most sense when the overhead of length prefixing and padding bitpacked messages up to the next byte is undesirable (eg. lots of small messages included in each packet). Sent messages are placed in a queue and each time a packet is sent some of the messages in the send queue are included in the outgoing packet. This way there are no reliable packets that need to be resent. Reliable messages are simply included in outgoing packets until they are received.</p><br><p>The easiest way to do this is to include all unacked messages in each packet sent. It goes something like this: each message sent has an id that increments each time a message is sent. Each outgoing packet includes the start <em>message id</em> followed by the data for <em>n</em> messages. The receiver continually sends back the most recent received message id to the sender as an ack and only messages newer than the most recent acked message id are included in packets.</p><br><p>This is simple and easy to implement but if a large burst of packet loss occurs while you are sending messages you get a spike in packet size due to unacked messages.</p><br><p>You can avoid this by extending the system to have an upper bound on the number of messages included per-packet <em>n</em>. But now if you have a high packet send rate (like 60 packets per-second) you are sending the same message multiple times until you get an ack for that message.</p><br><p>If your round trip time is 100ms each message will be sent 6 times redundantly before being acked on average. Maybe you really need this amount of redundancy because your messages are extremely time critical, but in most cases, your bandwidth would be better spent on other things.</p><br><p>The approach I prefer combines packet level acks with a prioritization system that picks the n most important messages to include in each packet. This combines time critical delivery and the ability to send only n messages per-packet, while distributing sends across all messages in the send queue.</p><br><h2 id="packet-level-acks">Packet Level Acks</h2><br><p>To implement packet level acks, we add the following packet header:</p><br><pre>struct Header<br>{<br>    uint16_t sequence;<br>    uint16_t ack;<br>    uint32_t ack_bits;<br>};<br></pre><br><p>These header elements combine to create the ack system: <strong>sequence</strong> is a number that increases with each packet sent, <strong>ack</strong> is the most recent packet sequence number received, and <strong>ack_bits</strong> is a bitfield encoding the set of acked packets.</p><br><p>If bit <strong>n</strong> is set in <strong>ack_bits</strong>, then <strong>ack - n</strong> is acked. Not only is <strong>ack_bits</strong> a smart encoding that saves bandwidth, it also adds <em>redundancy</em> to combat packet loss. Each ack is sent 32 times. If one packet is lost, there&rsquo;s 31 other packets with the same ack. Statistically speaking, acks are very likely to get through.</p><br><p>But bursts of packet loss do happen, so it&rsquo;s important to note that:</p><br><ol><br><li><p>If you receive an ack for packet n then that packet was <strong>definitely received</strong>.</p></li><br><li><p>If you don&rsquo;t receive an ack, the packet was <em>most likely</em> not received. But, it might have been, and the ack just didn&rsquo;t get through. <strong>This is extremely rare</strong>.</p></li><br></ol><br><p>In my experience it&rsquo;s not necessary to send perfect acks. Building a reliability system on top of a system that very rarely drops acks adds no significant problems. But it does create a challenge for testing this system works under all situations because of the edge cases when acks are dropped.</p><br><p>So please if you do implement this system yourself, setup a soak test with terrible network conditions to make sure your ack system is working correctly. You&rsquo;ll find such a soak test in the <a href="http://www.patreon.com/gafferongames" target="_blank" rel="noopener">example source code</a> for this article, and the open source network libraries <a href="https://github.com/networkprotocol/reliable.io" target="_blank" rel="noopener">reliable.io</a> and <a href="http://www.libyojimbo.com" target="_blank" rel="noopener">yojimbo</a> which also implement this technique.</p><br><h2 id="sequence-buffers">Sequence Buffers</h2><br><p>To implement this ack system we need a data structure on the sender side to track whether a packet has been acked so we can ignore redundant acks (each packet is acked multiple times via <strong>ack_bits</strong>. We also need a data structure on the receiver side to keep track of which packets have been received so we can fill in the <strong>ack_bits</strong> value in the packet header.</p><br><p>The data structure should have the following properties:</p><br><ul><br><li>Constant time insertion (inserts may be <em>random</em>, for example out of order packets&hellip;)</li><br><li>Constant time query if an entry exists given a packet sequence number</li><br><li>Constant time access for the data stored for a given packet sequence number</li><br><li>Constant time removal of entries</li><br></ul><br><p>You might be thinking. Oh of course, <em>hash table</em>. But there&rsquo;s a much simpler way:</p><br><pre>const int BufferSize = 1024;<br><br>uint32_t sequence_buffer[BufferSize];<br><br>struct PacketData<br>{<br>    bool acked;<br>};<br><br>PacketData packet_data[BufferSize];<br><br>PacketData <em> GetPacketData( uint16_t sequence )<br>{<br>    const int index = sequence % BufferSize;<br>    if ( sequence_buffer[index] == sequence )<br>        return &amp;packet_data[index];<br>    else<br>        return NULL;<br>}<br></em></pre><br><p>As you can see the trick here is a rolling buffer indexed by sequence number:</p><br><pre>const int index = sequence % BufferSize;<br></pre><br><p>This works because we don&rsquo;t care about being destructive to old entries. As the sequence number increases older entries are naturally overwritten as we insert new ones. The sequence_buffer[index] value is used to test if the entry at that index actually corresponds to the sequence number you&rsquo;re looking for. A sequence buffer value of 0xFFFFFFFF indicates an empty entry and naturally returns NULL for any sequence number query without an extra branch.</p><br><p>When entries are added in order like a send queue, all that needs to be done on insert is to update the sequence buffer value to the new sequence number and overwrite the data at that index:</p><br><pre>PacketData &amp; InsertPacketData( uint16_t sequence )<br>{<br>    const int index = sequence % BufferSize;<br>    sequence_buffer[index] = sequence;<br>    return packet_data[index];<br>}<br></pre><br><p>Unfortunately, on the receive side packets arrive out of order and some are lost. Under ridiculously high packet loss (99%) I&rsquo;ve seen old sequence buffer entries stick around from before the previous sequence number wrap at 65535 and break my ack logic (leading to false acks and broken reliability where the sender thinks the other side has received something they haven&rsquo;t&hellip;).</p><br><p>The solution to this problem is to walk between the previous highest insert sequence and the new insert sequence (if it is more recent) and clear those entries in the sequence buffer to 0xFFFFFFFF. Now in the common case, insert is <em>very close</em> to constant time, but worst case is linear where n is the number of sequence entries between the previous highest insert sequence and the current insert sequence.</p><br><p>Before we move on I would like to note that you can do much more with this data structure than just acks. For example, you could extend the per-packet data to include time sent:</p><br><pre>struct PacketData<br>{<br>    bool acked;<br>    double send_time;<br>};<br></pre><br><p>With this information you can create your own estimate of round trip time by comparing send time to current time when packets are acked and taking an <a href="https://en.wikipedia.org/wiki/Exponential_smoothing" target="_blank" rel="noopener">exponentially smoothed moving average</a>. You can even look at packets in the sent packet sequence buffer older than your RTT estimate (you should have received an ack for them by now&hellip;) to create your own packet loss estimate.</p><br><h2 id="ack-algorithm">Ack Algorithm</h2><br><p>Now that we have the data structures and packet header, here is the algorithm for implementing packet level acks:</p><br><p><strong>On packet send:</strong></p><br><ol><br><li><p>Insert an entry for for the current send packet sequence number in the sent packet sequence buffer with data indicating that it hasn&rsquo;t been acked yet</p></li><br><li><p>Generate <strong>ack</strong> and <strong>ack_bits</strong> from the contents of the local received packet sequence buffer and the most recent received packet sequence number</p></li><br><li><p>Fill the packet header with <strong>sequence</strong>, <strong>ack</strong> and <strong>ack_bits</strong></p></li><br><li><p>Send the packet and increment the send packet sequence number</p></li><br></ol><br><p><strong>On packet receive:</strong></p><br><ol><br><li><p>Read in <strong>sequence</strong> from the packet header</p></li><br><li><p>If <strong>sequence</strong> is more recent than the previous most recent received packet sequence number, update the most recent received packet sequence number</p></li><br><li><p>Insert an entry for this packet in the received packet sequence buffer</p></li><br><li><p>Decode the set of acked packet sequence numbers from <strong>ack</strong> and <strong>ack_bits</strong> in the packet header.</p></li><br><li><p>Iterate across all acked packet sequence numbers and for any packet that is not already acked call <strong>OnPacketAcked</strong>( uint16_t sequence ) and mark that packet as <em>acked</em> in the sent packet sequence buffer.</p></li><br></ol><br><p>Importantly this algorithm is done on both sides so if you have a client and a server then each side of the connection runs the same logic, maintaining its own sequence number for sent packets, tracking most recent received packet sequence # from the other side and a sequence buffer of received packets from which it generates <strong>sequence</strong>, <strong>ack</strong> and <strong>ack_bits</strong> to send to the other side.</p><br><p>And that&rsquo;s really all there is to it. Now you have a callback when a packet is received by the other side: <strong>OnPacketAcked</strong>. The main benefit of this ack system is now that you know which packets were received, you can build <em>any</em> reliability system you want on top. It&rsquo;s not limited to just reliable-ordered messages. For example, you could use it to implement delta encoding on a per-object basis.</p><br><h2 id="message-objects">Message Objects</h2><br><p>Messages are small objects (smaller than packet size, so that many will fit in a typical packet) that know how to serialize themselves. In my system they perform serialization using a <a href="https://gafferongames.com/building-a-game-network-protocol/serialization-strategies" target="_blank" rel="noopener">unified serialize function</a>unified serialize function.</p><br><p>The serialize function is templated so you write it once and it handles read, write and <em>measure</em>.</p><br><p>Yes. Measure. One of my favorite tricks is to have a dummy stream class called <strong>MeasureStream</strong> that doesn&rsquo;t do any actual serialization but just measures the number of bits that <em>would</em> be written if you called the serialize function. This is particularly useful for working out which messages are going to fit into your packet, especially when messages themselves can have arbitrarily complex serialize functions.</p><br><pre>struct TestMessage : public Message<br>{<br>    uint32_t a,b,c;<br><br>    TestMessage()<br>    {<br>        a = 0;<br>        b = 0;<br>        c = 0;<br>    }<br><br>    template &lt;typename Stream&gt; bool Serialize( Stream &amp; stream )<br>    {<br>        serialize_bits( stream, a, 32 );<br>        serialize_bits( stream, b, 32 );<br>        serialize_bits( stream, c, 32 );<br>        return true;<br>    }<br><br>    virtual SerializeInternal( WriteStream &amp; stream )<br>    {<br>        return Serialize( stream );<br>    }<br><br>    virtual SerializeInternal( ReadStream &amp; stream )<br>    {<br>        return Serialize( stream );<br>    }<br><br>    virtual SerializeInternal( MeasureStream &amp; stream )<br>    {<br>        return Serialize( stream );<br>    }<br>};<br></pre><br><p>The trick here is to bridge the unified templated serialize function (so you only have to write it once) to virtual serialize methods by calling into it from virtual functions per-stream type. I usually wrap this boilerplate with a macro, but it&rsquo;s expanded in the code above so you can see what&rsquo;s going on.</p><br><p>Now when you have a base message pointer you can do this and it <em>just works</em>:</p><br><pre>Message  message = CreateSomeMessage();<br>message-&gt;SerializeInternal( stream );<br></pre><br><p>An alternative if you know the full set of messages at compile time is to implement a big switch statement on message type casting to the correct message type before calling into the serialize function for each type. I&rsquo;ve done this in the past on console platform implementations of this message system (eg. PS3 SPUs) but for applications today (2016) the overhead of virtual functions is neglible.</p><br><p>Messages derive from a base class that provides a common interface such as serialization, querying the type of a message and reference counting. Reference counting is necessary because messages are passed around by pointer and stored not only in the message send queue until acked, but also in outgoing packets which are themselves C++ structs.</p><br><p>This is a strategy to avoid copying data by passing both messages and packets around by pointer. Somewhere else (ideally on a separate thread) packets and the messages inside them are serialized to a buffer. Eventually, when no references to a message exist in the message send queue (the message is acked) and no packets including that message remain in the packet send queue, the message is destroyed.</p><br><p>We also need a way to create messages. I do this with a message factory class with a virtual function overriden to create a message by type. It&rsquo;s good if the packet factory also knows the total number of message types, so we can serialize a message type over the network with tight bounds and discard malicious packets with message type values outside of the valid range:</p><br><pre>enum TestMessageTypes<br>{<br>    TEST_MESSAGE_A,<br>    TEST_MESSAGE_B,<br>    TEST_MESSAGE_C,<br>    TEST_MESSAGE_NUM_TYPES<br>};<br><br>// message definitions omitted<br><br>class TestMessageFactory : public MessageFactory<br>{<br>public:<br><br>    Message <em> Create( int type )<br>    {<br>        switch ( type )<br>        {<br>            case TEST_MESSAGE_A: return new TestMessageA();<br>            case TEST_MESSAGE_B: return new TestMessageB();<br>            case TEST_MESSAGE_C: return new TestMessageC();<br>        }<br>    }<br><br>    virtual int GetNumTypes() const<br>    {<br>        return TEST_MESSAGE_NUM_TYPES;<br>    }<br>};<br></em></pre><br><p>Again, this is boilerplate and is usually wrapped by macros, but underneath this is what&rsquo;s going on.</p><br><h2 id="reliable-ordered-message-algorithm">Reliable Ordered Message Algorithm</h2><br><p>The algorithm for sending reliable-ordered messages is as follows:</p><br><p><strong>On message send:</strong></p><br><ol><br><li><p>Measure how many bits the message serializes to using the measure stream</p></li><br><li><p>Insert the message pointer and the # of bits it serializes to into a sequence buffer indexed by message id. Set the time that message has last been sent to -1</p></li><br><li><p>Increment the send message id</p></li><br></ol><br><p><strong>On packet send:</strong></p><br><ol><br><li><p>Walk across the set of messages in the send message sequence buffer between the oldest unacked message id and the most recent inserted message id from left -&gt; right (increasing message id order).</p></li><br><li><p>Never send a message id that the receiver can&rsquo;t buffer or you&rsquo;ll break message acks (since that message won&rsquo;t be buffered, but the packet containing it will be acked, the sender thinks the message has been received, and will not resend it). This means you must <em>never</em> send a message id equal to or more recent than the oldest unacked message id plus the size of the message receive buffer.</p></li><br><li><p>For any message that hasn&rsquo;t been sent in the last 0.1 seconds <em>and</em> fits in the available space we have left in the packet, add it to the list of messages to send. Messages on the left (older messages) naturally have priority due to the iteration order.</p></li><br><li><p>Include the messages in the outgoing packet and add a reference to each message. Make sure the packet destructor decrements the ref count for each message.</p></li><br><li><p>Store the number of messages in the packet <strong>n</strong> and the array of message ids included in the packet in a sequence buffer indexed by the outgoing packet sequence number so they can be used to map packet level acks to the set of messages included in that packet.</p></li><br><li><p>Add the packet to the packet send queue.</p></li><br></ol><br><p><strong>On packet receive:</strong></p><br><ol><br><li><p>Walk across the set of messages included in the packet and insert them in the receive message sequence buffer indexed by their message id.</p></li><br><li><p>The ack system automatically acks the packet sequence number we just received.</p></li><br></ol><br><p><strong>On packet ack:</strong></p><br><ol><br><li><p>Look up the set of messages ids included in the packet by sequence number.</p></li><br><li><p>Remove those messages from the message send queue if they exist and decrease their ref count.</p></li><br><li><p>Update the last unacked message id by walking forward from the previous unacked message id in the send message sequence buffer until a valid message entry is found, or you reach the current send message id. Whichever comes first.</p></li><br></ol><br><p><strong>On message receive:</strong></p><br><ol><br><li><p>Check the receive message sequence buffer to see if a message exists for the current receive message id.</p></li><br><li><p>If the message exists, remove it from the receive message sequence buffer, increment the receive message id and return a pointer to the message.</p></li><br><li><p>Otherwise, no message is available to receive. Return <strong>NULL</strong>.</p></li><br></ol><br><p>In short, messages keep getting included in packets until a packet containing that message is acked. We use a data structure on the sender side to map packet sequence numbers to the set of message ids to ack. Messages are removed from the send queue when they are acked. On the receive side, messages arriving out of order are stored in a sequence buffer indexed by message id, which lets us receive them in the order they were sent.</p><br><h2 id="the-end-result">The End Result</h2><br><p>This provides the user with an interface that looks something like this on send:</p><br><pre>TestMessage  message = (TestMessage<em>) factory.Create( TEST_MESSAGE );<br>if ( message )<br>{<br>    message-&gt;a = 1;<br>    message-&gt;b = 2;<br>    message-&gt;c = 3;<br>    connection.SendMessage( message );<br>}</em></pre><br><p>And on the receive side:</p><br><pre>while ( true )<br>{<br>    Message  message = connection.ReceiveMessage();<br>    if ( !message )<br>        break;<br><br>    if ( message-&gt;GetType() == TEST_MESSAGE )<br>    {<br>        TestMessage <em> testMessage = (TestMessage</em>) message;<br>        // process test message<br>    }<br><br>    factory.Release( message );<br>}<br></pre><br><p>Which is flexible enough to implement whatever you like on top of it.</p>


<h1 id="è¯‘æ–‡">è¯‘æ–‡</h1>


<p><a href="http://gad.qq.com/program/translateview/7168700" target="_blank" rel="noopener">è¯‘æ–‡å‡ºå¤„</a></p>
<div class="WordSection1"><div><p class="MsoNormal" align="left" style="vertical-align: baseline; border: none; padding: 0cm;"><span style="font-family:å¾®è½¯é›…é»‘;font-size:medium;"><span style="color: rgb(34, 34, 34);">è¯‘è€…ï¼šç¿åƒ–éªï¼ˆ</span><span style="color: rgb(34, 34, 34);"><a href="http://gad.qq.com/user/index?id=304098" target="_blank" rel="noopener"><span><span>âˆˆæ˜Ÿé™…é•¿é€”â†</span></span></a></span><span style="color: rgb(34, 34, 34);">ï¼‰</span><span style="color: rgb(34, 34, 34);">  </span><span style="color: rgb(34, 34, 34);">å®¡æ ¡ï¼šä¾¯é¹ï¼ˆ</span><span style="color: rgb(34, 34, 34);"><a href="http://gad.qq.com/user/index?id=391222" target="_blank" rel="noopener"><span><span>å¶è½&amp;</span></span><span><span>æ— ç—•</span></span></a></span><span style="color: rgb(34, 34, 34);">ï¼‰</span><span style="color: rgb(34, 34, 34);"> </span></span> </p></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å—¨ï¼Œæˆ‘æ˜¯æ ¼ä¼¦è´¹å¾·å‹’ï¼Œæ¬¢è¿æ¥åˆ°</span><u><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#DD3333">åˆ›å»ºä¸€ä¸ªæ¸¸æˆç½‘ç»œåè®®</span></u><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ç¬¬äº”ç¯‡æ–‡ç« ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä»<span><a rel="noopener" href="http://gafferongames.com/building-a-game-network-protocol/sending-large-blocks-of-data/" target="_blank"><span style="color:#DD3333"><span>ä¸Šä¸€ç¯‡æ–‡ç« </span></span></a></span>åˆ°ç°åœ¨å·²ç»æœ‰å¾ˆé•¿ä¸€æ®µæ—¶é—´äº†ï¼Œä¸Šæ¬¡æˆ‘å·²ç»ç‡å…ˆè€Œä¸”å®ç°äº†ä½™ä¸‹çš„è¿™ä¸€ç³»åˆ—æ–‡ç« æ‰€éœ€çš„æºç å¹¶åˆ›å»ºäº†å¼€æºåº“<span><a rel="noopener" href="https://github.com/networkprotocol/libyojimbo" target="_blank"><span style="color:#DD3333">libyojimbo</span></a></span>ï¼Œæ˜¯æœ¬ç³»åˆ—æ–‡ç« æ‰€è¦æè¿°çš„ç½‘ç»œåè®®çš„ä¸€ä¸ªè´¨é‡æœ‰ä¿è¯çš„çš„å’Œç»è¿‡å•å…ƒæµ‹è¯•çš„ç‰ˆæœ¬ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å¦‚æœä½ æƒ³è¦æœ‰ä¸€ä¸ªå¼€æºåº“æ¥ä¸ºè‡ªå·±åœ¨<span>UDP</span>ä¹‹ä¸Šå®ç°å¯é æ¶ˆæ¯æˆ–æ˜¯ä¸ºäº†å…¶ä»–æ›´å¤šï¼Œçœ‹çœ‹<span><a rel="noopener" href="https://github.com/networkprotocol/libyojimbo" target="_blank"><span style="color:#DD3333">libyojimbo</span></a></span>ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åƒæˆ‘è¿™æ ·æ˜¯æƒ³ç†è§£å®ƒå…·ä½“æ˜¯æ€ä¹ˆå·¥ä½œçš„å¹¶ä¸”å¯èƒ½è‡ªå·±å»å®ç°å®ƒï¼Œé˜…è¯»ä¸‹å»ï¼Œå› ä¸ºæˆ‘ä»¬å°†è¦ä»å¤´åˆ°è„šåœ°å»å»ºç«‹ä¸€ä¸ªåœ¨<span>UDP</span>ä¹‹ä¸Šç”¨æ¥å‘é€å¯é æœ‰åºæ¶ˆæ¯çš„å®Œæ•´çš„ç³»ç»Ÿï¼</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="è¯´æ˜"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¯´æ˜</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å¾ˆå¤šäººä¹Ÿè®¸ä¼šè·Ÿä½ è¯´ï¼Œè¦åœ¨<span>UDP</span>ä¹‹ä¸Šå®ç°ä½ è‡ªå·±çš„å¯é æ¶ˆæ¯ç³»ç»Ÿæ˜¯æ„šè ¢çš„ã€‚ä¸ºä»€ä¹ˆè¦æ’°å†™ä½ ç‰¹æœ‰çš„ç®€åŒ–ç‰ˆæœ¬çš„<span>TCP</span>ï¼Ÿè¿™äº›äººæ·±ä¿¡ï¼Œä»»ä½•å¯é æ€§çš„å®ç°<i><u><span style="border:none windowtext 1.0pt;padding:0cm">ä¸å¯é¿å…åœ°</span></u></i><span> </span>æœ€ç»ˆä¼šæˆä¸ºä¸€ä¸ªï¼ˆç®€åŒ–çš„ï¼‰<span>TCP</span>çš„é‡å®ç°ã€‚ </span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½†ä¹Ÿæœ‰å¾ˆå¤šä¸åŒçš„æ–¹æ³•æ¥åœ¨<span>UDP</span>ä¹‹ä¸Šå®ç°å¯é æ¶ˆæ¯ï¼Œå„æœ‰ä¸åŒçš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚<span>TCP</span>çš„æ–¹æ³•å¹¶ä¸æ˜¯å”¯ä¸€çš„é€‰æ‹©ã€‚äº‹å®ä¸Šï¼Œæˆ‘æ‰€äº†è§£åˆ°çš„å¤§å¤šæ•°å¯é æœ‰åºä¿¡æ¯çš„é€‰æ‹©çš„åŸç†å’Œ<span>TCP</span>å¹¶ä¸ç›¸åŒã€‚æ‰€ä»¥è®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„ç›®æ ‡å‘æŒ¥åˆ›é€ åŠ›å¹¶å¼„æ‡‚æˆ‘ä»¬è¯¥å¦‚ä½•å……åˆ†åˆ©ç”¨æˆ‘ä»¬çš„ç°çŠ¶æ¥å®ç°ä¸€ä¸ªæ¯”<span>TCP</span><i><u><span style="border:none windowtext 1.0pt;padding:0cm">æ›´å¥½</span></u></i><span> </span>çš„å¯é æ€§ç³»ç»Ÿã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ç½‘ç»œåè®®åœ¨åŠ¨ä½œæ¸¸æˆç±»å‹ï¼ˆ<span>FPS</span>ï¼‰ä¸­çš„å…¸å‹ç‰¹å¾å°±æ˜¯ä¸€ä¸ª<u><span style="border:none windowtext 1.0pt;padding:0cm">æŒç»­å‘é€çš„æ•°æ®åŒ…ï¼Œ</span></u>åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šä»¥ç¨³å®šçš„é€Ÿåº¦å¦‚<span>20</span>æˆ–<span>30</span>åŒ…æ¯ç§’å‘é€ã€‚è¿™äº›æ•°æ®åŒ…éƒ½åŒ…å«æœ‰ä¸å¯é çš„æ— åºæ•°æ®ä¾‹å¦‚<span>t</span>æ—¶é—´å†…çš„ä¸–ç•ŒçŠ¶æ€ï¼›æ‰€ä»¥ï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼Œé‡æ–°å‘é€å®ƒå¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚å½“é‡æ–°å‘é€çš„æ•°æ®åŒ…åˆ°è¾¾æ—¶ï¼Œæ—¶é—´<span>t</span>å·²ç»è¿‡å»äº†ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ‰€ä»¥è¿™å°±æ˜¯æˆ‘ä»¬å°†è¦å®ç°å¯é æ€§çš„ç°çŠ¶ã€‚å¯¹äºæˆ‘ä»¬<span>90%</span>çš„æ•°æ®åŒ…ï¼Œä»…ä¸¢å¼ƒå¹¶ä¸å†é‡æ–°å‘é€å®ƒä¼šæ›´å¥½ã€‚å¯¹äº<span>10%</span>æˆ–æ›´å°‘ï¼ˆè¯¯å·®å…è®¸èŒƒå›´å†…ï¼‰çš„æƒ…å†µï¼Œæˆ‘ä»¬ç¡®å®éœ€è¦å¯é æ€§ï¼Œä½†è¿™æ ·çš„æ•°æ®æ˜¯éå¸¸ç½•è§çš„ï¼Œå¾ˆå°‘è¢«å‘é€è€Œä¸”æ¯”ä¸å¯é çš„æ•°æ®çš„å¹³å‡å¤§å°è¦å°å¾—å¤šã€‚è¿™ä¸ªä½¿ç”¨æ¡ˆä¾‹é€‚ç”¨äºæ‰€æœ‰è¿‡å»åäº”å¹´æ¥å‘å¸ƒçš„<span>AAA</span>çº§çš„<span>FPS</span>æ¸¸æˆã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="ä¸åŒçš„æ–¹æ³•"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä¸åŒçš„æ–¹æ³•</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å¯é æ€§çš„ä¸€ä¸ªå¸¸ç”¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸¤ç§åŒ…ç±»å‹ï¼šå¯é æœ‰åºçš„å’Œä¸å¯é çš„ã€‚ä½ åœ¨ä¼—å¤šç½‘ç»œåº“ä¸­éƒ½ä¼šçœ‹åˆ°è¿™ä¸ªæ–¹æ³•ã€‚å®ƒåŸºæœ¬çš„æƒ³æ³•æ˜¯ï¼Œè¿™ä¸ªåº“ä¸æ–­é‡æ–°å‘é€å¯é çš„æ•°æ®åŒ…ç›´åˆ°å®ƒçš„å¦ä¸€æ–¹æ¥æ”¶åˆ°ä¸ºæ­¢ã€‚è¿™æ˜¯ä¸€ä¸ªæœ€ç»ˆçœ‹èµ·æ¥ä¼šæœ‰ä¸€ç‚¹åƒ<span>TCP</span>æ–¹å¼ä¼ è¾“çš„å¯é åŒ…çš„é€‰æ‹©ã€‚è¿™å¹¶æ²¡æœ‰å¾ˆç³Ÿç³•ï¼Œä½†ä½ ä¹Ÿå¯ä»¥åšå¾—æ›´å¥½ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æˆ‘æ›´æ„¿æ„å»è€ƒè™‘çš„æ–¹æ³•å°±æ˜¯æ¶ˆæ¯å…¶å®æ˜¯æ›´å°çš„ä½åŒ…è£…å…ƒç´ ï¼Œå®ƒçŸ¥é“å¦‚ä½•ä½¿å®ƒä»¬è‡ªå·±åºåˆ—åŒ–ã€‚è¿™å°±æ˜¾å¾—éå¸¸æœ‰æ„ä¹‰äº†ï¼Œå› ä¸ºæŒ‰ä½æ‰“åŒ…çš„æ¶ˆæ¯ä¸­ï¼Œç”¨äºæè¿°ä¸‹ä¸ªå­—èŠ‚çš„å‰ç¼€æˆ–è€…åç¼€çš„å­—èŠ‚å¼€é”€åœ¨å¤§éƒ¨åˆ†çš„æƒ…å†µä¸‹æ˜¯ä¸å¿…éœ€çš„ï¼ˆä¾‹å¦‚æ¯ä¸ªåŒ…ä¸­åŒ…å«çš„è®¸å¤šå°çš„æ¶ˆæ¯ï¼‰ã€‚è¢«å‘é€çš„æ¶ˆæ¯ä¼šè¢«æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—å¹¶ä¸”æ¯æ¬¡ä¸€ä¸ªåŒ…è¢«å‘é€æ—¶ï¼Œå‘é€é˜Ÿåˆ—ä¸­çš„ä¸€äº›æ¶ˆæ¯å°±ä¼šè¢«åŒ…å«åœ¨å¤–å‘çš„åŒ…ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±æ²¡æœ‰å¯é çš„æ•°æ®åŒ…éœ€è¦è¢«é‡æ–°å‘é€äº†ã€‚å¯é æ¶ˆæ¯ä¹Ÿåªä¼šåŒ…å«åœ¨æ•°æ®åŒ…é‡Œç›´åˆ°å®ƒä»¬è¢«æ¥æ”¶ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¦åšåˆ°è¿™æ ·æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ï¼ŒæŠŠæ‰€æœ‰æœªåº”ç­”çš„æ¶ˆæ¯åŒ…å«åˆ°æ¯ä¸ªè¢«å‘é€çš„åŒ…ä¸­ã€‚å®ƒæ˜¯è¿™æ ·çš„ï¼šæ¯ä¸ªè¢«å‘é€çš„æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªéšæ¯å½“ä¸€ä¸ªæ¶ˆæ¯è¢«å‘é€æ—¶é€’å¢çš„<span>id</span>ã€‚æ¯ä¸ªè¾“å‡ºæ•°æ®åŒ…åŒ…å«èµ·å§‹<b><span style="border:none windowtext 1.0pt;padding:0cm">æ¶ˆæ¯<span>id</span></span></b><span> </span>ï¼Œç´§è·Ÿç€çš„æ˜¯<b><span style="border:none windowtext 1.0pt;padding:0cm">n</span></b><span> </span>ä¸ªæ¶ˆæ¯çš„æ•°æ®ã€‚æ¥æ”¶æ–¹ä¸æ–­å‘å›æœ€æ–°æ”¶åˆ°æ¶ˆæ¯çš„<span>id</span>ç»™å‘é€æ–¹ä½œä¸ºä¸€ä¸ªåº”ç­”ä¿¡å·ï¼Œå¹¶ä¸”æ¶ˆæ¯è¦å½“ä¸”ä»…å½“æ¯”æœ€æ–°çš„åº”ç­”æ¶ˆæ¯<span>id</span>è¦æ›´æ–°ï¼Œæ‰ä¼šè¢«åŒ…å«åœ¨æ•°æ®åŒ…ä¸­ã€‚ </span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™å¾ˆç®€å•ä¹Ÿæ˜“äºå®ç°ï¼Œä½†å½“ä½ æ­£åœ¨å‘é€æ¶ˆæ¯æ—¶å¦‚æœçªå‘ä¸€ä¸ªå¾ˆå¤§çš„åŒ…ä¸¢å¤±æƒ…å†µï¼Œä½ ä¼šé‡åˆ°ä¸€ä¸ªæ•°æ®åŒ…å¤§å°çš„å³°å€¼ï¼Œå› ä¸ºæœ‰å¾ˆå¤šæœªåº”ç­”çš„æ¶ˆæ¯ã€‚ã€‚æ­£å¦‚åœ¨<span><a rel="noopener" href="http://gafferongames.com/building-a-game-network-protocol/packet-fragmentation-and-reassembly/" target="_blank"><span style="color:#DD3333"><span>æ•°æ®åŒ…åˆ†å‰²</span></span><span style="color:#DD3333"><span>å’Œé‡ç»„</span></span></a></span>ä¸­è®¨è®ºçš„éœ€è¦æŒ‰ç…§<span>MTU</span>åˆ†å‰²åŒ…çš„æ–¹å¼æ¥å‘é€å¤§çš„æ•°æ®åŒ…ä¼šå¢åŠ ä¸¢åŒ…çš„æƒ…å†µã€‚åœ¨é«˜ä¸¢åŒ…ç‡ä¸‹ä½ æœ€ä¸æƒ³åšçš„å°±æ˜¯å¢å¤§åŒ…çš„è§„æ ¼å¹¶å¼•èµ·æ›´å¤šçš„åŒ…çš„ä¸¢å¤±ã€‚è¿™æ˜¯ä¸€ä¸ªæ½œåœ¨çš„æ— åº•æ´ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½ å¯ä»¥é€šè¿‡æ‰©å±•ç³»ç»Ÿæ¥ç»™æ¯ä¸ªåŒ…çš„æ¶ˆæ¯æ•°é‡<span>n</span>è®¾ç½®ä¸€ä¸ªä¸Šé™ï¼Œæ¥é¿å…è¿™ç§æƒ…å†µã€‚ä½†ç°åœ¨å¦‚æœä½ æœ‰ä¸€ä¸ªé«˜æ•°æ®åŒ…å‘é€ç‡ï¼ˆå¦‚æ¯ç§’<span>60</span>åŒ…ï¼‰ä½ å°±è¦å¤šæ¬¡å‘é€åŒæ ·çš„æ¶ˆæ¯ç›´åˆ°ä½ å¾—åˆ°è¯¥æ¶ˆæ¯çš„åº”ç­”ä¿¡å·ã€‚å¦‚æœçš„å¾€è¿”æ—¶é—´æ˜¯<span>100ms</span>ï¼Œæ¯æ¡æ¶ˆæ¯åœ¨è¢«åº”ç­”ä¹‹å‰å°†è¦å¹³å‡è¢«å¤šä½™å‘é€å…­æ¬¡ã€‚ä¹Ÿè®¸ä½ çœŸçš„éœ€è¦è¿™äº›å¤šä½™çš„å‘é€æ•°é‡å› ä¸ºä½ çš„æ¶ˆæ¯æ˜¯å¯¹æ—¶é—´æå…¶æ•æ„Ÿçš„ï¼Œä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥ç»™é˜Ÿåˆ—é‡Œçš„å…¶ä»–æ¶ˆæ¯åˆ†é…åˆç†çš„å¸¦å®½ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æˆ‘æ¯”è¾ƒå–œæ¬¢çš„æ–¹æ³•æ˜¯ç”¨ä¸€ä¸ªä¼˜å…ˆæ¬¡åºç³»ç»Ÿæ•´åˆæ¯åŒ…çš„åº”ç­”ä¿¡å·ï¼Œè¿™ä¸ªç³»ç»Ÿæ£€å‡º<span>n</span>æ¡æœ€é‡è¦çš„æ¶ˆæ¯å¹¶åŒ…å«åœ¨æ¯ä¸ªåŒ…ä¸­ã€‚åœ¨æ•£å¸ƒçš„æ¶ˆæ¯ç©¿è¿‡æ‰€æœ‰åœ¨å‘é€é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å‘é€æ—¶ï¼Œè¿™æ ·å°±æŠŠå¯¹æ—¶é—´æ•æ„Ÿçš„é€’é€ä¸æ¯åŒ…ä»…å‘é€<span>n</span>æ¡æ¶ˆæ¯çš„èƒ½åŠ›è”åˆèµ·æ¥äº†ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="æ•°æ®åŒ…å±‚çº§åº”ç­”"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ•°æ®åŒ…å±‚çº§åº”ç­”</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="line-height: 150%; font-size: 12pt; font-family: å¾®è½¯é›…é»‘, sans-serif; color: rgb(34, 34, 34);">è®©æˆ‘ä»¬è¡ŒåŠ¨èµ·æ¥å®ç°å®ƒã€‚</span> <span style="line-height: 150%; color: rgb(34, 34, 34); font-family: å¾®è½¯é›…é»‘, sans-serif; font-size: 12pt;">è¿™ç§å¯é æ€§ç³»ç»Ÿçš„åŸºç¡€æ˜¯æ¯ä¸ªåŒ…çš„åº”ç­”ã€‚</span></p><p class="MsoNormal" align="left" style="line-height: 150%; vertical-align: baseline;"><span style="font-size:12.0pt;line-height:150%;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½†ä¸ºä»€ä¹ˆåº”ç­”æ˜¯åœ¨æ•°æ®åŒ…å±‚çº§è€Œä¸æ˜¯åœ¨æ¶ˆæ¯å±‚çº§å‘¢ï¼Ÿç®€è¦æˆªè¯´åŸå› å°±æ˜¯åŒ…çš„æ•°é‡ä¼šè¿œè¿œå°‘äºæ¶ˆæ¯çš„æ•°é‡ã€‚å‡è®¾æ¯ä¸ªåŒ…ä¸­æœ‰<span>32</span>æˆ–<span>64</span>æ¡æ¶ˆæ¯ï¼Œæ˜¾ç„¶è®©ä¸€ä¸ªåŒ…å«<span>32</span>æˆ–<span>64</span>æ¡æ¶ˆæ¯çš„åŒ…æ¥åº”ç­”ä¼šæ¯”è®©æ¯ä¸ªæ¶ˆæ¯éƒ½åˆ†åˆ«åº”ç­”è¦é«˜æ•ˆå¾—å¤šã€‚</span> </p><p class="MsoNormal" align="left" style="line-height: 150%; vertical-align: baseline;"><span style="font-size:12.0pt;line-height:150%;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™æ ·åŒæ ·ä¹Ÿå¢åŠ äº†çµæ´»æ€§ï¼Œå› ä¸ºä½ å¯ä»¥åœ¨æ•°æ®åŒ…å±‚çº§åº”ç­”ä¸Šæ„å»ºå…¶ä»–å¯é æ€§ç³»ç»Ÿï¼Œä¸ä»…ä»…æ˜¯ä¸ºäº†å¯é æœ‰åºçš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨äº†æ•°æ®åŒ…å±‚çº§åº”ç­”ï¼Œä½ å°±çŸ¥é“å“ªä¸€ä¸ªæ—¶é—´å…ˆå†³çš„ä¸å¯é çŠ¶æ€æ›´æ–°å·²ç»“æŸï¼Œæ‰€ä»¥ä½ å¯ä»¥è½»æ˜“åœ°æ„å»ºä¸€ä¸ªç³»ç»Ÿï¼Œåœ¨ä¸€æ—¦ä¸€ä¸ªæ•°æ®åŒ…æ‰€åŒ…å«çš„æœ€åä¸€ä¸ªçŠ¶æ€æ›´æ–°å·²ç»åº”ç­”æ—¶ï¼Œåœæ­¢å‘é€ä¸å†æ”¹å˜çš„å¯¹è±¡çŠ¶æ€ã€‚</span> </p><p class="MsoNormal" align="left" style="line-height: 150%; vertical-align: baseline;"><span style="font-size:12.0pt;line-height:150%;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä¸ºå®ç°æ•°æ®åŒ…å±‚çº§çš„åº”ç­”ï¼Œåœ¨æ¯ä¸ªåŒ…çš„å‰é¢æ·»åŠ å¦‚ä¸‹çš„æŠ¥å¤´ï¼š</span></p><div><div id="highlighter_102525" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">struct</code> <code class="cpp plain">Header</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp plain">uint16_t sequence;</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp plain">uint16_t ack;</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp plain">uint32_t ack_bits;</code></div><div class="line number6 index5 alt1"><code class="cpp plain">};</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="line-height: 150%; vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™äº›æŠ¥å¤´å…ƒç´ ç»„åˆèµ·æ¥ä»¥åˆ›å»ºåº”ç­”ç³»ç»Ÿï¼š</span> </p><ul type="disc"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;     border:none windowtext 1.0pt;padding:0cm">sequence</span></b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;"> </span><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œéšæ¯ä¸ªæ•°æ®åŒ…å‘é€è€Œå¢é•¿ï¼ˆå¹¶ä¸”åœ¨è¾¾åˆ°<span>65535</span>åå›å¾€å¤ï¼‰ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;     border:none windowtext 1.0pt;padding:0cm">ack</span></b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;"> </span><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">æ˜¯ä»å¦ä¸€æ–¹æ¥æ”¶åˆ°çš„æœ€æ–°çš„æ•°æ®åŒ…åºåˆ—å·ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;     border:none windowtext 1.0pt;padding:0cm">ack_bits</span></b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;"> </span><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">æ˜¯ä¸€ä¸ªä½å­—æ®µï¼Œå®ƒç¼–ç ä¸<b><span style="border:none windowtext 1.0pt;padding:0cm">ack</span></b>ç›¸å…³çš„æ”¶åˆ°çš„æ•°æ®åŒ…ç»„åˆï¼šå¦‚æœä½<b><span style="border:none windowtext 1.0pt;padding:0cm">n</span></b>å·²ç»è®¾ç½®ï¼Œå³<span> <b><span style="border:none windowtext 1.0pt;padding:     0cm">ackâ€“</span></b> <b><span style="border:none windowtext 1.0pt;     padding:0cm">n</span></b> </span>æ•°æ®åŒ…è¢«æ¥æ”¶äº†ã€‚</span> </li></ul><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">ack_bits</span></b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"> </span><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä¸ä»…æ˜¯ä¸€ä¸ªèŠ‚çœå¸¦å®½çš„å·§å¦™çš„ç¼–ç ï¼Œå®ƒåŒæ ·ä¹Ÿå¢åŠ äº†<u><span style="border:none windowtext 1.0pt;padding:0cm">ä¿¡æ¯å†—ä½™</span></u>æ¥æŠµå¾¡åŒ…çš„ä¸¢å¤±ã€‚æ¯ä¸ªåº”ç­”ç è¦è¢«å‘é€<span>32</span>æ¬¡ã€‚å¦‚æœæœ‰ä¸€ä¸ªåŒ…ä¸¢å¤±äº†ï¼Œä»ç„¶æœ‰å…¶ä»–<span>31</span>ä¸ªåŒ…æœ‰ç€ç›¸åŒçš„åº”ç­”ç ã€‚ä»ç»Ÿè®¡ä¸Šæ¥è¯´ï¼Œåº”ç­”ç è¿˜æ˜¯éå¸¸æœ‰å¯èƒ½é€è¾¾çš„ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½†çªå‘çš„ä¼ é€æ•°æ®åŒ…çš„ä¸¢å¤±è¿˜æ˜¯æœ‰å¯èƒ½å‘ç”Ÿçš„ï¼Œæ‰€ä»¥é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼š</span> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¦‚æœä½ æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…<span>n</span>çš„åº”ç­”ç ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…<u><span style="border:none windowtext 1.0pt;     padding:0cm">è‚¯å®šå·²ç»æ”¶åˆ°</span></u>äº†ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¦‚æœä½ æ²¡æœ‰æ”¶åˆ°åº”ç­”ç ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…å°±<i><span style="border:none windowtext 1.0pt;padding:0cm">å¾ˆæœ‰å¯èƒ½</span></i><span> </span>æ²¡æœ‰è¢«æ”¶åˆ°ã€‚ä½†æ˜¯<span>â€¦</span>å®ƒä¹Ÿè®¸ä¼šæ˜¯ï¼Œä»…æ˜¯åº”ç­”ç æ²¡æœ‰é€è¾¾ã€‚<u><span style="border:none windowtext 1.0pt;padding:0cm">è¿™ç§æƒ…å†µæ˜¯æå…¶ç½•è§çš„ã€‚</span></u> </span> </li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä»¥æˆ‘çš„ç»éªŒï¼Œæ²¡æœ‰å¿…è¦è®¾è®¡å®Œå–„çš„åº”ç­”æœºåˆ¶ã€‚åœ¨ä¸€ä¸ªæå°‘ä¸¢åº”ç­”ç çš„ç³»ç»Ÿä¸Šæ„å»ºä¸€ä¸ªå¯é æ€§ç³»ç»Ÿå¹¶ä¸ä¼šå¢åŠ ä»€ä¹ˆå¤§é—®é¢˜ã€‚ä½†å¯¹äºåœ¨æ‰€æœ‰æƒ…å†µä¸‹æ¥æµ‹è¯•è¿™ä¸ªç³»ç»Ÿçš„å·¥ä½œå°†ä¼šæˆä¸ºå¾ˆå¤§çš„æŒ‘æˆ˜ï¼Œå› ä¸ºè¿˜è¦è€ƒè™‘åº”ç­”ç ä¸¢å¤±çš„è¾¹ç•Œæƒ…å†µã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ‰€ä»¥å¦‚æœä½ è‡ªå·±å®ç°è¿™ä¸ªç³»ç»Ÿçš„è¯ï¼Œè¯·è®¾ç½®ä¸€ä¸ªæµ¸æ³¡æµ‹è¯•æ¥è¦†ç›–ç³Ÿç³•çš„ç½‘ç»œæƒ…å†µï¼Œç”¨æ¥ç¡®ä¿ä½ çš„åº”ç­”ç³»ç»Ÿæ˜¯åœ¨æ­£ç¡®çš„å·¥ä½œï¼Œç›¸å…³åœ°ï¼Œä½ çš„æ¶ˆæ¯ç³»ç»Ÿçš„æ‰§è¡Œå®é™…ä¸Šæ˜¯åœ¨è¿™äº›ç½‘ç»œæƒ…å†µä¸‹<i><u>å¯é åœ°è€Œä¸”æœ‰åºçš„</u></i>äº¤ä»˜å¯é æœ‰åºæ¶ˆæ¯ã€‚ä»¥æˆ‘ä¹‹è§ï¼ˆå¹¶ä¸”æˆ‘å·²ç»å†™äº†è®¸å¤šè¿™æ ·çš„ç³»ç»Ÿçš„å˜å¼è‡³å°‘æœ‰åæ¬¡äº†ï¼‰ï¼Œè¿™æ˜¯ç¡®ä¿æ­£ç¡®è¡Œä¸ºçš„ä¸€ä¸ªå¿…è¦æ­¥éª¤ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½ åœ¨è¿™ç¯‡æ–‡ç« çš„ç¤ºä¾‹æºä»£ç ä¸­ä¼šæ‰¾åˆ°è¿™æ ·ä¸€ä¸ªæµ¸æ³¡æµ‹è¯•ï¼Œå®ƒå¯¹<span><a rel="noopener" href="https://www.patreon.com/gafferongames" target="_blank"><span style="color:#DD3333">patreon</span><span style="color:#DD3333"><span>æ”¯æŒ</span></span></a></span>æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”ä¹Ÿåœ¨å¼€æºç½‘ç»œåº“<span><a rel="noopener" href="http://www.libyojimbo.com/" target="_blank"><span style="color:#DD3333">libyojimbo</span></a></span>ä¸­ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="åºåˆ—ç¼“å†²åŒº"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">åºåˆ—ç¼“å†²åŒº</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä¸ºå®ç°è¿™ä¸ªåº”ç­”ç³»ç»Ÿï¼Œæˆ‘ä»¬åœ¨å‘é€æ–¹è¿˜éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥è¿½è¸ªä¸€ä¸ªæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«åº”ç­”ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¿½ç•¥å†—ä½™çš„åº”ç­”ï¼ˆæ¯ä¸ªåŒ…ä¼šé€šè¿‡<span> <b><span style="border:none windowtext 1.0pt;padding:0cm">ack_bits</span></b></span>å¤šæ¬¡åº”ç­”ï¼‰ã€‚æˆ‘ä»¬åŒæ ·åœ¨æ¥æ”¶æ–¹ä¹Ÿè¿˜éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥è¿½è¸ªé‚£äº›å·²ç»æ”¶åˆ°çš„åŒ…ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨æ•°æ®åŒ…çš„æŠ¥å¤´å¡«å†™<b><span style="border:none windowtext 1.0pt;padding:0cm">ack_bits</span></b>çš„å€¼ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™ä¸ªæ•°æ®ç»“æ„åº”è¯¥å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š</span> </p><ul type="disc"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¸¸é‡æ—¶é—´å†…æ’å…¥ï¼ˆæ’å…¥å¯èƒ½ä¼šæ˜¯<i><u><span style="border:none windowtext 1.0pt;padding:0cm">éšæœº</span></u></i>çš„ï¼Œä¾‹å¦‚ä¹±åºæ•°æ®åŒ…<span>â€¦</span>ï¼‰</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ç»™å®šçš„æ•°æ®åŒ…çš„åºåˆ—å·åœ¨å¸¸é‡æ—¶é—´å†…æŸ¥è¯¢ä¸€ä¸ªæ¡ç›®æ˜¯å¦å­˜åœ¨</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¯¹ç»™å®šçš„æ•°æ®åŒ…åºåˆ—å·ï¼Œåœ¨å¸¸é‡æ—¶é—´å†…è®¿é—®æ•°æ®å­˜å‚¨</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¸¸é‡æ—¶é—´å†…åˆ é™¤æ¡ç›®</span> </li></ul><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½ å¯èƒ½ä¼šæƒ³ã€‚å“¦ï¼Œå½“ç„¶ï¼Œ<i><u><span style="border:none windowtext 1.0pt;padding:0cm">å“ˆå¸Œè¡¨</span></u></i>ã€‚ä½†è¿˜æœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•ï¼š</span></p><div><div id="highlighter_389542" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">BufferSize = 1024;</code></div><div class="line number2 index1 alt1"> </div><div class="line number3 index2 alt2"><code class="cpp plain">uint32_t sequence_buffer[BufferSize];</code></div><div class="line number4 index3 alt1"> </div><div class="line number5 index4 alt2"><code class="cpp keyword bold">struct</code> <code class="cpp plain">PacketData</code></div><div class="line number6 index5 alt1"><code class="cpp plain">{</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">acked;</code></div><div class="line number8 index7 alt1"><code class="cpp plain">};</code></div><div class="line number9 index8 alt2"> </div><div class="line number10 index9 alt1"><code class="cpp plain">PacketData packet_data[BufferSize];</code></div><div class="line number11 index10 alt2"> </div><div class="line number12 index11 alt1"><code class="cpp plain"><code>PacketData * GetPacketData( uint16_t sequence )</code></code></div><div class="line number13 index12 alt2"><code class="cpp plain">{</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">    </code><code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">index = sequence % BufferSize;</code></div><div class="line number15 index14 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">if</code> <code class="cpp plain">( sequence_buffer[index] == sequence )</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp plain">&amp;packet_data[index];</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">else</code></div><div class="line number18 index17 alt1"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp plain">NULL;</code></div><div class="line number19 index18 alt2"><code class="cpp plain">}</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½ åœ¨è¿™å¯ä»¥çœ‹åˆ°çš„çªé—¨æ˜¯è¿™ä¸ªæ»šåŠ¨çš„ç¼“å†²åŒºæ˜¯ä»¥åºåˆ—å·æ¥ä½œä¸ºç´¢å¼•çš„ï¼š</span> </p><div style="border:solid #F0F0F0 1.0pt;border-left:solid #E0E0E0 2.25pt;padding:0cm 0cm 0cm 0cm;background:whitesmoke"><p class="MsoNormal" align="left" style="line-height: 16.8pt; vertical-align: baseline; border: none; padding: 0cm; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"><span style="font-family:&quot;Courier New&quot;;color:#222222">const int index =sequence % BufferSize;</span> </p></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™æ˜¯å¯è¡Œçš„ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸åœ¨æ„æ—§æ¡ç›®ç ´åã€‚éšç€åºåˆ—å·çš„é€’å¢ï¼Œæ—§çš„æ¡ç›®ä¹Ÿè‡ªç„¶è€Œç„¶åœ°éšç€æˆ‘ä»¬æ’å…¥äº†æ–°æ¡ç›®è€Œè¢«é‡å†™ã€‚<span>sequence_buffer[index]</span>çš„å€¼æ˜¯ç”¨æ¥æµ‹è¯•è¯¥ç´¢å¼•çš„æ¡ç›®æ˜¯å¦å®é™…ä¸Šä¸ä½ æ‰€æœå¯»çš„åºåˆ—å·ç›¸ç¬¦ã€‚ä¸€ä¸ªç¼“å†²åºåˆ—çš„å€¼æ˜¯<span>0xFFFFFFFF </span>å°±è¡¨ç¤ºä¸€ä¸ªç©ºçš„æ¡ç›®å¹¶è‡ªç„¶åœ°å¯¹ä»»ä½•åºåˆ—å·æŸ¥è¯¢è¿”å›<span>NULL</span>ï¼Œæ²¡æœ‰ä»»ä½•å…¶ä»–ï¼ˆä»£ç ï¼‰åˆ†æ”¯ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å½“æ¡ç›®è¢«é¡ºåºæ·»åŠ ï¼Œå°±åƒä¸€ä¸ªè¢«å‘é€çš„é˜Ÿåˆ—ï¼Œå¯¹æ’å…¥æ‰€éœ€è¦åšçš„å°±æ˜¯æŠŠè¿™ä¸ªåºåˆ—ç¼“å†²åŒºçš„å€¼æ›´æ–°ä¸ºæ–°çš„åºåˆ—å·å¹¶ä¸”åœ¨è¯¥ç´¢å¼•å¤„é‡å†™è¿™ä¸ªæ•°æ®ï¼š</span></p><div><div id="highlighter_839387" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">PacketData &amp; InsertPacketData( uint16_t sequence )</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">const</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">index = sequence % BufferSize;</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp plain">sequence_buffer[index] = sequence;</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">return</code> <code class="cpp plain">packet_data[index];</code></div><div class="line number6 index5 alt1"><code class="cpp plain">}</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ä½†åœ¨æ¥æ”¶ç«¯æ•°æ®åŒ…ä»¥ä¹±åºåˆ°è¾¾å¹¶ä¸”æœ‰ä¸€éƒ¨åˆ†ä¸¢å¤±ã€‚åœ¨é«˜å¾—ç¦»è°±çš„ä¸¢åŒ…ç‡ä¸‹ï¼ˆ<span>99%</span>ï¼‰ï¼Œæˆ‘å°±ä¼šçœ‹åˆ°æ—§çš„åºåˆ—ç¼“å†²åŒºæ¡ç›®è¿˜å­˜åœ¨ï¼Œä½†æ˜¯æ–°æ¡ç›®çš„åºåˆ—å·å·²ç»è¶…è¿‡äº†<span>65535</span>å¹¶ä¸”å¾ªç¯åˆ°è¾¾äº†æ—§æ¡ç›®ä¹‹å‰ï¼Œå¹¶ä¸”æ‰“ç ´äº†æˆ‘çš„åº”ç­”é€»è¾‘ï¼ˆå¯¼è‡´é”™è¯¯åº”ç­”å¹¶æ‰“ç ´äº†å¯é æ€§ï¼Œè¿™æ—¶å‘é€æ–¹ä¼šçœŸçš„è®¤ä¸ºå¯¹æ–¹å·²ç»æ¥æ”¶åˆ°äº†ä¸€äº›ä¸œè¥¿ä½†å…¶å®å¹¶ä¸æ˜¯<span>â€¦</span>ï¼‰</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•æ˜¯éå†ä¸Šä¸€ä¸ªæœ€é«˜çš„æ’å…¥åºåˆ—ä¸æœ€æ–°æ”¶åˆ°çš„æ’å…¥åºåˆ—ä¹‹é—´çš„æ¡ç›®ï¼ˆå¦‚æœå®ƒæ˜¯æ›´åŠ æ–°çš„è¯ï¼‰å¹¶åœ¨ç¼“å†²åŒºæ¸…é™¤è¿™äº›æ¡ç›®å³éƒ½ç½®ä¸º<span>0xFFFFFFFF</span>ã€‚ç°åœ¨ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ’å…¥æ“ä½œæ˜¯<i><u><span style="border:none windowtext 1.0pt;padding:0cm">éå¸¸æ¥è¿‘</span></u></i><span> </span>æ—¶é—´å¸¸é‡çš„ï¼Œä½†æœ€ç³Ÿçš„æƒ…å†µæ˜¯ï¼Œåœ¨å…ˆå‰æœ€é«˜çš„åºåˆ—å·å’Œå½“å‰æ’å…¥çš„åºåˆ—å·ä¹‹é—´çº¿æ€§éå†çš„æ¬¡æ•°<span>n</span>ç­‰äºç¼“å†²åŒºçš„é•¿åº¦ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰ï¼Œæˆ‘æƒ³æŒ‡å‡ºï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ªæ•°æ®ç»“æ„åšæ›´å¤šäº‹æƒ…è€Œä¸ä»…æ˜¯å¯¹äºåº”ç­”ç ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åŠ å…¥å‘é€æ—¶é—´ï¼Œæ¥æ‰©å±•æ¯ä¸ªåŒ…çš„æ•°æ®ï¼š</span></p><div><div id="highlighter_615471" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">struct</code> <code class="cpp plain">PacketData</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">acked;</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp color1 bold">double</code> <code class="cpp plain">send_time;</code></div><div class="line number5 index4 alt2"><code class="cpp plain">};</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æœ‰äº†è¿™äº›ä¿¡æ¯ä½ å¯ä»¥å¯¹å¾€è¿”æ—¶é—´é€šè¿‡åšæŒ‡æ•°çº§çš„å¹³æ»‘å–å¹³å‡æ•°åšä¿®æ­£ï¼Œæœ€ç»ˆå¾—åˆ°åˆç†çš„é¢„æœŸå¾€è¿”æ—¶é—´ã€‚ä½ ç”šè‡³å¯ä»¥çœ‹åˆ°åœ¨å‘é€æ•°æ®åŒ…çš„åºåˆ—ç¼“å­˜åŒºçš„æ•°æ®åŒ…ä¼šæ¯”ä½ <span>RTT</span>é¢„è®¡çš„ï¼ˆä½ ç°åœ¨åº”è¯¥å·²ç»æ”¶åˆ°äº†å®ƒä»¬çš„åº”ç­”ç <span>â€¦</span>ï¼‰è¦æ—§ï¼Œé€šè¿‡è¿™ä¸ªå¾€è¿”æ—¶é—´å¯¹è¿˜æ²¡æœ‰åº”ç­”çš„åŒ…åšåˆ¤æ–­ï¼Œæ¥å†³å®šåˆ›å»ºä½ çš„æ•°æ®åŒ…ä¸¢å¤±é¢„è®¡ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="åº”ç­”ç®—æ³•"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">åº”ç­”ç®—æ³•</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ç°åœ¨æˆ‘ä»¬æ¥æŠŠæ³¨æ„åŠ›é›†ä¸­åœ¨æ•°æ®åŒ…å±‚çº§åº”ç­”çš„å®é™…ç®—æ³•ä¸Šã€‚</span><span style="color: rgb(34, 34, 34); font-family: å¾®è½¯é›…é»‘, sans-serif; font-size: 12pt;">è¯¥ç®—æ³•å¦‚ä¸‹ï¼š</span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">åœ¨æ•°æ®åŒ…å‘é€ç«¯ï¼š</span></b> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">åœ¨æ•°æ®åŒ…å‘é€ç¼“å†²åŒºæ’å…¥ä¸€ä¸ªä¸ºå½“å‰å‘é€çš„æ•°æ®åŒ…åºåˆ—å·çš„æ¡ç›®ï¼Œå¹¶ä¸”å¸¦ç€è¡¨ç¤ºå®ƒè¿˜æ²¡æœ‰è¢«åº”ç­”çš„å­—æ®µ</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ä»æœ¬åœ°æ¥æ”¶åˆ°çš„æ•°æ®åŒ…åºåˆ—ç¼“å­˜å’Œæœ€æ–°æ¥æ”¶åˆ°çš„æ•°æ®åŒ…åºåˆ—å·ä¸­ç”Ÿæˆ<span> <b><span style="border:none windowtext 1.0pt;padding:     0cm">ack</span></b> </span>å’Œ<b><span style="border:none windowtext 1.0pt;     padding:0cm">ack_bits</span></b><span> </span></span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¡«å†™æ•°æ®åŒ…æŠ¥å¤´çš„<b><span style="border:none windowtext 1.0pt;padding:0cm">sequence, ack</span></b><span> </span>å’Œ<span> <b><span style="border:     none windowtext 1.0pt;padding:0cm">ack_bits</span></b> </span>å€¼</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å‘é€æ•°æ®åŒ…å¹¶é€’å¢å‘é€æ•°æ®åŒ…çš„åºåˆ—å·</span> </li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">åœ¨æ•°æ®åŒ…æ¥æ”¶ç«¯ï¼š</span></b> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ä»æ•°æ®åŒ…æŠ¥å¤´è¯»å–<span> <b><span style="border:none windowtext 1.0pt;padding:     0cm">sequence</span></b> </span></span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¦‚æœ<span> <b><span style="border:none windowtext 1.0pt;padding:     0cm">sequence</span></b> </span>æ¯”ä¹‹å‰çš„æœ€æ–°æ”¶åˆ°çš„æ•°æ®åŒ…åºåˆ—å·è¦æ–°ï¼Œå°±æ›´æ–°æœ€æ–°çš„æ¥æ”¶åˆ°çš„æ•°æ®åŒ…åºåˆ—å·</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">åœ¨æ¥æ”¶æ•°æ®åŒ…åºåˆ—ç¼“å†²åŒºä¸­ä¸ºè¿™ä¸ªæ•°æ®åŒ…æ’å…¥ä¸€ä¸ªæ¡ç›®</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ä»æ•°æ®åŒ…æŠ¥å¤´ä¸­çš„<b><span style="border:none windowtext 1.0pt;padding:0cm">ack</span></b>å’Œ<b><span style="border:none windowtext 1.0pt;padding:0cm">ack_bits</span></b>è§£ç åº”ç­”çš„æ•°æ®åŒ…åºåˆ—å·ç»„åˆ</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">è¿­ä»£åº”ç­”çš„æ•°æ®åŒ…åºåˆ—å·ä»¥åŠä»»ä½•è¿˜æ²¡æœ‰è¢«åº”ç­”çš„æ•°æ®åŒ…è°ƒç”¨<span> <b><span style="border:none windowtext 1.0pt;padding:     0cm">OnPacketAcked</span></b>( uint16_t sequence ) </span>åœ¨æ•°æ®åŒ…å‘é€ç¼“å†²åŒºæŠŠè¿™ä¸ªæ•°æ®åŒ…è®¾ç½®ä¸º<span>â€˜</span>å·²åº”ç­”çš„<span>â€™</span>ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;"><br></span></li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">é‡è¦çš„ä¸€ç‚¹æ˜¯è¿™ä¸ªç®—æ³•æ˜¯åœ¨ä¸¤ç«¯éƒ½å¯ä»¥æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å¦‚æœä½ æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å’Œä¸€ä¸ªæœåŠ¡ç«¯ï¼Œç„¶åæ¯ä¸€æ–¹çš„è¿æ¥è¿è¡Œç€åŒæ ·çš„é€»è¾‘ï¼Œç»´æŠ¤è‡ªå·±çš„åºåˆ—å·å‘é€çš„æ•°æ®åŒ…ï¼Œè·Ÿè¸ªæœ€æ–°ä»å¦ä¸€æ–¹æ”¶åˆ°çš„æ•°æ®åŒ…åºåˆ—<span>#</span>è¿˜æœ‰ä»ä¸€ä¸ªåºåˆ—ç¼“å†²åŒºé‡Œæ¥æ”¶åˆ°çš„æ•°æ®åŒ…ä¸­ç”Ÿæˆ<b><span style="border:none windowtext 1.0pt;padding:0cm">sequence, ack</span></b><span> </span>å’Œ<b><span style="border:none windowtext 1.0pt;padding:0cm">ack_bits</span></b><span> </span>æ¥å‘é€åˆ°å¦ä¸€æ–¹ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å¹¶ä¸”è¿™çœŸçš„å°±æ˜¯å’Œå®ƒæœ‰å…³çš„å…¨éƒ¨äº†ã€‚ç°åœ¨å½“ä¸€ä¸ªæ•°æ®åŒ…è¢«å¦ä¸€æ–¹æ¥æ”¶åˆ°æ—¶ï¼Œä½ æœ‰ä¸€ä¸ªå›è°ƒï¼š<b><span style="border:none windowtext 1.0pt;padding:0cm">OnPacketAcked</span></b><span> </span>ã€‚è¿™ä¸ªå¯é æ€§ç³»ç»Ÿçš„å…³é”®å°±åœ¨äºä½ å¾—çŸ¥é“å“ªä¸ªæ•°æ®åŒ…è¢«æ¥æ”¶ï¼Œä½ å¯ä»¥åœ¨ä½ æƒ³çš„åª’ä»‹ä¹‹ä¸Šåˆ›å»º<i><u><span style="border:none windowtext 1.0pt;padding:0cm">ä»»ä½•</span></u></i><span> </span>å¯é æ€§ç³»ç»Ÿã€‚å®ƒä¸ä»…é™äºå¯é æœ‰åºçš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ç”¨å®ƒç¡®è®¤å“ªä¸ªä¸å¯é çš„çŠ¶æ€æ›´æ–°å·²ç»å®Œæˆäº†ï¼Œç”¨ä»¥å®ç°åŸºäºæ¯ä¸ªç‰©ä½“çš„å¢é‡ç¼–ç ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="æ¶ˆæ¯å¯¹è±¡"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ¶ˆæ¯å¯¹è±¡</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ¶ˆæ¯æ˜¯å°å‹çš„å¯¹è±¡ï¼ˆæ¯”æ•°æ®åŒ…å¤§å°è¦å°ï¼Œæ‰€ä»¥å¾ˆå¤šæ¶ˆæ¯è£…é…åœ¨ä¸€ä¸ªå…¸å‹çš„æ•°æ®åŒ…ä¸­ï¼‰å¹¶ä¸”çŸ¥é“å¦‚ä½•å°†å®ƒä»¬è‡ªå·±åºåˆ—åŒ–ã€‚åœ¨æˆ‘çš„ç³»ç»Ÿé‡Œï¼Œå®ƒä»¬ä½¿ç”¨ä¸€ä¸ª</span><u><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#DD3333">ç»Ÿä¸€çš„åºåˆ—åŒ–å‡½æ•°</span></u><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ¥æ‰§è¡Œåºåˆ—åŒ–ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™ä¸ªåºåˆ—åŒ–çš„å‡½æ•°æ˜¯æ¨¡æ¿åŒ–çš„ï¼Œæ‰€ä»¥ä½ åªè¦å†™å®ƒä¸€æ¬¡å®ƒå°±ä¼šå¤„ç†è¯»ã€å†™ä»¥åŠ<i><u><span style="border:none windowtext 1.0pt;padding:0cm">æµ‹é‡</span></u></i> ã€‚<i><span style="border:none windowtext 1.0pt;padding:0cm"> </span></i></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ˜¯çš„ã€‚æµ‹é‡ã€‚æˆ‘å–œæ¬¢çš„ä¸€ä¸ªæŠ€å·§å°±æ˜¯æœ‰ä¸€ä¸ªè™šæ‹Ÿæµç±»å«åš<b><span style="border:none windowtext 1.0pt;padding:0cm">MeasureStream</span></b>ï¼Œå¦‚æœä½ è°ƒç”¨äº†åºåˆ—åŒ–å‡½æ•°ï¼Œå®ƒä¸å‚ä¸ä»»ä½•çš„åºåˆ—åŒ–ï¼Œè€Œåªæ˜¯æµ‹é‡<i><u><span style="border:none windowtext 1.0pt;padding:0cm">å¯èƒ½</span></u></i>è¢«å†™å…¥çš„æ¯”ç‰¹æ•°ã€‚è¿™å¯¹äºè§£å†³å“ªä¸ªæ¶ˆæ¯è¦è£…è½½åˆ°ä½ çš„æ•°æ®åŒ…é‡Œï¼Œç‰¹åˆ«æ˜¯å½“æ¶ˆæ¯å¯ä»¥æœ‰ä»»æ„å¤æ‚çš„åºåˆ—åŒ–å‡½æ•°çš„æƒ…å†µæ—¶æ˜¯ç‰¹åˆ«æœ‰ç”¨çš„ã€‚</span></p><div><div id="highlighter_699334" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">struct</code> <code class="cpp plain">TestMessage : </code><code class="cpp keyword bold">public</code> <code class="cpp plain">Message</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp plain">uint32_t a,b,c;</code></div><div class="line number4 index3 alt1"> </div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp plain">TestMessage()</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">        </code><code class="cpp plain">a = 0;</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">        </code><code class="cpp plain">b = 0;</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">        </code><code class="cpp plain">c = 0;</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number11 index10 alt2"> </div><div class="line number12 index11 alt1"><code class="cpp spaces">    </code><code class="cpp keyword bold">template</code> <code class="cpp plain">&lt;</code><code class="cpp keyword bold">typename</code> <code class="cpp plain">stream</code><code class="cpp string"></code><code class="cpp plain">&gt; </code><code class="cpp color1 bold">bool</code> <code class="cpp plain">Serialize( Stream &amp; stream )</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">    </code><code class="cpp plain">{ </code></div><div class="line number14 index13 alt1"><code class="cpp spaces">        </code><code class="cpp plain">serialize_bits( stream, a, 32 );</code></div><div class="line number15 index14 alt2"><code class="cpp spaces">        </code><code class="cpp plain">serialize_bits( stream, b, 32 );</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">        </code><code class="cpp plain">serialize_bits( stream, c, 32 );</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp keyword bold">true</code><code class="cpp plain">;</code></div><div class="line number18 index17 alt1"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number19 index18 alt2"> </div><div class="line number20 index19 alt1"><code class="cpp spaces">    </code><code class="cpp keyword bold">virtual</code> <code class="cpp plain">SerializeInternal( WriteStream &amp; stream )</code></div><div class="line number21 index20 alt2"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number22 index21 alt1"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp plain">Serialize( stream );</code></div><div class="line number23 index22 alt2"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number24 index23 alt1"> </div><div class="line number25 index24 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">virtual</code> <code class="cpp plain">SerializeInternal( ReadStream &amp; stream )</code></div><div class="line number26 index25 alt1"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number27 index26 alt2"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp plain">Serialize( stream );</code></div><div class="line number28 index27 alt1"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number29 index28 alt2"> </div><div class="line number30 index29 alt1"><code class="cpp spaces">    </code><code class="cpp keyword bold">virtual</code> <code class="cpp plain">SerializeInternal( MeasureStream &amp; stream )</code></div><div class="line number31 index30 alt2"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number32 index31 alt1"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp plain">Serialize( stream );        </code></div><div class="line number33 index32 alt2"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number34 index33 alt1"><code class="cpp plain">};</code><code class="cpp keyword bold"></code><code class="cpp plain"></code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™é‡Œçš„æŠ€å·§æ˜¯æ¡¥æ¥ç»Ÿä¸€æ¨¡æ¿çš„åºåˆ—åŒ–å‡½æ•°ï¼ˆæ‰€ä»¥ä½ åªéœ€è¦å†™ä¸€æ¬¡ï¼‰ä¸è™šæ‹Ÿåºåˆ—åŒ–æ–¹æ³•ï¼Œè¿™é€šè¿‡ä»è™šå‡½æ•°æ¯ä¸ªæµç±»å‹ä¸­è°ƒå…¥å®ƒã€‚æˆ‘é€šå¸¸ç”¨ä¸€ä¸ªå®æ¥æ‰“åŒ…è¿™ä¸ªå¼•ç”¨ï¼Œä½†å®ƒåœ¨ä¸Šæ–‡çš„ä»£ç ä¸­è¿™ä¸ªå®å·²ç»è¢«å±•å¼€ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°å‘ç”Ÿäº†ä»€ä¹ˆã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ç°åœ¨ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªåŸºäºæ¶ˆæ¯çš„æŒ‡é’ˆå¯ä»¥è®©ä½ åšåˆ°è¿™æ ·å¹¶ä¸”å®ƒåªæ˜¯é€šè¿‡é‡è½½æ¥å·¥ä½œï¼š</span></p><div><div id="highlighter_300994" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">Message <em> message = CreateSomeMessage();</em></code></div><div class="line number2 index1 alt1"><code class="cpp plain">message-&gt;SerializeInternal( stream );</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å¦å¤–ä¸€ä¸ªå°±æ˜¯å¦‚æœä½ åœ¨ç¼–è¯‘æ—¶é—´çŸ¥é“äº†æ¶ˆæ¯çš„å®Œæ•´ç»„åˆï¼Œå°±å¯ä»¥ä¸ºæ¯ä¸ªç±»å‹åœ¨è¢«è°ƒå…¥åºåˆ—åŒ–å‡½æ•°ä¹‹å‰å®ç°ä¸€ä¸ªå…³äºæ¶ˆæ¯ç±»å‹è½¬æ¢ä¸ºç¡®åˆ‡æ¶ˆæ¯ç±»å‹çš„å¤§çš„<span>switch</span>è¯­å¥ã€‚æˆ‘åœ¨è¿‡å»å·²ç»åœ¨æ§åˆ¶å°å¹³å°å®ç°çš„è¿™ä¸ªæ¶ˆæ¯ç³»ç»Ÿè¿™ä¹ˆåšäº†ï¼ˆå¦‚<span>PS3 SPUs</span>ï¼‰ï¼Œä½†å¯¹äºç°åœ¨ï¼ˆ<span>2016</span>ï¼‰çš„åº”ç”¨ç¨‹åºï¼Œè™šå‡½æ•°çš„æ€»å¼€é”€æ˜¯å¿½ç•¥ä¸è®¡çš„ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ¶ˆæ¯ä»ä¸€ä¸ªåŸºç±»æ´¾ç”Ÿï¼Œè¿™ä¸ªåŸºç±»æä¾›ä¸€ä¸ªé€šç”¨çš„æ¥å£ä¾‹å¦‚åºåˆ—åŒ–ã€æ¶ˆæ¯çš„æŸ¥è¯¢ç±»å‹è¿˜æœ‰å¼•ç”¨è®¡æ•°ã€‚å¼•ç”¨è®¡æ•°æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºæ¶ˆæ¯æ˜¯é€šè¿‡æŒ‡é’ˆä¼ é€’çš„å¹¶ä¸”åœ¨åº”ç­”ä¹‹å‰ä¸åªæ˜¯å­˜å‚¨åœ¨æ¶ˆæ¯å‘é€é˜Ÿåˆ—ï¼Œè€Œä¸”ä¹Ÿå­˜å‚¨åœ¨å¤–å‘çš„æ•°æ®åŒ…ä¸­ï¼ŒåŒ…æœ¬èº«æ˜¯<span>C++</span>ç»“æ„ä½“ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿™æ˜¯ä¸€ä¸ªç­–ç•¥ï¼Œå°±æ˜¯é¿å…é€šè¿‡æŒ‡é’ˆä¼ é€’æ¶ˆæ¯å’Œæ•°æ®åŒ…æ¥å¤åˆ¶æ•°æ®ã€‚åˆ«çš„ä¸€äº›åœºæ™¯ï¼ˆç†æƒ³çš„æƒ…å†µæ˜¯åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼‰å®ƒä»¬é‡Œé¢çš„æ•°æ®åŒ…å’Œæ¶ˆæ¯ä¼šåºåˆ—åŒ–åˆ°ä¸€ä¸ªç¼“å†²åŒºã€‚æœ€ç»ˆï¼Œå½“ä¸å†æœ‰å¯¹å­˜åœ¨æ¶ˆæ¯å‘é€é˜Ÿåˆ—çš„æ¶ˆæ¯çš„å¼•ç”¨æ—¶ï¼ˆæ¶ˆæ¯å·²ç»è¢«åº”ç­”ï¼‰å¹¶ä¸”æ²¡æœ‰æ•°æ®åŒ…åŒ…å«ä¿ç•™åœ¨æ•°æ®åŒ…å‘é€é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯å³æ˜¯è¢«é”€æ¯çš„ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ç§æ–¹å¼æ¥åˆ›å»ºæ¶ˆæ¯ã€‚æˆ‘ç”¨ä¸€ä¸ªæ¶ˆæ¯çš„å·¥å‚ç±»æ¥åšè¿™ä»¶äº‹æƒ…ï¼Œå®ƒæœ‰ä¸€ä¸ªè¢«å¤å†™çš„è™šå‡½æ•°æ¥æ ¹æ®ç±»å‹åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯ã€‚å¦‚æœè¿™ä¸ªæ•°æ®åŒ…å·¥å‚è¿˜çŸ¥é“æ¶ˆæ¯ç±»å‹çš„æ€»æ•°é‡å°±å¥½äº†ï¼Œé‚£æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ç½‘ç»œä¸Šåºåˆ—åŒ–ä¸€ä¸ªæ¶ˆæ¯ç±»å‹ï¼Œå› ä¸ºæœ‰ä¸¥æ ¼çš„ç•Œé™å’Œåœ¨æœ‰æ•ˆèŒƒå›´ä¹‹å¤–çš„æ¶ˆæ¯ç±»å‹å€¼çš„åŒ…çš„æ¶æ„ä¸¢å¼ƒï¼š</span></p><div><div id="highlighter_935705" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">enum</code> <code class="cpp plain">TestMessageTypes</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp plain">TEST_MESSAGE_A,</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp plain">TEST_MESSAGE_B,</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp plain">TEST_MESSAGE_C,</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">    </code><code class="cpp plain">TEST_MESSAGE_NUM_TYPES</code></div><div class="line number7 index6 alt2"><code class="cpp plain">};</code></div><div class="line number8 index7 alt1"> </div><div class="line number9 index8 alt2"><code class="cpp comments">// message definitions omitted</code></div><div class="line number10 index9 alt1"> </div><div class="line number11 index10 alt2"><code class="cpp keyword bold">class</code> <code class="cpp plain">TestMessageFactory : </code><code class="cpp keyword bold">public</code> <code class="cpp plain">MessageFactory</code></div><div class="line number12 index11 alt1"><code class="cpp plain">{ </code></div><div class="line number13 index12 alt2"><code class="cpp keyword bold">public</code><code class="cpp plain">:</code></div><div class="line number14 index13 alt1"> </div><div class="line number15 index14 alt2"><code class="cpp spaces">    </code><code class="cpp plain">Message  Create( </code><code class="cpp color1 bold">int</code> <code class="cpp plain">type )</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">        </code><code class="cpp keyword bold">switch</code> <code class="cpp plain">( type )</code></div><div class="line number18 index17 alt1"><code class="cpp spaces">        </code><code class="cpp plain">{</code></div><div class="line number19 index18 alt2"><code class="cpp spaces">            </code><code class="cpp keyword bold">case</code> <code class="cpp plain">TEST_MESSAGE_A: </code><code class="cpp keyword bold">return</code> <code class="cpp keyword bold">new</code> <code class="cpp plain">TestMessageA();</code></div><div class="line number20 index19 alt1"><code class="cpp spaces">            </code><code class="cpp keyword bold">case</code> <code class="cpp plain">TEST_MESSAGE_B: </code><code class="cpp keyword bold">return</code> <code class="cpp keyword bold">new</code> <code class="cpp plain">TestMessageB();</code></div><div class="line number21 index20 alt2"><code class="cpp spaces">            </code><code class="cpp keyword bold">case</code> <code class="cpp plain">TEST_MESSAGE_C: </code><code class="cpp keyword bold">return</code> <code class="cpp keyword bold">new</code> <code class="cpp plain">TestMessageC();</code></div><div class="line number22 index21 alt1"><code class="cpp spaces">        </code><code class="cpp plain">}</code></div><div class="line number23 index22 alt2"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number24 index23 alt1"> </div><div class="line number25 index24 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">virtual</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">GetNumTypes() </code><code class="cpp keyword bold">const</code></div><div class="line number26 index25 alt1"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number27 index26 alt2"><code class="cpp spaces">        </code><code class="cpp keyword bold">return</code> <code class="cpp plain">TEST_MESSAGE_NUM_TYPES;</code></div><div class="line number28 index27 alt1"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number29 index28 alt2"><code class="cpp plain">};</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å†æ¬¡é‡ç”³ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å¹¶ä¸”é€šå¸¸æ˜¯è¢«åŒ…è£¹åœ¨å®é‡Œé¢çš„ï¼Œä½†ä¸‹é¢è¦è¯´æ˜çš„å°±æ˜¯å®ƒå…·ä½“æ˜¯æ€ä¹ˆå›äº‹äº†ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="å¯é çš„æœ‰åºæ¶ˆæ¯ç®—æ³•"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å¯é çš„æœ‰åºæ¶ˆæ¯ç®—æ³•</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ç°åœ¨è®©æˆ‘ä»¬æ¥ç€æ‰‹äºå¦‚ä½•åœ¨åº”ç­”ç³»ç»Ÿä¸­å®ç°å¯é æœ‰åºæ¶ˆæ¯çš„ç»†èŠ‚ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å‘é€å¯é æœ‰åºæ¶ˆæ¯çš„ç®—æ³•å¦‚ä¸‹ï¼š</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">å¯¹äºæ¶ˆæ¯å‘é€ï¼š</span></b> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ä½¿ç”¨æµ‹é‡æµæµ‹é‡æ¶ˆæ¯åºåˆ—åŒ–åçš„å¤§å°</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">æ’å…¥æ¶ˆæ¯æŒ‡é’ˆå’Œå®ƒåºåˆ—åŒ–çš„ä½æ•°åˆ°ä¸€ä¸ªåºåˆ—ç¼“å†²åŒºï¼Œå®ƒä»¥æ¶ˆæ¯<span>id</span>ä¸ºç´¢å¼•ã€‚è®¾ç½®æ¶ˆæ¯æœ€åè¢«å‘é€çš„æ—¶é—´ä¸º<span>-1</span></span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">é€’å¢å‘é€çš„æ¶ˆæ¯çš„<span>id</span></span> </li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">å¯¹äºæ•°æ®åŒ…å‘é€ï¼š</span></b> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ä»å·¦<span>-&gt;</span>å³ï¼ˆé€’å¢çš„æ¶ˆæ¯<span>id</span>é¡ºåºï¼‰éå†åœ¨æœ€æ—©çš„æœªåº”ç­”æ¶ˆæ¯<span>id</span>å’Œæœ€æ–°æ’å…¥çš„æ¶ˆæ¯<span>id</span>ä¹‹é—´çš„å‘é€æ¶ˆæ¯åºåˆ—ç¼“å†²åŒºçš„è¿™ç»„æ¶ˆæ¯ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;border:none windowtext 1.0pt;     padding:0cm">è¶…çº§é‡è¦çš„ï¼š</span></b><span style="font-size:12.0pt;     font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;"> </span><span style="font-size:12.0pt;     font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ä¸è¦å‘é€ä¸€ä¸ªæ¥æ”¶æ–¹ä¸èƒ½ç¼“å†²çš„æ¶ˆæ¯<span>id</span>ï¼Œä¸ç„¶ä½ ä¼šç ´åæ¶ˆæ¯çš„åº”ç­”ï¼ˆç”±äºè¿™ä¸ªæ¶ˆæ¯ä¸èƒ½è¢«ç¼“å†²ï¼Œä½†åŒ…å«å®ƒçš„æ•°æ®åŒ…ä¼šè¢«åº”ç­”ï¼Œå‘é€æ–¹å°±ä¼šè®¤ä¸ºè¿™ä¸ªæ¶ˆæ¯å·²ç»è¢«æ¥æ”¶äº†ï¼Œå°±ä¸å†é‡æ–°å‘é€å®ƒäº†ï¼‰ã€‚è¿™æ„å‘³ç€ä½ å¿…é¡»ä¸èƒ½å‘é€ä¸€ä¸ªæ¶ˆæ¯<span>id</span>ç­‰äºæˆ–æ¯”æœ€æ—©çš„æœªåº”ç­”æ¶ˆæ¯çš„<span>id</span>åŠ ä¸Šæ¶ˆæ¯æ¥æ”¶ç¼“å†²åŒºå¤§å°è¦æ–°ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¯¹äºé‚£äº›åœ¨æœ€å<span>0.1</span>ç§’æ²¡æœ‰è¢«å‘é€çš„æ¶ˆæ¯<u><span style="border:none windowtext 1.0pt;     padding:0cm">å¹¶ä¸”</span></u>é€‚åˆæˆ‘ä»¬ç•™åœ¨æ•°æ®åŒ…çš„æœ‰æ•ˆç©ºé—´ï¼Œå°±æŠŠå®ƒè¿½åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨å»å‘é€ã€‚æ ¹æ®è¿­ä»£é¡ºåºå¾—åˆ°ä¼˜å…ˆçº§ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">åŒ…æ‹¬åœ¨å¤–å‘æ•°æ®åŒ…ä¸­çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”è¦ä¸ºæ¯ä¸ªæ¶ˆæ¯æ·»åŠ ä¸€ä¸ªå¼•ç”¨ã€‚ç¡®ä¿æ¯ä¸ªæ•°æ®åŒ…çš„ææ„å‡½æ•°ä¸­å‡äº†å¼•ç”¨è®¡æ•°ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">åœ¨æ•°æ®åŒ…<b><span style="border:none windowtext 1.0pt;padding:0cm">n</span></b>å­˜å‚¨æ¶ˆæ¯çš„æ•°é‡å¹¶ä¸”æ¶ˆæ¯çš„æ ‡è¯†æ•°ç»„åŒ…å«åœ¨ä¸€ä¸ªåºåˆ—ç¼“å†²åŒºçš„æ•°æ®åŒ…ä¸­ï¼Œä»¥å¤–å‘æ•°æ®åŒ…çš„åºåˆ—å·ä¸ºç´¢å¼•ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">æŠŠæ•°æ®åŒ…æ·»åŠ åˆ°æ•°æ®åŒ…å‘é€é˜Ÿåˆ—ã€‚</span> </li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">å¯¹äºæ•°æ®åŒ…æ¥æ”¶ï¼š</span></b> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">éå†åŒ…å«åœ¨æ•°æ®åŒ…ä¸­çš„æ¶ˆæ¯ç»„åˆå¹¶ä¸”æŠŠå®ƒä»¬æ’å…¥åˆ°æ¶ˆæ¯æ¥æ”¶é˜Ÿåˆ—ç¼“å†²åŒºï¼Œä»¥å®ƒä»¬çš„æ¶ˆæ¯<span>id</span>ä¸ºç´¢å¼•ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å‰é¢çš„åº”ç­”ç³»ç»Ÿè‡ªåŠ¨åœ°åº”ç­”æˆ‘ä»¬åˆšåˆšæ”¶åˆ°çš„æ•°æ®åŒ…åºåˆ—å·ã€‚</span> </li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">å¯¹äºæ•°æ®åŒ…åº”ç­”ï¼š</span></b> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ç”¨åºåˆ—å·æŸ¥æ‰¾åŒ…å«åœ¨æ•°æ®åŒ…ä¸­æ¶ˆæ¯ç»„åˆçš„æ ‡è¯†éƒ¨åˆ†ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">ä»æ¶ˆæ¯å‘é€é˜Ÿåˆ—ä¸­ç§»é™¤é‚£äº›å·²ç»å­˜åœ¨çš„æ¶ˆæ¯ï¼Œå¹¶å‡å°‘å®ƒä»¬çš„å¼•ç”¨è®¡æ•°ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">é€šè¿‡ä»å‘é€æ¶ˆæ¯é˜Ÿåˆ—ç¼“å†²åŒºä¸­ä¹‹å‰æœªåº”ç­”æ¶ˆæ¯çš„<span>id</span>çš„è½¬å¯„æ¥æ›´æ–°æœ€åä¸€ä¸ªæœªåº”ç­”çš„æ¶ˆæ¯çš„<span>id</span>ï¼Œç›´åˆ°å‘ç°ä¸€ä¸ªæœ‰æ•ˆçš„æ¶ˆæ¯æ¡ç›®ï¼Œæˆ–è€…ä½ ä¼šåˆ°è¾¾å½“å‰å‘é€æ¶ˆæ¯çš„<span>id</span>ã€‚ä»¥å…ˆåˆ°è€…ä¸ºå‡†ã€‚ </span> </li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">å¯¹äºæ¶ˆæ¯æ¥æ”¶ï¼š</span></b> </p><ol type="1"><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">æ£€æŸ¥æ¥å—æ¶ˆæ¯ç¼“å†²åŒºç¡®ä¿å½“å‰æ”¶åˆ°æ¶ˆæ¯çš„<span>id</span>å¯¹åº”çš„æ¶ˆæ¯æ˜¯å¦å­˜åœ¨ã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¦‚æœæ¶ˆæ¯å­˜åœ¨ï¼Œå°†å®ƒä»æ¶ˆæ¯é˜Ÿåˆ—ç¼“å†²åŒºä¸­ç§»é™¤ï¼Œé€’å¢æ¥æ”¶æ¶ˆæ¯çš„<span>id</span>å¹¶ç»™è¿™ä¸ªæ¶ˆæ¯è¿”å›ä¸€ä¸ªæŒ‡é’ˆã€‚</span> </li><li class="MsoNormal" style="color:#222222;text-align:left;vertical-align:baseline"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;">å¦‚æœå¦ï¼Œå°±æ˜¯æ²¡æœ‰æœ‰æ•ˆçš„æ¶ˆæ¯å¯æ¥æ”¶ã€‚è¿”å›<b><span style="border:none windowtext 1.0pt;padding:0cm">NULL</span></b>ã€‚</span> </li></ol><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ€»ä¹‹ï¼Œæ¶ˆæ¯è¦ä¿æŒè¢«åŒ…å«åœ¨æ•°æ®åŒ…ä¸­ç›´åˆ°è¿™ä¸ªæ•°æ®åŒ…åŒ…å«çš„æ¶ˆæ¯å¾—åˆ°åº”ç­”ã€‚æˆ‘ä»¬åœ¨å‘é€è€…æ–¹ä½¿ç”¨ä¸€ä¸ªæ•°æ®ç»“æ„æ¥ç»™æ¶ˆæ¯æ ‡è¯†çš„ç»„åˆæ˜ å°„æ•°æ®åŒ…åºåˆ—å·ä»¥ä¾¿åº”ç­”ã€‚å½“æ¶ˆæ¯è¢«åº”ç­”æ—¶ï¼Œè¦ä»å‘é€é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚å¯¹äºæ¥æ”¶æ–¹ï¼Œä»¥ä¹±åºåˆ°è¾¾çš„æ¶ˆæ¯ä¼šè¢«å­˜å‚¨åœ¨ä¸€ä¸ªåºåˆ—ç¼“å†²åŒºï¼Œå¹¶ä»¥æ¶ˆæ¯<span>id</span>ä¸ºç´¢å¼•ï¼Œè¿™ä¸ª<span>id</span>ä¼šè®©æˆ‘ä»¬ä»¥å®ƒä»¬è¢«å‘é€çš„é¡ºåºæ¥æ”¶å®ƒä»¬ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><br></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"></p><h2 id="æœ€ç»ˆçš„ç»“æœ"><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æœ€ç»ˆçš„ç»“æœ</span></h2> <p></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">åœ¨å‘é€æ–¹ï¼Œè¿™ä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªåƒè¿™æ ·çš„æ¥å£ï¼š</span></p><div><div id="highlighter_731637" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">TestMessage <em> message = (TestMessage</em>) factory.Create( TEST_MESSAGE );</code></div><div class="line number2 index1 alt1"><code class="cpp keyword bold">if</code> <code class="cpp plain">( message )</code></div><div class="line number3 index2 alt2"><code class="cpp plain">{</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp plain">message-&gt;a = 1;</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">    </code><code class="cpp plain">message-&gt;b = 2;</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">    </code><code class="cpp plain">message-&gt;c = 3;</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">    </code><code class="cpp plain">connection.SendMessage( message );</code></div><div class="line number8 index7 alt1"><code class="cpp plain">}</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">è¿˜æœ‰åœ¨æ¥æ”¶æ–¹ï¼š</span></p><div><div id="highlighter_315020" class="syntaxhighlighter  cpp"><div class="toolbar"><a class="toolbar_item command_help help">?</a></div><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">while</code> <code class="cpp plain">( </code><code class="cpp keyword bold">true</code> <code class="cpp plain">)</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">    </code><code class="cpp plain">Message <em> message = connection.ReceiveMessage();</em></code></div><div class="line number4 index3 alt1"><code class="cpp spaces">    </code><code class="cpp keyword bold">if</code> <code class="cpp plain">( !message )</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">        </code><code class="cpp keyword bold">break</code><code class="cpp plain">;</code></div><div class="line number6 index5 alt1"> </div><div class="line number7 index6 alt2"><code class="cpp spaces">    </code><code class="cpp keyword bold">if</code> <code class="cpp plain">( message-&gt;GetType() == TEST_MESSAGE )</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">    </code><code class="cpp plain">{</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">        </code><code class="cpp plain">TestMessage  testMessage = (TestMessage*) message;</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">        </code><code class="cpp comments">// process test message</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">    </code><code class="cpp plain">}</code></div><div class="line number12 index11 alt1"> </div><div class="line number13 index12 alt2"><code class="cpp spaces">    </code><code class="cpp plain">factory.Release( message );</code></div><div class="line number14 index13 alt1"><code class="cpp plain">}</code></div></div></td></tr></table></div></div><p class="MsoNormal" align="left" style="vertical-align: baseline;"><br></p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå®ƒå·²ç»æ˜¯ç®€å•å¾—ä¸èƒ½å†ç®€å•äº†ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">å¦‚æœè¿™å‡ ä¸ªæ¥å£æœ‰å¼•èµ·ä½ çš„å…´è¶£ï¼Œè¯·çœ‹çœ‹æˆ‘çš„æ–°å¼€æºåº“<span> <a rel="noopener" href="https://github.com/networkprotocol/libyojimbo" target="_blank"><span style="color:#DD3333">libyojimbo</span></a></span>ã€‚</span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">æˆ‘å¸Œæœ›ä½ åˆ°ç°åœ¨ä¸ºæ­¢å¯¹è¿™ä¸ªç³»åˆ—çš„æ–‡ç« æ˜¯äº«å—çš„<span><a rel="noopener" href="http://www.patreon.com/gafferongames" target="_blank"><span style="color:#DD3333"><span>è¯·åœ¨ patreon</span></span><span style="color:#DD3333"><span>ä¸Šæ”¯æŒæˆ‘çš„å†™ä½œ</span></span></a></span>ï¼Œå¹¶ä¸”æˆ‘å°†æ›´å¿«å†™æ–°çš„æ–‡ç« ï¼Œå†è€…ä½ ä¼šåœ¨åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡è½¯ä»¶çš„å¼€æºè®¸å¯è¯ä¸‹è·å¾—è¿™ç¯‡æ–‡ç« çš„ç¤ºä¾‹æºä»£ç ã€‚<b><u><span style="border:none windowtext 1.0pt;padding:0cm">è°¢è°¢ä½ çš„æ”¯æŒï¼</span></u></b></span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;Lucida Sans Unicode&quot;,&quot;sans-serif&quot;;color:#222222"> </span> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><b><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222;border:none windowtext 1.0pt;padding:0cm">å³å°†åˆ°æ¥ï¼š</span></b><b><span style="font-size:18.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222"><a rel="noopener" href="http://gafferongames.com/building-a-game-network-protocol/client-server-connection/" target="_blank"><span style="color:#DD3333"><span>å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„è¿æ¥</span></span></a></span></b> </p><p class="MsoNormal" align="left" style="vertical-align: baseline;"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">åœ¨<span>â€œ</span>åˆ›å»ºä¸€ä¸ªæ¸¸æˆç½‘ç»œåè®®<span>â€</span>çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¼šå±•ç¤ºä½ å¦‚ä½•åœ¨<span>UDP</span>ä¹‹ä¸Šåˆ›å»ºä½ è‡ªå·±çš„å®¢æˆ·ç«¯<span>/</span>æœåŠ¡å™¨è¿æ¥å±‚ï¼Œå®ƒä¼šå®ç°æŒ‘æˆ˜<span>/</span>å“åº”ï¼Œä¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ†é…å®¢æˆ·ç«¯æ’æ§½ï¼Œå½“æœåŠ¡å™¨çˆ†æ»¡æˆ–æ£€æµ‹è¶…æ—¶å°±æ‹’ç»å®¢æˆ·ç«¯çš„è¿æ¥ã€‚</span> </p><p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;"> </span> </p><p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;"> </span> </p><p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">ã€ç‰ˆæƒå£°æ˜ã€‘</span> </p><p class="MsoNormal"><span style="font-size:12.0pt;font-family:&quot;å¾®è½¯é›…é»‘&quot;,&quot;sans-serif&quot;;color:#222222">åŸæ–‡ä½œè€…æœªåšæƒåˆ©å£°æ˜ï¼Œè§†ä¸ºå…±äº«çŸ¥è¯†äº§æƒè¿›å…¥å…¬å…±é¢†åŸŸï¼Œè‡ªåŠ¨è·å¾—æˆæƒï¼›</span> </p><p class="MsoNormal"><span> </span> </p></div>                    <br>                

      


      

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/GafferOnGames/" rel="tag"><i class="fa fa-tag"></i> GafferOnGames</a>
            
          </div>
        

        
        
        

        
          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/ssl_tls_illustrated/" rel="next" title="SSL/TLSè¯¦è§£">
                  <i class="fa fa-chevron-left"></i> 
                  <p class="post-nav-pre-next-title">
                    SSL/TLSè¯¦è§£
                  </p> 
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/kbe_note_one/" rel="prev" title="kbeæœåŠ¡ç«¯ç¬”è®°(ä¸€)">
                <p class="post-nav-pre-next-title">
                    kbeæœåŠ¡ç«¯ç¬”è®°(ä¸€)
                </p> 
                <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        

        
        
      </footer>
      
    </div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  

  <aside id="sidebar" class="sidebar">

    
      
        <div id="sidebar-dimmer"></div>
      
    

    <div class="sidebar-inner">
    
      <div class="sidebar-toggle-inside motion-element">
        <div class="sidebar-toggle-line-wrap">
          <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
          <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
          <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
        </div>
      </div>

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a href="/" class="site-author-image" rel="start" style="border:none">
            <img class="site-author-image" itemprop="image" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA4MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0zNSAyNUg0NVYzNUgzNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+" data-src="/uploads/avatar.png" alt="Mike">
          </a>
          <p class="site-author-name" itemprop="name">Mike</p>
           
              <p class="site-description motion-element" itemprop="description">ğŸš™ ğŸš— ğŸ’¨ ğŸ’¨ If you want to create a blog like this, just follow my open-source project, "hexo-theme-neo", click the GitHub button below and check it out ^_^ . It is recommended to use Chrome, Safari, or Edge to read this blog since this blog was developed on Edge (Chromium kernel version) and tested on Safari.</p>
          
        </div>

        <nav class="site-state motion-element">

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">298</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">111</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

          <div class="site-state-item site-state-about">
            <a href="/about/">
              <span class="site-state-item-about fa fa-fw fa-user"></span>
              <span class="site-state-item-name">about</span>
            </a>
          </div>
          
        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/no5ix" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://open.spotify.com/user/313duq77ekebrfyak3xijqewzss4?si=e7653b829a9747bf" target="_blank" title="Spotify">
                  
                    <i class="fa fa-fw fa-spotify"></i>
                  
                    
                      Spotify
                    
                </a>
              </span>
            
          
          
          <!-- ç½‘æ˜“äº‘éŸ³ä¹ -->
            <!-- <div class="netease-cloud-music"> -->
              <!-- <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=280 height=110 src="//music.163.com/outchain/player?type=0&id=992743594&auto=0&height=90"></iframe> -->
            <!-- </div> -->
          <!-- ç½‘æ˜“äº‘éŸ³ä¹ -->

        </div>

        
        

        
        

        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“"><span class="nav-text">æœ¬ç¯‡è‡ªæˆ‘æ€»ç»“</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå¯é UDPåè®®"><span class="nav-text">ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªå¯é UDPåè®®</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åº”ç­”ç³»ç»Ÿæ˜¯å®ç°å¯é UDPçš„æœ€é‡è¦çš„éƒ¨åˆ†"><span class="nav-text">åº”ç­”ç³»ç»Ÿæ˜¯å®ç°å¯é UDPçš„æœ€é‡è¦çš„éƒ¨åˆ†</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‘é€æ–¹å¦‚ä½•è¿½è¸ªæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«åº”ç­”"><span class="nav-text">å‘é€æ–¹å¦‚ä½•è¿½è¸ªæ•°æ®åŒ…æ˜¯å¦å·²ç»è¢«åº”ç­”</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#åŸæ–‡"><span class="nav-text">åŸæ–‡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#introduction"><span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#different-approaches"><span class="nav-text">Different Approaches</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#packet-level-acks"><span class="nav-text">Packet Level Acks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sequence-buffers"><span class="nav-text">Sequence Buffers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ack-algorithm"><span class="nav-text">Ack Algorithm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#message-objects"><span class="nav-text">Message Objects</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reliable-ordered-message-algorithm"><span class="nav-text">Reliable Ordered Message Algorithm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#the-end-result"><span class="nav-text">The End Result</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#è¯‘æ–‡"><span class="nav-text">è¯‘æ–‡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#è¯´æ˜"><span class="nav-text">è¯´æ˜</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸åŒçš„æ–¹æ³•"><span class="nav-text">ä¸åŒçš„æ–¹æ³•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ•°æ®åŒ…å±‚çº§åº”ç­”"><span class="nav-text">æ•°æ®åŒ…å±‚çº§åº”ç­”</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åºåˆ—ç¼“å†²åŒº"><span class="nav-text">åºåˆ—ç¼“å†²åŒº</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åº”ç­”ç®—æ³•"><span class="nav-text">åº”ç­”ç®—æ³•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ¶ˆæ¯å¯¹è±¡"><span class="nav-text">æ¶ˆæ¯å¯¹è±¡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¯é çš„æœ‰åºæ¶ˆæ¯ç®—æ³•"><span class="nav-text">å¯é çš„æœ‰åºæ¶ˆæ¯ç®—æ³•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ€ç»ˆçš„ç»“æœ"><span class="nav-text">æœ€ç»ˆçš„ç»“æœ</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mike</span>
</div>



        

        
      </div>
    </footer>

    <!--
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      
        <span id="scrollpercent"><span>0</span>%</span>
      
    </div>
    -->

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>










  















  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/mediumzoom/medium-zoom.js?v=1.1.0"></script>





  




  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>


  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

    <script src="/js/src/local-search.js"></script>





  

  

  

  

  

  


  <script type="text/javascript" src="/lib/wobble_window/wobblewindow.js"> </script>
<script type="text/javascript" src="/js/src/custom.js"></script>
</body>
</html>






<script type="text/javascript" src="/js/src/headroom.js"></script>

<!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½ -->
<script type="text/javascript" src="/js/src/code-highlight-modification.js"></script>

<!-- Flashcards Script -->
<script type="text/javascript" src="/js/src/flashcards.js"></script>
